<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Resume Studio - Career Clarified</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- File Parsing Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .resume-preview {
            background: white;
            color: #1f2937;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // ============================================
        // UTILITY FUNCTIONS & HELPERS
        // ============================================

        // API Utilities
        const APIUtils = {
            validateAPIKey(apiKey) {
                if (!apiKey || typeof apiKey !== 'string') {
                    return { valid: false, error: 'API key is required' };
                }
                if (apiKey.length < 20) {
                    return { valid: false, error: 'API key appears to be invalid (too short)' };
                }
                if (!apiKey.startsWith('sk-')) {
                    return { valid: false, error: 'API key should start with "sk-"' };
                }
                return { valid: true };
            },
            
            getAPIKey() {
                const apiKey = localStorage.getItem('openai_api_key');
                const validation = this.validateAPIKey(apiKey);
                if (!validation.valid) {
                    throw new Error(validation.error || 'OpenAI API key not found. Please set it in Settings.');
                }
                return apiKey;
            },
            
            async retryWithBackoff(fn, maxRetries = 3, initialDelay = 1000) {
                let lastError;
                for (let attempt = 0; attempt < maxRetries; attempt++) {
                    try {
                        return await fn();
                    } catch (error) {
                        lastError = error;
                        if (attempt < maxRetries - 1) {
                            const delay = initialDelay * Math.pow(2, attempt);
                            await new Promise(resolve => setTimeout(resolve, delay));
                        }
                    }
                }
                throw lastError;
            },
            
            async callOpenAI(messages, model = 'gpt-4o-mini', options = {}) {
                const apiKey = this.getAPIKey();
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model,
                        messages,
                        max_tokens: options.maxTokens || 2000,
                        temperature: options.temperature || 0.7,
                        ...options
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: { message: 'Unknown error' } }));
                    throw new Error(errorData.error?.message || `API error: ${response.status}`);
                }
                
                return await response.json();
            }
        };

        // Resume Studio Storage (compatible with existing system)
        const ResumeStudioStorage = {
            storageKey: 'resume_studio_resumes',
            versionsKey: 'resume_studio_versions',
            templatesKey: 'resume_studio_templates',
            exportSettingsKey: 'resume_studio_export_settings',
            
            generateId() {
                return `resume-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            },
            
            getAllResumes() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error loading resumes:', error);
                    return [];
                }
            },
            
            saveResume(resumeId, data) {
                try {
                    const resumes = this.getAllResumes();
                    const resume = {
                        id: resumeId || this.generateId(),
                        ...data,
                        updatedAt: new Date().toISOString(),
                        createdAt: data.createdAt || new Date().toISOString()
                    };
                    
                    const existingIndex = resumes.findIndex(r => r.id === resume.id);
                    if (existingIndex >= 0) {
                        resumes[existingIndex] = resume;
                    } else {
                        resumes.push(resume);
                    }
                    
                    localStorage.setItem(this.storageKey, JSON.stringify(resumes));
                    this.saveVersion(resume.id, resume);
                    return resume;
                } catch (error) {
                    console.error('Error saving resume:', error);
                    throw error;
                }
            },
            
            loadResume(resumeId) {
                try {
                    const resumes = this.getAllResumes();
                    return resumes.find(r => r.id === resumeId) || null;
                } catch (error) {
                    console.error('Error loading resume:', error);
                    return null;
                }
            },
            
            deleteResume(resumeId) {
                try {
                    const resumes = this.getAllResumes();
                    const filtered = resumes.filter(r => r.id !== resumeId);
                    localStorage.setItem(this.storageKey, JSON.stringify(filtered));
                    
                    const allVersions = JSON.parse(localStorage.getItem(this.versionsKey) || '{}');
                    delete allVersions[resumeId];
                    localStorage.setItem(this.versionsKey, JSON.stringify(allVersions));
                    
                    return true;
                } catch (error) {
                    console.error('Error deleting resume:', error);
                    return false;
                }
            },
            
            duplicateResume(resumeId, newName) {
                try {
                    const original = this.loadResume(resumeId);
                    if (!original) return null;
                    
                    const duplicate = {
                        ...original,
                        id: this.generateId(),
                        name: newName || `${original.name} (Copy)`,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    delete duplicate.versions;
                    return this.saveResume(duplicate.id, duplicate);
                } catch (error) {
                    console.error('Error duplicating resume:', error);
                    return null;
                }
            },
            
            saveVersion(resumeId, resumeData) {
                try {
                    const allVersions = JSON.parse(localStorage.getItem(this.versionsKey) || '{}');
                    if (!allVersions[resumeId]) {
                        allVersions[resumeId] = [];
                    }
                    
                    const version = {
                        version: allVersions[resumeId].length + 1,
                        data: { ...resumeData },
                        timestamp: new Date().toISOString(),
                        description: `Auto-saved version ${allVersions[resumeId].length + 1}`
                    };
                    
                    allVersions[resumeId].push(version);
                    
                    if (allVersions[resumeId].length > 50) {
                        allVersions[resumeId] = allVersions[resumeId].slice(-50);
                    }
                    
                    localStorage.setItem(this.versionsKey, JSON.stringify(allVersions));
                    return version;
                } catch (error) {
                    console.error('Error saving version:', error);
                    return null;
                }
            },
            
            getVersions(resumeId) {
                try {
                    const allVersions = JSON.parse(localStorage.getItem(this.versionsKey) || '{}');
                    return allVersions[resumeId] || [];
                } catch (error) {
                    console.error('Error loading versions:', error);
                    return [];
                }
            },
            
            restoreVersion(resumeId, versionNumber) {
                try {
                    const versions = this.getVersions(resumeId);
                    const version = versions.find(v => v.version === versionNumber);
                    if (version) {
                        this.saveResume(resumeId, version.data);
                        return version.data;
                    }
                    return null;
                } catch (error) {
                    console.error('Error restoring version:', error);
                    return null;
                }
            }
        };

        // File Parsing Utilities
        const FileParserUtils = {
            async extractTextFromPDF(file) {
                try {
                    // Check if PDF.js is available
                    if (typeof pdfjsLib === 'undefined') {
                        throw new Error('PDF.js library not loaded. Please refresh the page.');
                    }

                    // Set worker source if needed
                    if (pdfjsLib.GlobalWorkerOptions) {
                        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    }

                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    
                    let fullText = '';
                    
                    // Extract text from all pages
                    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                        const page = await pdf.getPage(pageNum);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + '\n';
                    }
                    
                    return fullText.trim();
                } catch (error) {
                    console.error('Error extracting PDF text:', error);
                    throw new Error(`Failed to parse PDF: ${error.message}. Please ensure the file is not corrupted or password-protected.`);
                }
            },
            
            async extractTextFromDOCX(file) {
                try {
                    // Check if mammoth is available
                    if (typeof mammoth === 'undefined') {
                        throw new Error('Mammoth.js library not loaded. Please refresh the page.');
                    }

                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer: arrayBuffer });
                    
                    return result.value;
                } catch (error) {
                    console.error('Error extracting DOCX text:', error);
                    throw new Error(`Failed to parse DOCX: ${error.message}. Please ensure the file is not corrupted.`);
                }
            },
            
            async extractTextFromFile(file) {
                if (file.type === 'application/pdf') {
                    return await this.extractTextFromPDF(file);
                } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || 
                           file.type === 'application/msword') {
                    return await this.extractTextFromDOCX(file);
                } else if (file.type === 'text/plain') {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => resolve(e.target.result);
                        reader.onerror = () => reject(new Error('Failed to read text file'));
                        reader.readAsText(file);
                    });
                } else {
                    throw new Error(`Unsupported file type: ${file.type}. Please upload a PDF, DOCX, or TXT file.`);
                }
            },
            
            // Parse resume text and extract structured data
            parseResumeText(text) {
                const lines = text.split('\n').map(line => line.trim()).filter(line => line);
                const resumeData = createDefaultResume('Imported Resume');
                
                let currentSection = null;
                let currentExperience = null;
                let currentEducation = null;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    const lowerLine = line.toLowerCase();
                    
                    // Detect sections
                    if (lowerLine.includes('name') && !resumeData.personalInfo.name) {
                        const nameMatch = line.match(/name[:\s]+(.+)/i);
                        if (nameMatch) resumeData.personalInfo.name = nameMatch[1].trim();
                        currentSection = 'personal';
                    } else if (lowerLine.includes('email') && !resumeData.personalInfo.email) {
                        const emailMatch = line.match(/email[:\s]+(.+)/i) || line.match(/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/);
                        if (emailMatch) resumeData.personalInfo.email = emailMatch[1].trim();
                    } else if (lowerLine.includes('phone') && !resumeData.personalInfo.phone) {
                        const phoneMatch = line.match(/phone[:\s]+(.+)/i) || line.match(/([\d\s\+\-\(\)]+)/);
                        if (phoneMatch) resumeData.personalInfo.phone = phoneMatch[1].trim();
                    } else if (lowerLine.includes('summary') || lowerLine.includes('objective') || lowerLine.includes('profile')) {
                        currentSection = 'summary';
                        resumeData.summary = '';
                    } else if (lowerLine.includes('experience') || lowerLine.includes('employment') || lowerLine.includes('work history')) {
                        currentSection = 'experience';
                        currentExperience = null;
                    } else if (lowerLine.includes('education')) {
                        currentSection = 'education';
                        currentEducation = null;
                    } else if (lowerLine.includes('skills')) {
                        currentSection = 'skills';
                    } else {
                        // Process content based on current section
                        if (currentSection === 'summary' && line.length > 10) {
                            resumeData.summary += (resumeData.summary ? ' ' : '') + line;
                        } else if (currentSection === 'experience') {
                            // Try to detect job entries (dates, positions, companies)
                            const datePattern = /\d{4}|\w+\s+\d{4}|present|current/i;
                            if (datePattern.test(line) && line.length < 30) {
                                // Might be a date line, start new experience
                                if (currentExperience && currentExperience.position) {
                                    resumeData.experience.push(currentExperience);
                                }
                                currentExperience = {
                                    id: `exp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                                    position: '',
                                    company: '',
                                    startDate: '',
                                    endDate: '',
                                    description: ''
                                };
                                // Try to extract dates
                                const dates = line.match(/(\w+\s+\d{4}|\d{4})/gi);
                                if (dates) {
                                    currentExperience.startDate = dates[0] || '';
                                    currentExperience.endDate = dates[1] || (lowerLine.includes('present') || lowerLine.includes('current') ? 'Present' : '');
                                }
                            } else if (currentExperience && line.length > 5 && !line.includes('•') && !line.includes('-')) {
                                // Likely position or company
                                if (!currentExperience.position) {
                                    currentExperience.position = line;
                                } else if (!currentExperience.company) {
                                    currentExperience.company = line;
                                }
                            } else if (currentExperience && (line.includes('•') || line.includes('-') || line.includes('·'))) {
                                // Bullet point for description
                                const bulletText = line.replace(/^[•\-\·]\s*/, '').trim();
                                currentExperience.description += (currentExperience.description ? '\n' : '') + bulletText;
                            }
                        } else if (currentSection === 'education') {
                            // Similar logic for education
                            const datePattern = /\d{4}/;
                            if (datePattern.test(line) && line.length < 30) {
                                if (currentEducation && currentEducation.degree) {
                                    resumeData.education.push(currentEducation);
                                }
                                currentEducation = {
                                    id: `edu-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                                    institution: '',
                                    degree: '',
                                    field: '',
                                    graduationDate: line.match(/\d{4}/)?.[0] || ''
                                };
                            } else if (currentEducation && line.length > 3) {
                                if (!currentEducation.degree) {
                                    currentEducation.degree = line;
                                } else if (!currentEducation.institution) {
                                    currentEducation.institution = line;
                                } else if (!currentEducation.field && (line.toLowerCase().includes('science') || line.toLowerCase().includes('engineering') || line.toLowerCase().includes('art'))) {
                                    currentEducation.field = line;
                                }
                            }
                        } else if (currentSection === 'skills') {
                            // Extract skills (comma-separated or bullet points)
                            const skills = line.split(/[,;•\-\·]/).map(s => s.trim()).filter(s => s.length > 0);
                            skills.forEach(skill => {
                                if (skill.length > 1 && skill.length < 30) {
                                    const lowerSkill = skill.toLowerCase();
                                    if (lowerSkill.includes('javascript') || lowerSkill.includes('python') || lowerSkill.includes('java') || 
                                        lowerSkill.includes('react') || lowerSkill.includes('sql') || lowerSkill.includes('html') ||
                                        lowerSkill.match(/^[a-z]+$/i)) {
                                        resumeData.skills.technical.push(skill);
                                    } else {
                                        resumeData.skills.soft.push(skill);
                                    }
                                }
                            });
                        }
                    }
                }
                
                // Push last experience/education if exists
                if (currentExperience && currentExperience.position) {
                    resumeData.experience.push(currentExperience);
                }
                if (currentEducation && currentEducation.degree) {
                    resumeData.education.push(currentEducation);
                }
                
                return resumeData;
            }
        };

        // ATS Scoring Algorithm
        const ATSScoring = {
            calculateScore(resumeData, jobDescription = '') {
                let score = 0;
                const factors = {};
                
                // Personal Info completeness (10 points)
                const personalInfo = resumeData.personalInfo || {};
                const hasName = !!personalInfo.name;
                const hasEmail = !!personalInfo.email;
                const hasPhone = !!personalInfo.phone;
                const hasLocation = !!personalInfo.location;
                factors.personalInfo = (hasName + hasEmail + hasPhone + hasLocation) / 4 * 10;
                score += factors.personalInfo;
                
                // Summary presence (10 points)
                factors.summary = resumeData.summary && resumeData.summary.length > 50 ? 10 : 0;
                score += factors.summary;
                
                // Experience quality (30 points)
                const experience = resumeData.experience || [];
                factors.experience = Math.min(experience.length * 6, 30);
                score += factors.experience;
                
                // Education presence (10 points)
                const education = resumeData.education || [];
                factors.education = education.length > 0 ? 10 : 0;
                score += factors.education;
                
                // Skills presence (10 points)
                const skills = resumeData.skills || {};
                const allSkills = [
                    ...(skills.technical || []),
                    ...(skills.soft || []),
                    ...(skills.languages || [])
                ];
                factors.skills = Math.min(allSkills.length * 2, 10);
                score += factors.skills;
                
                // Keyword matching (30 points)
                if (jobDescription) {
                    const jobKeywords = this.extractKeywords(jobDescription.toLowerCase());
                    const resumeText = this.getResumeText(resumeData).toLowerCase();
                    const matchedKeywords = jobKeywords.filter(keyword => resumeText.includes(keyword));
                    factors.keywords = (matchedKeywords.length / jobKeywords.length) * 30;
                    score += factors.keywords;
                } else {
                    factors.keywords = 0;
                }
                
                return {
                    overall: Math.round(Math.min(score, 100)),
                    breakdown: factors
                };
            },
            
            extractKeywords(text) {
                // Simple keyword extraction - in production, use more sophisticated NLP
                const words = text.split(/\s+/);
                const commonWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'is', 'are', 'was', 'were'];
                return words.filter(word => 
                    word.length > 3 && 
                    !commonWords.includes(word.toLowerCase()) &&
                    /^[a-zA-Z]+$/.test(word)
                ).slice(0, 50);
            },
            
            getResumeText(resumeData) {
                let text = '';
                if (resumeData.personalInfo) {
                    text += Object.values(resumeData.personalInfo).join(' ') + ' ';
                }
                text += (resumeData.summary || '') + ' ';
                (resumeData.experience || []).forEach(exp => {
                    text += (exp.position || '') + ' ' + (exp.company || '') + ' ' + (exp.description || '') + ' ';
                });
                (resumeData.skills?.technical || []).forEach(skill => text += skill + ' ');
                return text;
            }
        };

        // ============================================
        // DEFAULT RESUME DATA STRUCTURE
        // ============================================

        const createDefaultResume = (name = 'Untitled Resume') => ({
            id: ResumeStudioStorage.generateId(),
            name,
            type: 'master',
            personalInfo: {
                name: '',
                email: '',
                phone: '',
                location: '',
                linkedIn: '',
                portfolio: '',
                github: ''
            },
            summary: '',
            experience: [],
            education: [],
            skills: {
                technical: [],
                soft: [],
                languages: []
            },
            certifications: [],
            projects: [],
            templateId: 'modern',
            customizations: {
                primaryColor: '#3b82f6',
                secondaryColor: '#1e40af',
                fontFamily: 'Inter',
                fontSize: '11pt',
                spacing: 'normal'
            },
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            metadata: {
                atsScore: 0
            }
        });

        // ============================================
        // MAIN APPLICATION COMPONENT
        // ============================================

        const App = () => {
            const [view, setView] = useState('manager'); // 'manager', 'editor', 'wizard', 'upload'
            const [currentResume, setCurrentResume] = useState(null);
            const [resumes, setResumes] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            useEffect(() => {
                loadResumes();
            }, []);

            const loadResumes = () => {
                const loadedResumes = ResumeStudioStorage.getAllResumes();
                setResumes(loadedResumes);
            };

            const handleCreateNew = () => {
                const newResume = createDefaultResume();
                setCurrentResume(newResume);
                setView('editor');
            };

            const handleCreateFromScratch = () => {
                setView('wizard');
            };

            const handleUploadResume = () => {
                setView('upload');
            };

            const handleEditResume = (resumeId) => {
                const resume = ResumeStudioStorage.loadResume(resumeId);
                if (resume) {
                    setCurrentResume(resume);
                    setView('editor');
                }
            };

            const handleDeleteResume = (resumeId) => {
                if (window.confirm('Are you sure you want to delete this resume?')) {
                    ResumeStudioStorage.deleteResume(resumeId);
                    loadResumes();
                    if (currentResume?.id === resumeId) {
                        setCurrentResume(null);
                        setView('manager');
                    }
                }
            };

            const handleDuplicateResume = (resumeId) => {
                const duplicated = ResumeStudioStorage.duplicateResume(resumeId);
                if (duplicated) {
                    loadResumes();
                }
            };

            const handleSaveResume = (resume) => {
                try {
                    ResumeStudioStorage.saveResume(resume.id, resume);
                    setCurrentResume(resume);
                    loadResumes();
                    setError(null);
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleBackToManager = () => {
                setView('manager');
                setCurrentResume(null);
                setError(null);
            };

            if (view === 'manager') {
                return <ResumeManager 
                    resumes={resumes}
                    onCreateNew={handleCreateNew}
                    onCreateFromScratch={handleCreateFromScratch}
                    onUploadResume={handleUploadResume}
                    onEditResume={handleEditResume}
                    onDeleteResume={handleDeleteResume}
                    onDuplicateResume={handleDuplicateResume}
                    onBack={() => window.parent.postMessage('navigate-to-dashboard', '*')}
                />;
            }

            if (view === 'editor' && currentResume) {
                return <ResumeEditor
                    resume={currentResume}
                    onSave={handleSaveResume}
                    onBack={handleBackToManager}
                />;
            }

            if (view === 'wizard') {
                return <ResumeWizard
                    onComplete={(resume) => {
                        setCurrentResume(resume);
                        setView('editor');
                    }}
                    onBack={handleBackToManager}
                />;
            }

            if (view === 'upload') {
                return <ResumeUploader
                    onComplete={(resume) => {
                        setCurrentResume(resume);
                        setView('editor');
                    }}
                    onBack={handleBackToManager}
                />;
            }

            return null;
        };

        // ============================================
        // RESUME MANAGER COMPONENT
        // ============================================

        const ResumeManager = ({ resumes, onCreateNew, onCreateFromScratch, onUploadResume, onEditResume, onDeleteResume, onDuplicateResume, onBack }) => {
            const masterResumes = resumes.filter(r => r.type === 'master');
            const campaignResumes = resumes.filter(r => r.type === 'campaign');

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="mb-8">
                            <button
                                onClick={onBack}
                                className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4 transition-colors"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                                </svg>
                                Back to Dashboard
                            </button>
                            <h1 className="text-4xl font-bold text-gray-900 mb-2">Smart Resume Studio</h1>
                            <p className="text-lg text-gray-600">Create, edit, and optimize your resumes with AI assistance</p>
                        </div>

                        {/* Action Buttons */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <button
                                onClick={onCreateNew}
                                className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all text-left group border-2 border-transparent hover:border-blue-500"
                            >
                                <div className="flex items-center gap-4 mb-3">
                                    <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-500 transition-colors">
                                        <svg className="w-6 h-6 text-blue-600 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                        </svg>
                                    </div>
                                    <h3 className="text-xl font-semibold text-gray-900">Create New Resume</h3>
                                </div>
                                <p className="text-gray-600">Start building your resume from scratch</p>
                            </button>

                            <button
                                onClick={onCreateFromScratch}
                                className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all text-left group border-2 border-transparent hover:border-green-500"
                            >
                                <div className="flex items-center gap-4 mb-3">
                                    <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center group-hover:bg-green-500 transition-colors">
                                        <svg className="w-6 h-6 text-green-600 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                    </div>
                                    <h3 className="text-xl font-semibold text-gray-900">Guided Builder</h3>
                                </div>
                                <p className="text-gray-600">Step-by-step wizard with AI guidance</p>
                            </button>

                            <button
                                onClick={onUploadResume}
                                className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all text-left group border-2 border-transparent hover:border-purple-500"
                            >
                                <div className="flex items-center gap-4 mb-3">
                                    <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center group-hover:bg-purple-500 transition-colors">
                                        <svg className="w-6 h-6 text-purple-600 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                    </div>
                                    <h3 className="text-xl font-semibold text-gray-900">Upload Resume</h3>
                                </div>
                                <p className="text-gray-600">Import and optimize existing resume</p>
                            </button>
                        </div>

                        {/* Resumes List */}
                        {resumes.length === 0 ? (
                            <div className="bg-white rounded-xl p-12 text-center shadow-lg">
                                <svg className="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <h3 className="text-xl font-semibold text-gray-900 mb-2">No Resumes Yet</h3>
                                <p className="text-gray-600 mb-6">Get started by creating your first resume</p>
                                <button
                                    onClick={onCreateNew}
                                    className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition-colors"
                                >
                                    Create Your First Resume
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                {masterResumes.length > 0 && (
                                    <div>
                                        <h2 className="text-2xl font-bold text-gray-900 mb-4">Master Resumes</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {masterResumes.map(resume => (
                                                <ResumeCard
                                                    key={resume.id}
                                                    resume={resume}
                                                    onEdit={() => onEditResume(resume.id)}
                                                    onDelete={() => onDeleteResume(resume.id)}
                                                    onDuplicate={() => onDuplicateResume(resume.id)}
                                                />
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {campaignResumes.length > 0 && (
                                    <div>
                                        <h2 className="text-2xl font-bold text-gray-900 mb-4">Campaign Resumes</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {campaignResumes.map(resume => (
                                                <ResumeCard
                                                    key={resume.id}
                                                    resume={resume}
                                                    onEdit={() => onEditResume(resume.id)}
                                                    onDelete={() => onDeleteResume(resume.id)}
                                                    onDuplicate={() => onDuplicateResume(resume.id)}
                                                />
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Resume Card Component
        const ResumeCard = ({ resume, onEdit, onDelete, onDuplicate }) => {
            const atsScore = resume.metadata?.atsScore || 0;
            const updatedDate = new Date(resume.updatedAt).toLocaleDateString();

            return (
                <div className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all">
                    <div className="flex items-start justify-between mb-4">
                        <div className="flex-1">
                            <h3 className="text-lg font-semibold text-gray-900 mb-1">{resume.name}</h3>
                            <p className="text-sm text-gray-500">{resume.type === 'master' ? 'Master Resume' : 'Campaign Resume'}</p>
                        </div>
                        <div className="flex gap-2">
                            <button
                                onClick={onEdit}
                                className="p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                title="Edit"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </button>
                            <button
                                onClick={onDuplicate}
                                className="p-2 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors"
                                title="Duplicate"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                            </button>
                            <button
                                onClick={onDelete}
                                className="p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                title="Delete"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div className="space-y-3">
                        <div className="flex items-center justify-between">
                            <span className="text-sm text-gray-600">ATS Score</span>
                            <div className="flex items-center gap-2">
                                <div className="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                                    <div 
                                        className={`h-full ${atsScore >= 70 ? 'bg-green-500' : atsScore >= 50 ? 'bg-yellow-500' : 'bg-red-500'}`}
                                        style={{ width: `${atsScore}%` }}
                                    />
                                </div>
                                <span className="text-sm font-semibold text-gray-900">{atsScore}</span>
                            </div>
                        </div>

                        <div className="text-xs text-gray-500">
                            Updated {updatedDate}
                        </div>
                    </div>

                    <button
                        onClick={onEdit}
                        className="mt-4 w-full py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                    >
                        Open Resume
                    </button>
                </div>
            );
        };

        // ============================================
        // RESUME EDITOR COMPONENT
        // ============================================

        const ResumeEditor = ({ resume: initialResume, onSave, onBack }) => {
            const [resume, setResume] = useState(initialResume);
            const [activeSection, setActiveSection] = useState('personalInfo');
            const [showPreview, setShowPreview] = useState(true);
            const [isSaving, setIsSaving] = useState(false);
            const [lastSaved, setLastSaved] = useState(null);
            const [isExporting, setIsExporting] = useState(false);
            const saveTimeoutRef = useRef(null);
            const previewRef = useRef(null);

            const handleSave = async () => {
                setIsSaving(true);
                try {
                    const updatedResume = {
                        ...resume,
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Calculate ATS score
                    const atsScore = ATSScoring.calculateScore(updatedResume, updatedResume.metadata?.jobDescription || '');
                    updatedResume.metadata = {
                        ...updatedResume.metadata,
                        atsScore: atsScore.overall
                    };
                    
                    onSave(updatedResume);
                    setLastSaved(new Date().toLocaleTimeString());
                } catch (error) {
                    console.error('Error saving resume:', error);
                } finally {
                    setIsSaving(false);
                }
            };

            // Auto-save on changes
            useEffect(() => {
                if (saveTimeoutRef.current) {
                    clearTimeout(saveTimeoutRef.current);
                }
                
                saveTimeoutRef.current = setTimeout(() => {
                    handleSave();
                }, 3000);

                return () => {
                    if (saveTimeoutRef.current) {
                        clearTimeout(saveTimeoutRef.current);
                    }
                };
            }, [resume]);

            const exportToPDF = async () => {
                if (!previewRef.current) {
                    alert('Preview not available. Please enable preview panel.');
                    return;
                }

                setIsExporting(true);
                try {
                    // Ensure preview is visible
                    const wasPreviewHidden = !showPreview;
                    if (wasPreviewHidden) {
                        setShowPreview(true);
                        // Wait for DOM update
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }

                    // Check if libraries are available
                    if (typeof window.jspdf === 'undefined' || typeof html2canvas === 'undefined') {
                        throw new Error('PDF export libraries not loaded. Please refresh the page.');
                    }

                    const { jsPDF } = window.jspdf;
                    
                    // Hide ATS score badge and any non-print elements
                    const previewElement = previewRef.current;
                    const atsBadge = previewElement.querySelector('.mb-4.p-2.bg-blue-50');
                    if (atsBadge) {
                        atsBadge.style.display = 'none';
                    }

                    // Capture the preview as canvas
                    const canvas = await html2canvas(previewElement, {
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        backgroundColor: '#ffffff'
                    });

                    // Restore ATS badge
                    if (atsBadge) {
                        atsBadge.style.display = '';
                    }

                    // Calculate dimensions
                    const imgWidth = 210; // A4 width in mm
                    const pageHeight = 297; // A4 height in mm
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    // Create PDF
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgData = canvas.toDataURL('image/png');

                    // Add first page
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    // Add additional pages if needed
                    while (heightLeft > 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    // Generate filename
                    const fileName = `${resume.name || 'Resume'}_${new Date().toISOString().split('T')[0]}.pdf`;

                    // Download PDF
                    pdf.save(fileName);

                    // Restore preview state if it was hidden
                    if (wasPreviewHidden) {
                        setShowPreview(false);
                    }
                } catch (error) {
                    console.error('Error exporting PDF:', error);
                    alert(`Failed to export PDF: ${error.message}`);
                } finally {
                    setIsExporting(false);
                }
            };

            const updateResume = (updates) => {
                setResume(prev => ({ ...prev, ...updates }));
            };

            const updatePersonalInfo = (field, value) => {
                setResume(prev => ({
                    ...prev,
                    personalInfo: { ...prev.personalInfo, [field]: value }
                }));
            };

            const addExperience = () => {
                const newExp = {
                    id: Date.now().toString(),
                    position: '',
                    company: '',
                    startDate: '',
                    endDate: '',
                    description: '',
                    achievements: []
                };
                setResume(prev => ({
                    ...prev,
                    experience: [...prev.experience, newExp]
                }));
            };

            const updateExperience = (id, updates) => {
                setResume(prev => ({
                    ...prev,
                    experience: prev.experience.map(exp => 
                        exp.id === id ? { ...exp, ...updates } : exp
                    )
                }));
            };

            const removeExperience = (id) => {
                setResume(prev => ({
                    ...prev,
                    experience: prev.experience.filter(exp => exp.id !== id)
                }));
            };

            const addEducation = () => {
                const newEdu = {
                    id: Date.now().toString(),
                    institution: '',
                    degree: '',
                    field: '',
                    graduationDate: ''
                };
                setResume(prev => ({
                    ...prev,
                    education: [...prev.education, newEdu]
                }));
            };

            const updateEducation = (id, updates) => {
                setResume(prev => ({
                    ...prev,
                    education: prev.education.map(edu => 
                        edu.id === id ? { ...edu, ...updates } : edu
                    )
                }));
            };

            const removeEducation = (id) => {
                setResume(prev => ({
                    ...prev,
                    education: prev.education.filter(edu => edu.id !== id)
                }));
            };

            const addSkill = (category, skill) => {
                if (!skill.trim()) return;
                setResume(prev => ({
                    ...prev,
                    skills: {
                        ...prev.skills,
                        [category]: [...(prev.skills[category] || []), skill.trim()]
                    }
                }));
            };

            const removeSkill = (category, index) => {
                setResume(prev => ({
                    ...prev,
                    skills: {
                        ...prev.skills,
                        [category]: prev.skills[category].filter((_, i) => i !== index)
                    }
                }));
            };

            const sections = [
                { id: 'personalInfo', label: 'Personal Info', icon: '👤' },
                { id: 'summary', label: 'Summary', icon: '📝' },
                { id: 'experience', label: 'Experience', icon: '💼' },
                { id: 'education', label: 'Education', icon: '🎓' },
                { id: 'skills', label: 'Skills', icon: '⚡' },
                { id: 'certifications', label: 'Certifications', icon: '🏆' },
                { id: 'projects', label: 'Projects', icon: '🚀' }
            ];

            return (
                <div className="min-h-screen bg-gray-50 flex flex-col">
                    {/* Header */}
                    <div className="bg-white border-b shadow-sm">
                        <div className="max-w-full mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <button
                                        onClick={onBack}
                                        className="flex items-center gap-2 text-gray-600 hover:text-gray-900"
                                    >
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                                        </svg>
                                        Back
                                    </button>
                                    <input
                                        type="text"
                                        value={resume.name}
                                        onChange={(e) => updateResume({ name: e.target.value })}
                                        className="text-2xl font-bold bg-transparent border-none focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2"
                                    />
                                </div>
                                <div className="flex items-center gap-4">
                                    {isSaving && (
                                        <span className="text-sm text-gray-500 flex items-center gap-2">
                                            <svg className="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                            Saving...
                                        </span>
                                    )}
                                    {lastSaved && !isSaving && (
                                        <span className="text-sm text-gray-500">Saved at {lastSaved}</span>
                                    )}
                                    <button
                                        onClick={exportToPDF}
                                        disabled={isExporting}
                                        className="px-4 py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center gap-2"
                                    >
                                        {isExporting ? (
                                            <>
                                                <svg className="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                                </svg>
                                                Exporting...
                                            </>
                                        ) : (
                                            <>
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                Export PDF
                                            </>
                                        )}
                                    </button>
                                    <button
                                        onClick={handleSave}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                                    >
                                        Save
                                    </button>
                                    <button
                                        onClick={() => setShowPreview(!showPreview)}
                                        className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors"
                                    >
                                        {showPreview ? 'Hide' : 'Show'} Preview
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex overflow-hidden">
                        {/* Editor Sidebar */}
                        <div className="w-64 bg-white border-r overflow-y-auto">
                            <div className="p-4">
                                <h3 className="text-sm font-semibold text-gray-500 uppercase mb-2">Sections</h3>
                                <div className="space-y-1">
                                    {sections.map(section => (
                                        <button
                                            key={section.id}
                                            onClick={() => setActiveSection(section.id)}
                                            className={`w-full text-left px-3 py-2 rounded-lg transition-colors flex items-center gap-2 ${
                                                activeSection === section.id
                                                    ? 'bg-blue-50 text-blue-700 font-medium'
                                                    : 'text-gray-700 hover:bg-gray-50'
                                            }`}
                                        >
                                            <span>{section.icon}</span>
                                            <span>{section.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Editor Content */}
                        <div className="flex-1 overflow-y-auto p-6">
                            <EditorSection
                                activeSection={activeSection}
                                resume={resume}
                                updateResume={updateResume}
                                updatePersonalInfo={updatePersonalInfo}
                                addExperience={addExperience}
                                updateExperience={updateExperience}
                                removeExperience={removeExperience}
                                addEducation={addEducation}
                                updateEducation={updateEducation}
                                removeEducation={removeEducation}
                                addSkill={addSkill}
                                removeSkill={removeSkill}
                            />
                        </div>

                        {/* Preview Panel */}
                        {showPreview && (
                            <div className="w-96 bg-gray-100 border-l overflow-y-auto p-6">
                                <div className="sticky top-6" ref={previewRef}>
                                    <ResumePreview resume={resume} />
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Editor Section Component
        const EditorSection = ({ activeSection, resume, updateResume, updatePersonalInfo, addExperience, updateExperience, removeExperience, addEducation, updateEducation, removeEducation, addSkill, removeSkill }) => {
            if (activeSection === 'personalInfo') {
                return (
                    <div className="max-w-2xl">
                        <h2 className="text-2xl font-bold mb-6">Personal Information</h2>
                        <div className="bg-white rounded-xl p-6 shadow-sm space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input
                                    type="text"
                                    value={resume.personalInfo.name || ''}
                                    onChange={(e) => updatePersonalInfo('name', e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="John Doe"
                                />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <input
                                        type="email"
                                        value={resume.personalInfo.email || ''}
                                        onChange={(e) => updatePersonalInfo('email', e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="john@example.com"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                    <input
                                        type="tel"
                                        value={resume.personalInfo.phone || ''}
                                        onChange={(e) => updatePersonalInfo('phone', e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="+1 (555) 123-4567"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                <input
                                    type="text"
                                    value={resume.personalInfo.location || ''}
                                    onChange={(e) => updatePersonalInfo('location', e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="City, State"
                                />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">LinkedIn</label>
                                    <input
                                        type="url"
                                        value={resume.personalInfo.linkedIn || ''}
                                        onChange={(e) => updatePersonalInfo('linkedIn', e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="linkedin.com/in/username"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Portfolio/GitHub</label>
                                    <input
                                        type="url"
                                        value={resume.personalInfo.portfolio || ''}
                                        onChange={(e) => updatePersonalInfo('portfolio', e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="github.com/username"
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (activeSection === 'summary') {
                return (
                    <div className="max-w-2xl">
                        <h2 className="text-2xl font-bold mb-6">Professional Summary</h2>
                        <div className="bg-white rounded-xl p-6 shadow-sm">
                            <textarea
                                value={resume.summary || ''}
                                onChange={(e) => updateResume({ summary: e.target.value })}
                                className="w-full h-48 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                placeholder="Write a compelling professional summary that highlights your key qualifications, experience, and career objectives..."
                            />
                            <p className="text-sm text-gray-500 mt-2">
                                {(resume.summary || '').length} characters
                            </p>
                        </div>
                    </div>
                );
            }

            if (activeSection === 'experience') {
                return (
                    <div className="max-w-2xl">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-bold">Work Experience</h2>
                            <button
                                onClick={addExperience}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center gap-2"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                                Add Experience
                            </button>
                        </div>
                        <div className="space-y-4">
                            {resume.experience.map((exp, index) => (
                                <ExperienceEditor
                                    key={exp.id || index}
                                    experience={exp}
                                    onUpdate={(updates) => updateExperience(exp.id || index, updates)}
                                    onRemove={() => removeExperience(exp.id || index)}
                                />
                            ))}
                            {resume.experience.length === 0 && (
                                <div className="bg-white rounded-xl p-12 text-center shadow-sm">
                                    <svg className="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                    </svg>
                                    <p className="text-gray-600 mb-4">No work experience added yet</p>
                                    <button
                                        onClick={addExperience}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                                    >
                                        Add Your First Experience
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (activeSection === 'education') {
                return (
                    <div className="max-w-2xl">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-bold">Education</h2>
                            <button
                                onClick={addEducation}
                                className="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors flex items-center gap-2"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                                Add Education
                            </button>
                        </div>
                        <div className="space-y-4">
                            {resume.education.map((edu, index) => (
                                <EducationEditor
                                    key={edu.id || index}
                                    education={edu}
                                    onUpdate={(updates) => updateEducation(edu.id || index, updates)}
                                    onRemove={() => removeEducation(edu.id || index)}
                                />
                            ))}
                            {resume.education.length === 0 && (
                                <div className="bg-white rounded-xl p-12 text-center shadow-sm">
                                    <svg className="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                    <p className="text-gray-600 mb-4">No education added yet</p>
                                    <button
                                        onClick={addEducation}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                                    >
                                        Add Education
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (activeSection === 'skills') {
                return (
                    <div className="max-w-2xl">
                        <h2 className="text-2xl font-bold mb-6">Skills</h2>
                        <div className="space-y-6">
                            <SkillCategory
                                title="Technical Skills"
                                skills={resume.skills?.technical || []}
                                onAdd={(skill) => addSkill('technical', skill)}
                                onRemove={(index) => removeSkill('technical', index)}
                            />
                            <SkillCategory
                                title="Soft Skills"
                                skills={resume.skills?.soft || []}
                                onAdd={(skill) => addSkill('soft', skill)}
                                onRemove={(index) => removeSkill('soft', index)}
                            />
                            <SkillCategory
                                title="Languages"
                                skills={resume.skills?.languages || []}
                                onAdd={(skill) => addSkill('languages', skill)}
                                onRemove={(index) => removeSkill('languages', index)}
                            />
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-2xl">
                    <h2 className="text-2xl font-bold mb-6">Coming Soon</h2>
                    <p className="text-gray-600">This section is under development.</p>
                </div>
            );
        };

        // Experience Editor Component
        const ExperienceEditor = ({ experience, onUpdate, onRemove }) => {
            const [skillInput, setSkillInput] = useState('');

            return (
                <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                    <div className="flex items-start justify-between mb-4">
                        <h3 className="text-lg font-semibold text-gray-900">Experience Entry</h3>
                        <button
                            onClick={onRemove}
                            className="text-red-600 hover:text-red-800 p-1"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                    <div className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Job Title</label>
                                <input
                                    type="text"
                                    value={experience.position || ''}
                                    onChange={(e) => onUpdate({ position: e.target.value })}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Software Engineer"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Company</label>
                                <input
                                    type="text"
                                    value={experience.company || ''}
                                    onChange={(e) => onUpdate({ company: e.target.value })}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Tech Corp"
                                />
                            </div>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                <input
                                    type="text"
                                    value={experience.startDate || ''}
                                    onChange={(e) => onUpdate({ startDate: e.target.value })}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Jan 2020"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                                <input
                                    type="text"
                                    value={experience.endDate || ''}
                                    onChange={(e) => onUpdate({ endDate: e.target.value })}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Present or Dec 2023"
                                />
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea
                                value={experience.description || ''}
                                onChange={(e) => onUpdate({ description: e.target.value })}
                                className="w-full h-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                placeholder="Describe your responsibilities and achievements..."
                            />
                        </div>
                    </div>
                </div>
            );
        };

        // Education Editor Component
        const EducationEditor = ({ education, onUpdate, onRemove }) => {
            return (
                <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
                    <div className="flex items-start justify-between mb-4">
                        <h3 className="text-lg font-semibold text-gray-900">Education Entry</h3>
                        <button
                            onClick={onRemove}
                            className="text-red-600 hover:text-red-800 p-1"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                    <div className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Institution</label>
                            <input
                                type="text"
                                value={education.institution || ''}
                                onChange={(e) => onUpdate({ institution: e.target.value })}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="University Name"
                            />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Degree</label>
                                <input
                                    type="text"
                                    value={education.degree || ''}
                                    onChange={(e) => onUpdate({ degree: e.target.value })}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Bachelor's Degree"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Field of Study</label>
                                <input
                                    type="text"
                                    value={education.field || ''}
                                    onChange={(e) => onUpdate({ field: e.target.value })}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Computer Science"
                                />
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Graduation Date</label>
                            <input
                                type="text"
                                value={education.graduationDate || ''}
                                onChange={(e) => onUpdate({ graduationDate: e.target.value })}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="May 2020"
                            />
                        </div>
                    </div>
                </div>
            );
        };

        // Skill Category Component
        const SkillCategory = ({ title, skills, onAdd, onRemove }) => {
            const [inputValue, setInputValue] = useState('');

            const handleAdd = () => {
                if (inputValue.trim()) {
                    onAdd(inputValue);
                    setInputValue('');
                }
            };

            return (
                <div className="bg-white rounded-xl p-6 shadow-sm">
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">{title}</h3>
                    <div className="flex flex-wrap gap-2 mb-4">
                        {skills.map((skill, index) => (
                            <span
                                key={index}
                                className="inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm"
                            >
                                {skill}
                                <button
                                    onClick={() => onRemove(index)}
                                    className="text-blue-600 hover:text-blue-800"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </span>
                        ))}
                    </div>
                    <div className="flex gap-2">
                        <input
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleAdd()}
                            className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Add skill..."
                        />
                        <button
                            onClick={handleAdd}
                            className="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                        >
                            Add
                        </button>
                    </div>
                </div>
            );
        };

        // Resume Preview Component (Simple Modern Template)
        const ResumePreview = ({ resume }) => {
            const personalInfo = resume.personalInfo || {};
            const atsScore = resume.metadata?.atsScore || 0;

            return (
                <div className="resume-preview rounded-lg p-8 max-w-full" style={{ minHeight: '297mm' }}>
                    {/* ATS Score Badge */}
                    <div className="mb-4 p-2 bg-blue-50 rounded-lg text-center">
                        <div className="text-xs text-gray-600 mb-1">ATS Compatibility Score</div>
                        <div className="flex items-center justify-center gap-2">
                            <div className="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div
                                    className={`h-full ${atsScore >= 70 ? 'bg-green-500' : atsScore >= 50 ? 'bg-yellow-500' : 'bg-red-500'}`}
                                    style={{ width: `${atsScore}%` }}
                                />
                            </div>
                            <span className="text-lg font-bold text-gray-900">{atsScore}</span>
                        </div>
                    </div>

                    {/* Header */}
                    <div className="text-center mb-6 border-b-2 border-blue-600 pb-4">
                        <h1 className="text-3xl font-bold text-gray-900 mb-2">
                            {personalInfo.name || 'Your Name'}
                        </h1>
                        <div className="flex flex-wrap justify-center gap-4 text-sm text-gray-600">
                            {personalInfo.email && <span>{personalInfo.email}</span>}
                            {personalInfo.phone && <span>{personalInfo.phone}</span>}
                            {personalInfo.location && <span>{personalInfo.location}</span>}
                        </div>
                        <div className="flex flex-wrap justify-center gap-4 text-sm text-blue-600 mt-2">
                            {personalInfo.linkedIn && (
                                <a href={personalInfo.linkedIn} target="_blank" rel="noopener noreferrer">
                                    LinkedIn
                                </a>
                            )}
                            {personalInfo.portfolio && (
                                <a href={personalInfo.portfolio} target="_blank" rel="noopener noreferrer">
                                    Portfolio
                                </a>
                            )}
                        </div>
                    </div>

                    {/* Summary */}
                    {resume.summary && (
                        <div className="mb-6">
                            <h2 className="text-xl font-bold text-gray-900 mb-2 border-b border-gray-300 pb-1">Professional Summary</h2>
                            <p className="text-sm text-gray-700 leading-relaxed">{resume.summary}</p>
                        </div>
                    )}

                    {/* Experience */}
                    {resume.experience && resume.experience.length > 0 && (
                        <div className="mb-6">
                            <h2 className="text-xl font-bold text-gray-900 mb-3 border-b border-gray-300 pb-1">Professional Experience</h2>
                            <div className="space-y-4">
                                {resume.experience.map((exp, index) => (
                                    <div key={index} className="mb-4">
                                        <div className="flex justify-between items-start mb-1">
                                            <div>
                                                <h3 className="font-semibold text-gray-900">{exp.position || 'Job Title'}</h3>
                                                <p className="text-gray-600">{exp.company || 'Company Name'}</p>
                                            </div>
                                            <span className="text-sm text-gray-600 whitespace-nowrap">
                                                {exp.startDate || 'Start'} - {exp.endDate || 'End'}
                                            </span>
                                        </div>
                                        {exp.description && (
                                            <p className="text-sm text-gray-700 mt-2">{exp.description}</p>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Education */}
                    {resume.education && resume.education.length > 0 && (
                        <div className="mb-6">
                            <h2 className="text-xl font-bold text-gray-900 mb-3 border-b border-gray-300 pb-1">Education</h2>
                            <div className="space-y-3">
                                {resume.education.map((edu, index) => (
                                    <div key={index}>
                                        <h3 className="font-semibold text-gray-900">{edu.degree || 'Degree'}</h3>
                                        <p className="text-gray-600">{edu.institution || 'Institution'}</p>
                                        {edu.field && <p className="text-sm text-gray-600">{edu.field}</p>}
                                        {edu.graduationDate && <p className="text-sm text-gray-500">{edu.graduationDate}</p>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Skills */}
                    {(resume.skills?.technical?.length > 0 || resume.skills?.soft?.length > 0 || resume.skills?.languages?.length > 0) && (
                        <div className="mb-6">
                            <h2 className="text-xl font-bold text-gray-900 mb-3 border-b border-gray-300 pb-1">Skills</h2>
                            <div className="space-y-2">
                                {resume.skills.technical && resume.skills.technical.length > 0 && (
                                    <div>
                                        <p className="font-medium text-gray-900 text-sm">Technical:</p>
                                        <p className="text-sm text-gray-700">{resume.skills.technical.join(', ')}</p>
                                    </div>
                                )}
                                {resume.skills.soft && resume.skills.soft.length > 0 && (
                                    <div>
                                        <p className="font-medium text-gray-900 text-sm">Soft Skills:</p>
                                        <p className="text-sm text-gray-700">{resume.skills.soft.join(', ')}</p>
                                    </div>
                                )}
                                {resume.skills.languages && resume.skills.languages.length > 0 && (
                                    <div>
                                        <p className="font-medium text-gray-900 text-sm">Languages:</p>
                                        <p className="text-sm text-gray-700">{resume.skills.languages.join(', ')}</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ============================================
        // RESUME WIZARD & UPLOADER (Placeholders)
        // ============================================

        const ResumeWizard = ({ onComplete, onBack }) => {
            const [currentStep, setCurrentStep] = useState(1);
            const [resumeData, setResumeData] = useState(createDefaultResume('My Resume'));
            const [isGeneratingAI, setIsGeneratingAI] = useState(false);
            const totalSteps = 7;

            const updateResume = (updates) => {
                setResumeData(prev => ({ ...prev, ...updates }));
            };

            const updatePersonalInfo = (field, value) => {
                setResumeData(prev => ({
                    ...prev,
                    personalInfo: { ...prev.personalInfo, [field]: value }
                }));
            };

            const addExperience = () => {
                const newExp = {
                    id: `exp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    position: '',
                    company: '',
                    startDate: '',
                    endDate: '',
                    description: '',
                    achievements: []
                };
                setResumeData(prev => ({
                    ...prev,
                    experience: [...prev.experience, newExp]
                }));
            };

            const updateExperience = (id, updates) => {
                setResumeData(prev => ({
                    ...prev,
                    experience: prev.experience.map(exp => 
                        exp.id === id ? { ...exp, ...updates } : exp
                    )
                }));
            };

            const removeExperience = (id) => {
                setResumeData(prev => ({
                    ...prev,
                    experience: prev.experience.filter(exp => exp.id !== id)
                }));
            };

            const addEducation = () => {
                const newEdu = {
                    id: `edu-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    institution: '',
                    degree: '',
                    field: '',
                    graduationDate: ''
                };
                setResumeData(prev => ({
                    ...prev,
                    education: [...prev.education, newEdu]
                }));
            };

            const updateEducation = (id, updates) => {
                setResumeData(prev => ({
                    ...prev,
                    education: prev.education.map(edu => 
                        edu.id === id ? { ...edu, ...updates } : edu
                    )
                }));
            };

            const removeEducation = (id) => {
                setResumeData(prev => ({
                    ...prev,
                    education: prev.education.filter(edu => edu.id !== id)
                }));
            };

            const addSkill = (category, skill) => {
                if (!skill.trim()) return;
                setResumeData(prev => ({
                    ...prev,
                    skills: {
                        ...prev.skills,
                        [category]: [...(prev.skills[category] || []), skill.trim()]
                    }
                }));
            };

            const removeSkill = (category, index) => {
                setResumeData(prev => ({
                    ...prev,
                    skills: {
                        ...prev.skills,
                        [category]: prev.skills[category].filter((_, i) => i !== index)
                    }
                }));
            };

            const addCertification = () => {
                const newCert = {
                    id: `cert-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    name: '',
                    issuer: '',
                    date: '',
                    expiryDate: '',
                    credentialId: ''
                };
                setResumeData(prev => ({
                    ...prev,
                    certifications: [...(prev.certifications || []), newCert]
                }));
            };

            const updateCertification = (id, updates) => {
                setResumeData(prev => ({
                    ...prev,
                    certifications: prev.certifications.map(cert => 
                        cert.id === id ? { ...cert, ...updates } : cert
                    )
                }));
            };

            const removeCertification = (id) => {
                setResumeData(prev => ({
                    ...prev,
                    certifications: prev.certifications.filter(cert => cert.id !== id)
                }));
            };

            const addProject = () => {
                const newProj = {
                    id: `proj-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    name: '',
                    description: '',
                    technologies: [],
                    link: '',
                    date: ''
                };
                setResumeData(prev => ({
                    ...prev,
                    projects: [...(prev.projects || []), newProj]
                }));
            };

            const updateProject = (id, updates) => {
                setResumeData(prev => ({
                    ...prev,
                    projects: prev.projects.map(proj => 
                        proj.id === id ? { ...proj, ...updates } : proj
                    )
                }));
            };

            const removeProject = (id) => {
                setResumeData(prev => ({
                    ...prev,
                    projects: prev.projects.filter(proj => proj.id !== id)
                }));
            };

            const generateAISummary = async () => {
                setIsGeneratingAI(true);
                try {
                    const experienceText = resumeData.experience.map(exp => 
                        `${exp.position} at ${exp.company}`
                    ).join(', ');
                    
                    const skillsText = [
                        ...(resumeData.skills?.technical || []),
                        ...(resumeData.skills?.soft || [])
                    ].join(', ');

                    const prompt = `Generate a professional resume summary (2-3 sentences) for someone with this experience and skills:\n\nExperience: ${experienceText || 'None specified'}\nSkills: ${skillsText || 'None specified'}\n\nReturn only the summary text, no additional commentary.`;

                    const response = await APIUtils.callOpenAI([
                        { role: 'user', content: prompt }
                    ], 'gpt-4o-mini', { maxTokens: 150, temperature: 0.7 });

                    const summary = response.choices[0].message.content.trim();
                    updateResume({ summary });
                } catch (error) {
                    console.error('Error generating AI summary:', error);
                    alert('Failed to generate summary. Please write it manually or check your API key in Settings.');
                } finally {
                    setIsGeneratingAI(false);
                }
            };

            const suggestSkills = async (category) => {
                setIsGeneratingAI(true);
                try {
                    const experienceText = resumeData.experience.map(exp => 
                        `${exp.position}: ${exp.description || ''}`
                    ).join('\n');

                    const prompt = `Based on this work experience, suggest 5-8 relevant ${category} skills for a resume. Return only a comma-separated list of skills, no numbering or bullets:\n\n${experienceText}`;

                    const response = await APIUtils.callOpenAI([
                        { role: 'user', content: prompt }
                    ], 'gpt-4o-mini', { maxTokens: 100, temperature: 0.5 });

                    const skillsText = response.choices[0].message.content.trim();
                    const skills = skillsText.split(',').map(s => s.trim()).filter(s => s);
                    
                    skills.forEach(skill => {
                        if (!resumeData.skills[category].includes(skill)) {
                            addSkill(category, skill);
                        }
                    });
                } catch (error) {
                    console.error('Error suggesting skills:', error);
                    alert('Failed to suggest skills. Please add them manually or check your API key.');
                } finally {
                    setIsGeneratingAI(false);
                }
            };

            const handleNext = () => {
                if (currentStep < totalSteps) {
                    setCurrentStep(currentStep + 1);
                } else {
                    // Save and complete
                    const savedResume = ResumeStudioStorage.saveResume(resumeData.id, resumeData);
                    onComplete(savedResume);
                }
            };

            const handleBack = () => {
                if (currentStep > 1) {
                    setCurrentStep(currentStep - 1);
                } else {
                    onBack();
                }
            };

            const canProceed = () => {
                switch(currentStep) {
                    case 1:
                        return resumeData.personalInfo.name && resumeData.personalInfo.email;
                    case 2:
                        return resumeData.summary.length > 50;
                    case 3:
                        return resumeData.experience.length > 0;
                    case 4:
                        return resumeData.education.length > 0;
                    case 5:
                        return (resumeData.skills?.technical?.length > 0 || resumeData.skills?.soft?.length > 0);
                    default:
                        return true;
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-6">
                    <div className="max-w-4xl mx-auto">
                        <button
                            onClick={onBack}
                            className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                            </svg>
                            Back to Manager
                        </button>

                        {/* Progress Indicator */}
                        <div className="bg-white rounded-xl p-6 shadow-lg mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-2xl font-bold text-gray-900">Guided Resume Builder</h2>
                                <span className="text-sm text-gray-600">Step {currentStep} of {totalSteps}</span>
                        </div>
                            <div className="w-full bg-gray-200 rounded-full h-2">
                                <div 
                                    className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                    style={{ width: `${(currentStep / totalSteps) * 100}%` }}
                                ></div>
                            </div>
                        </div>

                        {/* Step Content */}
                        <div className="bg-white rounded-xl p-8 shadow-lg mb-6">
                            {currentStep === 1 && (
                                <WizardStep1 
                                    personalInfo={resumeData.personalInfo}
                                    updatePersonalInfo={updatePersonalInfo}
                                />
                            )}
                            {currentStep === 2 && (
                                <WizardStep2
                                    summary={resumeData.summary}
                                    updateSummary={(summary) => updateResume({ summary })}
                                    onAIGenerate={generateAISummary}
                                    isGeneratingAI={isGeneratingAI}
                                />
                            )}
                            {currentStep === 3 && (
                                <WizardStep3
                                    experience={resumeData.experience}
                                    addExperience={addExperience}
                                    updateExperience={updateExperience}
                                    removeExperience={removeExperience}
                                />
                            )}
                            {currentStep === 4 && (
                                <WizardStep4
                                    education={resumeData.education}
                                    addEducation={addEducation}
                                    updateEducation={updateEducation}
                                    removeEducation={removeEducation}
                                />
                            )}
                            {currentStep === 5 && (
                                <WizardStep5
                                    skills={resumeData.skills}
                                    addSkill={addSkill}
                                    removeSkill={removeSkill}
                                    onAISuggest={suggestSkills}
                                    isGeneratingAI={isGeneratingAI}
                                />
                            )}
                            {currentStep === 6 && (
                                <WizardStep6
                                    certifications={resumeData.certifications || []}
                                    addCertification={addCertification}
                                    updateCertification={updateCertification}
                                    removeCertification={removeCertification}
                                />
                            )}
                            {currentStep === 7 && (
                                <WizardStep7
                                    projects={resumeData.projects || []}
                                    addProject={addProject}
                                    updateProject={updateProject}
                                    removeProject={removeProject}
                                />
                            )}
                        </div>

                        {/* Navigation */}
                        <div className="flex justify-between">
                            <button
                                onClick={handleBack}
                                className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors"
                            >
                                {currentStep === 1 ? 'Cancel' : 'Back'}
                            </button>
                            <button
                                onClick={handleNext}
                                disabled={!canProceed()}
                                className={`px-6 py-3 rounded-lg font-medium transition-colors ${
                                    canProceed()
                                        ? 'bg-blue-600 text-white hover:bg-blue-700'
                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                }`}
                            >
                                {currentStep === totalSteps ? 'Complete' : 'Next'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Wizard Step Components
        const WizardStep1 = ({ personalInfo, updatePersonalInfo }) => (
            <div>
                <h3 className="text-xl font-bold text-gray-900 mb-6">Personal Information</h3>
                <div className="space-y-4">
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                        <input
                            type="text"
                            value={personalInfo.name || ''}
                            onChange={(e) => updatePersonalInfo('name', e.target.value)}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="John Doe"
                        />
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input
                                type="email"
                                value={personalInfo.email || ''}
                                onChange={(e) => updatePersonalInfo('email', e.target.value)}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="john@example.com"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                            <input
                                type="tel"
                                value={personalInfo.phone || ''}
                                onChange={(e) => updatePersonalInfo('phone', e.target.value)}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="+1 (555) 123-4567"
                            />
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Location</label>
                        <input
                            type="text"
                            value={personalInfo.location || ''}
                            onChange={(e) => updatePersonalInfo('location', e.target.value)}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="City, State"
                        />
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">LinkedIn</label>
                            <input
                                type="url"
                                value={personalInfo.linkedIn || ''}
                                onChange={(e) => updatePersonalInfo('linkedIn', e.target.value)}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="linkedin.com/in/username"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Portfolio/GitHub</label>
                            <input
                                type="url"
                                value={personalInfo.portfolio || ''}
                                onChange={(e) => updatePersonalInfo('portfolio', e.target.value)}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="github.com/username"
                            />
                        </div>
                    </div>
                </div>
            </div>
        );

        const WizardStep2 = ({ summary, updateSummary, onAIGenerate, isGeneratingAI }) => (
            <div>
                <div className="flex items-center justify-between mb-6">
                    <h3 className="text-xl font-bold text-gray-900">Professional Summary</h3>
                    <button
                        onClick={onAIGenerate}
                        disabled={isGeneratingAI}
                        className="px-4 py-2 bg-purple-600 text-white rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors disabled:opacity-50"
                    >
                        {isGeneratingAI ? 'Generating...' : '✨ AI Generate'}
                    </button>
                </div>
                <textarea
                    value={summary || ''}
                    onChange={(e) => updateSummary(e.target.value)}
                    className="w-full h-48 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                    placeholder="Write a compelling professional summary (at least 50 characters) that highlights your key qualifications, experience, and career objectives..."
                />
                <p className="text-sm text-gray-500 mt-2">{summary.length} characters</p>
            </div>
        );

        const WizardStep3 = ({ experience, addExperience, updateExperience, removeExperience }) => (
            <div>
                <div className="flex items-center justify-between mb-6">
                    <h3 className="text-xl font-bold text-gray-900">Work Experience</h3>
                    <button
                        onClick={addExperience}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors flex items-center gap-2"
                    >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        Add Experience
                    </button>
                </div>
                <div className="space-y-4">
                    {experience.map((exp) => (
                        <div key={exp.id} className="border border-gray-200 rounded-lg p-4">
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Job Title</label>
                                    <input
                                        type="text"
                                        value={exp.position || ''}
                                        onChange={(e) => updateExperience(exp.id, { position: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Software Engineer"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Company</label>
                                    <input
                                        type="text"
                                        value={exp.company || ''}
                                        onChange={(e) => updateExperience(exp.id, { company: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Tech Corp"
                                    />
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                                    <input
                                        type="text"
                                        value={exp.startDate || ''}
                                        onChange={(e) => updateExperience(exp.id, { startDate: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Jan 2020"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                                    <input
                                        type="text"
                                        value={exp.endDate || ''}
                                        onChange={(e) => updateExperience(exp.id, { endDate: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Present"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea
                                    value={exp.description || ''}
                                    onChange={(e) => updateExperience(exp.id, { description: e.target.value })}
                                    className="w-full h-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"
                                    placeholder="Describe your responsibilities and achievements..."
                                />
                            </div>
                            <button
                                onClick={() => removeExperience(exp.id)}
                                className="mt-2 text-red-600 hover:text-red-800 text-sm"
                            >
                                Remove
                            </button>
                        </div>
                    ))}
                    {experience.length === 0 && (
                        <div className="text-center py-8 text-gray-500">
                            <p>No experience added yet. Click "Add Experience" to get started.</p>
                        </div>
                    )}
                </div>
            </div>
        );

        const WizardStep4 = ({ education, addEducation, updateEducation, removeEducation }) => (
            <div>
                <div className="flex items-center justify-between mb-6">
                    <h3 className="text-xl font-bold text-gray-900">Education</h3>
                    <button
                        onClick={addEducation}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors flex items-center gap-2"
                    >
                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                        Add Education
                    </button>
                </div>
                <div className="space-y-4">
                    {education.map((edu) => (
                        <div key={edu.id} className="border border-gray-200 rounded-lg p-4">
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Institution</label>
                                    <input
                                        type="text"
                                        value={edu.institution || ''}
                                        onChange={(e) => updateEducation(edu.id, { institution: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="University Name"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Degree</label>
                                    <input
                                        type="text"
                                        value={edu.degree || ''}
                                        onChange={(e) => updateEducation(edu.id, { degree: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Bachelor's Degree"
                                    />
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Field of Study</label>
                                    <input
                                        type="text"
                                        value={edu.field || ''}
                                        onChange={(e) => updateEducation(edu.id, { field: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Computer Science"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Graduation Date</label>
                                    <input
                                        type="text"
                                        value={edu.graduationDate || ''}
                                        onChange={(e) => updateEducation(edu.id, { graduationDate: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="May 2020"
                                    />
                                </div>
                            </div>
                            <button
                                onClick={() => removeEducation(edu.id)}
                                className="mt-2 text-red-600 hover:text-red-800 text-sm"
                            >
                                Remove
                            </button>
                        </div>
                    ))}
                    {education.length === 0 && (
                        <div className="text-center py-8 text-gray-500">
                            <p>No education added yet. Click "Add Education" to get started.</p>
                        </div>
                    )}
                </div>
            </div>
        );

        const WizardStep5 = ({ skills, addSkill, removeSkill, onAISuggest, isGeneratingAI }) => {
            const [inputValue, setInputValue] = useState('');
            const [currentCategory, setCurrentCategory] = useState('technical');

            const handleAdd = () => {
                if (inputValue.trim()) {
                    addSkill(currentCategory, inputValue);
                    setInputValue('');
                }
            };

            return (
                <div>
                    <h3 className="text-xl font-bold text-gray-900 mb-6">Skills</h3>
                    <div className="space-y-6">
                        {['technical', 'soft', 'languages'].map(category => (
                            <div key={category} className="border border-gray-200 rounded-lg p-4">
                                <div className="flex items-center justify-between mb-4">
                                    <h4 className="font-semibold text-gray-900 capitalize">{category} Skills</h4>
                                    {category === 'technical' && (
                                        <button
                                            onClick={() => {
                                                setCurrentCategory('technical');
                                                onAISuggest('technical');
                                            }}
                                            disabled={isGeneratingAI}
                                            className="px-3 py-1 bg-purple-600 text-white rounded text-xs font-medium hover:bg-purple-700 disabled:opacity-50"
                                        >
                                            {isGeneratingAI ? 'Generating...' : '✨ AI Suggest'}
                                        </button>
                                    )}
                                </div>
                                <div className="flex flex-wrap gap-2 mb-3">
                                    {(skills[category] || []).map((skill, index) => (
                                        <span
                                            key={index}
                                            className="inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm"
                                        >
                                            {skill}
                                            <button
                                                onClick={() => removeSkill(category, index)}
                                                className="text-blue-600 hover:text-blue-800"
                                            >
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                                </svg>
                                            </button>
                                        </span>
                                    ))}
                                </div>
                                <div className="flex gap-2">
                                    <input
                                        type="text"
                                        value={currentCategory === category ? inputValue : ''}
                                        onChange={(e) => {
                                            setCurrentCategory(category);
                                            setInputValue(e.target.value);
                                        }}
                                        onKeyPress={(e) => e.key === 'Enter' && handleAdd()}
                                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder={`Add ${category} skill...`}
                                    />
                                    <button
                                        onClick={() => {
                                            setCurrentCategory(category);
                                            handleAdd();
                                        }}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700"
                                    >
                                        Add
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const WizardStep6 = ({ certifications, addCertification, updateCertification, removeCertification }) => (
            <div>
                <div className="flex items-center justify-between mb-6">
                    <h3 className="text-xl font-bold text-gray-900">Certifications (Optional)</h3>
                    <button
                        onClick={addCertification}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors"
                    >
                        Add Certification
                    </button>
                </div>
                <div className="space-y-4">
                    {certifications.map((cert) => (
                        <div key={cert.id} className="border border-gray-200 rounded-lg p-4">
                            <div className="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Certification Name</label>
                                    <input
                                        type="text"
                                        value={cert.name || ''}
                                        onChange={(e) => updateCertification(cert.id, { name: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="AWS Certified Solutions Architect"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Issuer</label>
                                    <input
                                        type="text"
                                        value={cert.issuer || ''}
                                        onChange={(e) => updateCertification(cert.id, { issuer: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Amazon Web Services"
                                    />
                                </div>
                            </div>
                            <div className="grid grid-cols-3 gap-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                    <input
                                        type="text"
                                        value={cert.date || ''}
                                        onChange={(e) => updateCertification(cert.id, { date: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Jan 2023"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Expiry (Optional)</label>
                                    <input
                                        type="text"
                                        value={cert.expiryDate || ''}
                                        onChange={(e) => updateCertification(cert.id, { expiryDate: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Jan 2026"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Credential ID</label>
                                    <input
                                        type="text"
                                        value={cert.credentialId || ''}
                                        onChange={(e) => updateCertification(cert.id, { credentialId: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="ABC123"
                                    />
                                </div>
                            </div>
                            <button
                                onClick={() => removeCertification(cert.id)}
                                className="mt-2 text-red-600 hover:text-red-800 text-sm"
                            >
                                Remove
                            </button>
                        </div>
                    ))}
                    {certifications.length === 0 && (
                        <div className="text-center py-8 text-gray-500">
                            <p>No certifications added. This step is optional.</p>
                        </div>
                    )}
                </div>
            </div>
        );

        const WizardStep7 = ({ projects, addProject, updateProject, removeProject }) => {
            const [techInput, setTechInput] = useState('');

            const addTechToProject = (projectId, tech) => {
                if (!tech.trim()) return;
                const project = projects.find(p => p.id === projectId);
                if (project && !project.technologies.includes(tech.trim())) {
                    updateProject(projectId, {
                        technologies: [...project.technologies, tech.trim()]
                    });
                }
            };

            const removeTechFromProject = (projectId, techIndex) => {
                const project = projects.find(p => p.id === projectId);
                if (project) {
                    updateProject(projectId, {
                        technologies: project.technologies.filter((_, i) => i !== techIndex)
                    });
                }
            };

            return (
                <div>
                    <div className="flex items-center justify-between mb-6">
                        <h3 className="text-xl font-bold text-gray-900">Projects (Optional)</h3>
                        <button
                            onClick={addProject}
                            className="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors"
                        >
                            Add Project
                        </button>
                    </div>
                    <div className="space-y-4">
                        {projects.map((proj) => (
                            <div key={proj.id} className="border border-gray-200 rounded-lg p-4">
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Project Name</label>
                                        <input
                                            type="text"
                                            value={proj.name || ''}
                                            onChange={(e) => updateProject(proj.id, { name: e.target.value })}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            placeholder="E-Commerce Platform"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                        <input
                                            type="text"
                                            value={proj.date || ''}
                                            onChange={(e) => updateProject(proj.id, { date: e.target.value })}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            placeholder="2023"
                                        />
                                    </div>
                                </div>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                    <textarea
                                        value={proj.description || ''}
                                        onChange={(e) => updateProject(proj.id, { description: e.target.value })}
                                        className="w-full h-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 resize-none"
                                        placeholder="Describe the project and your role..."
                                    />
                                </div>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Technologies</label>
                                    <div className="flex flex-wrap gap-2 mb-2">
                                        {(proj.technologies || []).map((tech, index) => (
                                            <span
                                                key={index}
                                                className="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-700 rounded text-sm"
                                            >
                                                {tech}
                                                <button
                                                    onClick={() => removeTechFromProject(proj.id, index)}
                                                    className="text-gray-500 hover:text-gray-700"
                                                >
                                                    <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                                    </svg>
                                                </button>
                                            </span>
                                        ))}
                                    </div>
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={techInput}
                                            onChange={(e) => setTechInput(e.target.value)}
                                            onKeyPress={(e) => {
                                                if (e.key === 'Enter') {
                                                    addTechToProject(proj.id, techInput);
                                                    setTechInput('');
                                                }
                                            }}
                                            className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                            placeholder="Add technology..."
                                        />
                                        <button
                                            onClick={() => {
                                                addTechToProject(proj.id, techInput);
                                                setTechInput('');
                                            }}
                                            className="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm"
                                        >
                                            Add
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Link (Optional)</label>
                                    <input
                                        type="url"
                                        value={proj.link || ''}
                                        onChange={(e) => updateProject(proj.id, { link: e.target.value })}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="https://..."
                                    />
                                </div>
                                <button
                                    onClick={() => removeProject(proj.id)}
                                    className="mt-2 text-red-600 hover:text-red-800 text-sm"
                                >
                                    Remove
                                </button>
                            </div>
                        ))}
                        {projects.length === 0 && (
                            <div className="text-center py-8 text-gray-500">
                                <p>No projects added. This step is optional.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const ResumeUploader = ({ onComplete, onBack }) => {
            const [isProcessing, setIsProcessing] = useState(false);
            const [error, setError] = useState(null);
            const [uploadProgress, setUploadProgress] = useState(0);
            const fileInputRef = useRef(null);

            const handleFileSelect = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                // Validate file type
                const validTypes = [
                    'application/pdf',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'application/msword',
                    'text/plain'
                ];

                if (!validTypes.includes(file.type)) {
                    setError('Please upload a PDF, DOCX, or TXT file.');
                    return;
                }

                // Validate file size (max 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    setError('File size must be less than 10MB.');
                    return;
                }

                setIsProcessing(true);
                setError(null);
                setUploadProgress(0);

                try {
                    setUploadProgress(25);
                    // Extract text from file
                    const text = await FileParserUtils.extractTextFromFile(file);
                    
                    setUploadProgress(50);
                    // Parse text into structured resume data
                    const resumeData = FileParserUtils.parseResumeText(text);
                    
                    setUploadProgress(75);
                    // Save the resume
                    const savedResume = ResumeStudioStorage.saveResume(resumeData.id, resumeData);
                    
                    setUploadProgress(100);
                    // Complete the upload
                    setTimeout(() => {
                        onComplete(savedResume);
                    }, 500);
                } catch (err) {
                    console.error('Error processing file:', err);
                    setError(err.message || 'Failed to process file. Please try again.');
                    setIsProcessing(false);
                    setUploadProgress(0);
                }
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.stopPropagation();
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    // Create a synthetic event for handleFileSelect
                    const syntheticEvent = {
                        target: { files: [file] }
                    };
                    handleFileSelect(syntheticEvent);
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 p-6">
                    <div className="max-w-4xl mx-auto">
                        <button
                            onClick={onBack}
                            className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6"
                        >
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                            </svg>
                            Back to Manager
                        </button>

                        <div className="bg-white rounded-xl p-8 shadow-lg">
                            <h2 className="text-2xl font-bold text-gray-900 mb-2">Upload Your Resume</h2>
                            <p className="text-gray-600 mb-6">Import your existing resume from PDF, DOCX, or TXT format</p>

                            {error && (
                                <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <div className="flex items-center gap-2 text-red-800">
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        <span className="font-medium">Error: {error}</span>
                                    </div>
                                </div>
                            )}

                            <div
                                onDragOver={handleDragOver}
                                onDrop={handleDrop}
                                className={`border-2 border-dashed rounded-xl p-12 text-center transition-colors ${
                                    isProcessing 
                                        ? 'border-blue-300 bg-blue-50' 
                                        : 'border-gray-300 hover:border-blue-500 hover:bg-blue-50'
                                }`}
                            >
                                {isProcessing ? (
                                    <div className="space-y-4">
                                        <div className="flex justify-center">
                                            <svg className="w-12 h-12 text-blue-600 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                        </div>
                                        <div>
                                            <p className="text-lg font-semibold text-gray-900 mb-2">Processing your resume...</p>
                                            <div className="w-full bg-gray-200 rounded-full h-2 mb-2">
                                                <div 
                                                    className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                    style={{ width: `${uploadProgress}%` }}
                                                ></div>
                                            </div>
                                            <p className="text-sm text-gray-600">{uploadProgress}% complete</p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <div className="flex justify-center">
                                            <svg className="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                            </svg>
                                        </div>
                                        <div>
                                            <p className="text-lg font-semibold text-gray-900 mb-2">
                                                Drag and drop your resume here
                                            </p>
                                            <p className="text-gray-600 mb-4">or</p>
                                            <button
                                                onClick={() => fileInputRef.current?.click()}
                                                className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors"
                                            >
                                                Browse Files
                                            </button>
                                        </div>
                                        <p className="text-sm text-gray-500">
                                            Supported formats: PDF, DOCX, TXT (Max 10MB)
                                        </p>
                                    </div>
                                )}
                            </div>

                            <input
                                ref={fileInputRef}
                                type="file"
                                accept=".pdf,.docx,.doc,.txt"
                                onChange={handleFileSelect}
                                className="hidden"
                            />

                            <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                <h3 className="font-semibold text-gray-900 mb-2">What happens next?</h3>
                                <ul className="text-sm text-gray-600 space-y-1">
                                    <li>• Your resume will be parsed and structured automatically</li>
                                    <li>• Personal information, experience, and skills will be extracted</li>
                                    <li>• You can review and edit the imported data before saving</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================
        // RENDER APPLICATION
        // ============================================

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>