<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CareerFlow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/brand-analysis-utils.js"></script>
    <script type="module" src="/js/achievements.js"></script>
    <script type="module" src="/js/achievementService.js"></script>
    <script src="/js/contentAnalytics.js"></script>
    <script>
        // Initialize OpenAI API key helper functions for Content Generator
        (function() {
            // Make getOpenAIKey function available for Content Generator
            // Users can set their API key in Settings > Integrations
            if (!window.getOpenAIKey) {
                window.getOpenAIKey = function() {
                    return localStorage.getItem('openai_api_key');
                };
            }
            // Make checkOpenAIKey function available
            if (!window.checkOpenAIKey) {
                window.checkOpenAIKey = function() {
                    return localStorage.getItem('openai_api_key') !== null;
                };
            }
        })();
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar-icon {
            stroke-width: 1.5;
        }
        
        /* --- Scrollbar Styles --- */
        /* Generic Custom Scrollbar (used for main content) */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4f46e5; /* indigo-600 */
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #4338ca; /* indigo-700 */
        }
        
        /* --- End Scrollbar Styles --- */

        /* --- Sidebar Scrollbar --- */
        aside nav.custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: transparent;
        }

        aside:hover nav.custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #4f46e5; /* Use original scrollbar color on hover */
        }
        /* --- End Sidebar Scrollbar --- */
        
        /* Smart Resume Studio Styles */
        /* Custom slider thumb */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #4f46e5;
            cursor: pointer;
            border-radius: 50%;
        }
        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #4f46e5;
            cursor: pointer;
            border-radius: 50%;
        }
        /* Styles for Drag and Drop */
        .resume-content-view.dnd-active .resume-section {
            cursor: move;
            outline: 2px dashed #818cf8;
            transition: outline 0.2s ease-in-out;
        }
        .resume-content-view .resume-section.dragging {
            opacity: 0.4;
            transform: scale(0.98);
        }
        .resume-content-view.dragging-active {
            cursor: grabbing;
        }
        .drag-over-indicator {
            height: 60px;
            background-color: rgba(99, 102, 241, 0.1);
            border: 2px dashed #818cf8;
            border-radius: 8px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #4f46e5;
            font-weight: 500;
        }

        aside {
            transition: width 0.3s ease-in-out;
        }
        .sidebar-link.active {
            background-color: #4f46e5; /* indigo-600 */
            color: #ffffff;
            font-weight: 700;
        }
        .sidebar-link.active svg {
            color: #ffffff;
        }
        .ai-mentor-tab.active {
            background-color: #4f46e5; /* indigo-600 */
            color: #ffffff;
            font-weight: 500;
        }
        .sidebar-link:not(.active):hover,
        .ai-mentor-tab:not(.active):hover {
            background-color: rgba(79, 70, 229, 0.1);
        }
        
        aside.collapsed .sidebar-link {
            justify-content: center;
        }

        .sidebar-link.active:hover svg {
            color: #ffffff;
        }
        
        /* Dark Mode Styles */
        .dark { color-scheme: dark; }

        .dark body {
             background-image: none !important;
             background-color: #0f172a !important; /* slate-900 */
        }
        
        .dark aside,
        .dark header,
        .dark .bg-white\/50,
        .dark .bg-white\/70,
        .dark #user-menu,
        .dark #settings-modal-content { /* Added settings modal */
            background-color: rgba(30, 41, 59, 0.6) !important; /* slate-800 with 60% opacity */
            backdrop-filter: blur(20px);
            border-color: rgba(51, 65, 85, 1) !important; /* slate-700 */
        }

        .dark .text-slate-900,
        .dark .text-slate-800,
        .dark .font-bold {
            color: #f1f5f9; /* slate-100 */
        }

        .dark .text-slate-600,
        .dark .text-slate-500,
        .dark .text-sm {
             color: #94a3b8; /* slate-400 */
        }
        
        .dark .sidebar-link,
        .dark .ai-mentor-tab {
            color: #cbd5e1; /* slate-300 */
        }

        .dark .sidebar-link:not(.active):hover,
        .dark .ai-mentor-tab:not(.active):hover {
            background-color: rgba(79, 70, 229, 0.3); /* Secondary color hover for dark */
            color: #f8fafc; /* slate-50 */
        }
        
        .dark .sidebar-link.active,
        .dark .ai-mentor-tab.active {
            background-color: #4f46e5; /* indigo-600 */
            color: #ffffff;
        }

        .dark .sidebar-link.active svg {
            color: #ffffff;
        }

        .dark .border-white\/30 {
            border-color: rgba(51, 65, 85, 1); /* slate-700 */
        }
        
        /* Insights Page Styles */
        .insights-view-btn {
            color: #64748b;
        }
        
        .insights-view-btn.active {
            background-color: #4f46e5;
            color: #ffffff;
        }
        
        .dark .insights-view-btn {
            color: #94a3b8;
        }
        
        .dark .insights-view-btn.active {
            background-color: #4f46e5;
            color: #ffffff;
        }
        
        .insights-container.list-view {
            grid-template-columns: 1fr;
        }
        
        .insight-card {
            transition: all 0.3s ease;
        }
        
        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .insight-card.unread {
            border-left: 4px solid #4f46e5;
        }
        
        .insight-expanded {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .insight-expanded.show {
            max-height: 1000px;
        }

        .dark .bg-gray-100 {
            background-color: #334155; /* slate-700 */
        }
        
        .dark .text-gray-500 {
            color: #9ca3af; /* gray-400 */
        }

        .dark .bg-slate-50 {
            background-color: #1e293b; /* slate-800 */
            border-color: #334155; /* slate-700 */
        }

        .dark .border-slate-200 {
            border-color: #334155; /* slate-700 */
        }
        
        .dark .text-sm.font-medium.text-slate-700 {
             color: #cbd5e1; /* slate-300 */
        }
        
        .dark button.hover\:bg-slate-100:hover {
            background-color: #334155; /* slate-700 */
        }
        
        .dark .main-bg-color {
            background-color: transparent !important;
        }

        /* --- New styles for scroll fade effect --- */
        #scroll-fade-overlay {
            position: sticky;
            top: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(180deg, #dee5fb 40%, rgba(222, 229, 251, 0) 100%);
            z-index: 5;
            pointer-events: none;
            margin-bottom: -150px;
        }
        
        .dark #scroll-fade-overlay {
             background: linear-gradient(180deg, #0f172a 40%, rgba(15, 23, 42, 0) 100%);
        }
        /* --- End of new styles --- */

        /* --- Styles for Shortcut Customization --- */
        #shortcuts-container {
            position: relative;
            /* NEW: Fixed width to prevent layout shift and align items to the right */
            width: 290px; 
            display: flex;
            align-items: center;
            gap: 0.5rem; /* 8px */
            flex-direction: row-reverse;
            justify-content: flex-start;
            transition: all 0.3s ease-in-out;
        }
        #shortcuts-container.customization-active {
            border: 2px dashed #a5b4fc; /* indigo-300 */
            border-radius: 9999px; /* rounded-full */
            padding: 0.5rem;
            /* min-width: 150px; REMOVED */
            min-height: 56px;
            background-color: rgba(238, 242, 255, 0.5); /* indigo-50 with opacity */
        }
        #shortcuts-container.customization-active::before {
            content: attr(data-placeholder);
            color: #64748b; /* slate-500 */
            font-size: 0.875rem; /* text-sm */
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            /* NEW: Ensure placeholder text fits well */
            text-align: center;
            width: 90%;
        }
        .dark #shortcuts-container.customization-active {
            border-color: #6366f1; /* indigo-500 */
            background-color: rgba(30, 41, 59, 0.5); /* slate-800 with opacity */
        }
         .dark #shortcuts-container.customization-active::before {
            color: #94a3b8; /* slate-400 */
        }
        #shortcuts-container.drag-over {
            background-color: transparent;
            border-color: #4f46e5;
        }
        .sidebar-link.dragging {
            opacity: 0.4;
            cursor: grabbing;
        }
        .shortcut-item {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ffffff; /* Solid white background */
            border: 1px solid transparent;
            border-radius: 50%;
            color: #4f46e5; /* Primary indigo color for the icon */
            cursor: pointer;
            transition: all 0.2s;
            position: relative; /* For the remove button */
            flex-shrink: 0;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* Added a subtle shadow */
        }
        .dark .shortcut-item {
             background-color: #1e293b; /* Solid dark background (slate-800) */
             color: #a5b4fc; /* indigo-300 */
        }
        .shortcut-item:hover {
            background-color: #f8fafc; /* Lighter hover for light mode */
            border-color: #4f46e5;
        }
        .dark .shortcut-item:hover {
            background-color: #334155; /* slate-700 */
        }
        .shortcut-item svg {
            width: 24px;
            height: 24px;
            color: #4f46e5; /* Set icon color directly */
        }
        .dark .shortcut-item svg {
            color: #a5b4fc; /* Set icon color for dark mode */
        }
        .remove-shortcut-btn {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 20px;
            height: 20px;
            background-color: #ef4444; /* red-500 */
            color: white;
            border-radius: 50%;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1;
            cursor: pointer;
            border: 2px solid white;
            z-index: 10;
        }
        .dark .remove-shortcut-btn {
            border-color: #1e293b; /* slate-800 */
        }
        #shortcuts-container.customization-active .shortcut-item .remove-shortcut-btn {
            display: flex; /* Show remove button only in customization mode */
        }
        .shortcut-placeholder {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #a5b4fc; /* indigo-300 */
            border-radius: 50%;
            color: #64748b; /* slate-500 */
            font-size: 24px;
            font-weight: 300;
            flex-shrink: 0;
        }
        .dark .shortcut-placeholder {
            border-color: #6366f1; /* indigo-500 */
            color: #94a3b8; /* slate-400 */
        }
        /* --- End of Shortcut Styles --- */
        /* --- Notification Badge Styles --- */
        .dark .notification-ring {
            ring-color: #1e2d3b; /* slate-800 */
        }
        /* Style for read notifications */
        .notification-read {
            background-color: transparent !important;
        }
        
        /* --- Light Mode Notification Modal Style Override --- */
        /* This block ensures the modal has a light, glassy theme when NOT in dark mode */
        html:not(.dark) #notification-modal-content, html:not(.dark) #settings-modal-content {
            background-color: #edf1fe !important; /* Updated solid light blue background */
            border-color: #cbd5e1 !important; /* A suitable solid border color (slate-300) */
            backdrop-filter: none !important; /* Removed blur for solid background */
        }
        html:not(.dark) #notification-modal-content .border-b, html:not(.dark) #settings-modal-content .border-b,
        html:not(.dark) #notification-modal-content .border-r, html:not(.dark) #settings-modal-content .border-r,
        html:not(.dark) #notification-modal-content .border-t, html:not(.dark) #settings-modal-content .border-t {
             border-color: #cbd5e1 !important; /* Solid border (slate-300) */
        }
        html:not(.dark) #notification-list li:not(.notification-category-header) {
            background-color: rgba(255, 255, 255, 0.6) !important; /* Keep inner cards white and glassy */
            border-color: rgba(255, 255, 255, 0.3) !important; /* Keep inner cards' border */
        }
        html:not(.dark) #notification-actions, html:not(.dark) #settings-actions {
             border-color: #cbd5e1 !important; /* Solid border (slate-300) */
        }
        
        /* Light Mode Text Color Fix */
        html:not(.dark) #notification-modal-content h3, html:not(.dark) #settings-modal-content h3,
        html:not(.dark) #notification-modal-content .text-slate-800, html:not(.dark) #settings-modal-content .text-slate-800,
        html:not(.dark) #notification-modal-content .text-slate-700, html:not(.dark) #settings-modal-content .text-slate-700 {
            color: #1e293b !important; /* slate-800 */
        }
        html:not(.dark) #notification-modal-content .text-slate-500, html:not(.dark) #settings-modal-content .text-slate-500,
        html:not(.dark) #notification-modal-content .text-slate-400, html:not(.dark) #settings-modal-content .text-slate-400 {
            color: #64748b !important; /* slate-500 */
        }

        .user-menu-item:hover {
             background-color: rgba(79, 70, 229, 0.1);
        }
        .dark .user-menu-item:hover {
            background-color: rgba(79, 70, 229, 0.3);
            color: #f8fafc; /* slate-50 */
        }
        .dark .user-menu-item:hover svg {
            color: #4f46e5;
        }
        
        /* User menu background for light mode */
        #user-menu {
            background-color: #ecf1fd !important;
            backdrop-filter: none !important;
        }
        
        /* NEW History button styles */
        #history-button {
            background-color: rgba(79, 70, 229, 0.7);
        }
        #history-button:hover {
            background-color: #4f46e5;
        }
        
        /* NEW Dropdown Menu Styles */
        .dropdown-toggle {
            width: 100%;
            text-align: left;
            border-radius: 0.5rem; /* rounded-lg */
        }
        .dropdown-toggle:hover {
            background-color: rgba(79, 70, 229, 0.1);
        }
        .dark .dropdown-toggle:hover {
             background-color: rgba(79, 70, 229, 0.3);
        }
        .dropdown-chevron {
            transition: transform 0.2s ease-in-out;
        }
        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .dropdown-container.open .dropdown-content {
            max-height: 500px; /* Adjust if content is taller */
            transition: max-height 0.4s ease-in;
        }
        .dropdown-container.open .dropdown-chevron {
            transform: rotate(90deg);
        }
        
        /* NEW Styles for Collapsed Sidebar */
        aside.collapsed .sidebar-text,
        aside.collapsed .dropdown-toggle,
        aside.collapsed nav > div:first-of-type > h3 {
            display: none;
        }
        aside.collapsed .dropdown-content {
            max-height: none;
            overflow: visible;
            padding: 0;
        }
        aside.collapsed .sidebar-link {
            justify-content: center;
            padding-left: 0;
            padding-right: 0;
        }
        aside.collapsed .logo-container {
            justify-content: center;
        }
        aside.collapsed .space-y-6 > * + * {
            margin-top: 0;
        }
        aside.collapsed .dropdown-container {
            margin-bottom: 0.5rem;
        }

        /* Toast Animation */
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }
        
        /* NEW Settings Modal Styles */
        .settings-tab {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            color: #475569; /* slate-600 */
            transition: background-color 0.2s, color 0.2s;
            text-align: left;
        }
        .dark .settings-tab {
            color: #cbd5e1; /* slate-300 */
        }
        .settings-tab:hover {
            background-color: rgba(79, 70, 229, 0.1);
            color: #1e293b; /* slate-800 */
        }
        .dark .settings-tab:hover {
            background-color: rgba(79, 70, 229, 0.3);
            color: #f8fafc; /* slate-50 */
        }
        .settings-tab.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            font-weight: 600;
        }
        .dark .settings-tab.active {
            color: white;
        }

        /* --- NEW Chat Widget Styles --- */
        #chat-widget {
            background-color: #edf1fe;
        }
        .dark #chat-widget {
            background-color: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
        }
        .chat-message {
            max-width: 80%;
            border-radius: 0.75rem; /* rounded-xl */
            position: relative;
            z-index: 5;
        }

        .user-message {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            align-self: flex-end;
        }

        /* Agent bubble styles to match notification items */
        .agent-message {
            background-color: rgba(255, 255, 255, 0.7);
            color: #1e293b; /* slate-800 */
            align-self: flex-start;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .dark .agent-message {
            background-color: rgba(30, 41, 59, 0.8); /* slate-800, matching dark mode notification items */
            color: #f1f5f9; /* slate-100 */
            border: 1px solid #334155; /* slate-700 */
        }

        /* Input area styles */
        #chat-input {
            background-color: rgba(79, 70, 229, 0.05) !important;
            border-color: transparent !important;
        }
        .dark #chat-input {
            background-color: rgba(79, 70, 229, 0.15) !important;
            border-color: transparent !important;
        }
        #chat-input::placeholder { color: #4f46e5; opacity: 0.7; }
        .dark #chat-input::placeholder { color: #a5b4fc; opacity: 0.7; }
        /* --- End Chat Widget Styles --- */

        /* --- New Chat Messages Animation --- */
        #chat-messages {
            position: relative;
            overflow: hidden; /* To contain the animation */
        }
        #chat-messages #stars-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden;
            z-index: 1; /* Behind the sun */
        }
        #chat-messages .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle linear infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        #chat-messages .section-banner-sun {
            height: 250px;
            width: 250px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2; /* In front of stars, behind messages */
            background-color: #E6E6FA;
            border-radius: 50%;
            animation: shadowPulse 5s ease-in-out infinite, rotate 30s linear infinite;
            box-shadow:
                0px 0px 35px 18px #7891D5,
                -4px 0px 9px 1px #E8F0FF inset,
                13px 1px 35px 18px #4D69B4c5 inset,
                -20px -1px 42px 22px #7891D5c2 inset,
                125px 0px 66px 30px #2B448Caa inset;
        }
        @keyframes shadowPulse {
            0%, 100% {
                box-shadow:
                    0px 0px 35px 18px #7891D5,
                    -4px 0px 9px 1px #E8F0FF inset,
                    13px 1px 35px 18px #4D69B4c5 inset,
                    -20px -1px 42px 22px #7891D5c2 inset,
                    125px 0px 66px 30px #2B448Caa inset;
            }
            50% {
                box-shadow:
                    0px 0px 50px 25px #AEBFE3,
                    -4px 0px 16px 4px #E8F0FF inset,
                    13px 1px 50px 25px #4D69B4c5 inset,
                    -20px -1px 58px 29px #7891D5c2 inset,
                    125px 0px 84px 38px #2B448Caa inset;
            }
        }
        @keyframes rotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        /* --- End Chat Messages Animation --- */

        /* Custom slider styles */
        .slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #4a5568;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            border: 2px solid #fff;
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            border: 2px solid #fff;
        }
        
        /* For Resume Preview content */
        .resume-content-view {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .resume-content-view p {
            margin: 0;
            padding: 0;
        }

        /* --- NEW Drag and Drop Styles --- */
        .resume-section {
            transition: background-color 0.2s;
        }
        /* Show dotted outline on hover ONLY when DND is active and not currently dragging */
        .resume-content-view.dnd-active:not(.dragging-active) .resume-section:hover {
            outline: 2px dashed #4f46e5; /* indigo-600 */
            background-color: rgba(238, 242, 255, 0.7); /* indigo-50 with opacity */
            cursor: grab;
        }
        /* Style for the element being dragged */
        .resume-section.dragging {
            opacity: 0.4;
            cursor: grabbing;
        }
        /* The placeholder line indicating drop position */
        .drag-over-indicator {
            background-color: #e0e7ff; /* indigo-100 */
            border: 2px dashed #4338ca; /* indigo-700 */
            color: #4338ca; /* indigo-700 */
            text-align: center;
            padding: 8px;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500;
            border-radius: 6px;
            margin: 4px 0;
            animation: pulse 1.5s infinite ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { 
                border-color: #4338ca;
                background-color: #e0e7ff;
            }
            50% { 
                border-color: #6d28d9; /* purple-700 */
                background-color: #ede9fe; /* violet-100 */
            }
        }
        /* --- End Drag and Drop Styles --- */

    </style>
    <script src="/js/serper-search.js"></script>
</head>
<body class="flex h-screen overflow-hidden" style="background-image: url('https://ik.imagekit.io/fdd16n9cy/di.png?updatedAt=1757770843990'); background-size: cover; background-attachment: fixed;">

    <!-- Sidebar -->
    <aside id="sidebar" class="w-[16.5rem] bg-white/50 backdrop-blur-xl border-r border-white/30 flex flex-col z-20 flex-shrink-0">
        <div class="logo-container flex items-center justify-start p-4 h-20 flex-shrink-0">
            <div class="flex items-center gap-2 text-lg font-bold text-slate-800">
                <svg class="h-8 w-auto text-indigo-600" viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 4H20V20H4V4Z"></path>
                    <path d="M12 12H28V28H12V12Z" fill-opacity="0.7"></path>
                </svg>
                <span class="sidebar-text">Career Clarified</span>
            </div>
        </div>
        <nav class="flex-1 px-4 py-4 space-y-6 custom-scrollbar overflow-y-scroll">
            <div>
                <h3 class="px-3 mb-3 text-xs font-bold uppercase tracking-wider text-slate-500 sidebar-text">Overview</h3>
                <a href="#" id="dashboard-link" data-id="dashboard" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-semibold rounded-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="flex-shrink-0"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    <span class="sidebar-text">Dashboard</span>
                </a>
            </div>
            <div class="dropdown-container open">
                <button class="dropdown-toggle flex items-center justify-between p-3">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-slate-500 sidebar-text">Career Hub</h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-chevron text-slate-500 sidebar-text"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
                <div class="dropdown-content pl-4 pt-1 space-y-1">
                    <a href="#" data-id="resume-studio" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                         <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><path d="m18 13-3.5 3.5a2 2 0 0 1-2.82 0L10 15"/><path d="m15 16 4 4"/></svg>
                        <span class="sidebar-text">Smart Resume Studio</span>
                    </a>
                     <a href="#" data-id="app-tailor" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
                        <span class="sidebar-text">Application Tailor</span>
                    </a>
                    <a href="#" data-id="cover-letter" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                        <span class="sidebar-text">Cover Letter Generator</span>
                    </a>
                    <a href="#" data-id="job-finder" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        <span class="sidebar-text">Job Finder</span>
                    </a>
                    <a href="#" data-id="job-tracker" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/><path d="M8 10v4"/><path d="M12 10v2"/><path d="M16 10v6"/></svg>
                        <span class="sidebar-text">Job Tracker</span>
                    </a>
                    <a href="#" data-id="interview-prep" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 12h.01"/><path d="M12 12h.01"/><path d="M16 12h.01"/></svg>
                        <span class="sidebar-text">Interview Prep Kit</span>
                    </a>
                    <a href="#" data-id="work-history" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                        <span class="sidebar-text">Work History Manager</span>
                    </a>
                </div>
            </div>
            <div class="dropdown-container open">
                <button class="dropdown-toggle flex items-center justify-between p-3">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-slate-500 sidebar-text">Brand Building</h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-chevron text-slate-500 sidebar-text"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
                <div class="dropdown-content pl-4 pt-1 space-y-1">
                    <a href="#" id="brand-audit-link" data-id="brand-audit" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group active">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M3 6V3h3"/><path d="M18 3h3v3"/><path d="M3 18v3h3"/><path d="M18 18h3v3"/><path d="M7 12h10"/></svg>
                        <span class="sidebar-text">AI Personal Brand Audit</span>
                    </a>
                     <a href="#" data-id="content-engine" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                         <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>
                        <span class="sidebar-text">Content Engine</span>
                    </a>
                    <a href="#" data-id="career-portfolio" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
                        <span class="sidebar-text">AI Career Portfolio</span>
                    </a>
                    <a href="#" data-id="event-scout" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M14 19a6 6 0 0 0-12 0"/><circle cx="8" cy="10" r="4"/><path d="M22 19a6 6 0 0 0-6-6 4 4 0 1 0 0-8"/></svg>
                        <span class="sidebar-text">Career Event Scout</span>
                    </a>
                    <a href="#" data-id="brand-intelligence" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M12 5a3 3 0 1 0-5.993.251"/><path d="M12 5a3 3 0 1 1 5.993.251"/><path d="M12 19a3 3 0 1 0-5.993-.251"/><path d="M12 19a3 3 0 1 1 5.993-.251"/><path d="M21 12a3 3 0 1 1-.251-5.993"/><path d="M3 12a3 3 0 1 0 .251-5.993"/><path d="M21 12a3 3 0 1 0 .251 5.993"/><path d="M3 12a3 3 0 1 1-.251 5.993"/><path d="M12 5v14"/><path d="M12 12H5.122a3 3 0 0 1-.122-6H12"/><path d="M12 12h6.878a3 3 0 0 0 .122-6H12"/><path d="M12 12H5.122a3 3 0 0 0-.122 6H12"/><path d="M12 12h6.878a3 3 0 0 1 .122 6H12"/></svg>
                        <span class="sidebar-text">AI Brand Intelligence</span>
                    </a>
                </div>
            </div>
            <div class="dropdown-container open">
                 <button class="dropdown-toggle flex items-center justify-between p-3">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-slate-500 sidebar-text">Upskilling</h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="dropdown-chevron text-slate-500 sidebar-text"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
                <div class="dropdown-content pl-4 pt-1 space-y-1">
                    <a href="#" data-id="upskilling-dash" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                        <span class="sidebar-text">Upskilling Dashboard</span>
                    </a>
                    <a href="#" data-id="skill-radar" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M19.07 4.93A10 10 0 0 0 6.99 3.34"/><path d="M4 6h.01"/><path d="M2.29 9.62A10 10 0 1 0 21.71 9.62"/><path d="M12 12v10"/><path d="M15.21 15.21A5 5 0 0 0 12 12"/></svg>
                        <span class="sidebar-text">Skill Radar</span>
                    </a>
                    <a href="#" data-id="learning-path" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M18 6H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h13l4 4V8a2 2 0 0 0-2-2z"/><path d="M12 13v8"/><path d="M12 3v3"/></svg>
                        <span class="sidebar-text">Learning Path</span>
                    </a>
                    <a href="#" data-id="sprints" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                        <span class="sidebar-text">Sprints</span>
                    </a>
                    <a href="#" data-id="certifications" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>
                        <span class="sidebar-text">Certifications</span>
                    </a>
                    <a href="#" data-id="benchmarking" class="sidebar-link flex items-center space-x-4 px-3 py-2 text-sm font-medium text-slate-600 rounded-lg group">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-500 group-hover:text-indigo-600 flex-shrink-0"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M14 15V9h-6"/><path d="M21 3h-6v6h6V3z"/></svg>
                        <span class="sidebar-text">Skill Benchmarking</span>
                    </a>
                </div>
            </div>
        </nav>
        <div class="border-t border-white/30 p-2 flex items-center mt-auto flex-shrink-0">
            <button id="sidebar-toggle" class="p-2 rounded-lg text-indigo-600">
                <svg id="sidebar-toggle-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-300"><path d="m11 17-5-5 5-5"/><path d="m18 17-5-5 5-5"/></svg>
            </button>
        </div>
    </aside>

    <!-- Main content -->
    <main class="flex-1 flex flex-col overflow-hidden main-bg-color" style="background-color: #dee5fb;">
        <div class="flex-1 relative overflow-y-auto custom-scrollbar">
        <div id="scroll-fade-overlay"></div>
        <!-- Persistent Navigation Bar -->
         <header class="sticky top-6 z-10 max-w-7xl mx-auto w-full flex items-center justify-between gap-4 h-20 pl-6 pr-2 bg-white/50 backdrop-blur-xl flex-shrink-0 rounded-full shadow-lg border border-white/30 mt-6 mb-5">
            <!-- Header Title -->
            <div id="header-title" class="flex items-center gap-3 flex-shrink-0">
                <div id="header-icon-container" class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center flex-shrink-0">
                </div>
                <div>
                    <h1 id="header-main-title" class="text-xl font-bold text-slate-900">AI Mentor for Brand Growth</h1>
                    <p id="header-subtitle" class="text-slate-600 text-xs mt-1">Your personal AI coach for career and brand development</p>
                </div>
            </div>

            <!-- Central Search Bar -->
            <div class="flex-1 flex justify-center">
                <div class="relative w-full max-w-sm">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-slate-400"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </div>
                    <input 
                        type="text" 
                        id="search-input" 
                        placeholder="Search features, jobs, or content..." 
                        class="w-full h-12 pl-11 pr-4 bg-white/50 border border-transparent rounded-full focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-300"
                    >
                    <button 
                        id="search-button" 
                        class="absolute inset-y-0 right-0 pr-3 flex items-center"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-indigo-600 hover:text-indigo-800"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </button>
                </div>
            </div>

            <!-- Right side controls -->
            <div class="flex items-center gap-2 flex-shrink-0">
                <!-- Shortcuts Container -->
                <div id="shortcuts-container">
                    <!-- Dropped shortcuts will appear here -->
                </div>

                <!-- User Profile Dropdown -->
                <div class="relative">
                    <button id="user-menu-button" class="w-16 h-16 rounded-full bg-slate-200 flex items-center justify-center flex-shrink-0">
                        <img id="user-avatar" src="https://placehold.co/64x64/e2e8f0/64748b?text=U" class="w-full h-full rounded-full object-cover" alt="User avatar">
                    </button>
                    <!-- Notification Badge on User Icon -->
                    <span id="user-icon-notification-badge" class="absolute top-0 right-0 flex h-6 w-6 items-center justify-center rounded-full bg-indigo-600 text-white text-xs font-bold transform translate-x-1/4 -translate-y-1/4 ring-2 ring-white notification-ring hidden"></span>

                    <div id="user-menu" class="absolute right-0 mt-2 w-64 rounded-2xl shadow-lg border border-white/30 p-4 hidden z-50">
                        <div class="flex items-center gap-3 mb-4">
                            <img id="user-avatar-dropdown" src="https://placehold.co/48x48/e2e8f0/64748b?text=U" class="w-12 h-12 rounded-full object-cover" alt="User avatar">
                            <div>
                                <h4 class="font-semibold text-slate-800">User Name</h4>
                                <button id="upload-photo-button" class="text-xs text-indigo-600 hover:underline">Upload Photo</button>
                                <input type="file" id="photo-upload" class="hidden" accept="image/*">
                            </div>
                        </div>
                        <div class="border-t border-slate-200 pt-2 space-y-2">
                            <button id="notification-menu-button" class="user-menu-item group w-full text-left text-sm text-slate-700 rounded-md p-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-slate-500 dark:text-slate-400"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
                                <span>Notifications</span>
                                <!-- Notification Badge in Dropdown -->
                                <span id="dropdown-notification-badge" class="ml-auto bg-indigo-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full hidden"></span>
                            </button>
                            <button id="edit-shortcuts-button" class="user-menu-item group w-full text-left text-sm text-slate-700 rounded-md p-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-slate-500 dark:text-slate-400"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                                <span>Customize Shortcuts</span>
                            </button>
                            <div id="dark-mode-row" class="user-menu-item group w-full text-left text-sm text-slate-700 rounded-md p-2 flex items-center justify-between gap-2 cursor-pointer">
                                <div class="flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-slate-500 dark:text-slate-400"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                                    <span>Dark Mode</span>
                                </div>
                                <button id="dark-mode-toggle" class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors bg-slate-200">
                                    <span class="sr-only">Enable dark mode</span>
                                    <span class="inline-block w-4 h-4 transform bg-white rounded-full transition-transform translate-x-1"></span>
                                </button>
                            </div>
                            <button id="settings-button" class="user-menu-item group w-full text-left text-sm text-slate-700 rounded-md p-2 flex items-center gap-2">
                               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-slate-500 dark:text-slate-400"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg> <span>Settings</span>
                            </button>
                             <button id="signout-button" class="user-menu-item group w-full text-left text-sm text-slate-700 rounded-md p-2 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-slate-500 dark:text-slate-400"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                                 <span>Sign Out</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div id="main-padding-wrapper" class="px-6 md:px-8 pb-6 relative z-0">
            <div id="dashboard-content" class="max-w-7xl mx-auto hidden">
                <!-- Header Section -->
                <div class="pt-6 mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-4xl font-bold text-slate-900 mb-2">Career Analytics Dashboard</h1>
                            <p class="text-lg text-slate-600">Comprehensive overview of your career development progress</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-slate-500">Last updated:</span>
                                <span class="text-sm font-medium text-slate-700">2 minutes ago</span>
                            </div>
                            <button class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                                Refresh Data
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Key Metrics Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Total Applications -->
                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6 hover:shadow-xl transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><path d="m18 13-3.5 3.5a2 2 0 0 1-2.82 0L10 15"/><path d="m15 16 4 4"/></svg>
                            </div>
                            <div class="text-right">
                                <span class="text-sm text-green-600 font-semibold">+12.5%</span>
                                <p class="text-xs text-slate-500">vs last month</p>
                            </div>
                        </div>
                        <div>
                            <p class="text-3xl font-bold text-slate-900 mb-1">47</p>
                            <p class="text-sm text-slate-600 mb-3">Applications Sent</p>
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-slate-500">This month</span>
                                <span class="text-slate-700 font-medium">47 applications</span>
                            </div>
                        </div>
                    </div>

                    <!-- Interview Rate -->
                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6 hover:shadow-xl transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 12h.01"/><path d="M12 12h.01"/><path d="M16 12h.01"/></svg>
                            </div>
                            <div class="text-right">
                                <span class="text-sm text-green-600 font-semibold">+8.2%</span>
                                <p class="text-xs text-slate-500">vs last month</p>
                            </div>
                        </div>
                        <div>
                            <p class="text-3xl font-bold text-slate-900 mb-1">23%</p>
                            <p class="text-sm text-slate-600 mb-3">Interview Rate</p>
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-slate-500">11 interviews</span>
                                <span class="text-slate-700 font-medium">from 47 applications</span>
                            </div>
                        </div>
                    </div>

                    <!-- Skills Progress -->
                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6 hover:shadow-xl transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                            </div>
                            <div class="text-right">
                                <span class="text-sm text-green-600 font-semibold">+15</span>
                                <p class="text-xs text-slate-500">skills improved</p>
                            </div>
                        </div>
                        <div>
                            <p class="text-3xl font-bold text-slate-900 mb-1">18</p>
                            <p class="text-sm text-slate-600 mb-3">Skills Tracked</p>
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-slate-500">Avg. progress</span>
                                <span class="text-slate-700 font-medium">73% completion</span>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Performance -->
                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6 hover:shadow-xl transition-all duration-300">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M1 12s4-8 8-8 8 4 8 8-4 8-8 8-8-4-8-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            </div>
                            <div class="text-right">
                                <span class="text-sm text-green-600 font-semibold">+34%</span>
                                <p class="text-xs text-slate-500">vs last month</p>
                            </div>
                        </div>
                        <div>
                            <p class="text-3xl font-bold text-slate-900 mb-1">2.4K</p>
                            <p class="text-sm text-slate-600 mb-3">Profile Views</p>
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-slate-500">This month</span>
                                <span class="text-slate-700 font-medium">+820 views</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and Analytics Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- Application Trends Chart -->
                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-lg font-semibold text-slate-900">Application Trends</h3>
                                <p class="text-sm text-slate-600">Monthly application activity</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <button class="px-3 py-1 text-xs bg-indigo-100 text-indigo-700 rounded-full">This Year</button>
                                <button class="px-3 py-1 text-xs bg-slate-100 text-slate-600 rounded-full">Last Year</button>
                            </div>
                        </div>
                        <div class="h-64 flex items-end justify-between gap-2">
                            <!-- Mock chart bars -->
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-gradient-to-t from-indigo-500 to-indigo-400 rounded-t" style="height: 120px;"></div>
                                <span class="text-xs text-slate-500">Jan</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-gradient-to-t from-indigo-500 to-indigo-400 rounded-t" style="height: 140px;"></div>
                                <span class="text-xs text-slate-500">Feb</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-gradient-to-t from-indigo-500 to-indigo-400 rounded-t" style="height: 160px;"></div>
                                <span class="text-xs text-slate-500">Mar</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-gradient-to-t from-indigo-500 to-indigo-400 rounded-t" style="height: 180px;"></div>
                                <span class="text-xs text-slate-500">Apr</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-gradient-to-t from-indigo-500 to-indigo-400 rounded-t" style="height: 200px;"></div>
                                <span class="text-xs text-slate-500">May</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-gradient-to-t from-indigo-500 to-indigo-400 rounded-t" style="height: 220px;"></div>
                                <span class="text-xs text-slate-500">Jun</span>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <div class="w-8 bg-gradient-to-t from-green-500 to-green-400 rounded-t" style="height: 240px;"></div>
                                <span class="text-xs text-slate-500">Jul</span>
                            </div>
                        </div>
                        <div class="mt-4 flex items-center justify-between text-sm">
                            <span class="text-slate-600">Total applications: 1,247</span>
                            <span class="text-green-600 font-medium">+23% from last year</span>
                        </div>
                    </div>

                    <!-- Skills Progress Chart -->
                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-lg font-semibold text-slate-900">Skills Progress</h3>
                                <p class="text-sm text-slate-600">Top performing skills</p>
                            </div>
                            <button class="px-3 py-1 text-xs bg-slate-100 text-slate-600 rounded-full">View All</button>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <span class="text-xs font-semibold text-blue-600">JS</span>
                                    </div>
                                    <span class="text-sm font-medium text-slate-900">JavaScript</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-24 bg-slate-200 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: 85%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-slate-700">85%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                        <span class="text-xs font-semibold text-green-600">TS</span>
                                    </div>
                                    <span class="text-sm font-medium text-slate-900">TypeScript</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-24 bg-slate-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 72%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-slate-700">72%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <span class="text-xs font-semibold text-purple-600">R</span>
                                    </div>
                                    <span class="text-sm font-medium text-slate-900">React</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-24 bg-slate-200 rounded-full h-2">
                                        <div class="bg-purple-500 h-2 rounded-full" style="width: 68%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-slate-700">68%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center">
                                        <span class="text-xs font-semibold text-orange-600">N</span>
                                    </div>
                                    <span class="text-sm font-medium text-slate-900">Node.js</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="w-24 bg-slate-200 rounded-full h-2">
                                        <div class="bg-orange-500 h-2 rounded-full" style="width: 55%"></div>
                                    </div>
                                    <span class="text-sm font-medium text-slate-700">55%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity and Quick Actions -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Recent Activity -->
                    <div class="lg:col-span-2 bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-slate-900">Recent Activity</h3>
                            <button class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">View All</button>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-start gap-4 p-4 bg-slate-50 rounded-xl">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><path d="m18 13-3.5 3.5a2 2 0 0 1-2.82 0L10 15"/><path d="m15 16 4 4"/></svg>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-900">Applied to Senior Frontend Developer at TechCorp</p>
                                    <p class="text-xs text-slate-500 mt-1">Application submitted successfully</p>
                                    <p class="text-xs text-slate-400 mt-1">2 hours ago</p>
                                </div>
                                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">New</span>
                            </div>
                            <div class="flex items-start gap-4 p-4 bg-slate-50 rounded-xl">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M8 12h.01"/><path d="M12 12h.01"/><path d="M16 12h.01"/></svg>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-900">Interview scheduled for tomorrow at 2:00 PM</p>
                                    <p class="text-xs text-slate-500 mt-1">Google Meet link sent to your email</p>
                                    <p class="text-xs text-slate-400 mt-1">4 hours ago</p>
                                </div>
                                <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">Scheduled</span>
                            </div>
                            <div class="flex items-start gap-4 p-4 bg-slate-50 rounded-xl">
                                <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-600"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-900">Completed Advanced React Patterns course</p>
                                    <p class="text-xs text-slate-500 mt-1">Earned certificate and 15 skill points</p>
                                    <p class="text-xs text-slate-400 mt-1">1 day ago</p>
                                </div>
                                <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">Completed</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions & Insights -->
                    <div class="space-y-6">
                        <!-- Quick Actions -->
                        <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                            <h3 class="text-lg font-semibold text-slate-900 mb-4">Quick Actions</h3>
                            <div class="space-y-3">
                                <button class="w-full p-4 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-xl hover:from-indigo-600 hover:to-indigo-700 transition-all duration-200 flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><path d="m18 13-3.5 3.5a2 2 0 0 1-2.82 0L10 15"/><path d="m15 16 4 4"/></svg>
                                    <span class="font-medium">Create New Resume</span>
                                </button>
                                <button class="w-full p-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                                    <span class="font-medium">Find Jobs</span>
                                </button>
                                <button class="w-full p-4 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl hover:from-purple-600 hover:to-purple-700 transition-all duration-200 flex items-center gap-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                                    <span class="font-medium">Start Learning</span>
                                </button>
                            </div>
                        </div>

                        <!-- AI Insights -->
                        <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-6 border border-indigo-200">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                                </div>
                                <h3 class="text-lg font-semibold text-slate-900">AI Insights</h3>
                            </div>
                            <div class="space-y-3">
                                <div class="p-3 bg-white/60 rounded-lg">
                                    <p class="text-sm font-medium text-slate-900 mb-1">Skill Gap Alert</p>
                                    <p class="text-xs text-slate-600">Consider learning Docker to increase your marketability by 23%</p>
                                </div>
                                <div class="p-3 bg-white/60 rounded-lg">
                                    <p class="text-sm font-medium text-slate-900 mb-1">Profile Optimization</p>
                                    <p class="text-xs text-slate-600">Add 2 more projects to increase profile views by 15%</p>
                                </div>
                                <div class="p-3 bg-white/60 rounded-lg">
                                    <p class="text-sm font-medium text-slate-900 mb-1">Networking Opportunity</p>
                                    <p class="text-xs text-slate-600">3 relevant events this week in your area</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="brand-audit-content" class="max-w-7xl mx-auto">
                 <!-- AI Mentor Feature -->
                <div class="pt-6">
                    <div class="">
                        <!-- Navigation Tabs -->
                        <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-lg p-1.5 grid grid-cols-3 md:grid-cols-6 gap-1.5">
                            <button data-tab="dashboard" class="ai-mentor-tab px-4 py-3 rounded-md text-sm font-medium transition-colors whitespace-nowrap active">Dashboard</button>
                            <button data-tab="analysis" class="ai-mentor-tab px-4 py-3 rounded-md text-sm font-medium transition-colors whitespace-nowrap text-slate-600">Brand Analysis</button>
                            <button data-tab="insights" class="ai-mentor-tab px-4 py-3 rounded-md text-sm font-medium transition-colors whitespace-nowrap text-slate-600">Insights</button>
                            <button data-tab="goals" class="ai-mentor-tab px-4 py-3 rounded-md text-sm font-medium transition-colors whitespace-nowrap text-slate-600">Goals</button>
                            <button data-tab="achievements" class="ai-mentor-tab px-4 py-3 rounded-md text-sm font-medium transition-colors whitespace-nowrap text-slate-600">Achievements</button>
                            <button data-tab="settings" class="ai-mentor-tab px-4 py-3 rounded-md text-sm font-medium transition-colors whitespace-nowrap text-slate-600">Settings</button>
                        </div>
                        
                        <!-- Tab Content -->
                        <div id="ai-mentor-content-container" class="mt-8">
                            <!-- Dashboard Tab Content -->
                            <div id="dashboard-tab-content" class="ai-mentor-tab-content grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div class="lg:col-span-2 space-y-6">
                                    <!-- Overall Brand Score -->
                                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                        <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-green-500"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                                            Your Overall Brand Score
                                        </h3>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-baseline gap-2">
                                                <span class="text-5xl font-bold text-yellow-500">78</span>
                                                <span class="text-slate-500">/ 100</span>
                                            </div>
                                            <button id="add-notification-button" class="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-all duration-300 disabled:opacity-50">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                                                Re-analyze Brand
                                            </button>
                                        </div>
                                        <p class="text-slate-500 text-sm mt-2">Last updated: 9/15/2025, 10:00:00 AM</p>
                                    </div>
                                    <!-- Key Metrics Breakdown -->
                                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Key Metrics Breakdown</h3>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div class="bg-slate-50 rounded-lg p-4 text-center">
                                                <div class="text-2xl font-bold text-green-600">82</div>
                                                <div class="text-slate-500 text-sm capitalize">Visibility</div>
                                            </div>
                                            <div class="bg-slate-50 rounded-lg p-4 text-center">
                                                <div class="text-2xl font-bold text-yellow-600">75</div>
                                                <div class="text-slate-500 text-sm capitalize">Engagement</div>
                                            </div>
                                            <div class="bg-slate-50 rounded-lg p-4 text-center">
                                                <div class="text-2xl font-bold text-green-600">80</div>
                                                <div class="text-slate-500 text-sm capitalize">Professional Presence</div>
                                            </div>
                                            <div class="bg-slate-50 rounded-lg p-4 text-center">
                                                <div class="text-2xl font-bold text-yellow-600">70</div>
                                                <div class="text-slate-500 text-sm capitalize">Network Quality</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Top Recommendations -->
                                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Top Recommendations</h3>
                                        <div class="space-y-3">
                                            <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h4 class="font-medium text-slate-800">Complete Your LinkedIn Profile</h4>
                                                    <span class="text-xs font-medium px-2 py-1 rounded-full text-green-700 bg-green-100">easy</span>
                                                </div>
                                                <p class="text-slate-600 text-sm line-clamp-2">Your profile is missing key information that could improve visibility.</p>
                                                <button class="text-indigo-600 text-sm mt-2 flex items-center gap-1 hover:text-indigo-800">
                                                    View Details <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3 h-3"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                                                </button>
                                            </div>
                                            <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h4 class="font-medium text-slate-800">Improve Content Engagement</h4>
                                                    <span class="text-xs font-medium px-2 py-1 rounded-full text-yellow-800 bg-yellow-100">medium</span>
                                                </div>
                                                <p class="text-slate-600 text-sm line-clamp-2">Your posts could generate more engagement with better strategy.</p>
                                                <button class="text-indigo-600 text-sm mt-2 flex items-center gap-1 hover:text-indigo-800">
                                                    View Details <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3 h-3"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Sidebar -->
                                <div class="space-y-6">
                                     <!-- LinkedIn Connection Status -->
                                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                        <h3 class="text-lg font-semibold text-slate-800 mb-4">LinkedIn Connection</h3>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 text-blue-500"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></svg>
                                                <span class="font-medium text-slate-800">Connected</span>
                                            </div>
                                            <button class="px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm disabled:opacity-50">Sync Now</button>
                                        </div>
                                        <p class="text-slate-500 text-xs mt-2">Last synced: 9/17/2025, 11:00:00 PM</p>
                                    </div>
                                    <!-- Recent Insights -->
                                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Recent Insights</h3>
                                        <div class="space-y-3">
                                            <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                                <div class="flex items-center justify-between mb-1">
                                                    <h4 class="font-medium text-slate-800 text-sm">Your LinkedIn Engagement is Trending Up! </h4>
                                                    <span class="text-xs text-blue-700 bg-blue-100 px-2 py-1 rounded-full">New</span>
                                                </div>
                                                <p class="text-slate-600 text-xs line-clamp-2">Great progress this week! Your brand score improved by 8 points. Your engagement metrics are trending upward...</p>
                                                <button class="text-indigo-600 text-xs mt-2 hover:text-indigo-800">Read More</button>
                                            </div>
                                            <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
                                                <div class="flex items-center justify-between mb-1">
                                                    <h4 class="font-medium text-slate-800 text-sm">Monthly Brand Review: Strategic Positioning</h4>
                                                </div>
                                                <p class="text-slate-600 text-xs line-clamp-2">This month has been a journey of growth and learning. You've made meaningful progress in building your professional brand...</p>
                                                <button class="text-indigo-600 text-xs mt-2 hover:text-indigo-800">Read More</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Goals Progress -->
                                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Goals Progress</h3>
                                        <div id="goals-progress-container" class="space-y-3">
                                            <div class="text-center py-4 text-slate-500 text-sm">
                                                <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mb-2"></div>
                                                <p>Loading goals...</p>
                                            </div>
                                        </div>
                                    </div>
                                     <!-- Recent Achievements -->
                                    <div class="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                        <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4">Recent Achievements</h3>
                                        <div id="recent-achievements-container" class="space-y-3">
                                            <div class="text-center py-4 text-slate-500 dark:text-slate-400 text-sm">
                                                <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mb-2"></div>
                                                <p>Loading achievements...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Other Tab Contents (initially hidden) -->
                            <div id="analysis-tab-content" class="ai-mentor-tab-content hidden"></div>
                            
                            <!-- Insights Tab Content -->
                            <div id="insights-tab-content" class="ai-mentor-tab-content hidden">
                                <div class="space-y-6">
                                    <!-- Header Section -->
                                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                        <div>
                                            <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-50">AI-Generated Insights</h2>
                                            <p class="text-slate-600 dark:text-slate-400 text-sm mt-1">Discover actionable recommendations to improve your personal brand</p>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <button id="refresh-insights-btn" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <polyline points="23 4 23 10 17 10"></polyline>
                                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                                </svg>
                                                Refresh
                                            </button>
                                            <button id="export-insights-btn" class="px-4 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                    <polyline points="7 10 12 15 17 10"></polyline>
                                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                                </svg>
                                                Export
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Filters Section -->
                                    <div class="bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/30 dark:border-slate-700 shadow-lg rounded-2xl p-6">
                                        <div class="flex flex-col md:flex-row gap-4">
                                            <!-- Search -->
                                            <div class="flex-1">
                                                <input type="text" id="insights-search" placeholder="Search insights..." class="w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-50 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            </div>
                                            
                                            <!-- Category Filter -->
                                            <select id="insights-category-filter" class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                <option value="all">All Categories</option>
                                                <option value="engagement">Engagement</option>
                                                <option value="review">Review</option>
                                                <option value="optimization">Optimization</option>
                                                <option value="content">Content</option>
                                                <option value="network">Network</option>
                                                <option value="portfolio">Portfolio</option>
                                                <option value="skills">Skills</option>
                                                <option value="consistency">Consistency</option>
                                            </select>
                                            
                                            <!-- Priority Filter -->
                                            <select id="insights-priority-filter" class="px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                <option value="all">All Priorities</option>
                                                <option value="high">High Priority</option>
                                                <option value="medium">Medium Priority</option>
                                                <option value="low">Low Priority</option>
                                            </select>
                                            
                                            <!-- View Toggle -->
                                            <div class="flex items-center gap-2 border border-slate-300 dark:border-slate-600 rounded-lg p-1 bg-white dark:bg-slate-700">
                                                <button id="insights-view-grid" class="insights-view-btn active px-3 py-1 rounded text-sm transition-colors">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <rect x="3" y="3" width="7" height="7"></rect>
                                                        <rect x="14" y="3" width="7" height="7"></rect>
                                                        <rect x="14" y="14" width="7" height="7"></rect>
                                                        <rect x="3" y="14" width="7" height="7"></rect>
                                                    </svg>
                                                </button>
                                                <button id="insights-view-list" class="insights-view-btn px-3 py-1 rounded text-sm transition-colors">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <line x1="8" y1="6" x2="21" y2="6"></line>
                                                        <line x1="8" y1="12" x2="21" y2="12"></line>
                                                        <line x1="8" y1="18" x2="21" y2="18"></line>
                                                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- Active Filters Display -->
                                        <div id="active-filters" class="flex flex-wrap gap-2 mt-4 hidden">
                                            <span class="text-sm text-slate-600 dark:text-slate-400">Active filters:</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Stats Section -->
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div class="bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/30 dark:border-slate-700 shadow-lg rounded-xl p-4">
                                            <div class="text-2xl font-bold text-slate-800 dark:text-slate-50" id="total-insights-count">0</div>
                                            <div class="text-sm text-slate-600 dark:text-slate-400">Total Insights</div>
                                        </div>
                                        <div class="bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/30 dark:border-slate-700 shadow-lg rounded-xl p-4">
                                            <div class="text-2xl font-bold text-red-600 dark:text-red-400" id="unread-insights-count">0</div>
                                            <div class="text-sm text-slate-600 dark:text-slate-400">Unread</div>
                                        </div>
                                        <div class="bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/30 dark:border-slate-700 shadow-lg rounded-xl p-4">
                                            <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" id="high-priority-count">0</div>
                                            <div class="text-sm text-slate-600 dark:text-slate-400">High Priority</div>
                                        </div>
                                        <div class="bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/30 dark:border-slate-700 shadow-lg rounded-xl p-4">
                                            <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="actionable-count">0</div>
                                            <div class="text-sm text-slate-600 dark:text-slate-400">Actionable</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Insights Grid/List Container -->
                                    <div id="insights-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        <!-- Insights will be rendered here -->
                                    </div>
                                    
                                    <!-- Empty State -->
                                    <div id="insights-empty-state" class="hidden text-center py-16 bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/30 dark:border-slate-700 shadow-lg rounded-2xl">
                                        <div class="text-6xl mb-4"></div>
                                        <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-50 mb-2">No insights found</h3>
                                        <p class="text-slate-600 dark:text-slate-400">Try adjusting your filters to see more results</p>
                                    </div>
                                    
                                    <!-- Loading State -->
                                    <div id="insights-loading" class="hidden text-center py-16">
                                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-indigo-600 border-t-transparent"></div>
                                        <p class="mt-4 text-slate-600 dark:text-slate-400">Loading insights...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="goals-tab-content" class="ai-mentor-tab-content hidden"></div>
                            <div id="achievements-tab-content" class="ai-mentor-tab-content hidden">
                                <!-- Achievements Tab Content will be loaded dynamically -->
                            </div>
                            <div id="settings-tab-content" class="ai-mentor-tab-content hidden"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="upskilling-dash-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Upskilling Dashboard Content -->
                    <div id="upskilling-dash-container"></div>
                </div>
            </div>
            
            <div id="career-portfolio-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- AI-Generated Career Portfolio/Microsite Content -->
                    <div id="career-portfolio-container"></div>
                </div>
            </div>
            
            <div id="resume-studio-content" class="max-w-7xl mx-auto hidden">
                    <!-- Smart Resume Studio Content -->
                <div class="pt-6">
                    <div id="resume-studio-container"></div>
                </div>
            </div>
            
            <div id="app-tailor-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Application Tailor Content -->
                    <div id="app-tailor-container"></div>
                </div>
            </div>
            
            <div id="cover-letter-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Cover Letter Generator Content -->
                    <div id="cover-letter-container"></div>
                </div>
            </div>
            
            <div id="job-finder-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Job Finder Content -->
                    <div id="job-finder-container"></div>
                </div>
            </div>
            
            <div id="job-tracker-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Job Tracker Content -->
                    <div id="job-tracker-container"></div>
                </div>
            </div>
            
            <div id="interview-prep-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Interview Prep Kit Content -->
                    <div id="interview-prep-container"></div>
                </div>
            </div>
            
            <div id="work-history-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Work History Manager Content -->
                    <div id="work-history-container"></div>
                </div>
            </div>
            
            <div id="ai-brand-audit-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- AI-Powered Personal Brand Audit Content -->
                    <div id="ai-brand-audit-container"></div>
                </div>
            </div>
            
            <div id="content-engine-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Content Engine for Thought Leadership Content -->
                    <div id="content-engine-container"></div>
                </div>
            </div>
            
            <div id="career-event-scout-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Career Event Scout Content -->
                    <div id="career-event-scout-container"></div>
                </div>
            </div>
            
            <div id="brand-intelligence-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- AI Brand Intelligence Content -->
                    <div id="brand-intelligence-container"></div>
                </div>
            </div>
            
            <div id="skill-radar-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Skill Radar Content -->
                    <div id="skill-radar-container"></div>
                </div>
            </div>
            
            <div id="learning-path-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Learning Path Content -->
                    <div id="learning-path-container"></div>
                </div>
            </div>
            
            <div id="sprints-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Sprints Content -->
                    <div id="sprints-container"></div>
                </div>
            </div>
            
            <div id="certifications-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Certifications Content -->
                    <div id="certifications-container"></div>
                </div>
            </div>
            
            <div id="skill-benchmarking-content" class="max-w-7xl mx-auto hidden">
                <div class="pt-6">
                    <!-- Skill Benchmarking Content -->
                    <div id="skill-benchmarking-container"></div>
                </div>
            </div>
            
            </div>
        </div>
    </main>

    <!-- Notification Modal -->
    <div id="notification-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <!-- Overlay -->
        <div id="notification-modal-overlay" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <!-- Modal Content -->
        <div id="notification-modal-content" class="relative w-full max-w-2xl bg-white/50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl shadow-lg border border-white/30 dark:border-slate-700 m-4 flex flex-col" style="max-height: 90vh;">
            <!-- Header -->
            <div class="flex items-center justify-between p-5 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <h3 id="notification-modal-title" class="text-lg font-semibold text-slate-800 dark:text-slate-100">Notifications</h3>
                    <span id="modal-header-notification-badge" class="bg-indigo-600 text-white text-xs font-semibold px-2 py-0.5 rounded-full hidden"></span>
                </div>
                <div class="flex items-center gap-2">
                    <button id="close-notification-modal" class="p-2 rounded-lg hover:bg-slate-200/60 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
            </div>
            <!-- Notification List -->
            <ul id="notification-list" class="overflow-y-auto p-4 space-y-3 flex-grow custom-scrollbar relative">
                <!-- Notifications will be dynamically inserted here -->
            </ul>
            <!-- Footer Actions -->
            <div id="notification-actions" class="p-4 flex-shrink-0 flex items-center justify-between">
                <button id="history-button" class="px-4 py-2 text-white rounded-lg font-medium transition-all duration-300">History</button>
                <button id="back-button" class="px-4 py-2 bg-slate-500 text-white rounded-lg font-medium hover:bg-slate-600 transition-all duration-300 hidden">
                    &larr; Back to Notifications
                </button>
                <button id="clear-all-button" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-all duration-300">Clear All</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <!-- Overlay -->
        <div id="settings-modal-overlay" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <!-- Modal Content -->
        <div id="settings-modal-content" class="relative w-full max-w-4xl bg-white/50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl shadow-lg border border-white/30 dark:border-slate-700 m-4 flex flex-col" style="max-height: 90vh;">
            <!-- Header -->
            <div class="flex items-center justify-between p-5 flex-shrink-0 border-b border-white/30 dark:border-slate-700">
                <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-100">Settings</h3>
                <button id="close-settings-modal" class="p-2 rounded-lg hover:bg-slate-200/60 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <!-- Main Content Area -->
            <div class="flex flex-grow overflow-hidden">
                <!-- Left Navigation -->
                <nav class="w-1/4 p-4 border-r border-white/30 dark:border-slate-700 overflow-y-auto custom-scrollbar">
                    <ul class="space-y-1">
                        <li><button class="settings-tab active" data-tab="profile">Profile</button></li>
                        <li><button class="settings-tab" data-tab="integrations">Integrations</button></li>
                        <li><button class="settings-tab" data-tab="billing">Manage Billing</button></li>
                        <li><button class="settings-tab" data-tab="invoices">Invoices</button></li>
                        <li><button class="settings-tab" data-tab="security">Security</button></li>
                        <li><button class="settings-tab" data-tab="notifications-settings">Notifications</button></li>
                    </ul>
                </nav>
                <!-- Right Content Panels -->
                <div class="w-3/4 p-6 overflow-y-auto custom-scrollbar">
                    <!-- Profile Content -->
                    <div id="profile-settings-content" class="settings-tab-content space-y-6">
                        <div>
                            <h4 class="text-xl font-semibold text-slate-800">Personal Profile</h4>
                            <p class="text-slate-500 mt-1">This is how your profile looks to others.</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <img src="https://placehold.co/64x64/e2e8f0/64748b?text=U" class="w-16 h-16 rounded-full object-cover" alt="User Avatar">
                            <div>
                                <button class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-200">Change</button>
                                <button class="p-2 text-slate-500 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                            </div>
                        </div>
                        <div>
                            <label for="fullName" class="block text-sm font-medium text-slate-700">Full Name</label>
                            <input type="text" id="fullName" value="User Name" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-white/70 dark:bg-slate-700/50 dark:border-slate-600 dark:text-slate-200 p-2">
                        </div>
                         <div>
                            <label for="email" class="block text-sm font-medium text-slate-700">Email Address</label>
                            <input type="email" id="email" value="user.name@example.com" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-white/70 dark:bg-slate-700/50 dark:border-slate-600 dark:text-slate-200 p-2">
                        </div>
                    </div>
                    <!-- Other Settings Content (Initially Hidden) -->
                    <div id="integrations-settings-content" class="settings-tab-content hidden space-y-6">
                         <div>
                            <h4 class="text-xl font-semibold text-slate-800 dark:text-slate-100">Integrations</h4>
                            <p class="text-slate-500 dark:text-slate-400 mt-1">Connect your favorite apps to streamline your workflow.</p>
                        </div>
                        
                        <!-- OpenAI API Integration -->
                        <div class="bg-white/50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-xl p-6 space-y-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600 dark:text-green-400">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h5 class="text-lg font-semibold text-slate-800 dark:text-slate-100">OpenAI API</h5>
                                    <p class="text-sm text-slate-500 dark:text-slate-400">Power AI features across the platform</p>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="openai-api-key" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        API Key
                                    </label>
                                    <div class="flex gap-2">
                                        <input 
                                            type="password" 
                                            id="openai-api-key" 
                                            placeholder="sk-..." 
                                            class="flex-1 px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white/70 dark:bg-slate-800/50 text-slate-900 dark:text-slate-100 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none"
                                        />
                                        <button 
                                            id="toggle-api-key-visibility"
                                            class="px-4 py-2 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors"
                                            type="button"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                <circle cx="12" cy="12" r="3"></circle>
                                            </svg>
                                        </button>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">
                                        Your API key is stored locally and never sent to our servers.
                                    </p>
                                </div>
                                
                                <div class="flex items-center gap-4">
                                    <button 
                                        id="test-api-key-button"
                                        class="px-4 py-2 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-lg text-sm font-medium hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition-colors"
                                    >
                                        Test Connection
                                    </button>
                                    <span id="api-key-status" class="text-sm text-slate-500 dark:text-slate-400"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- JSearch API Integration -->
                        <div class="bg-white/50 dark:bg-slate-700/50 border border-slate-200 dark:border-slate-600 rounded-xl p-6 space-y-4">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                                    <span class="text-2xl"></span>
                                </div>
                                <div>
                                    <h5 class="text-lg font-semibold text-slate-800 dark:text-slate-100">JSearch API</h5>
                                    <p class="text-sm text-slate-500 dark:text-slate-400">Get real job listings from job boards</p>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="jsearch-api-key" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                        JSearch API Key (Optional)
                                    </label>
                                    <div class="flex gap-2">
                                        <input 
                                            type="password" 
                                            id="jsearch-api-key" 
                                            placeholder="Enter your JSearch API key" 
                                            class="flex-1 px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white/70 dark:bg-slate-800/50 text-slate-900 dark:text-slate-100 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none"
                                        />
                                        <button 
                                            id="toggle-jsearch-api-key-visibility"
                                            class="px-4 py-2 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors"
                                            type="button"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                <circle cx="12" cy="12" r="3"></circle>
                                            </svg>
                                        </button>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">
                                        <strong>Note:</strong> JSearch API has browser CORS restrictions. For real job data, you'd need a backend proxy. Currently using AI-powered realistic job listings instead.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div id="billing-settings-content" class="settings-tab-content hidden">
                         <div>
                            <h4 class="text-xl font-semibold text-slate-800">Manage Billing</h4>
                            <p class="text-slate-500 mt-1">Update your payment method and view your subscription details.</p>
                        </div>
                    </div>
                     <div id="invoices-settings-content" class="settings-tab-content hidden">
                         <div>
                            <h4 class="text-xl font-semibold text-slate-800">Invoices</h4>
                            <p class="text-slate-500 mt-1">Review and download your past invoices.</p>
                        </div>
                    </div>
                     <div id="security-settings-content" class="settings-tab-content hidden">
                         <div>
                            <h4 class="text-xl font-semibold text-slate-800">Security</h4>
                            <p class="text-slate-500 mt-1">Manage your password and two-factor authentication.</p>
                        </div>
                    </div>
                    <div id="notifications-settings-settings-content" class="settings-tab-content hidden">
                         <div>
                            <h4 class="text-xl font-semibold text-slate-800">Notification Settings</h4>
                            <p class="text-slate-500 mt-1">Choose how and when you want to be notified.</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer -->
            <div id="settings-actions" class="p-4 flex-shrink-0 flex items-center justify-end gap-4 border-t border-white/30 dark:border-slate-700">
                <button id="cancel-settings-button" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-lg font-medium hover:bg-slate-300 dark:bg-slate-600 dark:text-slate-200 dark:hover:bg-slate-500 transition-colors">Cancel</button>
                <button id="save-settings-button" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Floating Chat Button -->
    <button id="chat-widget-button" class="fixed bottom-8 right-8 w-16 h-16 bg-indigo-600 rounded-full shadow-lg flex items-center justify-center text-white hover:bg-indigo-700 transition-colors z-50">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
    </button>
    
    <!-- Chat Widget -->
    <div id="chat-widget" class="fixed bottom-28 right-8 w-full max-w-sm h-full max-h-[600px] rounded-2xl shadow-lg hidden z-50 flex flex-col overflow-hidden">
        
        <!-- Close Button -->
        <button id="close-chat-widget" class="absolute top-4 right-4 z-20 p-2 rounded-full text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        
        <!-- Messages -->
        <div id="chat-messages" class="flex-grow p-4 space-y-4 overflow-y-auto custom-scrollbar flex flex-col">
            <!-- Animation HTML -->
            <div id="stars-container"></div>
            <div class="section-banner-sun"></div>
            <!-- Messages will be injected here -->
        </div>
        
        <!-- Input -->
        <div class="p-4 flex-shrink-0">
            <div class="flex items-center gap-2">
                <input type="text" id="chat-input" placeholder="Type your message..." class="w-full h-10 px-3 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-300 text-sm text-slate-800 dark:text-slate-200">
                <button id="send-chat-button" class="w-10 h-10 bg-indigo-600 text-white rounded-lg flex items-center justify-center flex-shrink-0 hover:bg-indigo-700 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            
            if (sidebar && sidebarToggle) {
                sidebarToggle.addEventListener('click', () => {
                    const isCollapsed = sidebar.classList.contains('collapsed');
                    const toggleIcon = document.getElementById('sidebar-toggle-icon');

                    if (isCollapsed) {
                        // Expanding
                        sidebar.classList.remove('w-16', 'collapsed');
                        sidebar.classList.add('w-[16.5rem]');
                        if (toggleIcon) toggleIcon.classList.remove('rotate-180');
                    } else {
                        // Collapsing
                        sidebar.classList.remove('w-[16.5rem]');
                        sidebar.classList.add('w-16', 'collapsed');
                        if (toggleIcon) toggleIcon.classList.add('rotate-180');
                    }
                });
            }

            // New navigation logic
            const sidebarLinks = document.querySelectorAll('.sidebar-link');
            const contentSections = {
                'dashboard': document.getElementById('dashboard-content'),
                'brand-audit': document.getElementById('brand-audit-content'),
                'upskilling-dash': document.getElementById('upskilling-dash-content'),
                'career-portfolio': document.getElementById('career-portfolio-content'),
                'resume-studio': document.getElementById('resume-studio-content'),
                'app-tailor': document.getElementById('app-tailor-content'),
                'cover-letter': document.getElementById('cover-letter-content'),
                'job-finder': document.getElementById('job-finder-content'),
                'job-tracker': document.getElementById('job-tracker-content'),
                'interview-prep': document.getElementById('interview-prep-content'),
                'work-history': document.getElementById('work-history-content'),
                'ai-brand-audit': document.getElementById('ai-brand-audit-content'),
                'content-engine': document.getElementById('content-engine-content'),
                'event-scout': document.getElementById('career-event-scout-content'),
                'brand-intelligence': document.getElementById('brand-intelligence-content'),
                'skill-radar': document.getElementById('skill-radar-content'),
                'learning-path': document.getElementById('learning-path-content'),
                'sprints': document.getElementById('sprints-content'),
                'certifications': document.getElementById('certifications-content'),
                'benchmarking': document.getElementById('skill-benchmarking-content')
            };

            const headerMainTitle = document.getElementById('header-main-title');
            const headerSubtitle = document.getElementById('header-subtitle');
            const headerIconContainer = document.getElementById('header-icon-container');

            const headerContentMap = {
                'dashboard': { title: 'Dashboard', subtitle: 'Organize your work and improve your performance.' },
                'resume-studio': { title: 'Smart Resume Studio', subtitle: 'Craft the perfect resume with AI assistance.' },
                'app-tailor': { title: 'Application Tailor', subtitle: 'Customize your applications for each job.' },
                'cover-letter': { title: 'Cover Letter Generator', subtitle: 'Create compelling cover letters in minutes.' },
                'job-finder': { title: 'Job Finder', subtitle: 'Discover your next career opportunity.' },
                'job-tracker': { title: 'Job Tracker', subtitle: 'Keep your job applications organized.' },
                'interview-prep': { title: 'Interview Prep Kit', subtitle: 'Ace your next interview with AI-powered tools.' },
                'work-history': { title: 'Work History Manager', subtitle: 'A complete record of your professional experience.' },
                'brand-audit': { title: 'AI Personal Brand Audit', subtitle: 'Get a comprehensive analysis of your online presence.' },
                'content-engine': { title: 'Content Engine', subtitle: 'Generate professional content to build your brand.' },
                'career-portfolio': { title: 'AI Career Portfolio', subtitle: 'Your living, breathing mentor experience.' },
                'event-scout': { title: 'Career Event Scout', subtitle: 'Find networking events and opportunities.' },
                'brand-intelligence': { title: 'AI Brand Intelligence', subtitle: 'Monitor your brand and industry trends.' },
                'upskilling-dash': { title: 'Upskilling Dashboard', subtitle: 'Your central hub for skill growth.' },
                'skill-radar': { title: 'Skill Radar', subtitle: 'Identify and track in-demand skills.' },
                'learning-path': { title: 'Learning Path', subtitle: 'Personalized learning plans for your goals.' },
                'sprints': { title: 'Sprints', subtitle: 'Focused, short-term learning challenges.' },
                'certifications': { title: 'Certifications', subtitle: 'Track and manage your professional certifications.' },
                'benchmarking': { title: 'Skill Benchmarking', subtitle: 'See how your skills stack up against your peers.' }
            };

            function updateHeader(linkId) {
                const content = headerContentMap[linkId];
                const sourceLink = document.querySelector(`.sidebar-link[data-id="${linkId}"]`);

                if (content && headerMainTitle && headerSubtitle) {
                    headerMainTitle.textContent = content.title;
                    headerSubtitle.textContent = content.subtitle;
                } else { 
                    const linkText = sourceLink ? sourceLink.querySelector('.sidebar-text').textContent.trim() : 'Dashboard';
                    headerMainTitle.textContent = linkText;
                    headerSubtitle.textContent = 'Manage your career effectively.';
                }

                if (sourceLink && headerIconContainer) {
                    const iconSVG = sourceLink.querySelector('svg').cloneNode(true);
                    iconSVG.classList.remove(...iconSVG.classList);
                    iconSVG.classList.add('w-6', 'h-6', 'text-white');
                    headerIconContainer.innerHTML = ''; 
                    headerIconContainer.appendChild(iconSVG);
                }
            }


            // Set initial state
            const setActiveLink = (linkId) => {
                sidebarLinks.forEach(link => {
                    link.classList.remove('active');
                });
                const activeLink = document.querySelector(`.sidebar-link[data-id="${linkId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                updateHeader(linkId);
            };
            
            function animateSkillProgress(percentage) {
                const circle = document.getElementById('skill-progress-circle');
                const text = document.getElementById('skill-progress-text');
                if (!circle || !text) return;

                const radius = circle.r.baseVal.value;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (percentage / 100) * circumference;

                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                // Set initial state without transition to avoid animation on page load
                circle.style.transition = 'none';
                circle.style.strokeDashoffset = circumference;
                
                // Use a timeout to apply the transition and new offset, forcing a reflow
                setTimeout(() => {
                    circle.style.transition = 'stroke-dashoffset 1s ease-out';
                    circle.style.strokeDashoffset = offset;
                }, 50);

                // Animate the text
                let start = 0;
                const duration = 1000;
                const startTime = performance.now();

                function step(currentTime) {
                    const elapsedTime = currentTime - startTime;
                    const progress = Math.min(elapsedTime / duration, 1);
                    const currentVal = Math.round(progress * percentage);
                    
                    text.textContent = `${currentVal}%`;

                    if (progress < 1) {
                        requestAnimationFrame(step);
                    } else {
                        text.textContent = `${percentage}%`;
                    }
                }
                requestAnimationFrame(step);
            }

            const mainPaddingWrapper = document.getElementById('main-padding-wrapper');
            const showContent = (contentId) => {
                // Cleanup Work History Manager when navigating away
                if (contentId !== 'work-history' && window.cleanupWorkHistoryManager) {
                    window.cleanupWorkHistoryManager();
                }
                
                Object.values(contentSections).forEach(section => {
                    if (section) section.classList.add('hidden');
                });

                const activeContent = contentSections[contentId];
                if (activeContent) {
                    activeContent.classList.remove('hidden');
                     // If showing the upskilling dash, trigger animation
                    if (contentId === 'upskilling-dash') {
                        animateSkillProgress(65); // Hardcoded value from PRD
                    }
                    // If showing the app-tailor, trigger rendering
                    if (contentId === 'resume-studio') {
                        setTimeout(() => {
                            window.renderSmartResumeStudio();
                        }, 100);
                    }
                    // If showing the app-tailor, trigger rendering
                    if (contentId === 'app-tailor') {
                        setTimeout(() => {
                            console.log('Application Tailor content shown, triggering render...');
                            window.renderApplicationTailor();
                        }, 100);
                    }
                    // If showing the cover-letter, trigger rendering
                    if (contentId === 'cover-letter') {
                        setTimeout(() => {
                            console.log('Cover Letter Generator content shown, triggering render...');
                            window.renderCoverLetterGenerator();
                        }, 100);
                    }
                    // If showing the job-finder, trigger rendering
                    if (contentId === 'job-finder') {
                        setTimeout(() => {
                            console.log('Job Finder content shown, triggering render...');
                            window.renderJobFinder();
                        }, 100);
                    }
                    // If showing the job-tracker, trigger rendering
                    if (contentId === 'job-tracker') {
                        setTimeout(() => {
                            console.log('Job Tracker content shown, triggering render...');
                            window.renderJobTracker();
                        }, 100);
                    }
                    // If showing the interview-prep, trigger rendering
                    if (contentId === 'interview-prep') {
                        setTimeout(() => {
                            console.log('Interview Prep Kit content shown, triggering render...');
                            window.renderInterviewPrepKit();
                        }, 100);
                    }
                    // If showing the work-history, trigger rendering
                    if (contentId === 'work-history') {
                        setTimeout(() => {
                            console.log('Work History Manager content shown, triggering render...');
                            window.renderWorkHistoryManager();
                        }, 100);
                    }
                    // If showing the ai-brand-audit, trigger rendering
                    if (contentId === 'ai-brand-audit') {
                        setTimeout(() => {
                            console.log('AI-Powered Personal Brand Audit content shown, triggering render...');
                            window.renderAIBrandAudit();
                        }, 100);
                    }
                    // If showing the content-engine, trigger rendering
                    if (contentId === 'content-engine') {
                        setTimeout(() => {
                            console.log('Content Engine for Thought Leadership content shown, triggering render...');
                            window.renderContentEngine();
                        }, 100);
                    }
                    // If showing the career-portfolio, trigger rendering
                    if (contentId === 'career-portfolio') {
                        setTimeout(() => {
                            console.log('AI-Generated Career Portfolio/Microsite content shown, triggering render...');
                            window.renderAIPortfolio();
                        }, 100);
                    }
                    // If showing the event-scout, trigger rendering
                    if (contentId === 'event-scout') {
                        setTimeout(() => {
                            console.log('Career Event Scout content shown, triggering render...');
                            window.renderCareerEventScout();
                        }, 100);
                    }
                    // If showing the brand-intelligence, trigger rendering
                    if (contentId === 'brand-intelligence') {
                        setTimeout(() => {
                            console.log('AI Brand Intelligence content shown, triggering render...');
                            window.renderAIBrandIntelligence();
                        }, 100);
                    }
                    // If showing the upskilling-dash, trigger rendering
                    if (contentId === 'upskilling-dash') {
                        setTimeout(() => {
                            console.log('Upskilling Dashboard content shown, triggering render...');
                            window.renderUpskillingDashboard();
                        }, 100);
                    }
                    // If showing the skill-radar, trigger rendering
                    if (contentId === 'skill-radar') {
                        setTimeout(() => {
                            console.log('Skill Radar content shown, triggering render...');
                            window.renderSkillRadar();
                        }, 100);
                    }
                    // If showing the learning-path, trigger rendering
                    if (contentId === 'learning-path') {
                        setTimeout(() => {
                            console.log('Learning Path content shown, triggering render...');
                            window.renderLearningPath();
                        }, 100);
                    }
                    // If showing the sprints, trigger rendering
                    if (contentId === 'sprints') {
                        setTimeout(() => {
                            console.log('Sprints content shown, triggering render...');
                            window.renderSprints();
                        }, 100);
                    }
                    // If showing the certifications, trigger rendering
                    if (contentId === 'certifications') {
                        setTimeout(() => {
                            console.log('Certifications content shown, triggering render...');
                            window.renderCertifications();
                        }, 100);
                    }
                    // If showing the benchmarking, trigger rendering
                    if (contentId === 'benchmarking') {
                        setTimeout(() => {
                            console.log('Skill Benchmarking content shown, triggering render...');
                            window.renderSkillBenchmarking();
                        }, 100);
                    }
                }
            };

            // Initially show Brand Audit
            setActiveLink('brand-audit');
            showContent('brand-audit');

            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const linkId = link.dataset.id;
                    
                    if (contentSections[linkId]) {
                        setActiveLink(linkId);
                        showContent(linkId);
                    }
                });
            });

            // AI Mentor Tabs Logic
            const mentorTabs = document.querySelectorAll('.ai-mentor-tab');
            const mentorTabContents = document.querySelectorAll('.ai-mentor-tab-content');

            mentorTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');

                    // Update button styles
                    mentorTabs.forEach(t => {
                        t.classList.remove('active');
                    });
                    tab.classList.add('active');
                    
                    // Show content
                    mentorTabContents.forEach(content => {
                        if (content.id === `${tabId}-tab-content`) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });

                    // Handle insights tab specially
                    if (tabId === 'insights') {
                        renderInsightsPage();
                    } else if (tabId === 'achievements') {
                        // Load achievements tab
                        loadAchievementsTab();
                    } else if (tabId !== 'dashboard') {
                    // For now, other tabs show a placeholder
                        const contentEl = document.getElementById(`${tabId}-tab-content`);
                        if(contentEl && !contentEl.innerHTML) {
                             contentEl.innerHTML = `<div class="text-center p-16 bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl">
                                  <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-50">Content for ${tab.textContent} coming soon!</h3>
                                  <p class="text-slate-600 dark:text-slate-400 mt-2">This section is under construction.</p>
                                  </div>`;
                        }
                    }
                });
            });

            // User menu toggle
            const userMenuButton = document.getElementById('user-menu-button');
            const userMenu = document.getElementById('user-menu');
            
            if (userMenuButton && userMenu) {
                userMenuButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userMenu.classList.toggle('hidden');
                });

                document.addEventListener('click', (e) => {
                    if (!userMenu.contains(e.target) && !userMenuButton.contains(e.target)) {
                        userMenu.classList.add('hidden');
                    }
                });
            }

            // Photo Upload
            const uploadPhotoButton = document.getElementById('upload-photo-button');
            const photoUpload = document.getElementById('photo-upload');
            const userAvatar = document.getElementById('user-avatar');
            const userAvatarDropdown = document.getElementById('user-avatar-dropdown');

            if (uploadPhotoButton && photoUpload && userAvatar && userAvatarDropdown) {
                uploadPhotoButton.addEventListener('click', () => photoUpload.click());
                photoUpload.addEventListener('change', (event) => {
                    if (event.target.files && event.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imageUrl = e.target.result;
                            userAvatar.src = imageUrl;
                            userAvatarDropdown.src = imageUrl;
                        };
                        reader.readAsDataURL(event.target.files[0]);
                    }
                });
            }

            // Dark Mode Toggle
            const darkModeRow = document.getElementById('dark-mode-row');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            if (darkModeRow && darkModeToggle) {
                darkModeRow.addEventListener('click', () => {
                    document.documentElement.classList.toggle('dark');
                    const toggleCircle = darkModeToggle.querySelector('span:last-child');
                    if (document.documentElement.classList.contains('dark')) {
                        toggleCircle.classList.remove('translate-x-1');
                        toggleCircle.classList.add('translate-x-6');
                        darkModeToggle.classList.remove('bg-slate-200');
                        darkModeToggle.classList.add('bg-indigo-600');
                    } else {
                        toggleCircle.classList.remove('translate-x-6');
                        toggleCircle.classList.add('translate-x-1');
                        darkModeToggle.classList.remove('bg-indigo-600');
                        darkModeToggle.classList.add('bg-slate-200');
                    }
                });
            }

            // --- Notification Logic ---
            const userIconBadge = document.getElementById('user-icon-notification-badge');
            const dropdownBadge = document.getElementById('dropdown-notification-badge');
            const notificationMenuButton = document.getElementById('notification-menu-button');
            const addNotificationButton = document.getElementById('add-notification-button');
            
            // Modal Elements
            const notificationModal = document.getElementById('notification-modal');
            const notificationList = document.getElementById('notification-list');
            const closeNotificationModalButton = document.getElementById('close-notification-modal');
            const notificationModalOverlay = document.getElementById('notification-modal-overlay');
            const modalHeaderBadge = document.getElementById('modal-header-notification-badge');
            const modalTitle = document.getElementById('notification-modal-title');
            const historyButton = document.getElementById('history-button');
            const clearAllButton = document.getElementById('clear-all-button');
            const backButton = document.getElementById('back-button');

            // --- Notification State ---
            let isHistoryView = false;
            let notificationHistory = [];
            
            // Demo notifications data
            let notifications = [
                // Today
                { id: 1, text: "Your profile analysis is complete. View your new insights.", timestamp: "5 mins ago", read: false, sourceId: 'brand-intelligence', createdAt: new Date('2025-09-20T09:35:00Z').getTime() },
                { id: 2, text: "Your brand score improved by 5 points!", timestamp: "50 mins ago", read: false, sourceId: 'brand-audit', createdAt: new Date('2025-09-20T08:50:00Z').getTime() },
                { id: 3, text: "New feature 'AI Portfolio' is now available.", timestamp: "2 hours ago", read: false, sourceId: 'career-portfolio', createdAt: new Date('2025-09-20T07:50:00Z').getTime() },
                { id: 4, text: "You have 3 new job recommendations.", timestamp: "5 hours ago", read: false, sourceId: 'job-finder', createdAt: new Date('2025-09-20T04:50:00Z').getTime() },
                
                // Yesterday
                { id: 5, text: "You have a new connection request from Jane Doe.", timestamp: "Yesterday", read: true, sourceId: 'event-scout', createdAt: new Date('2025-09-19T18:00:00Z').getTime() },
                { id: 6, text: "Monthly Brand Review is ready.", timestamp: "Yesterday", read: true, sourceId: 'brand-audit', createdAt: new Date('2025-09-19T12:00:00Z').getTime() },

                // This Week
                { id: 7, text: "A new post was generated for your review.", timestamp: "Wednesday", read: true, sourceId: 'content-engine', createdAt: new Date('2025-09-17T10:00:00Z').getTime() },
                { id: 8, text: "3 new articles have been generated by the Content Engine.", timestamp: "Tuesday", read: true, sourceId: 'content-engine', createdAt: new Date('2025-09-16T14:00:00Z').getTime() },
                
                // Previously (This Month / Older)
                { id: 9, text: "A new skill 'Data Analysis' was added to your Skill Radar.", timestamp: "Sep 5", read: true, sourceId: 'skill-radar', createdAt: new Date('2025-09-05T09:00:00Z').getTime() },
                { id: 10, text: "Your 'Content Engine' summary from last month.", timestamp: "Last month", read: true, sourceId: 'content-engine', createdAt: new Date('2025-08-15T12:00:00Z').getTime() },
                { id: 11, text: "Older notification from a while back.", timestamp: "2 months ago", read: true, sourceId: 'dashboard', createdAt: new Date('2025-07-10T12:00:00Z').getTime() },
            ];
            
            // --- Insights Data Structure ---
            let insightsData = [];
            
            // Initialize default insights data
            const defaultInsights = [
                {
                    id: 1,
                    title: "Your LinkedIn Engagement is Trending Up!",
                    description: "Great progress this week! Your brand score improved by 8 points. Your engagement metrics are trending upward...",
                    fullDescription: "Detailed analysis shows your engagement metrics increased by 23% this week. Your posts are receiving more comments and shares, indicating growing audience interest. This positive trend suggests your content strategy is resonating with your network.",
                    category: "engagement",
                    priority: "high",
                    date: new Date('2025-09-20T09:35:00Z'),
                    type: "trending",
                    read: false,
                    actionable: true,
                    metrics: { change: 8, percentage: 23, trend: "up" },
                    icon: "",
                    source: "brand-audit"
                },
                {
                    id: 2,
                    title: "Monthly Brand Review: Strategic Positioning",
                    description: "This month has been a journey of growth and learning. You've made meaningful progress in building your professional brand...",
                    fullDescription: "Your monthly brand review reveals significant improvements across multiple dimensions. Your visibility score increased by 12%, professional presence is up 8%, and network quality improved by 15%. Strategic positioning in your industry is becoming more defined.",
                    category: "review",
                    priority: "medium",
                    date: new Date('2025-09-19T12:00:00Z'),
                    type: "monthly-review",
                    read: false,
                    actionable: true,
                    metrics: { visibility: 12, presence: 8, network: 15 },
                    icon: "",
                    source: "brand-audit"
                },
                {
                    id: 3,
                    title: "LinkedIn Profile Optimization Opportunity",
                    description: "Your profile is missing key information that could improve visibility by 25%.",
                    fullDescription: "Analysis shows that adding a professional summary, skills section, and featured work could significantly boost your profile's discoverability. Profiles with complete information receive 3x more profile views.",
                    category: "optimization",
                    priority: "high",
                    date: new Date('2025-09-18T10:00:00Z'),
                    type: "recommendation",
                    read: false,
                    actionable: true,
                    metrics: { potentialIncrease: 25 },
                    icon: "",
                    source: "brand-audit"
                },
                {
                    id: 4,
                    title: "Content Engagement Strategy Working",
                    description: "Your recent posts have shown 40% higher engagement rates compared to last month.",
                    fullDescription: "The shift to more technical content and industry insights is paying off. Your posts are getting more meaningful comments and shares, indicating you're building thought leadership in your field.",
                    category: "content",
                    priority: "medium",
                    date: new Date('2025-09-17T14:30:00Z'),
                    type: "success",
                    read: true,
                    actionable: false,
                    metrics: { engagementIncrease: 40 },
                    icon: "",
                    source: "content-engine"
                },
                {
                    id: 5,
                    title: "Network Growth Milestone",
                    description: "You've reached 3,200 connections! You're 64% of the way to your goal of 5,000.",
                    fullDescription: "Continuing at this rate, you'll reach your goal in approximately 3 months. Consider engaging more with existing connections to strengthen relationships while growing your network.",
                    category: "network",
                    priority: "low",
                    date: new Date('2025-09-16T09:00:00Z'),
                    type: "milestone",
                    read: true,
                    actionable: true,
                    metrics: { current: 3200, goal: 5000, progress: 64 },
                    icon: "",
                    source: "brand-audit"
                },
                {
                    id: 6,
                    title: "Portfolio Enhancement Needed",
                    description: "Adding case studies to your portfolio could increase credibility by 35%.",
                    fullDescription: "Your portfolio showcases projects well, but adding detailed case studies with problem-solving approaches, challenges faced, and results achieved would significantly enhance your professional credibility.",
                    category: "portfolio",
                    priority: "medium",
                    date: new Date('2025-09-15T11:20:00Z'),
                    type: "recommendation",
                    read: false,
                    actionable: true,
                    metrics: { credibilityIncrease: 35 },
                    icon: "",
                    source: "brand-audit"
                },
                {
                    id: 7,
                    title: "Skill Gap Identified",
                    description: "Consider learning Docker to increase your marketability by 23%.",
                    fullDescription: "Based on job market analysis, Docker skills are in high demand for your target roles. Adding this skill could open up 15-20% more job opportunities in your field.",
                    category: "skills",
                    priority: "high",
                    date: new Date('2025-09-14T08:45:00Z'),
                    type: "skill-gap",
                    read: false,
                    actionable: true,
                    metrics: { marketabilityIncrease: 23, opportunityIncrease: 18 },
                    icon: "",
                    source: "skill-radar"
                },
                {
                    id: 8,
                    title: "Brand Consistency Score",
                    description: "Your brand messaging is consistent across platforms, scoring 85/100.",
                    fullDescription: "Excellent work maintaining consistent messaging across LinkedIn, portfolio, and resume. This consistency helps build a strong, recognizable personal brand.",
                    category: "consistency",
                    priority: "low",
                    date: new Date('2025-09-13T16:00:00Z'),
                    type: "score",
                    read: true,
                    actionable: false,
                    metrics: { score: 85 },
                    icon: "",
                    source: "brand-audit"
                }
            ];
            
            function filterOldNotifications() {
                // Automatically remove notifications older than 30 days from active list
                const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                notifications = notifications.filter(n => n.createdAt >= thirtyDaysAgo);
                 // We could also clean up the history here if needed, but the prompt implies they persist.
            }
            
            // --- Insights Data Management Functions ---
            
            // Initialize insights data from localStorage or use defaults
            function initializeInsightsData() {
                try {
                    const saved = localStorage.getItem('brand_audit_insights');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        // Convert date strings back to Date objects
                        insightsData = parsed.map(insight => ({
                            ...insight,
                            date: new Date(insight.date)
                        }));
                    } else {
                        insightsData = [...defaultInsights];
                        saveInsightsToStorage();
                    }
                } catch (error) {
                    console.error('Error loading insights:', error);
                    insightsData = [...defaultInsights];
                }
            }
            
            // Save insights to localStorage
            function saveInsightsToStorage() {
                try {
                    localStorage.setItem('brand_audit_insights', JSON.stringify(insightsData));
                } catch (error) {
                    console.error('Error saving insights:', error);
                }
            }
            
            // Get insights filtered by category
            function getInsightsByCategory(category) {
                if (!category || category === 'all') return insightsData;
                return insightsData.filter(insight => insight.category === category);
            }
            
            // Get insights filtered by priority
            function getInsightsByPriority(priority) {
                if (!priority || priority === 'all') return insightsData;
                return insightsData.filter(insight => insight.priority === priority);
            }
            
            // Get unread insights count
            function getUnreadInsightsCount() {
                return insightsData.filter(insight => !insight.read).length;
            }
            
            // Mark insight as read
            function markInsightAsRead(insightId) {
                const insight = insightsData.find(i => i.id === insightId);
                if (insight) {
                    insight.read = true;
                    saveInsightsToStorage();
                    return true;
                }
                return false;
            }
            
            // Mark insight as unread
            function markInsightAsUnread(insightId) {
                const insight = insightsData.find(i => i.id === insightId);
                if (insight) {
                    insight.read = false;
                    saveInsightsToStorage();
                    return true;
                }
                return false;
            }
            
            // Delete insight
            function deleteInsight(insightId) {
                const index = insightsData.findIndex(i => i.id === insightId);
                if (index !== -1) {
                    insightsData.splice(index, 1);
                    saveInsightsToStorage();
                    return true;
                }
                return false;
            }
            
            // Add new insight
            function addInsight(insight) {
                const newId = insightsData.length > 0 ? Math.max(...insightsData.map(i => i.id)) + 1 : 1;
                const newInsight = {
                    ...insight,
                    id: newId,
                    date: insight.date || new Date(),
                    read: false
                };
                insightsData.unshift(newInsight); // Add to beginning
                saveInsightsToStorage();
                return newInsight;
            }
            
            // Format date for display
            function formatInsightDate(date) {
                const now = new Date();
                const diffTime = now - date;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) return 'Today';
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
                if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
                return date.toLocaleDateString();
            }
            
            // Get priority color class
            function getPriorityColorClass(priority) {
                switch(priority) {
                    case 'high': return 'text-red-600 bg-red-100 dark:text-red-400 dark:bg-red-900/30';
                    case 'medium': return 'text-yellow-600 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900/30';
                    case 'low': return 'text-green-600 bg-green-100 dark:text-green-400 dark:bg-green-900/30';
                    default: return 'text-slate-600 bg-slate-100 dark:text-slate-400 dark:bg-slate-800';
                }
            }
            
            // Get category color class
            function getCategoryColorClass(category) {
                switch(category) {
                    case 'engagement': return 'bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300';
                    case 'review': return 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300';
                    case 'optimization': return 'bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300';
                    case 'content': return 'bg-pink-100 text-pink-700 dark:bg-pink-900/30 dark:text-pink-300';
                    case 'network': return 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300';
                    case 'portfolio': return 'bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300';
                    case 'skills': return 'bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-300';
                    case 'consistency': return 'bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-300';
                    default: return 'bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300';
                }
            }
            
            // Initialize insights on page load
            initializeInsightsData();
            
            // --- Insights Page Rendering and Interaction ---
            
            let currentFilters = {
                search: '',
                category: 'all',
                priority: 'all',
                view: 'grid'
            };
            
            // Render insights page
            function renderInsightsPage() {
                const container = document.getElementById('insights-container');
                const emptyState = document.getElementById('insights-empty-state');
                const loadingState = document.getElementById('insights-loading');
                
                if (!container) return;
                
                // Hide loading and empty states initially
                loadingState.classList.add('hidden');
                
                // Apply filters
                let filteredInsights = [...insightsData];
                
                // Search filter
                if (currentFilters.search) {
                    const searchLower = currentFilters.search.toLowerCase();
                    filteredInsights = filteredInsights.filter(insight => 
                        insight.title.toLowerCase().includes(searchLower) ||
                        insight.description.toLowerCase().includes(searchLower) ||
                        (insight.fullDescription && insight.fullDescription.toLowerCase().includes(searchLower))
                    );
                }
                
                // Category filter
                if (currentFilters.category !== 'all') {
                    filteredInsights = filteredInsights.filter(insight => 
                        insight.category === currentFilters.category
                    );
                }
                
                // Priority filter
                if (currentFilters.priority !== 'all') {
                    filteredInsights = filteredInsights.filter(insight => 
                        insight.priority === currentFilters.priority
                    );
                }
                
                // Sort by date (newest first)
                filteredInsights.sort((a, b) => b.date - a.date);
                
                // Update stats
                updateInsightsStats(filteredInsights);
                
                // Show empty state if no insights
                if (filteredInsights.length === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                
                // Render insights
                container.innerHTML = filteredInsights.map(insight => createInsightCard(insight)).join('');
                
                // Update container class for view mode
                if (currentFilters.view === 'list') {
                    container.classList.add('list-view');
                } else {
                    container.classList.remove('list-view');
                }
                
                // Attach event listeners to cards
                attachInsightCardListeners();
                
                // Update sidebar to keep in sync
                updateRecentInsightsSidebar();
            }
            
            // Create insight card HTML
            function createInsightCard(insight) {
                const categoryColor = getCategoryColorClass(insight.category);
                const priorityColor = getPriorityColorClass(insight.priority);
                const dateStr = formatInsightDate(insight.date);
                const unreadClass = insight.read ? '' : 'unread';
                const expandedId = `insight-expanded-${insight.id}`;
                
                return `
                    <div class="insight-card bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border border-white/30 dark:border-slate-700 shadow-lg rounded-xl p-6 ${unreadClass}">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">${insight.icon}</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-slate-800 dark:text-slate-50 text-lg mb-1">${insight.title}</h3>
                                    <div class="flex items-center gap-2 flex-wrap">
                                        <span class="px-2 py-1 rounded-full text-xs font-medium ${categoryColor}">${insight.category}</span>
                                        <span class="px-2 py-1 rounded-full text-xs font-medium ${priorityColor}">${insight.priority}</span>
                                        ${insight.actionable ? '<span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300">Actionable</span>' : ''}
                                    </div>
                                </div>
                            </div>
                            ${!insight.read ? '<div class="w-2 h-2 bg-indigo-600 rounded-full"></div>' : ''}
                        </div>
                        
                        <p class="text-slate-600 dark:text-slate-400 text-sm mb-4 line-clamp-2">${insight.description}</p>
                        
                        <div class="insight-expanded" id="${expandedId}">
                            <p class="text-slate-600 dark:text-slate-400 text-sm mb-4">${insight.fullDescription || insight.description}</p>
                            ${insight.metrics ? `
                                <div class="bg-slate-50 dark:bg-slate-700/50 rounded-lg p-3 mb-4">
                                    <h4 class="text-xs font-semibold text-slate-700 dark:text-slate-300 mb-2">Key Metrics:</h4>
                                    <div class="space-y-1">
                                        ${Object.entries(insight.metrics).map(([key, value]) => 
                                            `<div class="flex justify-between text-xs">
                                                <span class="text-slate-600 dark:text-slate-400">${key.replace(/([A-Z])/g, ' $1').trim()}:</span>
                                                <span class="font-medium text-slate-800 dark:text-slate-200">${typeof value === 'number' && key.includes('percentage') || key.includes('Increase') || key.includes('progress') ? `${value}%` : value}</span>
                                            </div>`
                                        ).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="flex items-center justify-between pt-4 border-t border-slate-200 dark:border-slate-700">
                            <span class="text-xs text-slate-500 dark:text-slate-400">${dateStr}</span>
                            <div class="flex items-center gap-2">
                                <button class="insight-expand-btn text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 text-sm font-medium" data-insight-id="${insight.id}">
                                    <span class="expand-text">Read More</span>
                                    <span class="collapse-text hidden">Read Less</span>
                                </button>
                                <button class="insight-mark-read-btn text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 text-sm" data-insight-id="${insight.id}" title="${insight.read ? 'Mark as unread' : 'Mark as read'}">
                                    ${insight.read ? '' : ''}
                                </button>
                                <button class="insight-delete-btn text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 text-sm" data-insight-id="${insight.id}" title="Delete">
                                    
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Attach event listeners to insight cards
            function attachInsightCardListeners() {
                // Expand/collapse buttons
                document.querySelectorAll('.insight-expand-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const insightId = parseInt(btn.getAttribute('data-insight-id'));
                        const expandedDiv = document.getElementById(`insight-expanded-${insightId}`);
                        const expandText = btn.querySelector('.expand-text');
                        const collapseText = btn.querySelector('.collapse-text');
                        
                        if (expandedDiv) {
                            expandedDiv.classList.toggle('show');
                            expandText.classList.toggle('hidden');
                            collapseText.classList.toggle('hidden');
                        }
                    });
                });
                
                // Mark as read/unread buttons
                document.querySelectorAll('.insight-mark-read-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const insightId = parseInt(btn.getAttribute('data-insight-id'));
                        const insight = insightsData.find(i => i.id === insightId);
                        
                        if (insight) {
                            if (insight.read) {
                                markInsightAsUnread(insightId);
                            } else {
                                markInsightAsRead(insightId);
                            }
                            renderInsightsPage();
                        }
                    });
                });
                
                // Delete buttons
                document.querySelectorAll('.insight-delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const insightId = parseInt(btn.getAttribute('data-insight-id'));
                        
                        if (confirm('Are you sure you want to delete this insight?')) {
                            deleteInsight(insightId);
                            renderInsightsPage();
                        }
                    });
                });
            }
            
            // Update insights stats
            function updateInsightsStats(filteredInsights) {
                const totalEl = document.getElementById('total-insights-count');
                const unreadEl = document.getElementById('unread-insights-count');
                const highPriorityEl = document.getElementById('high-priority-count');
                const actionableEl = document.getElementById('actionable-count');
                
                if (totalEl) totalEl.textContent = filteredInsights.length;
                if (unreadEl) unreadEl.textContent = filteredInsights.filter(i => !i.read).length;
                if (highPriorityEl) highPriorityEl.textContent = filteredInsights.filter(i => i.priority === 'high').length;
                if (actionableEl) actionableEl.textContent = filteredInsights.filter(i => i.actionable).length;
            }
            
            // Initialize insights page event listeners
            function initializeInsightsPageListeners() {
                // Search input
                const searchInput = document.getElementById('insights-search');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        currentFilters.search = e.target.value;
                        renderInsightsPage();
                    });
                }
                
                // Category filter
                const categoryFilter = document.getElementById('insights-category-filter');
                if (categoryFilter) {
                    categoryFilter.addEventListener('change', (e) => {
                        currentFilters.category = e.target.value;
                        renderInsightsPage();
                    });
                }
                
                // Priority filter
                const priorityFilter = document.getElementById('insights-priority-filter');
                if (priorityFilter) {
                    priorityFilter.addEventListener('change', (e) => {
                        currentFilters.priority = e.target.value;
                        renderInsightsPage();
                    });
                }
                
                // View toggle buttons
                const gridViewBtn = document.getElementById('insights-view-grid');
                const listViewBtn = document.getElementById('insights-view-list');
                
                if (gridViewBtn) {
                    gridViewBtn.addEventListener('click', () => {
                        currentFilters.view = 'grid';
                        gridViewBtn.classList.add('active');
                        listViewBtn.classList.remove('active');
                        renderInsightsPage();
                    });
                }
                
                if (listViewBtn) {
                    listViewBtn.addEventListener('click', () => {
                        currentFilters.view = 'list';
                        listViewBtn.classList.add('active');
                        gridViewBtn.classList.remove('active');
                        renderInsightsPage();
                    });
                }
                
                // Refresh button
                const refreshBtn = document.getElementById('refresh-insights-btn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => {
                        refreshBtn.disabled = true;
                        refreshBtn.innerHTML = '<div class="inline-block animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>';
                        setTimeout(() => {
                            initializeInsightsData();
                            renderInsightsPage();
                            refreshBtn.disabled = false;
                            refreshBtn.innerHTML = `
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                </svg>
                                Refresh
                            `;
                        }, 1000);
                    });
                }
                
                // Export button
                const exportBtn = document.getElementById('export-insights-btn');
                if (exportBtn) {
                    exportBtn.addEventListener('click', () => {
                        exportInsights();
                    });
                }
            }
            
            // Export insights as JSON
            function exportInsights() {
                const dataStr = JSON.stringify(insightsData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `insights-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
            
            // Update Recent Insights sidebar
            function updateRecentInsightsSidebar() {
                const recentInsightsList = document.getElementById('recent-insights-list');
                if (!recentInsightsList) return;
                
                // Get top 2 unread insights, or recent insights if all are read
                const recentInsights = [...insightsData]
                    .sort((a, b) => b.date - a.date)
                    .slice(0, 2);
                
                if (recentInsights.length === 0) {
                    recentInsightsList.innerHTML = '<p class="text-slate-500 dark:text-slate-400 text-sm">No insights yet</p>';
                    return;
                }
                
                recentInsightsList.innerHTML = recentInsights.map(insight => `
                    <div class="bg-slate-50 dark:bg-slate-700/50 rounded-lg p-3 border border-slate-200 dark:border-slate-600">
                        <div class="flex items-center justify-between mb-1">
                            <h4 class="font-medium text-slate-800 dark:text-slate-50 text-sm">${insight.icon} ${insight.title}</h4>
                            ${!insight.read ? '<span class="text-xs text-blue-700 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/30 px-2 py-1 rounded-full">New</span>' : ''}
                        </div>
                        <p class="text-slate-600 dark:text-slate-400 text-xs line-clamp-2">${insight.description}</p>
                        <button class="recent-insight-read-more text-indigo-600 dark:text-indigo-400 text-xs mt-2 hover:text-indigo-800 dark:hover:text-indigo-300" data-insight-id="${insight.id}">
                            Read More
                        </button>
                    </div>
                `).join('');
                
                // Attach click handlers to Read More buttons
                recentInsightsList.querySelectorAll('.recent-insight-read-more').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const insightId = parseInt(btn.getAttribute('data-insight-id'));
                        // Switch to Insights tab
                        const insightsTab = document.querySelector('[data-tab="insights"]');
                        if (insightsTab) {
                            insightsTab.click();
                            // Mark as read
                            setTimeout(() => {
                                markInsightAsRead(insightId);
                                renderInsightsPage();
                                updateRecentInsightsSidebar();
                            }, 100);
                        }
                    });
                });
            }
            
            // Generate insight from brand audit completion
            function generateInsightFromBrandAudit(brandScore, recommendations) {
                // Generate insights based on brand audit results
                if (brandScore && brandScore.overall) {
                    const score = brandScore.overall;
                    let insight = null;
                    
                    if (score >= 80) {
                        insight = {
                            title: "Excellent Brand Score Achievement!",
                            description: `Congratulations! Your brand score of ${score}/100 places you in the top tier of professionals.`,
                            fullDescription: `Your comprehensive brand analysis shows excellent performance across all metrics. Your strong online presence, consistent messaging, and professional content are working effectively.`,
                            category: "review",
                            priority: "low",
                            type: "achievement",
                            actionable: false,
                            metrics: { score: score },
                            icon: "",
                            source: "brand-audit"
                        };
                    } else if (score >= 60) {
                        insight = {
                            title: "Good Brand Score - Room for Improvement",
                            description: `Your brand score is ${score}/100. There are opportunities to enhance your professional presence.`,
                            fullDescription: `Your brand analysis shows solid fundamentals with clear areas for growth. Focus on the high-priority recommendations to see significant improvement.`,
                            category: "optimization",
                            priority: "medium",
                            type: "recommendation",
                            actionable: true,
                            metrics: { score: score, potentialImprovement: 100 - score },
                            icon: "",
                            source: "brand-audit"
                        };
                    } else {
                        insight = {
                            title: "Brand Score Needs Attention",
                            description: `Your brand score of ${score}/100 indicates significant opportunities for improvement.`,
                            fullDescription: `Your brand analysis reveals several areas that need attention. Focus on completing your profiles and implementing the recommended strategies to see rapid improvement.`,
                            category: "optimization",
                            priority: "high",
                            type: "recommendation",
                            actionable: true,
                            metrics: { score: score, criticalGap: 60 - score },
                            icon: "",
                            source: "brand-audit"
                        };
                    }
                    
                    if (insight) {
                        addInsight(insight);
                        updateRecentInsightsSidebar();
                    }
                }
            }
            
            // Initialize insights page listeners when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    initializeInsightsPageListeners();
                    updateRecentInsightsSidebar();
                });
            } else {
                initializeInsightsPageListeners();
                updateRecentInsightsSidebar();
            }
            
            // Update Recent Insights sidebar when insights data changes
            setInterval(() => {
                updateRecentInsightsSidebar();
            }, 30000); // Update every 30 seconds
            
            function getNotificationCategory(timestamp) {
                const now = new Date('2025-09-20T09:10:00'); // Fixed time for consistent demo
                const date = new Date(timestamp);
                
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                const notificationDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());

                if (notificationDate.getTime() === today.getTime()) return 'Today';
                if (notificationDate.getTime() === yesterday.getTime()) return 'Yesterday';
                
                const startOfWeek = new Date(today);
                startOfWeek.setDate(today.getDate() - today.getDay()); 
                if (notificationDate >= startOfWeek) return 'This Week';

                const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                if (notificationDate >= startOfMonth) return 'This Month';

                return 'Older';
            }

            function renderNotifications() {
                const listToRender = isHistoryView ? notificationHistory : notifications;
                notificationList.innerHTML = '';
                
                if (listToRender.length === 0) {
                    const message = isHistoryView ? "Your notification history is empty." : "You're all caught up!";
                    notificationList.innerHTML = `<li class="text-center text-slate-500 dark:text-slate-400 py-12">${message}</li>`;
                    return;
                }

                const grouped = listToRender.reduce((acc, n) => {
                    const category = getNotificationCategory(n.createdAt);
                    if (!acc[category]) acc[category] = [];
                    acc[category].push(n);
                    return acc;
                }, {});

                const categoryOrder = ['Today', 'Yesterday', 'This Week', 'This Month', 'Older'];
                
                categoryOrder.forEach(category => {
                    if (grouped[category]) {
                        const header = document.createElement('li');
                        // Add a specific class to target these headers with CSS
                        header.className = 'notification-category-header';
                        // The H4 inside no longer needs a background as it scrolls with content.
                        header.innerHTML = `<h4 class="text-sm font-bold text-slate-500 dark:text-slate-400 py-2">${category}</h4>`;
                        notificationList.appendChild(header);

                        grouped[category].forEach(notification => {
                            const li = document.createElement('li');
                            const isClickable = !isHistoryView;
                            li.className = `flex items-start gap-4 p-4 rounded-xl transition-colors ${isClickable ? 'cursor-pointer bg-slate-50 border border-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700' : 'bg-slate-50/50 dark:bg-slate-800/50'}`;
                            li.dataset.id = notification.id;

                            let iconHtml = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-indigo-600"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
                            const sourceLink = document.querySelector(`.sidebar-link[data-id="${notification.sourceId}"]`);
                            if (sourceLink) {
                                const svgElement = sourceLink.querySelector('svg').cloneNode(true);
                                svgElement.classList.remove(...svgElement.classList);
                                svgElement.classList.add('w-5', 'h-5', 'text-indigo-600');
                                iconHtml = svgElement.outerHTML;
                            }

                            let displayTimestampText = notification.timestamp;
                            if (['This Week', 'This Month', 'Older'].includes(category)) {
                                const date = new Date(notification.createdAt);
                                displayTimestampText = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                            }
                            
                            const displayTimestamp = `<span class="font-medium" style="color: #4f46e5;">${displayTimestampText}</span>`;

                            li.innerHTML = `
                                <div class="flex-shrink-0 w-12 h-12 rounded-full bg-white flex items-center justify-center shadow-md">${iconHtml}</div>
                                <div class="flex-grow">
                                    <div class="flex items-start justify-between">
                                        <p class="text-sm font-medium text-slate-800 dark:text-slate-200 pr-2">${notification.text}</p>
                                        ${!isHistoryView && !notification.read ? '<span class="flex-shrink-0 text-xs font-medium px-2 py-1 rounded-full bg-indigo-600 text-white">New</span>' : ''}
                                    </div>
                                    <p class="text-xs mt-1">${displayTimestamp}</p>
                                </div>
                            `;
                            
                            if (isClickable) {
                                li.addEventListener('click', () => {
                                    const notif = notifications.find(n => n.id == notification.id);
                                    if (notif) {
                                        // Mark as read if it was unread
                                        if (!notif.read) {
                                            notif.read = true;
                                            updateNotificationUI(); // Update the badges
                                        }

                                        // Find the corresponding sidebar link and click it to navigate
                                        const sourceLink = document.querySelector(`.sidebar-link[data-id="${notif.sourceId}"]`);
                                        if (sourceLink) {
                                            sourceLink.click();
                                        }
                                        
                                        // Close the modal for a seamless experience
                                        closeModal();
                                    }
                                });
                            }
                            notificationList.appendChild(li);
                        });
                    }
                });
            }


            function updateNotificationUI() {
                const unreadCount = notifications.filter(n => !n.read).length;
                const countStr = unreadCount > 99 ? '99+' : unreadCount.toString();
                if (unreadCount > 0) {
                    userIconBadge.textContent = countStr;
                    dropdownBadge.textContent = countStr;
                    modalHeaderBadge.textContent = countStr;
                    userIconBadge.classList.remove('hidden');
                    dropdownBadge.classList.remove('hidden');
                    modalHeaderBadge.classList.remove('hidden');
                } else {
                    userIconBadge.classList.add('hidden');
                    dropdownBadge.classList.add('hidden');
                    modalHeaderBadge.classList.add('hidden');
                }
            }

            function closeModal() {
                notificationModal.classList.add('hidden');
                 // Reset to default view when closing
                if (isHistoryView) {
                    isHistoryView = false;
                    modalTitle.textContent = 'Notifications';
                    historyButton.classList.remove('hidden');
                    clearAllButton.classList.remove('hidden');
                    backButton.classList.add('hidden');
                }
            }
            
            // Initial UI update
            filterOldNotifications();
            updateNotificationUI();

            // Open modal
            if (notificationMenuButton) {
                notificationMenuButton.addEventListener('click', () => {
                    filterOldNotifications();
                    renderNotifications();
                    notificationModal.classList.remove('hidden');
                    userMenu.classList.add('hidden');
                });
            }
            
            // Add a notification for demonstration
            if (addNotificationButton) {
                 addNotificationButton.addEventListener('click', async () => {
                    const newNotification = { id: Date.now(), text: `Brand re-analysis complete! New insights available.`, timestamp: "Just now", read: false, sourceId: 'brand-audit', createdAt: Date.now() };
                    notifications.unshift(newNotification);
                    updateNotificationUI();
                    
                    // Generate insight from brand audit
                    // Mock brand score - in production, this would come from actual audit
                    const mockBrandScore = {
                        overall: 78,
                        linkedin: 82,
                        resume: 74,
                        portfolio: 85,
                        github: 71
                    };
                    generateInsightFromBrandAudit(mockBrandScore, []);
                    
                    // Check and unlock achievements based on brand metrics
                    await checkAndUnlockAchievementsAfterAnalysis(mockBrandScore);
                    
                    // Update insights page if it's currently visible
                    const insightsTabContent = document.getElementById('insights-tab-content');
                    if (insightsTabContent && !insightsTabContent.classList.contains('hidden')) {
                        renderInsightsPage();
                    }
                    
                    // Refresh recent achievements in sidebar
                    renderRecentAchievements();
                });
            }

            // Modal event listeners
            closeNotificationModalButton.addEventListener('click', closeModal);
            notificationModalOverlay.addEventListener('click', closeModal);

            clearAllButton.addEventListener('click', () => {
                notificationHistory.unshift(...notifications);
                notifications = [];
                updateNotificationUI();
                renderNotifications();
            });

            historyButton.addEventListener('click', () => {
                isHistoryView = true;
                modalTitle.textContent = 'History';
                historyButton.classList.add('hidden');
                clearAllButton.classList.add('hidden');
                backButton.classList.remove('hidden');
                renderNotifications();
            });
            
            backButton.addEventListener('click', () => {
                isHistoryView = false;
                modalTitle.textContent = 'Notifications';
                historyButton.classList.remove('hidden');
                clearAllButton.classList.remove('hidden');
                backButton.classList.add('hidden');
                renderNotifications();
            });


            // --- Sidebar Dropdown Logic ---
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            dropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const parentContainer = toggle.parentElement;
                    // Toggle the clicked one
                    parentContainer.classList.toggle('open');
                });
            });


            // --- Shortcut Customization Logic (with reordering) ---
            const editShortcutsButton = document.getElementById('edit-shortcuts-button');
            const shortcutsContainer = document.getElementById('shortcuts-container');
            let isCustomizing = false;
            let shortcuts = ['brand-audit', 'content-engine', 'job-finder']; // Default shortcuts
            const MAX_SHORTCUTS = 5;
            let draggedShortcutId = null; // To track internal drags

            function handleClickOutsideShortcuts(e) {
                // Deactivate customization if the click is outside the shortcuts container, the sidebar,
                // the user menu itself, and the button that toggles it.
                if (isCustomizing &&
                    !shortcutsContainer.contains(e.target) &&
                    !sidebar.contains(e.target) &&
                    !userMenu.contains(e.target) &&
                    !editShortcutsButton.contains(e.target)) {
                    toggleCustomizationMode();
                }
            }

            function renderShortcuts() {
                shortcutsContainer.innerHTML = '';

                // Control the placeholder text attribute.
                if (isCustomizing && shortcuts.length === 0) {
                    shortcutsContainer.setAttribute('data-placeholder', 'Drag & drop from the sidebar to add shortcuts');
                } else {
                    shortcutsContainer.removeAttribute('data-placeholder');
                }

                // Render the actual shortcut items
                shortcuts.forEach(id => {
                    const sourceLink = document.querySelector(`.sidebar-link[data-id="${id}"]`);
                    if (sourceLink) {
                        const shortcutItem = document.createElement('a');
                        shortcutItem.href = "#";
                        shortcutItem.className = 'shortcut-item';
                        shortcutItem.dataset.id = id;
                        shortcutItem.setAttribute('draggable', 'true'); // Make shortcuts always draggable
                        const iconHTML = sourceLink.querySelector('svg').outerHTML;
                        shortcutItem.innerHTML = `${iconHTML}<button class="remove-shortcut-btn">&times;</button>`;
                        
                        // Add click handler to navigate
                        shortcutItem.addEventListener('click', (e) => {
                            if (!isCustomizing) {
                                e.preventDefault();
                                sourceLink.click();
                            }
                        });

                        // Add remove handler
                        shortcutItem.querySelector('.remove-shortcut-btn').addEventListener('click', (e) => {
                             e.preventDefault();
                             e.stopPropagation();
                             shortcuts = shortcuts.filter(sId => sId !== id);
                             renderShortcuts();
                        });

                        // Add drag handlers for reordering
                        shortcutItem.addEventListener('dragstart', (e) => {
                            e.stopPropagation();
                            draggedShortcutId = id;
                            e.dataTransfer.setData('application/shortcut-id', id);
                            e.dataTransfer.effectAllowed = 'move';
                            setTimeout(() => shortcutItem.classList.add('dragging'), 0);
                        });

                        shortcutItem.addEventListener('dragend', () => {
                            draggedShortcutId = null;
                            shortcutItem.classList.remove('dragging');
                        });
                        
                        shortcutsContainer.appendChild(shortcutItem);
                    }
                });
                
                // Render placeholder slots (+) if in customization mode and NOT empty
                if (isCustomizing && shortcuts.length > 0) {
                    const emptySlots = MAX_SHORTCUTS - shortcuts.length;
                    for (let i = 0; i < emptySlots; i++) {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'shortcut-placeholder';
                        placeholder.textContent = '+';
                        shortcutsContainer.appendChild(placeholder);
                    }
                }
            }
            
            function toggleCustomizationMode() {
                isCustomizing = !isCustomizing;
                shortcutsContainer.classList.toggle('customization-active', isCustomizing);
                sidebarLinks.forEach(link => {
                    link.setAttribute('draggable', isCustomizing);
                });
                
                const buttonSpan = editShortcutsButton.querySelector('span');
                if (isCustomizing) {
                    buttonSpan.textContent = 'Done Customizing';
                    // Add listener to exit customization by clicking away
                    document.addEventListener('click', handleClickOutsideShortcuts, true);
                } else {
                    buttonSpan.textContent = 'Customize Shortcuts';
                    // Clean up the listener when not customizing
                    document.removeEventListener('click', handleClickOutsideShortcuts, true);
                }
                renderShortcuts(); // Re-render to show/hide placeholders
            }

            editShortcutsButton.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleCustomizationMode();
            });
            
            // Drag and Drop Logic from SIDEBAR
            sidebarLinks.forEach(link => {
                link.addEventListener('dragstart', (e) => {
                    if(!isCustomizing) {
                        e.preventDefault();
                        return;
                    }
                    draggedShortcutId = null; // Ensure we know it's not an internal drag
                    e.dataTransfer.setData('application/sidebar-link-id', link.dataset.id);
                    link.classList.add('dragging');
                });
                link.addEventListener('dragend', () => {
                     link.classList.remove('dragging');
                });
            });

            // Drag handling for the CONTAINER
            shortcutsContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                // Allow drop if customizing (for new items) or if an internal item is being dragged for reordering
                if (isCustomizing || draggedShortcutId) {
                    shortcutsContainer.classList.add('drag-over');
                }
            });

             shortcutsContainer.addEventListener('dragleave', () => {
                shortcutsContainer.classList.remove('drag-over');
            });
            
            shortcutsContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                shortcutsContainer.classList.remove('drag-over');
                
                const newIdFromSidebar = e.dataTransfer.getData('application/sidebar-link-id');
                const movedId = e.dataTransfer.getData('application/shortcut-id');

                // Case 1: Reordering an existing shortcut
                if (movedId) {
                    const targetElement = e.target.closest('.shortcut-item');
                    if (!targetElement || targetElement.dataset.id === movedId) {
                        return; // Dropped on itself or in a gap, do nothing
                    }

                    const fromIndex = shortcuts.indexOf(movedId);
                    const toIndex = shortcuts.indexOf(targetElement.dataset.id);

                    if (fromIndex !== -1 && toIndex !== -1) {
                        // Move element in the array
                        const [item] = shortcuts.splice(fromIndex, 1);
                        shortcuts.splice(toIndex, 0, item);
                        renderShortcuts();
                    }
                }
                // Case 2: Adding a new shortcut from the sidebar (only in customization mode)
                else if (isCustomizing && newIdFromSidebar) {
                    if (!shortcuts.includes(newIdFromSidebar) && shortcuts.length < MAX_SHORTCUTS) {
                        const targetElement = e.target.closest('.shortcut-item, .shortcut-placeholder');
                        if (targetElement && targetElement.classList.contains('shortcut-item')) {
                            const toIndex = shortcuts.indexOf(targetElement.dataset.id);
                            shortcuts.splice(toIndex, 0, newIdFromSidebar);
                        } else {
                            shortcuts.push(newIdFromSidebar);
                        }
                        renderShortcuts();
                    }
                }
            });


            // --- Settings Modal Logic ---
            const settingsButton = document.getElementById('settings-button');
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsModalButton = document.getElementById('close-settings-modal');
            const settingsModalOverlay = document.getElementById('settings-modal-overlay');
            const cancelSettingsButton = document.getElementById('cancel-settings-button');
            const settingsTabs = document.querySelectorAll('.settings-tab');
            const settingsTabContents = document.querySelectorAll('.settings-tab-content');

            if (settingsButton && settingsModal) {
                settingsButton.addEventListener('click', () => {
                    settingsModal.classList.remove('hidden');
                    userMenu.classList.add('hidden'); // Close the user menu
                });
            }

            // Signout functionality
            const signoutButton = document.getElementById('signout-button');
            if (signoutButton) {
                signoutButton.addEventListener('click', () => {
                    // Close the user menu
                    userMenu.classList.add('hidden');
                    
                    // Show confirmation dialog
                    if (confirm('Are you sure you want to sign out?')) {
                        // Clear any stored data (localStorage, sessionStorage, etc.)
                        localStorage.clear();
                        sessionStorage.clear();
                        
                        // Show loading state
                        signoutButton.innerHTML = `
                            <svg class="animate-spin w-4 h-4 text-slate-500 dark:text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span>Signing Out...</span>
                        `;
                        signoutButton.disabled = true;
                        
                        // Simulate signout process
                        setTimeout(() => {
                            // Redirect to homepage/landing page
                            window.location.href = '/landing.html';
                        }, 1500);
                    }
                });
            }

            function closeSettingsModal() {
                if (settingsModal) {
                    settingsModal.classList.add('hidden');
                }
            }

            if (closeSettingsModalButton) closeSettingsModalButton.addEventListener('click', closeSettingsModal);
            if (settingsModalOverlay) settingsModalOverlay.addEventListener('click', closeSettingsModal);
            if (cancelSettingsButton) cancelSettingsButton.addEventListener('click', closeSettingsModal);
            
            // Save Settings Button Handler
            const saveSettingsButton = document.getElementById('save-settings-button');
            if (saveSettingsButton) {
                saveSettingsButton.addEventListener('click', () => {
                    // Save API key if entered
                    if (openaiApiKeyInput && openaiApiKeyInput.value.trim()) {
                        localStorage.setItem('openai_api_key', openaiApiKeyInput.value.trim());
                    }
                    
                    // Show success message
                    if (apiKeyStatus) {
                        apiKeyStatus.textContent = ' Settings saved!';
                        apiKeyStatus.className = 'text-sm text-green-500';
                        setTimeout(() => {
                            closeSettingsModal();
                        }, 1000);
                    } else {
                        closeSettingsModal();
                    }
                });
            }

            settingsTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = tab.dataset.tab;

                    // Update tab styles
                    settingsTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    // Update content visibility
                    settingsTabContents.forEach(content => {
                        const contentId = `${tabId}-settings-content`;
                        if (content.id === contentId) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            // --- OpenAI API Key Management ---
            const openaiApiKeyInput = document.getElementById('openai-api-key');
            const toggleVisibilityButton = document.getElementById('toggle-api-key-visibility');
            const testApiKeyButton = document.getElementById('test-api-key-button');
            const apiKeyStatus = document.getElementById('api-key-status');

            // Load saved API key
            if (openaiApiKeyInput) {
                const savedKey = localStorage.getItem('openai_api_key');
                if (savedKey) {
                    openaiApiKeyInput.value = savedKey;
                }
            }

            // Toggle API key visibility
            if (toggleVisibilityButton && openaiApiKeyInput) {
                toggleVisibilityButton.addEventListener('click', () => {
                    const type = openaiApiKeyInput.type === 'password' ? 'text' : 'password';
                    openaiApiKeyInput.type = type;
                    
                    // Update icon
                    const icon = toggleVisibilityButton.querySelector('svg');
                    if (type === 'text') {
                        icon.innerHTML = '<path d="M17.94 18a8.07 8.07 0 0 0 1.16-9.34L21 6l-3 3M9 2L3 8l3 3m8 8l6-6-3-3M2 2l20 20M10 10l4 4m-7-7l3 3"></path>';
                    } else {
                        icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
                    }
                });
            }

            // Auto-save API key as user types
            if (openaiApiKeyInput) {
                openaiApiKeyInput.addEventListener('input', (e) => {
                    const apiKey = e.target.value.trim();
                    if (apiKey && apiKey.startsWith('sk-')) {
                        localStorage.setItem('openai_api_key', apiKey);
                        apiKeyStatus.textContent = '';
                    }
                });
            }

            // Test API key connection
            if (testApiKeyButton && openaiApiKeyInput) {
                testApiKeyButton.addEventListener('click', async () => {
                    const apiKey = openaiApiKeyInput.value.trim();
                    
                    if (!apiKey) {
                        apiKeyStatus.textContent = 'Please enter an API key';
                        apiKeyStatus.className = 'text-sm text-red-500';
                        return;
                    }
                    
                    if (!apiKey.startsWith('sk-')) {
                        apiKeyStatus.textContent = 'Invalid API key format';
                        apiKeyStatus.className = 'text-sm text-red-500';
                        return;
                    }
                    
                    testApiKeyButton.disabled = true;
                    apiKeyStatus.textContent = 'Testing...';
                    apiKeyStatus.className = 'text-sm text-blue-500';
                    
                    try {
                        const response = await fetch('https://api.openai.com/v1/models', {
                            headers: {
                                'Authorization': `Bearer ${apiKey}`
                            }
                        });
                        
                        if (response.ok) {
                            apiKeyStatus.textContent = ' API key is valid';
                            apiKeyStatus.className = 'text-sm text-green-500';
                            localStorage.setItem('openai_api_key', apiKey);
                        } else {
                            apiKeyStatus.textContent = ' Invalid API key';
                            apiKeyStatus.className = 'text-sm text-red-500';
                        }
                    } catch (error) {
                        apiKeyStatus.textContent = ' Connection failed';
                        apiKeyStatus.className = 'text-sm text-red-500';
                    } finally {
                        testApiKeyButton.disabled = false;
                    }
                });
            }

            // --- JSearch API Key Management ---
            const jsearchApiKeyInput = document.getElementById('jsearch-api-key');
            const toggleJsearchVisibilityButton = document.getElementById('toggle-jsearch-api-key-visibility');

            // Load saved JSearch API key
            if (jsearchApiKeyInput) {
                const savedKey = localStorage.getItem('jsearch_api_key');
                if (savedKey) {
                    jsearchApiKeyInput.value = savedKey;
                }
            }

            // Toggle JSearch API key visibility
            if (toggleJsearchVisibilityButton && jsearchApiKeyInput) {
                toggleJsearchVisibilityButton.addEventListener('click', () => {
                    const type = jsearchApiKeyInput.type === 'password' ? 'text' : 'password';
                    jsearchApiKeyInput.type = type;
                    
                    // Update icon
                    const icon = toggleJsearchVisibilityButton.querySelector('svg');
                    if (type === 'text') {
                        icon.innerHTML = '<path d="M17.94 18a8.07 8.07 0 0 0 1.16-9.34L21 6l-3 3M9 2L3 8l3 3m8 8l6-6-3-3M2 2l20 20M10 10l4 4m-7-7l3 3"></path>';
                    } else {
                        icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
                    }
                });
            }

            // Auto-save JSearch API key as user types
            if (jsearchApiKeyInput) {
                jsearchApiKeyInput.addEventListener('input', (e) => {
                    const apiKey = e.target.value.trim();
                    if (apiKey) {
                        localStorage.setItem('jsearch_api_key', apiKey);
                    }
                });
            }

            // --- NEW Chat Widget Logic ---
            const chatWidgetButton = document.getElementById('chat-widget-button');
            const chatWidget = document.getElementById('chat-widget');
            const closeChatWidgetButton = document.getElementById('close-chat-widget');
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendChatButton = document.getElementById('send-chat-button');

            // --- Star Generation for Chat Widget ---
            const starsContainer = document.querySelector('#chat-widget #stars-container');
            if (starsContainer) {
                const numberOfStars = 100;
                const sunRadius = 125; // Half of the sun's 250px width/height
                const minStarRadius = sunRadius + 15; // Start stars just outside the sun
                const maxStarRadius = sunRadius + 120; // How far out the stars should go

                for (let i = 0; i < numberOfStars; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    
                    const size = Math.random() * 2 + 1;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    
                    // Random position in a circle around the sun's center
                    const angle = Math.random() * 2 * Math.PI;
                    const radius = Math.random() * (maxStarRadius - minStarRadius) + minStarRadius;
                    const xOffset = radius * Math.cos(angle);
                    const yOffset = radius * Math.sin(angle);
                    
                    star.style.left = `calc(50% + ${xOffset}px)`;
                    star.style.top = `calc(50% + ${yOffset}px)`;
                    
                    star.style.animationDuration = `${Math.random() * 3 + 2}s`;
                    star.style.animationDelay = `${Math.random() * 3}s`;
                    starsContainer.appendChild(star);
                }
            }

            if (chatWidgetButton && chatWidget) {
                chatWidgetButton.addEventListener('click', () => {
                    chatWidget.classList.remove('hidden');
                    chatWidgetButton.classList.add('hidden');
                });
            }

            if (closeChatWidgetButton) {
                closeChatWidgetButton.addEventListener('click', () => {
                    chatWidget.classList.add('hidden');
                    chatWidgetButton.classList.remove('hidden');
                });
            }

            function addMessage(message, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${type}-message p-3 rounded-lg`;
                messageDiv.innerHTML = `<p class="text-sm">${message}</p>`;
                chatMessages.appendChild(messageDiv);
                // Auto-scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight; 
            }

            function handleSendMessage() {
                const messageText = chatInput.value.trim();
                if (messageText) {
                    addMessage(messageText, 'user');
                    chatInput.value = '';
                    
                    // Simulate agent reply
                    setTimeout(() => {
                        addMessage("Thanks for your message! An agent will be with you shortly.", 'agent');
                    }, 1000);
                }
            }

            // Initial agent message
            addMessage("Hello! I am Luna.<br>How can I help you today?", 'agent');

            if (sendChatButton) sendChatButton.addEventListener('click', handleSendMessage);
            if (chatInput) chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSendMessage();
                }
            });


            renderShortcuts();
        });
    </script>

    <!-- Smart Resume Studio React Component -->
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // --- Mock Lucide Icons ---
        const createIcon = (svgContent) => ({ className }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
                dangerouslySetInnerHTML={{ __html: svgContent }}
            />
        );

        const icons = {
            FileText: createIcon(`<path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><line x1="10" y1="9" x2="8" y2="9" />`),
            Upload: createIcon(`<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" />`),
            Plus: createIcon(`<line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" />`),
            AlertCircle: createIcon(`<circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" />`),
            CheckCircle: createIcon(`<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" />`),
            RefreshCw: createIcon(`<polyline points="23 4 23 10 17 10" /><polyline points="1 20 1 14 7 14" /><path d="M3.51 9a9 9 0 0 1 14.85-3.36L20.49 9" /><path d="M20.49 15a9 9 0 0 1-14.85 3.36L3.51 15" />`),
            ArrowRight: createIcon(`<line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" />`),
            Star: createIcon(`<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />`),
            Target: createIcon(`<circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" />`),
            Brain: createIcon(`<path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v1.2a1 1 0 0 0 1 1h.3a1 1 0 0 0 .9-.6 2.5 2.5 0 0 1 2.4-1.9 2.5 2.5 0 0 1 2.5 2.5v1.3a1 1 0 0 0 1 1h.1a1 1 0 0 0 1-1V10a2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 0 5A2.5 2.5 0 0 1 20 15v.2a1 1 0 0 0 1 1h.1a1 1 0 0 0 1-1V14a2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 0 5 2.5 2.5 0 0 1-2.5-2.5v-1.3a1 1 0 0 0-1-1h-.3a1 1 0 0 0-.9.6 2.5 2.5 0 0 1-2.4 1.9A2.5 2.5 0 0 1 12 15.5v-1.2a1 1 0 0 0-1-1h-.1a1 1 0 0 0-1 1V16a2.5 2.5 0 0 1-2.5 2.5 2.5 2.5 0 0 1 0-5A2.5 2.5 0 0 1 8 11v-.2a1 1 0 0 0-1-1h-.1a1 1 0 0 0-1 1V12a2.5 2.5 0 0 1-2.5 2.5 2.5 2.5 0 0 1 0-5A2.5 2.5 0 0 1 4 7V5.7a1 1 0 0 0-1-1h-.3a1 1 0 0 0-.9.6 2.5 2.5 0 0 1-2.4 1.9A2.5 2.5 0 0 1 0 4.5 2.5 2.5 0 0 1 2.5 2h.1A2.5 2.5 0 0 1 5 4.5v1.2a1 1 0 0 0 1 1h.3a1 1 0 0 0 .9-.6A2.5 2.5 0 0 1 9.5 4.2V2.5A2.5 2.5 0 0 1 9.5 2z" /><path d="M12 13a2.5 2.5 0 0 0-2.5 2.5v.2a1 1 0 0 1-1 1h-.1a1 1 0 0 1-1-1V16a2.5 2.5 0 0 0-5 0v.2a1 1 0 0 1-1 1h-.1a1 1 0 0 1-1-1V16a2.5 2.5 0 0 0-5 0v.2a1 1 0 0 1-1 1h-.1a1 1 0 0 1-1-1V16a2.5 2.5 0 0 0-2.5-2.5 2.5 2.5 0 0 0 0 5 2.5 2.5 0 0 0 2.5-2.5v-.2a1 1 0 0 1 1-1h.1a1 1 0 0 1 1 1V18a2.5 2.5 0 0 0 5 0v-.2a1 1 0 0 1 1-1h.1a1 1 0 0 1 1 1V18a2.5 2.5 0 0 0 5 0v-.2a1 1 0 0 1 1-1h.1a1 1 0 0 1 1 1V18a2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 0-5 2.5 2.5 0 0 0-2.5 2.5v.2a1 1 0 0 1-1 1h-.1a1 1 0 0 1-1-1V16a2.5 2.5 0 0 0-2.5-2.5z" />`),
            Shield: createIcon(`<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />`),
            TrendingUp: createIcon(`<polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" />`),
            Clock: createIcon(`<circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" />`),
            Sparkles: createIcon(`<path d="m12 3-1.9 1.9-3.2.9 1 3.1-.9 3.2 3.1 1 1.9 1.9 1.9-1.9 3.1-1-.9-3.2 1-3.1-3.2-.9z" /><path d="M5 22s1.5-2 4-2" /><path d="m19 22-4-2" /><path d="M22 5s-2-1.5-2-4" /><path d="m2 5 2-4" />`),
            Zap: createIcon(`<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />`),
            Download: createIcon(`<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" />`),
            Save: createIcon(`<path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" />`),
            Eye: createIcon(`<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" /><circle cx="12" cy="12" r="3" />`),
            RotateCcw: createIcon(`<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" />`),
            X: createIcon(`<line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />`),
            List: createIcon(`<line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/>`),
            ListOrdered: createIcon(`<line x1="10" x2="21" y1="6" y2="6"/><line x1="10" x2="21" y1="12" y2="12"/><line x1="10" x2="21" y1="18" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/>`),
            Indent: createIcon(`<polyline points="21 12 15 6 21 18 15 12"/><line x1="3" x2="15" y1="6" y2="6"/><line x1="3" x2="15" y1="18" y2="18"/><line x1="3" x2="21" y1="12" y2="12"/>`),
            Outdent: createIcon(`<polyline points="3 12 9 6 3 18 9 12"/><line x1="21" x2="9" y1="6" y2="6"/><line x1="21" x2="9" y1="18" y2="18"/><line x1="21" x2="3" y1="12" y2="12"/>`),
            AlignCenter: createIcon(`<line x1="18" x2="6" y1="10" y2="10"/><line x1="21" x2="3" y1="6" y2="6"/><line x1="21" x2="3" y1="14" y2="14"/><line x1="18" x2="6" y1="18" y2="18"/>`),
            AlignLeft: createIcon(`<line x1="17" x2="3" y1="10" y2="10"/><line x1="21" x2="3" y1="6" y2="6"/><line x1="21" x2="3" y1="14" y2="14"/><line x1="17" x2="3" y1="18" y2="18"/>`),
            AlignRight: createIcon(`<line x1="21" x2="7" y1="10" y2="10"/><line x1="21" x2="3" y1="6" y2="6"/><line x1="21" x2="3" y1="14" y2="14"/><line x1="21" x2="7" y1="18" y2="18"/>`),
            Bold: createIcon(`<path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>`),
            Italic: createIcon(`<line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/>`),
            Underline: createIcon(`<path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"/><line x1="4" y1="21" x2="20" y2="21"/>`),
            Link: createIcon(`<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"/>`),
            Phone: createIcon(`<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>`),
            Mail: createIcon(`<rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>`),
            MapPin: createIcon(`<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/>`),
            Minus: createIcon(`<line x1="5" y1="12" x2="19" y2="12"/>`),
            Calendar: createIcon(`<rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" y2="6"/><line x1="8" y1="2" y2="6"/><line x1="3" y1="10" y2="10"/>`),
        };

        const { FileText, Upload, Plus, AlertCircle, CheckCircle, RefreshCw, ArrowRight, Star, Target, Brain, Shield, TrendingUp, Clock, Sparkles, Zap, Download, Save, Eye, RotateCcw, X, List, ListOrdered, Indent, Outdent, AlignLeft, AlignCenter, AlignRight, Bold, Italic, Underline, Link, Phone, Mail, MapPin, Minus, Calendar } = icons;

        // --- Mock Custom Hook ---
        const useTheme = () => {
            return { theme: 'dark' };
        };

        // --- Mock Child Components ---
        // Mock for AICopilot.js
        const AICopilot = ({ activeResume, selectedText, aiProcessing, onATSOptimization, onEnhanceText, onGapJustification }) => {
            return (
                <div className="space-y-4">
                    <div>
                        <h4 className="text-sm font-semibold text-slate-800 mb-3">AI Copilot</h4>
                        {activeResume ? (
                            <div className="p-3 bg-slate-100 border border-slate-200 rounded-lg text-sm text-slate-600">
                                <p><span className="font-semibold text-slate-800">ATS Score:</span> {activeResume.atsScore}%</p>
                                <p className="mt-1">AI suggestions will appear here based on your resume content.</p>
                            </div>
                        ) : (
                            <div className="p-3 bg-slate-100 border border-slate-200 rounded-lg text-sm text-slate-500">
                                Select a resume to activate AI Copilot.
                            </div>
                        )}
                    </div>
                    
                    <div className="space-y-2">
                        <button
                            onClick={onATSOptimization}
                            disabled={!activeResume || aiProcessing}
                            className="w-full flex items-center gap-3 p-3 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <Shield className="w-5 h-5 text-blue-500" />
                            <div>
                                <p className="text-sm font-medium text-slate-800 text-left">ATS Optimization</p>
                                <p className="text-xs text-slate-500 text-left">Improve your score against tracking systems.</p>
                            </div>
                        </button>
                        <button
                            onClick={onEnhanceText}
                            disabled={!selectedText || aiProcessing}
                            className="w-full flex items-center gap-3 p-3 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <Sparkles className="w-5 h-5 text-yellow-500" />
                            <div>
                                <p className="text-sm font-medium text-slate-800 text-left">Enhance Selected Text</p>
                                <p className="text-xs text-slate-500 text-left">Rewrite text for more impact. Select text to enable.</p>
                            </div>
                        </button>
                        <button
                            onClick={onGapJustification}
                            disabled={!activeResume || aiProcessing}
                            className="w-full flex items-center gap-3 p-3 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <Clock className="w-5 h-5 text-orange-500" />
                            <div>
                                <p className="text-sm font-medium text-slate-800 text-left">Gap Justification</p>
                                <p className="text-xs text-slate-500 text-left">Get help explaining career gaps.</p>
                            </div>
                        </button>
                        {aiProcessing && <p className="text-sm text-center text-indigo-600 animate-pulse">AI is working...</p>}
                    </div>
                </div>
            );
        };

        // Mock for ResumePreview.js
        const ResumePreview = ({ content, templateId, colors, formatting, activeSections, onContentChange, editorRef }) => {
            const pageStyle = {
                fontFamily: formatting.fontStyle,
                fontSize: `${formatting.fontSize}pt`,
                lineHeight: formatting.lineSpacing,
                padding: `${formatting.topBottomMargin}mm ${formatting.sideMargins}mm`,
                color: '#333',
            };
            
            const [isDndActive, setIsDndActive] = useState(false);
            const dndActivationRef = useRef({ count: 0, timestamp: 0 });

            // Effect to toggle the dnd-active class for CSS styling
            useEffect(() => {
                const editorNode = editorRef.current;
                if (editorNode) {
                    editorNode.classList.toggle('dnd-active', isDndActive);
                }
            }, [isDndActive]);

            // Effect for Drag and Drop functionality
            useEffect(() => {
                const editorNode = editorRef.current;
                if (!editorNode) return;
                let draggedElement = null;
                
                // --- DND Activation Logic ---
                const handleContextMenu = (e) => {
                    e.preventDefault();
                    const now = Date.now();
                    if (now - dndActivationRef.current.timestamp > 500) {
                        dndActivationRef.current.count = 1;
                    } else {
                        dndActivationRef.current.count++;
                    }
                    dndActivationRef.current.timestamp = now;
                    if (dndActivationRef.current.count === 2) {
                        setIsDndActive(true);
                        dndActivationRef.current.count = 0;
                    }
                };

                // Deactivate on a regular left click
                const handleDeactivationClick = (e) => {
                    if (isDndActive && e.button !== 2 && !editorNode.classList.contains('dragging-active')) {
                        setIsDndActive(false);
                    }
                };

                // --- Drag and Drop Handlers ---
                const handleDragStart = (e) => {
                    if (!isDndActive) {
                        e.preventDefault();
                        return;
                    }
                    draggedElement = e.target.closest('.resume-section');
                    if (draggedElement) {
                        editorNode.classList.add('dragging-active');
                        setTimeout(() => draggedElement.classList.add('dragging'), 0);
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/plain', 'dragging');
                    } else {
                        e.preventDefault();
                    }
                };

                const handleDragOver = (e) => {
                    e.preventDefault();
                    if (!isDndActive) return;
                    
                    const target = e.target.closest('.resume-section');
                    if (!target || target === draggedElement) return;
                    const rect = target.getBoundingClientRect();
                    const isAfter = e.clientY > rect.top + rect.height / 2;
                    
                    // Clean up old indicators first
                    editorNode.querySelectorAll('.drag-over-indicator').forEach(el => el.remove());
                    
                    const placeholder = document.createElement('div');
                    placeholder.className = 'drag-over-indicator';
                    
                    const sectionName = draggedElement.dataset.sectionName;
                    placeholder.textContent = sectionName ? `${sectionName} will be placed here` : 'Drop here';
                    if (isAfter) {
                        target.parentNode.insertBefore(placeholder, target.nextSibling);
                    } else {
                        target.parentNode.insertBefore(placeholder, target);
                    }
                };

                const handleDrop = (e) => {
                    e.preventDefault();
                    const placeholder = editorNode.querySelector('.drag-over-indicator');
                    if (draggedElement && placeholder) {
                        placeholder.parentNode.insertBefore(draggedElement, placeholder);
                        onContentChange(editorNode.innerHTML);
                    }
                    // Cleanup
                    if (placeholder) placeholder.remove();
                    if (draggedElement) draggedElement.classList.remove('dragging');
                    editorNode.classList.remove('dragging-active');
                    draggedElement = null;
                    setIsDndActive(false);
                };
                
                const handleDragEnd = () => {
                    if (draggedElement) draggedElement.classList.remove('dragging');
                    editorNode.querySelectorAll('.drag-over-indicator').forEach(el => el.remove());
                    editorNode.classList.remove('dragging-active');
                    draggedElement = null;
                };

                // Make sections draggable
                const sections = editorNode.querySelectorAll('.resume-section');
                sections.forEach(section => section.setAttribute('draggable', 'true'));
                editorNode.addEventListener('contextmenu', handleContextMenu);
                editorNode.addEventListener('click', handleDeactivationClick);
                editorNode.addEventListener('dragstart', handleDragStart);
                editorNode.addEventListener('dragover', handleDragOver);
                editorNode.addEventListener('drop', handleDrop);
                editorNode.addEventListener('dragend', handleDragEnd);
                
                return () => {
                    editorNode.removeEventListener('contextmenu', handleContextMenu);
                    editorNode.removeEventListener('click', handleDeactivationClick);
                    editorNode.removeEventListener('dragstart', handleDragStart);
                    editorNode.removeEventListener('dragover', handleDragOver);
                    editorNode.removeEventListener('drop', handleDrop);
                    editorNode.removeEventListener('dragend', handleDragEnd);
                };
            }, [content, onContentChange, editorRef, isDndActive]);

            // Use useEffect to prevent cursor jumping issues
            useEffect(() => {
                if (editorRef.current && editorRef.current.innerHTML !== content) {
                    editorRef.current.innerHTML = content;
                }
            }, [content]);

            // Apply formatting changes to editor
            useEffect(() => {
                if (editorRef.current) {
                    editorRef.current.style.fontFamily = formatting.fontStyle;
                    editorRef.current.style.fontSize = `${formatting.fontSize}pt`;
                    editorRef.current.style.lineHeight = formatting.lineSpacing;
                    editorRef.current.style.padding = `${formatting.topBottomMargin}mm ${formatting.sideMargins}mm`;
                    editorRef.current.style.color = formatting.textColor;
                    
                    // Apply colors to headings
                    const headings = editorRef.current.querySelectorAll('p > b, p > strong, h1, h2, h3');
                    headings.forEach(heading => {
                        heading.style.color = colors.primary;
                    });
                }
            }, [formatting, colors, editorRef]);

            return (
                <div className="w-full bg-transparent p-8">
                    <div 
                        ref={editorRef}
                        contentEditable={true}
                        suppressContentEditableWarning={true}
                        onInput={e => onContentChange(e.currentTarget.innerHTML)}
                        className="w-[210mm] min-h-[297mm] bg-white shadow-2xl mx-auto resume-content-view focus:outline-none focus:ring-2 focus:ring-indigo-400 custom-scrollbar"
                        style={pageStyle}
                    >
                    </div>
                </div>
            );
        };

        // Mock for ResumeListViewer.js
        const ResumeListViewer = ({ resumes, onSelectResume, onCreateNew, onImport }) => {
            return (
                <div className="p-8 text-slate-800 h-full overflow-y-auto custom-scrollbar">
                    <div className="flex items-center justify-between mb-6">
                        <h2 className="text-2xl font-bold text-slate-900">Resume Library</h2>
                        <div className="flex gap-3">
                            <button
                                onClick={onImport}
                                className="px-4 py-2 border border-gray-300 text-slate-700 rounded-lg hover:bg-gray-50 transition-colors font-medium text-sm flex items-center gap-2"
                            >
                                <Upload className="w-4 h-4" />
                                Import
                            </button>
                            <button
                                onClick={onCreateNew}
                                className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium text-sm flex items-center gap-2"
                            >
                                <Plus className="w-4 h-4" />
                                Create New
                            </button>
                        </div>
                    </div>
                    {resumes.length > 0 ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {resumes.map(resume => (
                                <div key={resume.id} className="bg-white/70 backdrop-blur-xl p-6 rounded-lg border border-white/30 hover:border-indigo-300 transition-all shadow-lg">
                                    <h3 className="font-semibold text-lg text-slate-900">{resume.title}</h3>
                                    <p className={`text-xs font-medium uppercase mt-1 ${resume.type === 'master' ? 'text-amber-600' : 'text-cyan-600'}`}>{resume.type}</p>
                                    <p className="text-sm text-slate-600 mt-2">ATS Score: {resume.atsScore}%</p>
                                    <p className="text-xs text-slate-500 mt-1">Updated: {new Date(resume.updatedAt).toLocaleDateString()}</p>
                                    <button
                                        onClick={() => onSelectResume(resume.id)}
                                        className="mt-4 w-full px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition-colors text-sm"
                                    >
                                        Edit this Resume
                                    </button>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="text-center py-16 bg-white/70 backdrop-blur-xl border border-white/30 rounded-2xl">
                            <FileText className="w-16 h-16 mx-auto text-slate-400 mb-4" />
                            <h3 className="text-xl font-semibold text-slate-700">No Resumes Yet</h3>
                            <p className="text-slate-500 mt-2 mb-6">Create or import a resume to get started.</p>
                            <div className="flex gap-4 justify-center">
                                <button
                                    onClick={onImport}
                                    className="px-6 py-3 border border-gray-300 text-slate-700 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center gap-2"
                                >
                                    <Upload className="w-5 h-5" />
                                    Import Resume
                                </button>
                                <button
                                    onClick={onCreateNew}
                                    className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium flex items-center gap-2"
                                >
                                    <Plus className="w-5 h-5" />
                                    Create New
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Main App Component ---
        const SmartResumeStudio = () => {
            const { theme } = useTheme();
            const [step, setStep] = useState('selection');
            const [uploadedFile, setUploadedFile] = useState(null);
            const [uploadError, setUploadError] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [resumes, setResumes] = useState([]);
            const [activeResumeId, setActiveResumeId] = useState(null);
            const [activeResume, setActiveResume] = useState(null);
            const [editorContent, setEditorContent] = useState('');
            const [viewMode, setViewMode] = useState('edit');
            const [isLoading, setIsLoading] = useState(false);
            const [selectedTemplateId, setSelectedTemplateId] = useState('classic-1');
            const [selectedColors, setSelectedColors] = useState({
                primary: '#3B82F6',
                secondary: '#64748B',
                accent: '#8B5CF6'
            });
            const [formattingSettings, setFormattingSettings] = useState({
                alignment: 'left',
                textColor: '#334155',
                highlightColor: 'transparent',
                fontStyle: 'Inter',
                fontSize: 11,
                headingSize: 14,
                sectionSpacing: 16,
                paragraphSpacing: 8,
                lineSpacing: 1.4,
                topBottomMargin: 20,
                sideMargins: 20,
                paragraphIndent: 0
            });
            const [activeSections, setActiveSections] = useState([
                'Heading',
                'Profile',
                'Core Skills',
                'Experience',
                'Education'
            ]);
            const [undoHistory, setUndoHistory] = useState([]);
            const [historyPointer, setHistoryPointer] = useState(-1);
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [showImportModal, setShowImportModal] = useState(false);
            const [showExportModal, setShowExportModal] = useState(false);
            const [newResumeTitle, setNewResumeTitle] = useState('');
            const [newResumeType, setNewResumeType] = useState('campaign');
            const [importFile, setImportFile] = useState(null);
            const [importStatus, setImportStatus] = useState('idle');
            const [importError, setImportError] = useState('');
            const [activeTab, setActiveTab] = useState('design');
            const [templateCategory, setTemplateCategory] = useState('all');
            const [selectedText, setSelectedText] = useState('');
            const [aiProcessing, setAiProcessing] = useState(false);
            const [toast, setToast] = useState(null);
            const [autoSaveEnabled, setAutoSaveEnabled] = useState(true);
            const autoSaveTimeoutRef = useRef(null);
            const fileInputRef = useRef(null);
            const editorRef = useRef(null);
            const handleSaveRef = useRef(null);
            const handleUndoRef = useRef(null);

            // --- Validation Utilities ---
            const ValidationUtils = {
                sanitizeInput(input) {
                    if (typeof input !== 'string') return '';
                    return input.trim().replace(/[<>]/g, '');
                },
                
                validateResumeTitle(title) {
                    if (!title || typeof title !== 'string') {
                        return { valid: false, error: 'Resume title is required' };
                    }
                    const trimmed = title.trim();
                    if (trimmed.length === 0) {
                        return { valid: false, error: 'Resume title cannot be empty' };
                    }
                    if (trimmed.length > 100) {
                        return { valid: false, error: 'Resume title must be less than 100 characters' };
                    }
                    if (!/^[a-zA-Z0-9\s\-_.,()]+$/.test(trimmed)) {
                        return { valid: false, error: 'Resume title contains invalid characters' };
                    }
                    return { valid: true };
                },
                
                validateFile(file) {
                    if (!file) {
                        return { valid: false, error: 'No file selected' };
                    }
                    
                    const allowedTypes = [
                        'application/pdf',
                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'application/msword',
                        'text/plain'
                    ];
                    
                    // Also check by extension for better compatibility
                    const fileName = file.name.toLowerCase();
                    const validExtensions = ['.pdf', '.docx', '.doc', '.txt'];
                    const hasValidExtension = validExtensions.some(ext => fileName.endsWith(ext));
                    
                    if (!allowedTypes.includes(file.type) && !hasValidExtension) {
                        return { valid: false, error: 'Please select a valid file type (PDF, DOCX, DOC, or TXT)' };
                    }
                    
                    const maxSize = 10 * 1024 * 1024; // 10MB
                    if (file.size > maxSize) {
                        return { valid: false, error: `File size must be less than ${(maxSize / 1024 / 1024).toFixed(0)}MB` };
                    }
                    
                    if (file.size === 0) {
                        return { valid: false, error: 'File is empty' };
                    }
                    
                    return { valid: true };
                },
                
                validateResumeData(resume) {
                    if (!resume || typeof resume !== 'object') {
                        return { valid: false, error: 'Invalid resume data structure' };
                    }
                    if (!resume.id || typeof resume.id !== 'string') {
                        return { valid: false, error: 'Resume must have a valid ID' };
                    }
                    if (!resume.title || typeof resume.title !== 'string') {
                        return { valid: false, error: 'Resume must have a title' };
                    }
                    return { valid: true };
                },
                
                validateSectionName(sectionName) {
                    if (!sectionName || typeof sectionName !== 'string') {
                        return { valid: false, error: 'Section name is required' };
                    }
                    if (sectionName.trim().length === 0) {
                        return { valid: false, error: 'Section name cannot be empty' };
                    }
                    if (sectionName.length > 50) {
                        return { valid: false, error: 'Section name must be less than 50 characters' };
                    }
                    return { valid: true };
                },
                
                sanitizeFileName(fileName) {
                    return fileName.replace(/[^a-zA-Z0-9.-]/g, '_').substring(0, 255);
                }
            };

            // --- Error Handling Utilities ---
            // Note: These will be updated to use showToast after it's defined below
            let ErrorHandler = null;
            
            // Define showToast first, then create ErrorHandler that uses it
            const showToast = (message, type = 'success') => {
                if (!message || typeof message !== 'string') {
                    console.warn('Invalid toast message:', message);
                    return;
                }
                
                // Sanitize message to prevent XSS (ValidationUtils will be defined above)
                let sanitizedMessage = message;
                if (typeof ValidationUtils !== 'undefined' && ValidationUtils.sanitizeInput) {
                    sanitizedMessage = ValidationUtils.sanitizeInput(message);
                } else {
                    sanitizedMessage = message.trim().replace(/[<>]/g, '');
                }
                
                if (sanitizedMessage.length === 0) {
                    return;
                }
                
                setToast({ message: sanitizedMessage, type });
                setTimeout(() => setToast(null), 3000);
            };

            // Now create ErrorHandler that uses showToast
            ErrorHandler = {
                handleStorageError(error, operation) {
                    console.error(`Storage error during ${operation}:`, error);
                    const message = error.name === 'QuotaExceededError' 
                        ? 'Storage quota exceeded. Please free up space or delete old resumes.'
                        : `Failed to ${operation}. Please try again.`;
                    showToast(message, 'error');
                    return message;
                },
                
                handleAPIError(error, operation) {
                    console.error(`API error during ${operation}:`, error);
                    let message = `Failed to ${operation}.`;
                    
                    if (error.message) {
                        if (error.message.includes('API key')) {
                            message = 'OpenAI API key not found. Please set it in Settings.';
                        } else if (error.message.includes('network') || error.message.includes('fetch')) {
                            message = 'Network error. Please check your connection.';
                        } else {
                            message = error.message;
                        }
                    }
                    
                    showToast(message, 'error');
                    return message;
                },
                
                handleFileReadError(error) {
                    console.error('File read error:', error);
                    showToast('Failed to read file. The file may be corrupted.', 'error');
                }
            };

            const sectionTemplates = {
                'Heading': `<div class="resume-section" data-section-name="Heading"><p><b>[YOUR NAME]</b></p><p>[Your Title/Position]</p><p>[Your Email] | [Your Phone] | [Your LinkedIn]</p></div>`,
                'Profile': `<div class="resume-section" data-section-name="Profile"><p><br></p><p><b>PROFESSIONAL SUMMARY</b></p><p>[Write a compelling summary of your professional background and key achievements]</p></div>`,
                'Core Skills': `<div class="resume-section" data-section-name="Core Skills"><p><br></p><p><b>CORE SKILLS</b></p><p> [Skill 1]</p><p> [Skill 2]</p><p> [Skill 3]</p></div>`,
                'Experience': `<div class="resume-section" data-section-name="Experience"><p><br></p><p><b>EXPERIENCE</b></p><p>[Job Title] | [Company Name] | [Start Date - End Date]</p><p> [Achievement or responsibility]</p><p> [Achievement or responsibility]</p><p> [Achievement or responsibility]</p></div>`,
                'Education': `<div class="resume-section" data-section-name="Education"><p><br></p><p><b>EDUCATION</b></p><p>[Degree] in [Field of Study]</p><p>[University Name] | [Graduation Year]</p></div>`,
                'Projects': `<div class="resume-section" data-section-name="Projects"><p><br></p><p><b>PROJECTS</b></p><p>[Project Name] | [Link to Project]</p><p> [Description of the project and your role]</p></div>`,
                'Certifications': `<div class="resume-section" data-section-name="Certifications"><p><br></p><p><b>CERTIFICATIONS</b></p><p> [Certification Name] - [Issuing Organization] ([Year])</p></div>`,
                'Languages': `<div class="resume-section" data-section-name="Languages"><p><br></p><p><b>LANGUAGES</b></p><p> [Language] (Native/Fluent/Professional/Basic)</p></div>`,
                'Volunteering': `<div class="resume-section" data-section-name="Volunteering"><p><br></p><p><b>VOLUNTEER EXPERIENCE</b></p><p>[Role] | [Organization] | [Dates]</p><p> [Description of your contributions and impact.]</p></div>`,
                'Publications': `<div class="resume-section" data-section-name="Publications"><p><br></p><p><b>PUBLICATIONS</b></p><p> [Title of Publication], <i>[Journal or Conference Name]</i>, [Year]</p></div>`,
                'Professional Affiliations': `<div class="resume-section" data-section-name="Professional Affiliations"><p><br></p><p><b>PROFESSIONAL AFFILIATIONS</b></p><p> [Member/Role], [Organization Name]</p></div>`,
                'Interests': `<div class="resume-section" data-section-name="Interests"><p><br></p><p><b>INTERESTS</b></p><p>[Interest 1], [Interest 2], [Interest 3]</p></div>`,
                'Awards & Honors': `<div class="resume-section" data-section-name="Awards & Honors"><p><br></p><p><b>AWARDS & HONORS</b></p><p> [Award Name] - [Awarding Body] ([Year])</p></div>`,
                'References': `<div class="resume-section" data-section-name="References"><p><br></p><p><b>REFERENCES</b></p><p>Available upon request.</p></div>`,
                'Custom Section': `<div class="resume-section" data-section-name="Custom Section"><p><br></p><p><b>[CUSTOM SECTION TITLE]</b></p><p>[Your content here]</p></div>`,
            };

            const mockUserCV = `JOHN DOE
Software Engineer
john.doe@email.com | (555) 123-4567 | LinkedIn: linkedin.com/in/johndoe

PROFESSIONAL SUMMARY
Experienced software engineer with 5+ years developing scalable web applications using React, Node.js, and cloud technologies. Proven track record of leading cross-functional teams and delivering high-impact solutions.

CORE SKILLS
 Frontend: React, TypeScript, JavaScript, HTML5, CSS3
 Backend: Node.js, Python, Express.js, RESTful APIs
 Databases: PostgreSQL, MongoDB, Redis
 Cloud: AWS, Docker, Kubernetes
 Tools: Git, Jenkins, Jira, Agile/Scrum

EXPERIENCE
Senior Software Engineer | TechCorp Inc. | 2022-Present
 Led development of microservices architecture serving 100K+ users
 Implemented CI/CD pipelines reducing deployment time by 60%
 Mentored 3 junior developers and conducted code reviews
 Collaborated with product team to define technical requirements

Software Engineer | StartupXYZ | 2020-2022
 Built responsive web applications using React and Node.js
 Optimized database queries improving application performance by 40%
 AWS Certified Solutions Architect
 Certified Scrum Master (CSM)`;

            const plainTextToHtml = (text) => {
                if (!text) return '';
                return text.split('\n').map(line => `<p>${line || '<br>'}</p>`).join('');
            };

            const handleChooseCV = () => {
                setStep('upload');
            };

            const handleStartFromScratch = () => {
                try {
                    // Validate that we have sections to work with
                    if (!activeSections || activeSections.length === 0) {
                        showToast('No sections available. Please refresh the page.', 'error');
                        return;
                    }
                    
                    const initialContent = activeSections
                        .map(sectionName => {
                            const template = sectionTemplates[sectionName];
                            if (!template) {
                                console.warn(`Missing template for section: ${sectionName}`);
                                return '';
                            }
                            return template;
                        })
                        .filter(content => content.length > 0)
                        .join('');
                    
                    if (initialContent.length === 0) {
                        showToast('Failed to generate initial resume content', 'error');
                        return;
                    }
                    
                    const emptyResume = {
                        id: 'new-cv-' + Date.now(),
                        title: 'New Resume',
                        type: 'master',
                        content: initialContent,
                        atsScore: 0,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Validate the created resume
                    const validation = ValidationUtils.validateResumeData(emptyResume);
                    if (!validation.valid) {
                        showToast(validation.error, 'error');
                        return;
                    }
                    
                    setResumes([emptyResume]);
                    setActiveResumeId(emptyResume.id);
                    setActiveResume(emptyResume);
                    setEditorContent(initialContent);
                    setUndoHistory([initialContent]);
                    setHistoryPointer(0);
                    setStep('studio');
                    
                    // Save to localStorage
                    try {
                        localStorage.setItem('smart_resume_studio_resumes', JSON.stringify([emptyResume]));
                    } catch (storageError) {
                        ErrorHandler.handleStorageError(storageError, 'create new resume');
                    }
                } catch (error) {
                    console.error('Error starting from scratch:', error);
                    showToast('An error occurred while creating the resume', 'error');
                }
            };
            
            const processImportedFile = async (file) => {
                if (!file) {
                    setImportError('No file selected for processing.');
                    setImportStatus('error');
                    showToast('Please select a file to import', 'error');
                    return;
                }
                
                // Validate file again before processing
                const validation = ValidationUtils.validateFile(file);
                if (!validation.valid) {
                    setImportError(validation.error);
                    setImportStatus('error');
                    showToast(validation.error, 'error');
                    return;
                }
                
                setIsProcessing(true);
                setImportStatus('processing');
                setImportError('');
                
                try {
                    // Simulate file processing delay
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Sanitize filename for resume title
                    const sanitizedTitle = ValidationUtils.sanitizeFileName(
                        file.name.replace(/\.[^/.]+$/, '')
                    ) || 'Imported Resume';
                    
                    // Check for duplicate titles
                    const duplicateExists = resumes.some(r => 
                        r.title.trim().toLowerCase() === sanitizedTitle.toLowerCase()
                    );
                    
                    const finalTitle = duplicateExists 
                        ? `${sanitizedTitle} (${Date.now()})`
                        : sanitizedTitle;
                    
                    const newResume = {
                        id: Date.now().toString(),
                        title: finalTitle,
                        type: 'master',
                        content: plainTextToHtml(mockUserCV),
                        atsScore: 75,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Validate the created resume
                    const resumeValidation = ValidationUtils.validateResumeData(newResume);
                    if (!resumeValidation.valid) {
                        throw new Error(resumeValidation.error);
                    }
                    
                    const updatedResumes = [...resumes, newResume];
                    
                    // Save to localStorage with error handling
                    try {
                        localStorage.setItem('smart_resume_studio_resumes', JSON.stringify(updatedResumes));
                        setResumes(updatedResumes);
                        setActiveResumeId(newResume.id);
                        setActiveResume(newResume);
                        setEditorContent(newResume.content);
                        setUndoHistory([newResume.content]);
                        setHistoryPointer(0);
                        setStep('studio');
                        setShowImportModal(false);
                        setImportFile(null);
                        setImportStatus('idle');
                        setUploadError('');
                        setImportError('');
                        
                        // Reset file input
                        if (fileInputRef.current) {
                            fileInputRef.current.value = '';
                        }
                        
                        showToast('Resume imported successfully', 'success');
                    } catch (storageError) {
                        ErrorHandler.handleStorageError(storageError, 'import resume');
                        setImportStatus('error');
                    }
                } catch (error) {
                    console.error('Error processing imported file:', error);
                    const errorMessage = error.message || 'Failed to process the uploaded file';
                    setUploadError(errorMessage);
                    setImportError(errorMessage);
                    setImportStatus('error');
                    showToast(errorMessage, 'error');
                } finally {
                    setIsProcessing(false);
                }
            };

            const handleResumeSelect = (resumeId) => {
                try {
                    if (!resumeId || typeof resumeId !== 'string') {
                        showToast('Invalid resume ID', 'error');
                        return;
                    }
                    
                    const resume = resumes.find(r => r.id === resumeId);
                    if (!resume) {
                        showToast('Resume not found', 'error');
                        return;
                    }
                    
                    // Validate resume data before selecting
                    const validation = ValidationUtils.validateResumeData(resume);
                    if (!validation.valid) {
                        showToast(`Cannot load resume: ${validation.error}`, 'error');
                        return;
                    }
                    
                    setActiveResumeId(resumeId);
                    setActiveResume(resume);
                    setEditorContent(resume.content || '');
                    setUndoHistory([resume.content || '']);
                    setHistoryPointer(0);
                    setViewMode('edit');
                } catch (error) {
                    console.error('Error selecting resume:', error);
                    showToast('An error occurred while loading the resume', 'error');
                }
            };


            const handleContentChange = (newContent) => {
                try {
                    // Validate content
                    if (typeof newContent !== 'string') {
                        console.warn('Invalid content type:', typeof newContent);
                        return;
                    }
                    
                    // Prevent excessively large content (safety check)
                    if (newContent.length > 1000000) { // 1MB limit
                        showToast('Content is too large. Please reduce the size.', 'error');
                        return;
                    }
                    
                    if (newContent !== editorContent) {
                        const newHistory = undoHistory.slice(0, historyPointer + 1);
                        
                        // Limit history size to prevent memory issues
                        if (newHistory.length > 50) {
                            newHistory.shift();
                            setHistoryPointer(newHistory.length - 1);
                        }
                        
                        newHistory.push(newContent);
                        setUndoHistory(newHistory);
                        setHistoryPointer(newHistory.length - 1);
                        setEditorContent(newContent);
                        
                        // Auto-save after 2 seconds of inactivity
                        if (autoSaveEnabled && activeResume) {
                            if (autoSaveTimeoutRef.current) {
                                clearTimeout(autoSaveTimeoutRef.current);
                            }
                            autoSaveTimeoutRef.current = setTimeout(() => {
                                if (handleSaveRef.current) {
                                    handleSaveRef.current(true); // silent save
                                }
                            }, 2000);
                        }
                    }
                } catch (error) {
                    console.error('Error handling content change:', error);
                    showToast('An error occurred while updating content', 'error');
                }
            };

            const handleUndo = () => {
                try {
                    if (historyPointer > 0) {
                        const newPointer = historyPointer - 1;
                        if (undoHistory[newPointer]) {
                            setHistoryPointer(newPointer);
                            setEditorContent(undoHistory[newPointer]);
                        } else {
                            showToast('Cannot undo: History data is invalid', 'error');
                        }
                    }
                } catch (error) {
                    console.error('Error during undo:', error);
                    showToast('Failed to undo change', 'error');
                }
            };

            const handleSave = async (silent = false) => {
                if (!activeResume) {
                    showToast('No resume selected', 'error');
                    return;
                }
                
                try {
                    setIsLoading(true);
                    
                    // Validate resume data before saving
                    const validation = ValidationUtils.validateResumeData(activeResume);
                    if (!validation.valid) {
                        showToast(validation.error, 'error');
                        setIsLoading(false);
                        return;
                    }
                    
                    // Simulate save delay
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const updatedResume = { 
                        ...activeResume, 
                        content: editorContent, 
                        updatedAt: new Date().toISOString() 
                    };
                    
                    const updatedResumes = resumes.map(r => 
                        r.id === activeResume.id ? updatedResume : r
                    );
                    
                    // Save to localStorage with error handling
                    try {
                        localStorage.setItem('smart_resume_studio_resumes', JSON.stringify(updatedResumes));
                        setResumes(updatedResumes);
                        setActiveResume(updatedResume);
                        
                        if (!silent) {
                            showToast('Resume saved successfully', 'success');
                        }
                    } catch (storageError) {
                        ErrorHandler.handleStorageError(storageError, 'save resume');
                    }
                    
                    setIsLoading(false);
                } catch (error) {
                    console.error('Error saving resume:', error);
                    setIsLoading(false);
                    showToast('An unexpected error occurred while saving', 'error');
                }
            };

            // Store latest function references in refs for keyboard shortcuts
            // Update refs on every render to ensure latest functions are available
            handleSaveRef.current = handleSave;
            handleUndoRef.current = handleUndo;

            const createNewResume = async () => {
                try {
                    // Validate resume title
                    const titleValidation = ValidationUtils.validateResumeTitle(newResumeTitle);
                    if (!titleValidation.valid) {
                        showToast(titleValidation.error, 'error');
                        return;
                    }
                    
                    // Check for duplicate titles
                    const sanitizedTitle = ValidationUtils.sanitizeInput(newResumeTitle);
                    const duplicateExists = resumes.some(r => 
                        r.title.trim().toLowerCase() === sanitizedTitle.toLowerCase()
                    );
                    
                    if (duplicateExists) {
                        showToast('A resume with this title already exists', 'error');
                        return;
                    }
                    
                    const newResume = {
                        id: Date.now().toString(),
                        title: sanitizedTitle,
                        type: newResumeType,
                        content: newResumeType === 'master' 
                            ? activeSections.map(sectionName => sectionTemplates[sectionName] || '').join('')
                            : (resumes.find(r => r.type === 'master')?.content || activeSections.map(sectionName => sectionTemplates[sectionName] || '').join('')),
                        atsScore: 0,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    
                    // Validate the created resume
                    const resumeValidation = ValidationUtils.validateResumeData(newResume);
                    if (!resumeValidation.valid) {
                        showToast(resumeValidation.error, 'error');
                        return;
                    }
                    
                    const updatedResumes = [...resumes, newResume];
                    
                    // Save to localStorage with error handling
                    try {
                        localStorage.setItem('smart_resume_studio_resumes', JSON.stringify(updatedResumes));
                        setResumes(updatedResumes);
                        setActiveResumeId(newResume.id);
                        setActiveResume(newResume);
                        setEditorContent(newResume.content);
                        setUndoHistory([newResume.content]);
                        setHistoryPointer(0);
                        setShowCreateModal(false);
                        setNewResumeTitle('');
                        setViewMode('edit');
                        setStep('studio');
                        showToast(`${newResumeType === 'master' ? 'Master' : 'Campaign'} resume created`, 'success');
                    } catch (storageError) {
                        ErrorHandler.handleStorageError(storageError, 'create resume');
                    }
                } catch (error) {
                    console.error('Error creating resume:', error);
                    showToast('An unexpected error occurred while creating the resume', 'error');
                }
            };

            const handleFileSelectForImportModal = (event) => {
                try {
                    const file = event.target.files?.[0];
                    if (!file) {
                        setImportError('');
                        return;
                    }
                    
                    // Validate file
                    const validation = ValidationUtils.validateFile(file);
                    if (!validation.valid) {
                        setImportError(validation.error);
                        setImportFile(null);
                        // Reset file input
                        if (event.target) {
                            event.target.value = '';
                        }
                        return;
                    }
                    
                    setImportFile(file);
                    setImportError('');
                } catch (error) {
                    console.error('Error handling file selection:', error);
                    setImportError('An error occurred while processing the file');
                    setImportFile(null);
                }
            };

            const applyTextColor = (color) => {
                try {
                    // Validate color format
                    if (!color || typeof color !== 'string') {
                        showToast('Invalid color value', 'error');
                        return;
                    }
                    
                    // Validate hex color format
                    if (!/^#[0-9A-Fa-f]{6}$/.test(color)) {
                        showToast('Please enter a valid color (hex format)', 'error');
                        return;
                    }
                    
                    if (!editorRef.current) {
                        showToast('Editor not ready', 'error');
                        return;
                    }
                    
                    editorRef.current.focus();
                    document.execCommand('foreColor', false, color);
                    handleContentChange(editorRef.current.innerHTML);
                } catch (error) {
                    console.error('Error applying text color:', error);
                    showToast('Failed to apply text color', 'error');
                }
            };

            const applyFormat = (command, value = null) => {
                try {
                    if (!editorRef.current) {
                        showToast('Editor not ready', 'error');
                        return;
                    }
                    
                    // Validate command
                    const validCommands = ['bold', 'italic', 'underline', 'insertUnorderedList', 'insertOrderedList', 'justifyLeft', 'justifyCenter', 'justifyRight'];
                    if (!validCommands.includes(command)) {
                        console.warn('Invalid format command:', command);
                        return;
                    }
                
                const alignmentCommands = {
                    justifyLeft: 'left',
                    justifyCenter: 'center',
                    justifyRight: 'right'
                };
                if (command in alignmentCommands) {
                    const alignment = alignmentCommands[command];
                    editorRef.current.focus();
                    const selection = window.getSelection();
                    if (!selection.rangeCount) return;
                    const range = selection.getRangeAt(0);
                    const editorNode = editorRef.current;
                    
                    if (!editorNode.contains(range.commonAncestorContainer)) return;
                    
                    const paragraphsToAlign = new Set();
                    const allParagraphs = editorNode.querySelectorAll('p');
                    allParagraphs.forEach(p => {
                        if (range.intersectsNode(p)) {
                            paragraphsToAlign.add(p);
                        }
                    });
                    
                    if (paragraphsToAlign.size === 0 && range.collapsed) {
                        let currentNode = range.startContainer;
                        while (currentNode && currentNode !== editorNode) {
                            if (currentNode.nodeName === 'P') {
                                paragraphsToAlign.add(currentNode);
                                break;
                            }
                            currentNode = currentNode.parentNode;
                        }
                    }
                    
                    paragraphsToAlign.forEach(p => {
                        p.style.textAlign = alignment;
                    });
                } else {
                    editorRef.current.focus();
                    document.execCommand(command, false, value);
                }
                
                handleContentChange(editorRef.current.innerHTML);
                } catch (error) {
                    console.error('Error applying format:', error);
                    showToast('Failed to apply formatting', 'error');
                }
            };

            const handleAddSection = (sectionName) => {
                try {
                    // Validate section name
                    const validation = ValidationUtils.validateSectionName(sectionName);
                    if (!validation.valid) {
                        showToast(validation.error, 'error');
                        return;
                    }
                    
                    // Check if section already exists
                    if (activeSections.includes(sectionName)) {
                        showToast('Section already exists', 'error');
                        return;
                    }
                    
                    // Check if section template exists
                    if (!sectionTemplates[sectionName]) {
                        showToast('Invalid section type', 'error');
                        return;
                    }
                    
                    setActiveSections([...activeSections, sectionName]);
                    const sectionContent = sectionTemplates[sectionName];
                    if (sectionContent) {
                        const newContent = editorContent + sectionContent;
                        handleContentChange(newContent);
                        showToast(`${sectionName} section added`, 'success');
                    }
                } catch (error) {
                    console.error('Error adding section:', error);
                    showToast('An error occurred while adding the section', 'error');
                }
            };

            const handleDeleteSection = (sectionName) => {
                try {
                    // Validate section name
                    const validation = ValidationUtils.validateSectionName(sectionName);
                    if (!validation.valid) {
                        showToast(validation.error, 'error');
                        return;
                    }
                    
                    // Check if section exists
                    if (!activeSections.includes(sectionName)) {
                        showToast('Section not found', 'error');
                        return;
                    }
                    
                    // Prevent deleting all sections
                    if (activeSections.length <= 1) {
                        showToast('Cannot delete the last section', 'error');
                        return;
                    }
                    
                    setActiveSections(activeSections.filter(section => section !== sectionName));
                    
                    const tempContainer = document.createElement('div');
                    tempContainer.innerHTML = editorContent;
                    
                    const sectionToRemove = tempContainer.querySelector(`.resume-section[data-section-name="${sectionName}"]`);
                    
                    if (sectionToRemove) {
                        sectionToRemove.remove();
                        handleContentChange(tempContainer.innerHTML);
                        showToast(`${sectionName} section removed`, 'success');
                    }
                } catch (error) {
                    console.error('Error deleting section:', error);
                    showToast('An error occurred while removing the section', 'error');
                }
            };

            const handleATSOptimization = async () => {
                if (!activeResume) {
                    showToast('Please select a resume first', 'error');
                    return;
                }
                
                try {
                    setAiProcessing(true);
                    showToast('Optimizing resume for ATS...', 'info');
                    
                    // Simulate API call - in production, this would call OpenAI API
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    if (activeResume) {
                        const newScore = Math.min(100, activeResume.atsScore + 10);
                        const updatedResumes = resumes.map(r => 
                            r.id === activeResume.id 
                                ? { ...r, atsScore: newScore }
                                : r
                        );
                        
                        try {
                            localStorage.setItem('smart_resume_studio_resumes', JSON.stringify(updatedResumes));
                            setResumes(updatedResumes);
                            setActiveResume({ ...activeResume, atsScore: newScore });
                            showToast(`ATS score improved to ${newScore}%`, 'success');
                        } catch (storageError) {
                            ErrorHandler.handleStorageError(storageError, 'update ATS score');
                        }
                    }
                } catch (error) {
                    console.error('Error during ATS optimization:', error);
                    ErrorHandler.handleAPIError(error, 'optimize resume');
                } finally {
                    setAiProcessing(false);
                }
            };

            const handleEnhanceText = async () => {
                if (!selectedText || selectedText.trim().length === 0) {
                    showToast('Please select some text to enhance', 'error');
                    return;
                }
                
                try {
                    setAiProcessing(true);
                    showToast('Enhancing text with AI...', 'info');
                    
                    // Simulate API call - in production, this would call OpenAI API
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    // In production, this would replace the selected text with enhanced version
                    showToast('Text enhanced successfully', 'success');
                } catch (error) {
                    console.error('Error enhancing text:', error);
                    ErrorHandler.handleAPIError(error, 'enhance text');
                } finally {
                    setAiProcessing(false);
                }
            };

            const handleGapJustification = async () => {
                if (!activeResume) {
                    showToast('Please select a resume first', 'error');
                    return;
                }
                
                try {
                    setAiProcessing(true);
                    showToast('Generating gap justification...', 'info');
                    
                    // Simulate API call - in production, this would call OpenAI API
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    
                    showToast('Gap justification suggestions ready', 'success');
                } catch (error) {
                    console.error('Error generating gap justification:', error);
                    ErrorHandler.handleAPIError(error, 'generate gap justification');
                } finally {
                    setAiProcessing(false);
                }
            };
            
            const getStatusIcon = () => {
                switch (importStatus) {
                    case 'uploading': return <div className="w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin" />;
                    case 'processing': return <div className="w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full animate-spin" />;
                    case 'success': return <CheckCircle className="w-6 h-6 text-green-500" />;
                    case 'error': return <AlertCircle className="w-6 h-6 text-red-500" />;
                    default: return <FileText className="w-6 h-6 text-blue-500" />;
                }
            };

            const getStatusText = () => {
                switch (importStatus) {
                    case 'uploading': return 'Uploading file...';
                    case 'processing': return 'Processing resume content...';
                    case 'success': return 'Resume imported successfully!';
                    case 'error': return 'Import failed';
                    default: return 'Select a file to import';
                }
            };

            const colorPalettes = [
                { name: 'Blue', primary: '#3B82F6', secondary: '#64748B', accent: '#8B5CF6' },
                { name: 'Green', primary: '#10B981', secondary: '#64748B', accent: '#F59E0B' },
                { name: 'Purple', primary: '#8B5CF6', secondary: '#64748B', accent: '#EF4444' },
                { name: 'Orange', primary: '#F97316', secondary: '#64748B', accent: '#06B6D4' },
                { name: 'Red', primary: '#EF4444', secondary: '#64748B', accent: '#10B981' },
                { name: 'Teal', primary: '#14B8A6', secondary: '#64748B', accent: '#F59E0B' },
                { name: 'Indigo', primary: '#6366F1', secondary: '#64748B', accent: '#EC4899' },
                { name: 'Gray', primary: '#6B7280', secondary: '#9CA3AF', accent: '#3B5CF6' },
                { name: 'Black', primary: '#000000', secondary: '#475569', accent: '#e2e8f0' },
                { name: 'White', primary: '#FFFFFF', secondary: '#f1f5f9', accent: '#64748b' }
            ];

            const templates = [
                { id: 'classic-1', name: 'Professional Classic', category: 'classic', preview: 'bg-white border-2 border-gray-300', description: 'Traditional professional layout' },
                { id: 'modern-1', name: 'Tech Modern', category: 'modern', preview: 'bg-gradient-to-br from-indigo-500 to-purple-600', description: 'Technology industry modern' },
                { id: 'photo-1', name: 'Professional Photo', category: 'photo', preview: 'bg-gradient-to-r from-blue-100 to-blue-200 border-2 border-blue-300', description: 'Photo-centric professional' },
                { id: 'classic-2', name: 'Executive Classic', category: 'classic', preview: 'bg-gray-50 border-2 border-gray-400', description: 'Executive-level traditional' },
                { id: 'modern-2', name: 'Creative Modern', category: 'modern', preview: 'bg-gradient-to-br from-pink-500 to-rose-600', description: 'Creative and bold design' },
                { id: 'photo-2', name: 'Creative Photo', category: 'photo', preview: 'bg-gradient-to-r from-purple-100 to-pink-200 border-2 border-purple-300', description: 'Creative industries focused' },
            ];

            const availableSections = ['Heading', 'Profile', 'Core Skills', 'Experience', 'Education', 'Projects', 'Certifications', 'Languages', 'Volunteering', 'Publications', 'Professional Affiliations', 'Interests', 'Awards & Honors', 'References', 'Custom Section'];

            const fontStyles = ['Inter', 'Roboto', 'Open Sans', 'Lato', 'Montserrat', 'Poppins', 'Source Sans Pro', 'Century Gothic'];

            const filteredTemplates = templateCategory === 'all' ? templates : templates.filter(t => t.category === templateCategory);

            const updateFormatting = (key, value) => {
                try {
                    // Validate formatting key
                    const validKeys = [
                        'alignment', 'textColor', 'highlightColor', 'fontStyle', 'fontSize', 
                        'headingSize', 'sectionSpacing', 'paragraphSpacing', 'lineSpacing', 
                        'topBottomMargin', 'sideMargins', 'paragraphIndent'
                    ];
                    
                    if (!validKeys.includes(key)) {
                        console.warn('Invalid formatting key:', key);
                        return;
                    }
                    
                    // Validate value based on key type
                    if (key === 'fontSize' || key === 'headingSize') {
                        const numValue = Number(value);
                        if (isNaN(numValue) || numValue < 8 || numValue > 24) {
                            showToast('Font size must be between 8 and 24', 'error');
                            return;
                        }
                        value = numValue;
                    } else if (key === 'lineSpacing') {
                        const numValue = Number(value);
                        if (isNaN(numValue) || numValue < 1 || numValue > 2) {
                            showToast('Line spacing must be between 1 and 2', 'error');
                            return;
                        }
                        value = numValue;
                    } else if (key === 'topBottomMargin' || key === 'sideMargins') {
                        const numValue = Number(value);
                        if (isNaN(numValue) || numValue < 0 || numValue > 50) {
                            showToast('Margins must be between 0 and 50mm', 'error');
                            return;
                        }
                        value = numValue;
                    } else if (key === 'textColor' || key === 'highlightColor') {
                        if (typeof value !== 'string' || !/^#[0-9A-Fa-f]{6}$|transparent/.test(value)) {
                            showToast('Invalid color format', 'error');
                            return;
                        }
                    } else if (key === 'fontStyle') {
                        const validFonts = ['Inter', 'Roboto', 'Open Sans', 'Lato', 'Montserrat', 'Poppins', 'Source Sans Pro', 'Century Gothic'];
                        if (!validFonts.includes(value)) {
                            console.warn('Invalid font style:', value);
                            return;
                        }
                    }
                    
                    setFormattingSettings(prev => ({ ...prev, [key]: value }));
                } catch (error) {
                    console.error('Error updating formatting:', error);
                    showToast('Failed to update formatting setting', 'error');
                }
            };

            // Load resumes from localStorage on mount
            useEffect(() => {
                try {
                    const savedData = localStorage.getItem('smart_resume_studio_resumes');
                    if (!savedData) {
                        return;
                    }
                    
                    const savedResumes = JSON.parse(savedData);
                    
                    // Validate loaded data structure
                    if (!Array.isArray(savedResumes)) {
                        console.error('Invalid resume data structure in localStorage');
                        showToast('Failed to load saved resumes. Data may be corrupted.', 'error');
                        // Clear corrupted data
                        try {
                            localStorage.removeItem('smart_resume_studio_resumes');
                        } catch (e) {
                            console.error('Failed to clear corrupted data:', e);
                        }
                        return;
                    }
                    
                    // Validate each resume before adding
                    const validResumes = savedResumes.filter(resume => {
                        const validation = ValidationUtils.validateResumeData(resume);
                        if (!validation.valid) {
                            console.warn('Invalid resume data found:', resume, validation.error);
                            return false;
                        }
                        return true;
                    });
                    
                    if (validResumes.length > 0) {
                        setResumes(validResumes);
                        // If there's only one resume and no active one, auto-select it
                        if (validResumes.length === 1 && !activeResumeId) {
                            const resume = validResumes[0];
                            setActiveResumeId(resume.id);
                            setActiveResume(resume);
                            setEditorContent(resume.content || '');
                            setUndoHistory([resume.content || '']);
                            setHistoryPointer(0);
                            setStep('studio');
                        } else if (validResumes.length > 1 && !activeResumeId) {
                            // Multiple resumes - show list view
                            setStep('list');
                        }
                    }
                } catch (error) {
                    console.error('Error loading resumes from localStorage:', error);
                    ErrorHandler.handleStorageError(error, 'load resumes');
                }
            }, []);

            // Save resumes to localStorage when they change
            useEffect(() => {
                if (resumes.length > 0) {
                    try {
                        // Validate all resumes before saving
                        const validResumes = resumes.filter(resume => {
                            const validation = ValidationUtils.validateResumeData(resume);
                            if (!validation.valid) {
                                console.warn('Attempted to save invalid resume:', resume, validation.error);
                                return false;
                            }
                            return true;
                        });
                        
                        if (validResumes.length !== resumes.length) {
                            console.warn(`Filtered out ${resumes.length - validResumes.length} invalid resumes before saving`);
                            showToast('Some resumes were not saved due to validation errors', 'error');
                        }
                        
                        localStorage.setItem('smart_resume_studio_resumes', JSON.stringify(validResumes));
                    } catch (error) {
                        ErrorHandler.handleStorageError(error, 'save resumes');
                    }
                }
            }, [resumes]);

            // Track selected text for AI features
            useEffect(() => {
                if (editorRef.current) {
                    const handleSelection = () => {
                        const selection = window.getSelection();
                        if (selection && selection.toString().trim()) {
                            setSelectedText(selection.toString());
                        }
                    };
                    editorRef.current.addEventListener('mouseup', handleSelection);
                    editorRef.current.addEventListener('keyup', handleSelection);
                    return () => {
                        if (editorRef.current) {
                            editorRef.current.removeEventListener('mouseup', handleSelection);
                            editorRef.current.removeEventListener('keyup', handleSelection);
                        }
                    };
                }
            }, [activeResumeId]);

            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    // Don't intercept if typing in input fields
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || (e.target.isContentEditable && e.target !== editorRef.current)) {
                        return;
                    }
                    
                    // Ctrl+S or Cmd+S: Save
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        if (activeResume && step === 'studio' && handleSaveRef.current) {
                            handleSaveRef.current();
                        }
                    }
                    // Ctrl+Z or Cmd+Z: Undo (only if not in input)
                    if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                        if (step === 'studio' && document.activeElement === editorRef.current && handleUndoRef.current) {
                            e.preventDefault();
                            handleUndoRef.current();
                        }
                    }
                    // Escape: Close modals
                    if (e.key === 'Escape') {
                        if (showCreateModal) setShowCreateModal(false);
                        if (showExportModal) setShowExportModal(false);
                        if (showImportModal) setShowImportModal(false);
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [activeResume, step, showCreateModal, showExportModal, showImportModal]);

            // Cleanup auto-save timeout
            useEffect(() => {
                return () => {
                    if (autoSaveTimeoutRef.current) {
                        clearTimeout(autoSaveTimeoutRef.current);
                    }
                };
            }, []);

            if (step === 'list' || (step === 'studio' && resumes.length === 0 && !activeResumeId)) {
                return (
                    <ResumeListViewer 
                        resumes={resumes}
                        onSelectResume={handleResumeSelect}
                        onCreateNew={() => setShowCreateModal(true)}
                        onImport={() => setStep('upload')}
                    />
                );
            }

            if (step === 'selection') {
                return (
                    <div className="h-full flex items-center justify-center p-8 bg-gradient-to-br from-indigo-50 via-white to-purple-50">
                        <div className="w-full max-w-4xl">
                            <div className="text-center mb-12">
                                <h1 className="text-4xl font-bold text-slate-900 mb-4">Smart Resume Studio</h1>
                                <p className="text-xl text-slate-600">Create professional resumes with AI-powered editing</p>
                            </div>
                            
                            <div className="grid md:grid-cols-2 gap-6">
                                <button
                                    onClick={handleChooseCV}
                                    className="p-8 bg-white/70 backdrop-blur-xl border-2 border-white/30 rounded-2xl hover:border-indigo-400 transition-all shadow-lg hover:shadow-xl text-left group"
                                >
                                    <Upload className="w-12 h-12 text-indigo-600 mb-4 group-hover:scale-110 transition-transform" />
                                    <h3 className="text-2xl font-bold text-slate-900 mb-2">Import Your CV</h3>
                                    <p className="text-slate-600">Upload your existing resume and start editing</p>
                                </button>
                                
                                <button
                                    onClick={handleStartFromScratch}
                                    className="p-8 bg-white/70 backdrop-blur-xl border-2 border-white/30 rounded-2xl hover:border-indigo-400 transition-all shadow-lg hover:shadow-xl text-left group"
                                >
                                    <Plus className="w-12 h-12 text-purple-600 mb-4 group-hover:scale-110 transition-transform" />
                                    <h3 className="text-2xl font-bold text-slate-900 mb-2">Start From Scratch</h3>
                                    <p className="text-slate-600">Build a new resume with our templates</p>
                                </button>
                            </div>
                            
                            {resumes.length > 0 && (
                                <div className="mt-8 text-center">
                                    <button
                                        onClick={() => setStep('list')}
                                        className="inline-flex items-center gap-2 px-6 py-3 bg-white/70 backdrop-blur-xl border-2 border-white/30 text-slate-700 rounded-lg hover:border-indigo-400 hover:text-indigo-600 transition-all font-medium"
                                    >
                                        <FileText className="w-5 h-5" />
                                        View Existing Resumes ({resumes.length})
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (step === 'upload') {
                return (
                    <div className="h-full flex items-center justify-center p-8">
                        <div className="w-full max-w-2xl bg-white/70 backdrop-blur-xl border border-white/30 rounded-2xl p-8 shadow-xl">
                            <h2 className="text-2xl font-bold text-slate-900 mb-6">Import Your Resume</h2>
                            <div className="space-y-6">
                                <div className="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center">
                                    <FileText className="w-16 h-16 mx-auto text-gray-400 mb-4" />
                                    <p className="text-sm text-slate-600 mb-4">Select a file to import</p>
                                    <button
                                        onClick={() => fileInputRef.current?.click()}
                                        className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                    >
                                        Choose File
                                    </button>
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        onChange={(e) => {
                                            const file = e.target.files?.[0];
                                            if (file) {
                                                setUploadedFile(file);
                                                setUploadError('');
                                            }
                                        }}
                                        accept=".pdf,.docx,.doc,.txt"
                                        className="hidden"
                                    />
                                </div>
                                
                                {uploadedFile && (
                                    <div className="p-4 bg-indigo-50 border border-indigo-200 rounded-lg">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <FileText className="w-6 h-6 text-indigo-600" />
                                                <div>
                                                    <p className="font-medium text-slate-900">{uploadedFile.name}</p>
                                                    <p className="text-sm text-slate-600">{(uploadedFile.size / 1024).toFixed(2)} KB</p>
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    setUploadedFile(null);
                                                    if (fileInputRef.current) fileInputRef.current.value = '';
                                                }}
                                                className="text-red-600 hover:text-red-800"
                                            >
                                                <X className="w-5 h-5" />
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {uploadError && (
                                    <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
                                        <p className="text-sm text-red-800">{uploadError}</p>
                                    </div>
                                )}

                                <div className="flex gap-4">
                                    <button
                                        onClick={() => setStep('selection')}
                                        className="flex-1 px-6 py-3 border border-gray-300 text-slate-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                                    >
                                        Back
                                    </button>
                                    <button
                                        onClick={() => uploadedFile && processImportedFile(uploadedFile)}
                                        disabled={!uploadedFile || isProcessing}
                                        className="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        {isProcessing ? 'Processing...' : 'Import Resume'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col">
                    {/* Main Content Area */}
                    <div className="flex gap-6" style={{ minHeight: 'calc(100vh - 12rem)' }}>
                        {/* Left Sidebar */}
                        <div className="w-80 bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6 overflow-y-auto custom-scrollbar flex-shrink-0" style={{ maxHeight: 'calc(100vh - 12rem)' }}>
                            {/* Resume Header */}
                            <div className="mb-6 pb-4 border-b border-gray-200">
                                <div className="flex items-center gap-2 mb-3">
                                    <button
                                        onClick={() => setStep('list')}
                                        className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors"
                                        title="Back to list"
                                    >
                                        <ArrowRight className="w-4 h-4 text-slate-600 rotate-180" />
                                    </button>
                                    <h2 className="text-base font-semibold text-slate-900 flex-1">
                                        {activeResume ? activeResume.title : 'New Resume'}
                                    </h2>
                                    {activeResume && (
                                        <span className={`text-xs font-medium px-2 py-1 rounded ${
                                            activeResume.type === 'master' ? 'bg-amber-100 text-amber-700' : 'bg-cyan-100 text-cyan-700'
                                        }`}>
                                            {activeResume.type.toUpperCase()}
                                        </span>
                                    )}
                                </div>
                                
                                {/* Action Buttons */}
                                <div className="flex flex-wrap items-center gap-2">
                                    <button
                                        onClick={handleUndo}
                                        disabled={historyPointer <= 0}
                                        className="p-1.5 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50"
                                        title="Undo (Ctrl+Z)"
                                    >
                                        <RotateCcw className="w-4 h-4 text-slate-600" />
                                    </button>
                                    <button
                                        onClick={handleSave}
                                        disabled={isLoading}
                                        className="px-3 py-1.5 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium text-xs flex items-center gap-1.5 disabled:opacity-50"
                                        title="Save (Ctrl+S)"
                                    >
                                        {isLoading ? (
                                            <>
                                                <div className="w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                Saving...
                                            </>
                                        ) : (
                                            <>
                                                <Save className="w-3 h-3" />
                                                Save
                                            </>
                                        )}
                                    </button>
                                    {autoSaveEnabled && (
                                        <span className="text-xs text-slate-500 px-1.5" title="Auto-save enabled">
                                            Auto-save
                                        </span>
                                    )}
                                    <button
                                        onClick={() => setShowExportModal(true)}
                                        className="px-3 py-1.5 border border-gray-300 text-slate-700 rounded-lg hover:bg-gray-50 transition-colors font-medium text-xs flex items-center gap-1.5"
                                        title="Export resume"
                                    >
                                        <Download className="w-3 h-3" />
                                        Export
                                    </button>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-3 mb-6">
                                <button
                                    onClick={() => setActiveTab('design')}
                                    className={`py-3 px-4 rounded-lg text-sm font-medium transition-all ${
                                        activeTab === 'design' 
                                            ? 'bg-purple-600 text-white shadow-md' 
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    Design
                                </button>
                                <button
                                    onClick={() => setActiveTab('formatting')}
                                    className={`py-3 px-4 rounded-lg text-sm font-medium transition-all ${
                                        activeTab === 'formatting' 
                                            ? 'bg-purple-600 text-white shadow-md' 
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    Formatting
                                </button>
                                <button
                                    onClick={() => setActiveTab('sections')}
                                    className={`py-3 px-4 rounded-lg text-sm font-medium transition-all ${
                                        activeTab === 'sections' 
                                            ? 'bg-purple-600 text-white shadow-md' 
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    Sections
                                </button>
                                <button
                                    onClick={() => setActiveTab('ai')}
                                    className={`py-3 px-4 rounded-lg text-sm font-medium transition-all ${
                                        activeTab === 'ai' 
                                            ? 'bg-purple-600 text-white shadow-md' 
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    AI Copilot
                                </button>
                            </div>

                            {activeTab === 'design' && (
                                <div className="space-y-6">
                                    {/* Template Selection */}
                                    <div>
                                        <h3 className="text-sm font-semibold text-slate-800 mb-3">Template</h3>
                                        <div className="flex gap-2 mb-3">
                                            <button
                                                onClick={() => setTemplateCategory('all')}
                                                className={`px-3 py-1 text-xs rounded-lg transition-colors ${
                                                    templateCategory === 'all' 
                                                        ? 'bg-indigo-600 text-white' 
                                                        : 'bg-gray-100 text-slate-600 hover:bg-gray-200'
                                                }`}
                                            >
                                                All
                                            </button>
                                            <button
                                                onClick={() => setTemplateCategory('classic')}
                                                className={`px-3 py-1 text-xs rounded-lg transition-colors ${
                                                    templateCategory === 'classic' 
                                                        ? 'bg-indigo-600 text-white' 
                                                        : 'bg-gray-100 text-slate-600 hover:bg-gray-200'
                                                }`}
                                            >
                                                Classic
                                            </button>
                                            <button
                                                onClick={() => setTemplateCategory('modern')}
                                                className={`px-3 py-1 text-xs rounded-lg transition-colors ${
                                                    templateCategory === 'modern' 
                                                        ? 'bg-indigo-600 text-white' 
                                                        : 'bg-gray-100 text-slate-600 hover:bg-gray-200'
                                                }`}
                                            >
                                                Modern
                                            </button>
                                            <button
                                                onClick={() => setTemplateCategory('photo')}
                                                className={`px-3 py-1 text-xs rounded-lg transition-colors ${
                                                    templateCategory === 'photo' 
                                                        ? 'bg-indigo-600 text-white' 
                                                        : 'bg-gray-100 text-slate-600 hover:bg-gray-200'
                                                }`}
                                            >
                                                Photo
                                            </button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            {filteredTemplates.map(template => (
                                                <button
                                                    key={template.id}
                                                    onClick={() => setSelectedTemplateId(template.id)}
                                                    className={`p-3 border-2 rounded-lg transition-all ${
                                                        selectedTemplateId === template.id
                                                            ? 'border-indigo-600 bg-indigo-50'
                                                            : 'border-gray-200 hover:border-gray-300'
                                                    }`}
                                                >
                                                    <div className={`h-16 ${template.preview} rounded mb-2`}></div>
                                                    <p className="text-xs font-medium text-slate-800 text-left">{template.name}</p>
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Color Palette */}
                                    <div>
                                        <h3 className="text-sm font-semibold text-slate-800 mb-3">Color Palette</h3>
                                        <div className="grid grid-cols-5 gap-2">
                                            {colorPalettes.map((palette, idx) => (
                                                <button
                                                    key={idx}
                                                    onClick={() => setSelectedColors(palette)}
                                                    className="p-2 border-2 rounded-lg hover:border-gray-400 transition-colors"
                                                    title={palette.name}
                                                >
                                                    <div className="flex gap-1">
                                                        <div className="w-4 h-4 rounded" style={{ backgroundColor: palette.primary }}></div>
                                                        <div className="w-4 h-4 rounded" style={{ backgroundColor: palette.secondary }}></div>
                                                        <div className="w-4 h-4 rounded" style={{ backgroundColor: palette.accent }}></div>
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'formatting' && (
                                <div className="space-y-6">
                                    {/* Text Formatting Tools */}
                                    <div>
                                        <h3 className="text-sm font-semibold text-slate-800 mb-3">Text Formatting</h3>
                                        <div className="space-y-4">
                                            <div className="flex gap-2 flex-wrap">
                                                <button
                                                    onClick={() => applyFormat('bold')}
                                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                    title="Bold"
                                                >
                                                    <Bold className="w-4 h-4 text-slate-600" />
                                                </button>
                                                <button
                                                    onClick={() => applyFormat('italic')}
                                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                    title="Italic"
                                                >
                                                    <Italic className="w-4 h-4 text-slate-600" />
                                                </button>
                                                <button
                                                    onClick={() => applyFormat('underline')}
                                                    className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                    title="Underline"
                                                >
                                                    <Underline className="w-4 h-4 text-slate-600" />
                                                </button>
                                            </div>
                                            
                                            <div>
                                                <label className="text-xs text-slate-600 mb-1 block">Text Color</label>
                                                <div className="flex gap-2">
                                                    <input
                                                        type="color"
                                                        value={formattingSettings.textColor}
                                                        onChange={(e) => {
                                                            updateFormatting('textColor', e.target.value);
                                                            applyTextColor(e.target.value);
                                                        }}
                                                        className="w-full h-10 border border-gray-300 rounded-lg cursor-pointer"
                                                    />
                                                </div>
                                            </div>

                                            <div>
                                                <label className="text-xs text-slate-600 mb-1 block">Alignment</label>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => applyFormat('justifyLeft')}
                                                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                        title="Align Left"
                                                    >
                                                        <AlignLeft className="w-4 h-4 text-slate-600" />
                                                    </button>
                                                    <button
                                                        onClick={() => applyFormat('justifyCenter')}
                                                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                        title="Align Center"
                                                    >
                                                        <AlignCenter className="w-4 h-4 text-slate-600" />
                                                    </button>
                                                    <button
                                                        onClick={() => applyFormat('justifyRight')}
                                                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                        title="Align Right"
                                                    >
                                                        <AlignRight className="w-4 h-4 text-slate-600" />
                                                    </button>
                                                </div>
                                            </div>

                                            <div>
                                                <label className="text-xs text-slate-600 mb-1 block">Lists</label>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => applyFormat('insertUnorderedList')}
                                                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                        title="Bullet List"
                                                    >
                                                        <List className="w-4 h-4 text-slate-600" />
                                                    </button>
                                                    <button
                                                        onClick={() => applyFormat('insertOrderedList')}
                                                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                                                        title="Numbered List"
                                                    >
                                                        <ListOrdered className="w-4 h-4 text-slate-600" />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Document Formatting Options */}
                                    <div>
                                        <h3 className="text-sm font-semibold text-slate-800 mb-3">Document Settings</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="text-xs text-slate-600 mb-1 block">Font Style</label>
                                                <select
                                                    value={formattingSettings.fontStyle}
                                                    onChange={(e) => updateFormatting('fontStyle', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                >
                                                    {fontStyles.map(font => (
                                                        <option key={font} value={font}>{font}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-600 mb-1 block">Font Size: {formattingSettings.fontSize}pt</label>
                                                <input
                                                    type="range"
                                                    min="8"
                                                    max="16"
                                                    value={formattingSettings.fontSize}
                                                    onChange={(e) => updateFormatting('fontSize', parseInt(e.target.value))}
                                                    className="w-full slider"
                                                />
                                            </div>
                                            <div>
                                                <label className="text-xs text-slate-600 mb-1 block">Line Spacing: {formattingSettings.lineSpacing}</label>
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="2"
                                                    step="0.1"
                                                    value={formattingSettings.lineSpacing}
                                                    onChange={(e) => updateFormatting('lineSpacing', parseFloat(e.target.value))}
                                                    className="w-full slider"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'sections' && (
                                <div className="space-y-4">
                                    <div>
                                        <h3 className="text-sm font-semibold text-slate-800 mb-3">Active Sections</h3>
                                        <div className="space-y-2">
                                            {activeSections.map(sectionName => (
                                                <div key={sectionName} className="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                                                    <span className="text-sm text-slate-700">{sectionName}</span>
                                                    <button
                                                        onClick={() => handleDeleteSection(sectionName)}
                                                        className="text-red-600 hover:text-red-800"
                                                    >
                                                        <X className="w-4 h-4" />
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h3 className="text-sm font-semibold text-slate-800 mb-3">Add Section</h3>
                                        <div className="space-y-2">
                                            {availableSections.filter(s => !activeSections.includes(s)).map(sectionName => (
                                                <button
                                                    key={sectionName}
                                                    onClick={() => handleAddSection(sectionName)}
                                                    className="w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-gray-50 rounded-lg transition-colors flex items-center gap-2"
                                                >
                                                    <Plus className="w-4 h-4 text-indigo-600" />
                                                    {sectionName}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'ai' && (
                                <AICopilot
                                    activeResume={activeResume}
                                    selectedText={selectedText}
                                    aiProcessing={aiProcessing}
                                    onATSOptimization={handleATSOptimization}
                                    onEnhanceText={handleEnhanceText}
                                    onGapJustification={handleGapJustification}
                                />
                            )}
                        </div>

                        {/* Center Editor */}
                        <div className="flex-1 overflow-y-auto custom-scrollbar" style={{ maxHeight: 'calc(100vh - 12rem)' }}>
                            <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                {activeResume ? (
                                    <ResumePreview
                                        content={editorContent}
                                        templateId={selectedTemplateId}
                                        colors={selectedColors}
                                        formatting={formattingSettings}
                                        activeSections={activeSections}
                                        onContentChange={handleContentChange}
                                        editorRef={editorRef}
                                    />
                                ) : (
                                    <div className="flex items-center justify-center" style={{ minHeight: '400px' }}>
                                        <div className="text-center">
                                            <FileText className="w-16 h-16 mx-auto text-gray-400 mb-4" />
                                            <p className="text-slate-600">No resume selected. Create or import a resume to get started.</p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                    </div>

                    {/* Create Modal */}
                    {showCreateModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                                <h3 className="text-2xl font-bold text-slate-900 mb-6">Create New Resume</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">
                                            Resume Title
                                            <span className="text-red-500 ml-1">*</span>
                                        </label>
                                        <input
                                            type="text"
                                            value={newResumeTitle}
                                            onChange={(e) => {
                                                const value = e.target.value;
                                                // Real-time validation feedback
                                                if (value.length > 100) {
                                                    showToast('Title must be less than 100 characters', 'error');
                                                    return;
                                                }
                                                setNewResumeTitle(value);
                                            }}
                                            placeholder="e.g., Software Engineer Resume"
                                            maxLength={100}
                                            className={`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                                                newResumeTitle.length > 0 && !ValidationUtils.validateResumeTitle(newResumeTitle).valid
                                                    ? 'border-red-300 bg-red-50'
                                                    : 'border-gray-300'
                                            }`}
                                        />
                                        {newResumeTitle.length > 0 && !ValidationUtils.validateResumeTitle(newResumeTitle).valid && (
                                            <p className="mt-1 text-xs text-red-600">
                                                {ValidationUtils.validateResumeTitle(newResumeTitle).error}
                                            </p>
                                        )}
                                        <p className="mt-1 text-xs text-slate-500">
                                            {newResumeTitle.length}/100 characters
                                        </p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Resume Type</label>
                                        <select
                                            value={newResumeType}
                                            onChange={(e) => setNewResumeType(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                        >
                                            <option value="master">Master Resume</option>
                                            <option value="campaign">Campaign Resume</option>
                                        </select>
                                    </div>
                                    <div className="flex gap-4 pt-4">
                                        <button
                                            onClick={() => {
                                                setShowCreateModal(false);
                                                setNewResumeTitle('');
                                            }}
                                            className="flex-1 px-6 py-3 border border-gray-300 text-slate-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={createNewResume}
                                            className="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                        >
                                            Create
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Export Modal */}
                    {showExportModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                            <div className="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
                                <h3 className="text-2xl font-bold text-slate-900 mb-6">Export Resume</h3>
                                <div className="space-y-4">
                                    <button
                                        onClick={() => {
                                            try {
                                                if (!activeResume) {
                                                    showToast('No resume selected', 'error');
                                                    return;
                                                }
                                                
                                                if (!editorContent || editorContent.trim().length === 0) {
                                                    showToast('Resume is empty. Please add some content first.', 'error');
                                                    return;
                                                }
                                                
                                                const sanitizedTitle = ValidationUtils.sanitizeFileName(
                                                    activeResume.title || 'resume'
                                                );
                                                
                                                const blob = new Blob([editorContent], { type: 'text/html' });
                                                const url = URL.createObjectURL(blob);
                                                const a = document.createElement('a');
                                                a.href = url;
                                                a.download = `${sanitizedTitle}.html`;
                                                document.body.appendChild(a);
                                                a.click();
                                                document.body.removeChild(a);
                                                URL.revokeObjectURL(url);
                                                setShowExportModal(false);
                                                showToast('Resume exported as HTML', 'success');
                                            } catch (error) {
                                                console.error('Error exporting HTML:', error);
                                                showToast('Failed to export resume. Please try again.', 'error');
                                            }
                                        }}
                                        className="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium text-left flex items-center gap-2"
                                    >
                                        <Download className="w-5 h-5" />
                                        Export as HTML
                                    </button>
                                    <button
                                        onClick={() => {
                                            try {
                                                if (!activeResume) {
                                                    showToast('No resume selected', 'error');
                                                    return;
                                                }
                                                
                                                if (!editorContent || editorContent.trim().length === 0) {
                                                    showToast('Resume is empty. Please add some content first.', 'error');
                                                    return;
                                                }
                                                
                                                const sanitizedTitle = ValidationUtils.sanitizeInput(
                                                    activeResume.title || 'Resume'
                                                );
                                                
                                                // Escape HTML in title for use in document title
                                                const safeTitle = sanitizedTitle.replace(/"/g, '&quot;');
                                                
                                                // Validate formatting settings to prevent injection
                                                const safeFontStyle = /^[a-zA-Z\s]+$/.test(formattingSettings.fontStyle) 
                                                    ? formattingSettings.fontStyle 
                                                    : 'Inter';
                                                const safeFontSize = Math.max(8, Math.min(16, formattingSettings.fontSize || 11));
                                                const safeLineSpacing = Math.max(1, Math.min(2, formattingSettings.lineSpacing || 1.4));
                                                const safeTopMargin = Math.max(0, Math.min(50, formattingSettings.topBottomMargin || 20));
                                                const safeSideMargin = Math.max(0, Math.min(50, formattingSettings.sideMargins || 20));
                                                const safeTextColor = /^#[0-9A-Fa-f]{6}$/.test(formattingSettings.textColor)
                                                    ? formattingSettings.textColor
                                                    : '#334155';
                                                
                                                const printWindow = window.open('', '_blank');
                                                if (printWindow) {
                                                    printWindow.document.write(`
                                                        <!DOCTYPE html>
                                                        <html>
                                                        <head>
                                                            <title>${safeTitle}</title>
                                                            <style>
                                                                @media print {
                                                                    @page { margin: 0; size: A4; }
                                                                }
                                                                body { 
                                                                    font-family: ${safeFontStyle}; 
                                                                    font-size: ${safeFontSize}pt; 
                                                                    line-height: ${safeLineSpacing}; 
                                                                    padding: ${safeTopMargin}mm ${safeSideMargin}mm;
                                                                    margin: 0;
                                                                    color: ${safeTextColor};
                                                                }
                                                            </style>
                                                        </head>
                                                        <body>${editorContent}</body>
                                                        </html>
                                                    `);
                                                    printWindow.document.close();
                                                    printWindow.print();
                                                    setShowExportModal(false);
                                                    showToast('Print dialog opened', 'success');
                                                } else {
                                                    showToast('Please allow popups to print', 'error');
                                                }
                                            } catch (error) {
                                                console.error('Error opening print dialog:', error);
                                                showToast('Failed to open print dialog. Please try again.', 'error');
                                            }
                                        }}
                                        className="w-full px-6 py-3 border border-gray-300 text-slate-700 rounded-lg hover:bg-gray-50 transition-colors font-medium text-left flex items-center gap-2"
                                    >
                                        <FileText className="w-5 h-5" />
                                        Print / PDF
                                    </button>
                                    <button
                                        onClick={() => setShowExportModal(false)}
                                        className="w-full px-6 py-3 border border-gray-300 text-slate-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Toast Notification */}
                    {toast && (
                        <div className={`fixed bottom-6 right-6 z-50 px-6 py-4 rounded-lg shadow-xl transition-all transform ${
                            toast.type === 'success' 
                                ? 'bg-green-500 text-white' 
                                : toast.type === 'error'
                                ? 'bg-red-500 text-white'
                                : 'bg-blue-500 text-white'
                        }`}>
                            <div className="flex items-center gap-3">
                                {toast.type === 'success' && <CheckCircle className="w-5 h-5" />}
                                {toast.type === 'error' && <AlertCircle className="w-5 h-5" />}
                                <p className="font-medium">{toast.message}</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Smart Resume Studio when resume-studio-content is shown
        window.renderSmartResumeStudio = function() {
            const container = document.getElementById('resume-studio-container');
            
            if (!container) {
                console.error('Resume studio container not found');
                return;
            }
            
            try {
                // Clean up previous root if exists
                if (window.smartResumeStudioRoot) {
                    try {
                        window.smartResumeStudioRoot.unmount();
                    } catch (unmountError) {
                        console.warn('Error unmounting previous root:', unmountError);
                    }
                    window.smartResumeStudioRoot = null;
                }
                
                // Clear container before rendering
                container.innerHTML = '';
                
                // Verify React is available
                if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                    throw new Error('React libraries not loaded. Please refresh the page.');
                }
                
                const root = ReactDOM.createRoot(container);
                root.render(<SmartResumeStudio />);
                window.smartResumeStudioRoot = root;
            } catch (error) {
                console.error('Error rendering Smart Resume Studio:', error);
                // Display error message in container
                container.innerHTML = `
                    <div class="p-8 text-center">
                        <div class="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md mx-auto">
                            <h3 class="text-lg font-semibold text-red-800 mb-2">Error Loading Resume Studio</h3>
                            <p class="text-sm text-red-600 mb-4">${error.message || 'An unexpected error occurred'}</p>
                            <button 
                                onclick="window.location.reload()" 
                                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
                            >
                                Reload Page
                            </button>
                        </div>
                    </div>
                `;
            }
        };

        // Cleanup function for Smart Resume Studio
        window.cleanupSmartResumeStudio = function() {
            if (window.smartResumeStudioRoot) {
                window.smartResumeStudioRoot.unmount();
                window.smartResumeStudioRoot = null;
            }
        };
    </script>

    <!-- Application Tailor React Component -->
    <script type="text/babel">
        const { useState } = React;

        const ApplicationTailor = () => {
            const [step, setStep] = useState('upload');
            const [resumeFile, setResumeFile] = useState(null);
            const [resumeContent, setResumeContent] = useState('');
            const [jobDescription, setJobDescription] = useState('');
            const [companyUrl, setCompanyUrl] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [uploadError, setUploadError] = useState('');
            const [analysisError, setAnalysisError] = useState('');
            const [tailoredResume, setTailoredResume] = useState('');
            const [matchScores, setMatchScores] = useState({
                overall: 94,
                keywordAlignment: 92,
                skillMatching: 88,
                experienceRelevance: 95,
                atsCompatibility: 98
            });
            const [optimizations, setOptimizations] = useState([]);
            const [isFetchingUrl, setIsFetchingUrl] = useState(false);
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            // Function to fetch job description from URL
            const handleFetchJobDescription = async () => {
                if (!companyUrl.trim()) {
                    alert('Please enter a URL first');
                    return;
                }

                // Validate URL
                try {
                    new URL(companyUrl);
                } catch (error) {
                    alert('Please enter a valid URL');
                    return;
                }

                setIsFetchingUrl(true);
                const apiKey = localStorage.getItem('openai_api_key');
                
                if (!apiKey) {
                    alert('OpenAI API key not found. Please set it in Settings > Integrations.');
                    setIsFetchingUrl(false);
                    return;
                }

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a web scraper. Extract the full job description from web pages, including job title, requirements, responsibilities, qualifications, and company information. Return the complete job posting text.'
                                },
                                {
                                    role: 'user',
                                    content: `Please fetch and extract the complete job description from this URL: ${companyUrl}

Extract:
- Job title
- Company name
- Full job description
- Requirements/qualifications
- Responsibilities
- Any other relevant details

Return the complete job posting text in a clear, readable format. If you cannot access the URL, explain why and provide guidance.`
                                }
                            ],
                            temperature: 0.3,
                            max_tokens: 4000
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Failed to fetch job description');
                    }

                    const data = await response.json();
                    const content = data.choices[0]?.message?.content;
                    
                    if (content) {
                        setJobDescription(content);
                        alert(' Job description fetched successfully!');
                    } else {
                        throw new Error('No content extracted from URL');
                    }
                } catch (error) {
                    console.error('Error fetching job description:', error);
                    alert(error.message || 'Failed to fetch job description. Please paste it manually.');
                } finally {
                    setIsFetchingUrl(false);
                }
            };

            const handleFileUpload = (event) => {
                const file = event.target.files?.[0];
                if (file) {
                    const allowedTypes = [
                        'application/pdf',
                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'application/msword',
                        'text/plain'
                    ];
                    
                    if (!allowedTypes.includes(file.type)) {
                        setUploadError('Please select a valid file type (PDF, DOCX, or TXT)');
                        return;
                    }
                    
                    if (file.size > 10 * 1024 * 1024) {
                        setUploadError('File size must be less than 10MB');
                        return;
                    }
                    
                    setResumeFile(file);
                    setUploadError('');
                    
                    // Read file content
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setResumeContent(e.target.result);
                    };
                    reader.readAsText(file);
                    
                    setStep('job-input');
                }
            };

            const handleAnalysis = async () => {
                if (!jobDescription.trim()) return;
                
                setIsProcessing(true);
                setAnalysisError('');
                setStep('analysis');
                
                try {
                    // Get API key
                    const apiKey = localStorage.getItem('openai_api_key');
                    if (!apiKey) {
                        throw new Error('OpenAI API key not found. Please set it in Settings.');
                    }

                    // Call OpenAI to analyze and tailor the resume
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are an expert resume writer and career coach. You help job seekers tailor their resumes to specific job postings by analyzing requirements, identifying matching skills and experiences, and optimizing content for ATS (Applicant Tracking Systems).'
                                },
                                {
                                    role: 'user',
                                    content: `Analyze this resume and tailor it to match the following job description.

RESUME CONTENT:
${resumeContent}

JOB DESCRIPTION:
${jobDescription}

TASK:
1. Analyze the job requirements and identify key keywords, skills, and qualifications needed
2. Review the resume to identify matching and missing elements
3. Create a tailored version of the resume that:
   - Naturally integrates relevant keywords from the job description
   - Emphasizes matching skills and experiences
   - Reorders/prioritizes relevant work experience
   - Optimizes for ATS compatibility
   - Maintains authenticity and avoids keyword stuffing

4. Calculate match scores in these categories (as percentages):
   - Overall Job Match Score
   - Keyword Alignment
   - Skill Matching
   - Experience Relevance
   - ATS Compatibility

5. List key optimizations made

Return your response in the following JSON format:
{
  "tailoredResume": "The optimized resume content...",
  "matchScores": {
    "overall": 94,
    "keywordAlignment": 92,
    "skillMatching": 88,
    "experienceRelevance": 95,
    "atsCompatibility": 98
  },
  "optimizations": [
    {
      "category": "Keywords Added",
      "description": "12 relevant keywords integrated naturally"
    },
    {
      "category": "Skills Emphasized",
      "description": "Highlighted matching technical skills"
    }
  ]
}`
                                }
                            ],
                            temperature: 0.5,
                            max_tokens: 3000
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Failed to analyze resume');
                    }

                    const data = await response.json();
                    const content = data.choices[0]?.message?.content;
                    
                    if (!content) {
                        throw new Error('No response from OpenAI');
                    }

                    // Extract JSON from response
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('Invalid response format');
                    }

                    const result = JSON.parse(jsonMatch[0]);
                    
                    setTailoredResume(result.tailoredResume || '');
                    setMatchScores(result.matchScores || matchScores);
                    setOptimizations(result.optimizations || []);
                    
                    // Save to localStorage for later use
                    const analysisResult = {
                        tailoredResume: result.tailoredResume,
                        matchScores: result.matchScores,
                        optimizations: result.optimizations,
                        jobDescription: jobDescription,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem('last_resume_analysis', JSON.stringify(analysisResult));
                    
                    setStep('results');
                } catch (error) {
                    console.error('Error during analysis:', error);
                    setAnalysisError(error.message || 'Failed to analyze resume. Please try again.');
                    setStep('job-input');
                } finally {
                    setIsProcessing(false);
                }
            };

            const handleDownload = () => {
                if (!tailoredResume) return;
                
                const blob = new Blob([tailoredResume], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tailored-resume-${new Date().getTime()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="space-y-8">
                    {/* Progress Indicator */}
                    <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                        <div className="flex items-center justify-between mb-4">
                            <span className="text-sm font-semibold text-slate-800">Progress</span>
                            <span className="text-sm text-slate-600">
                                Step {step === 'upload' ? 1 : step === 'job-input' ? 2 : step === 'analysis' ? 3 : 4} of 4
                            </span>
                        </div>
                        <div className="w-full bg-slate-200 rounded-full h-3">
                            <div 
                                className="bg-gradient-to-r from-indigo-500 to-purple-600 h-3 rounded-full transition-all duration-500 shadow-lg"
                                style={{ 
                                    width: step === 'upload' ? '25%' : 
                                           step === 'job-input' ? '50%' : 
                                           step === 'analysis' ? '75%' : '100%' 
                                }}
                            ></div>
                        </div>
                    </div>

                    {/* Step 1: Resume Upload */}
                    {step === 'upload' && (
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-8">
                                <h3 className="text-2xl font-bold text-slate-800 mb-6 text-center">Upload Your Resume</h3>
                                
                                <div className="border-2 border-dashed border-slate-300 rounded-2xl p-12 text-center hover:border-indigo-500/50 transition-colors">
                                    <input
                                        type="file"
                                        accept=".pdf,.docx,.doc"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                        id="resume-upload"
                                    />
                                    
                                    <div className="flex flex-col items-center gap-6">
                                        <div className="w-20 h-20 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                                            <div className="w-10 h-10 text-white text-2xl"></div>
                                        </div>
                                        
                                        <div>
                                            <h4 className="text-xl font-semibold text-slate-800 mb-3">
                                                {resumeFile ? resumeFile.name : 'Choose your resume file'}
                                            </h4>
                                            <p className="text-slate-600">
                                                {resumeFile ? 
                                                    `${(resumeFile.size / 1024 / 1024).toFixed(2)} MB  Ready to proceed` :
                                                    'PDF or DOCX format (Max 10MB)'
                                                }
                                            </p>
                                        </div>
                                        
                                        <label
                                            htmlFor="resume-upload"
                                            className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-4 rounded-xl font-semibold cursor-pointer transition-all duration-300 hover:from-indigo-600 hover:to-purple-700 hover:transform hover:scale-105"
                                        >
                                            {resumeFile ? 'Change File' : 'Select File'}
                                        </label>
                                    </div>
                                </div>

                                {uploadError && (
                                    <div className="mt-6 bg-red-50 border border-red-200 rounded-2xl p-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-5 h-5 text-red-600"></div>
                                            <p className="text-red-700 font-medium">{uploadError}</p>
                                        </div>
                                    </div>
                                )}

                                {resumeFile && (
                                    <div className="mt-6 text-center">
                                        <button
                                            onClick={() => setStep('job-input')}
                                            className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 hover:from-indigo-600 hover:to-purple-700 hover:transform hover:scale-105"
                                        >
                                            Continue to Job Details
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Step 2: Job Input */}
                    {step === 'job-input' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h3 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6 flex items-center gap-3`}>
                                        <div className="w-6 h-6 text-indigo-500"></div>
                                        Company Information
                                    </h3>
                                    
                                    <div>
                                        <label className={`block text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-3`}>
                                            Company Website or Job Posting URL (Optional)
                                        </label>
                                        <div className="flex gap-2">
                                            <input
                                                type="url"
                                                value={companyUrl}
                                                onChange={(e) => setCompanyUrl(e.target.value)}
                                                placeholder="https://company.com or job posting URL"
                                                className={`flex-1 px-4 py-3 ${isLightMode ? 'bg-gray-50 border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none transition-all duration-300`}
                                            />
                                            <button
                                                onClick={handleFetchJobDescription}
                                                disabled={!companyUrl.trim() || isFetchingUrl}
                                                className={`px-6 py-3 rounded-xl font-medium transition-all duration-300 whitespace-nowrap ${
                                                    companyUrl.trim() && !isFetchingUrl 
                                                        ? 'bg-indigo-600 text-white hover:bg-indigo-700' 
                                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                }`}
                                            >
                                                {isFetchingUrl ? ' Fetching...' : ' Fetch Job'}
                                            </button>
                                        </div>
                                        <p className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mt-2`}>
                                            {isFetchingUrl ? 'Fetching job description from URL...' : 'Paste URL and click "Fetch Job" to automatically extract job description'}
                                        </p>
                                    </div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h3 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6 flex items-center gap-3`}>
                                        <div className="w-6 h-6 text-purple-500"></div>
                                        Job Description
                                    </h3>
                                    
                                    <div>
                                        <label className={`block text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-3`}>
                                            Complete Job Posting
                                        </label>
                                        <textarea
                                            value={jobDescription}
                                            onChange={(e) => setJobDescription(e.target.value)}
                                            placeholder="Paste the complete job description here..."
                                            rows={12}
                                            className={`w-full px-4 py-3 ${isLightMode ? 'bg-gray-50 border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none resize-none transition-all duration-300`}
                                        />
                                        <div className="flex items-center justify-between mt-3">
                                            <p className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                Include job title, requirements, responsibilities, and company information
                                            </p>
                                            <span className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                {jobDescription.length} characters
                                            </span>
                                        </div>
                                    </div>

                                    <button
                                        onClick={handleAnalysis}
                                        disabled={!jobDescription.trim() || isProcessing}
                                        className="w-full mt-6 bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-4 rounded-xl font-semibold transition-all duration-300 hover:from-indigo-600 hover:to-purple-700 hover:transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
                                    >
                                        {isProcessing ? (
                                            <>
                                                <div className="w-5 h-5 animate-spin"></div>
                                                Analyzing...
                                            </>
                                        ) : (
                                            <>
                                                <div className="w-5 h-5"></div>
                                                Analyze & Tailor Resume
                                            </>
                                        )}
                                    </button>

                                    {analysisError && (
                                        <div className="mt-4 bg-red-50 border border-red-200 rounded-xl p-4">
                                            <div className="flex items-center gap-3">
                                                <div className="w-5 h-5 text-red-600"></div>
                                                <p className="text-red-700 font-medium">{analysisError}</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Resume Summary</h3>
                                    <div className="space-y-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-5 h-5 text-green-500"></div>
                                            <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'} text-sm`}>Resume uploaded successfully</span>
                                        </div>
                                        <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                            <strong className={isLightMode ? 'text-gray-900' : 'text-gray-50'}>File:</strong> {resumeFile?.name}
                                        </div>
                                        <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                            <strong className={isLightMode ? 'text-gray-900' : 'text-gray-50'}>Size:</strong> {resumeFile ? (resumeFile.size / 1024 / 1024).toFixed(2) : '0'} MB
                                        </div>
                                    </div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Tips for Best Results</h3>
                                    <div className="space-y-4 text-sm">
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>Include the complete job posting for better analysis</p>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>Company URL helps personalize the application</p>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>More details = better customization</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Step 3: Analysis */}
                    {step === 'analysis' && (
                        <div className="max-w-3xl mx-auto text-center">
                            <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-12`}>
                                <div className="w-24 h-24 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-8 shadow-lg">
                                    <div className="w-12 h-12 text-white text-4xl animate-pulse"></div>
                                </div>
                                <h3 className={`text-3xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Analyzing Job Requirements</h3>
                                <p className={`text-lg ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-8`}>Our AI is analyzing the job posting and tailoring your resume...</p>
                                
                                <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-800'} rounded-full h-4 mb-6`}>
                                    <div className="bg-gradient-to-r from-indigo-500 to-purple-600 h-4 rounded-full transition-all duration-1000 shadow-lg animate-pulse" style={{ width: '75%' }}></div>
                                </div>
                                
                                <div className={`${isLightMode ? 'bg-gray-50 border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-2xl p-6`}>
                                    <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-3`}>Processing Steps</h4>
                                    <div className={`space-y-2 text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                        <div className="flex items-center gap-2">
                                            <div className="w-4 h-4 text-green-500"></div>
                                            <span>Extracting job requirements</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <div className="w-4 h-4 text-green-500"></div>
                                            <span>Analyzing skill matches</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <div className="w-4 h-4 text-indigo-500 animate-spin"></div>
                                            <span>Optimizing content alignment</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <div className={`w-4 h-4 border-2 ${isLightMode ? 'border-gray-300' : 'border-gray-600'} rounded-full`}></div>
                                            <span>Generating tailored resume</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Step 4: Results */}
                    {step === 'results' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2">
                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h3 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} flex items-center gap-3`}>
                                            <div className="w-6 h-6 text-indigo-500"></div>
                                            Your Tailored Resume
                                        </h3>
                                        <div className="flex gap-3">
                                            <button className={`${isLightMode ? 'bg-gray-100 text-gray-700 hover:bg-gray-200' : 'bg-gray-700 text-gray-50 hover:bg-gray-600'} px-4 py-2 rounded-xl font-medium flex items-center gap-2 transition-colors`}>
                                                <div className="w-4 h-4"></div>
                                                Preview
                                            </button>
                                            <button onClick={handleDownload} className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-xl font-medium flex items-center gap-2 hover:from-indigo-600 hover:to-purple-700 transition-colors">
                                                <div className="w-4 h-4"></div>
                                                Download
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className={`${isLightMode ? 'bg-gray-50 border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-2xl p-6`}>
                                        {tailoredResume ? (
                                            <div className="space-y-6">
                                                <div className={`bg-white ${isLightMode ? 'text-gray-900' : 'bg-gray-900 text-gray-50'} p-8 rounded-xl whitespace-pre-wrap font-mono text-sm`}>
                                                    {tailoredResume}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="text-center py-20">
                                                <div className={`w-16 h-16 ${isLightMode ? 'text-gray-400' : 'text-gray-400'} mx-auto mb-4 text-6xl`}></div>
                                                <h4 className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Tailored Resume Ready</h4>
                                                <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>Your resume has been optimized for this specific job posting</p>
                                            </div>
                                        )}
                                    </div>
                                    
                                    {analysisError && (
                                        <div className="mt-6 bg-red-50 border border-red-200 rounded-2xl p-4">
                                            <div className="flex items-center gap-3">
                                                <div className="w-5 h-5 text-red-600"></div>
                                                <p className="text-red-700 font-medium">{analysisError}</p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Tailoring Results</h3>
                                    <div className="space-y-4">
                                        <div className="text-center">
                                            <div className="text-4xl font-bold text-green-500 mb-2">{matchScores.overall}%</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Job Match Score</div>
                                        </div>
                                        
                                        <div className="space-y-3 text-sm">
                                            <div className="flex justify-between">
                                                <span className={isLightMode ? 'text-gray-900' : 'text-gray-50'}>Keyword Alignment</span>
                                                <span className="text-green-500 font-semibold">{matchScores.keywordAlignment}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className={isLightMode ? 'text-gray-900' : 'text-gray-50'}>Skill Matching</span>
                                                <span className="text-green-500 font-semibold">{matchScores.skillMatching}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className={isLightMode ? 'text-gray-900' : 'text-gray-50'}>Experience Relevance</span>
                                                <span className="text-green-500 font-semibold">{matchScores.experienceRelevance}%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className={isLightMode ? 'text-gray-900' : 'text-gray-50'}>ATS Compatibility</span>
                                                <span className="text-green-500 font-semibold">{matchScores.atsCompatibility}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Key Optimizations</h3>
                                    <div className="space-y-3">
                                        {optimizations.length > 0 ? (
                                            optimizations.map((opt, index) => (
                                                <div key={index} className={`${isLightMode ? 'bg-gray-50 border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-3`}>
                                                    <h4 className="text-green-500 text-sm font-semibold mb-1">{opt.category}</h4>
                                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'} text-sm`}>{opt.description}</p>
                                                </div>
                                            ))
                                        ) : (
                                            <>
                                                <div className={`${isLightMode ? 'bg-gray-50 border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-3`}>
                                                    <h4 className="text-green-500 text-sm font-semibold mb-1">Keywords Added</h4>
                                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'} text-sm`}>12 relevant keywords integrated naturally</p>
                                                </div>
                                                
                                                <div className={`${isLightMode ? 'bg-gray-50 border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-3`}>
                                                    <h4 className="text-blue-500 text-sm font-semibold mb-1">Skills Emphasized</h4>
                                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'} text-sm`}>Highlighted matching technical skills</p>
                                                </div>
                                                
                                                <div className={`${isLightMode ? 'bg-gray-50 border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-3`}>
                                                    <h4 className="text-purple-500 text-sm font-semibold mb-1">Experience Reordered</h4>
                                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'} text-sm`}>Most relevant experience prioritized</p>
                                                </div>
                                            </>
                                        )}
                                    </div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Actions</h3>
                                    <div className="space-y-2">
                                        <button
                                            onClick={() => setStep('job-input')}
                                            className={`w-full text-left p-3 ${isLightMode ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100' : 'text-gray-400 hover:text-gray-50 hover:bg-gray-800'} rounded-xl transition-colors`}
                                        >
                                            Edit job description
                                        </button>
                                        <button
                                            onClick={() => setStep('upload')}
                                            className={`w-full text-left p-3 ${isLightMode ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100' : 'text-gray-400 hover:text-gray-50 hover:bg-gray-800'} rounded-xl transition-colors`}
                                        >
                                            Use different resume
                                        </button>
                                        <button className={`w-full text-left p-3 ${isLightMode ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100' : 'text-gray-400 hover:text-gray-50 hover:bg-gray-800'} rounded-xl transition-colors`}>
                                            Generate cover letter
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Application Tailor when app-tailor-content is shown
        window.renderApplicationTailor = function() {
            console.log('renderApplicationTailor called');
            const container = document.getElementById('app-tailor-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Application Tailor...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<ApplicationTailor />);
                    console.log('Application Tailor rendered successfully');
                } catch (error) {
                    console.error('Error rendering Application Tailor:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Application Tailor</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('app-tailor-container not found');
            }
        };

        // Add event listener for when app-tailor content is shown
        document.addEventListener('DOMContentLoaded', function() {
            // Render Application Tailor immediately when DOM is ready
            setTimeout(() => {
                const appTailorContent = document.getElementById('app-tailor-content');
                if (appTailorContent && !appTailorContent.classList.contains('hidden')) {
                    console.log('Application Tailor content is visible, rendering...');
                    window.renderApplicationTailor();
                }
            }, 100);

            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const appTailorContent = document.getElementById('app-tailor-content');
                        if (appTailorContent && !appTailorContent.classList.contains('hidden')) {
                            console.log('Application Tailor content became visible, rendering...');
                            window.renderApplicationTailor();
                        }
                    }
                });
            });

            const appTailorContent = document.getElementById('app-tailor-content');
            if (appTailorContent) {
                observer.observe(appTailorContent, { attributes: true, attributeFilter: ['class'] });
            }
        });

        // Cover Letter Generator React Component
        const CoverLetterGenerator = () => {
            const [step, setStep] = useState('upload');
            const [cvFile, setCvFile] = useState(null);
            const [cvContent, setCvContent] = useState('');
            const [companyUrl, setCompanyUrl] = useState('');
            const [jobDescription, setJobDescription] = useState('');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [isGenerating, setIsGenerating] = useState(false);
            const [analysisData, setAnalysisData] = useState(null);
            const [generatedCoverLetter, setGeneratedCoverLetter] = useState('');
            const [editedCoverLetter, setEditedCoverLetter] = useState('');
            const [uploadError, setUploadError] = useState('');
            const [showPreview, setShowPreview] = useState(false);
            const [isFetchingUrl, setIsFetchingUrl] = useState(false);

            // Function to fetch job description from URL
            const handleFetchJobDescription = async () => {
                if (!companyUrl.trim()) {
                    alert('Please enter a URL first');
                    return;
                }

                // Validate URL
                try {
                    new URL(companyUrl);
                } catch (error) {
                    alert('Please enter a valid URL');
                    return;
                }

                setIsFetchingUrl(true);
                const apiKey = localStorage.getItem('openai_api_key');
                
                if (!apiKey) {
                    alert('OpenAI API key not found. Please set it in Settings > Integrations.');
                    setIsFetchingUrl(false);
                    return;
                }

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a web scraper. Extract the full job description from web pages, including job title, requirements, responsibilities, qualifications, and company information. Return the complete job posting text.'
                                },
                                {
                                    role: 'user',
                                    content: `Please fetch and extract the complete job description from this URL: ${companyUrl}

Extract:
- Job title
- Company name
- Full job description
- Requirements/qualifications
- Responsibilities
- Any other relevant details

Return the complete job posting text in a clear, readable format. If you cannot access the URL, explain why and provide guidance.`
                                }
                            ],
                            temperature: 0.3,
                            max_tokens: 4000
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Failed to fetch job description');
                    }

                    const data = await response.json();
                    const content = data.choices[0]?.message?.content;
                    
                    if (content) {
                        setJobDescription(content);
                        alert(' Job description fetched successfully!');
                    } else {
                        throw new Error('No content extracted from URL');
                    }
                } catch (error) {
                    console.error('Error fetching job description:', error);
                    alert(error.message || 'Failed to fetch job description. Please paste it manually.');
                } finally {
                    setIsFetchingUrl(false);
                }
            };

            const handleFileUpload = (event) => {
                const file = event.target.files?.[0];
                if (file) {
                    const allowedTypes = [
                        'application/pdf',
                        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                        'application/msword',
                        'text/plain'
                    ];
                    
                    if (!allowedTypes.includes(file.type)) {
                        setUploadError('Please select a valid file type (PDF, DOCX, DOC, or TXT)');
                        return;
                    }
                    
                    if (file.size > 10 * 1024 * 1024) {
                        setUploadError('File size must be less than 10MB');
                        return;
                    }
                    
                    setCvFile(file);
                    setUploadError('');
                    
                    // Read file content
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setCvContent(e.target.result);
                    };
                    reader.readAsText(file);
                    
                    setStep('input');
                }
            };

            const handleAnalysis = async () => {
                if (!jobDescription.trim()) return;
                
                setIsAnalyzing(true);
                setStep('generate');
                
                try {
                    // Get API key
                    const apiKey = localStorage.getItem('openai_api_key');
                    if (!apiKey) {
                        throw new Error('OpenAI API key not found. Please set it in Settings > Integrations.');
                    }

                    // Call OpenAI to analyze the resume and job description
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a career advisor who analyzes resumes and job postings to identify matches and gaps. Provide structured analysis data in JSON format.'
                                },
                                {
                                    role: 'user',
                                    content: `Analyze this resume and job description to prepare for generating a tailored cover letter.

RESUME/CV CONTENT:
${cvContent}

JOB DESCRIPTION:
${jobDescription}

COMPANY INFORMATION:
${companyUrl || 'Not provided'}

TASK:
Analyze and extract key information to help write a targeted cover letter.

Return your analysis in the following JSON format:
{
  "jobTitle": "Extracted job title from the job description",
  "keyRequirements": ["List", "of", "key", "requirements", "and", "skills", "from", "job", "description"],
  "matchingSkills": ["List", "of", "skills", "from", "resume", "that", "match", "the", "job"],
  "gaps": ["Skills", "or", "requirements", "from", "job", "that", "are", "missing", "in", "resume"],
  "companyInfo": "Company name and brief description if available"
}

Return only valid JSON, no additional text:`
                                }
                            ],
                            temperature: 0.3,
                            max_tokens: 1000
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Failed to analyze documents');
                    }

                    const data = await response.json();
                    const content = data.choices[0]?.message?.content;
                    
                    if (!content) {
                        throw new Error('No response from OpenAI');
                    }

                    // Extract JSON from response
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('Invalid response format');
                    }

                    const analysis = JSON.parse(jsonMatch[0]);
                    setAnalysisData(analysis);
                } catch (error) {
                    console.error('Error during analysis:', error);
                    alert(error.message || 'Failed to analyze documents. Using basic information.');
                    
                    // Fallback to basic mock data
                    setAnalysisData({
                        cvContent: cvContent,
                        jobDescription: jobDescription,
                        companyInfo: companyUrl || 'Company Information',
                        jobTitle: 'Position',
                        keyRequirements: [],
                        matchingSkills: [],
                        gaps: []
                    });
                } finally {
                    setIsAnalyzing(false);
                }
            };

            const handleGenerate = async () => {
                setIsGenerating(true);
                
                try {
                    // Get API key
                    const apiKey = localStorage.getItem('openai_api_key');
                    if (!apiKey) {
                        throw new Error('OpenAI API key not found. Please set it in Settings > Integrations.');
                    }

                    // Call OpenAI to generate cover letter
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are an expert cover letter writer. You create compelling, professional cover letters that are tailored to specific job postings. Your cover letters are concise, engaging, and highlight the most relevant qualifications.'
                                },
                                {
                                    role: 'user',
                                    content: `Write a professional cover letter based on this resume and job description.

RESUME/CV CONTENT:
${cvContent}

JOB DESCRIPTION:
${jobDescription}

COMPANY INFORMATION:
${companyUrl || 'Not provided'}

INSTRUCTIONS:
1. Write a compelling cover letter that:
   - Demonstrates understanding of the job requirements
   - Highlights relevant experience and skills from the resume
   - Shows enthusiasm for the position
   - Incorporates specific details from the job description
   - Is professional, concise (3-4 paragraphs), and engaging
   - Addresses the hiring manager professionally

2. Format:
   - Use proper business letter format
   - Start with "Dear Hiring Manager," (or specific name if company name is provided)
   - Include 3-4 body paragraphs
   - End with "Best regards," or "Sincerely," followed by [Your Name]

3. Make it specific to the job posting and company, not generic.

Return only the cover letter text, no additional explanation:`
                                }
                            ],
                            temperature: 0.7,
                            max_tokens: 800
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Failed to generate cover letter');
                    }

                    const data = await response.json();
                    const content = data.choices[0]?.message?.content;
                    
                    if (!content) {
                        throw new Error('No response from OpenAI');
                    }
                    
                    setGeneratedCoverLetter(content);
                    setEditedCoverLetter(content);
                    setStep('edit');
                } catch (error) {
                    console.error('Error generating cover letter:', error);
                    alert(error.message || 'Failed to generate cover letter. Please try again.');
                } finally {
                    setIsGenerating(false);
                }
            };

            const handleCopy = async () => {
                try {
                    await navigator.clipboard.writeText(editedCoverLetter);
                    alert('Cover letter copied to clipboard!');
                } catch (error) {
                    console.error('Failed to copy:', error);
                }
            };

            const handleDownload = () => {
                const element = document.createElement('a');
                const file = new Blob([editedCoverLetter], { type: 'text/plain' });
                element.href = URL.createObjectURL(file);
                element.download = 'cover-letter.txt';
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
            };

            const handleReset = () => {
                setStep('upload');
                setCvFile(null);
                setCvContent('');
                setCompanyUrl('');
                setJobDescription('');
                setAnalysisData(null);
                setGeneratedCoverLetter('');
                setEditedCoverLetter('');
                setUploadError('');
            };

            return (
                <div className="space-y-8">

                    {/* Progress Indicator */}
                    <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                        <div className="flex items-center justify-between mb-4">
                            <span className="text-sm font-semibold text-slate-800">Progress</span>
                            <span className="text-sm text-slate-600">
                                Step {step === 'upload' ? 1 : step === 'input' ? 2 : step === 'generate' ? 3 : 4} of 4
                            </span>
                        </div>
                        <div className="w-full bg-slate-200 rounded-full h-3">
                            <div 
                                className="bg-gradient-to-r from-emerald-500 to-teal-500 h-3 rounded-full transition-all duration-500 shadow-lg"
                                style={{ 
                                    width: step === 'upload' ? '25%' : 
                                           step === 'input' ? '50%' : 
                                           step === 'generate' ? '75%' : '100%' 
                                }}
                            ></div>
                        </div>
                    </div>

                    {/* Step 1: CV Upload */}
                    {step === 'upload' && (
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-8">
                                <h3 className="text-2xl font-bold text-slate-800 mb-6 text-center">Upload Your CV</h3>
                                
                                <div className="border-2 border-dashed border-slate-300 rounded-2xl p-12 text-center hover:border-emerald-500/50 transition-colors">
                                    <input
                                        type="file"
                                        accept=".pdf,.docx,.doc,.txt"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                        id="cv-upload"
                                    />
                                    
                                    <div className="flex flex-col items-center gap-6">
                                        <div className="w-20 h-20 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center shadow-lg">
                                            <div className="w-10 h-10 text-white text-2xl"></div>
                                        </div>
                                        
                                        <div>
                                            <h4 className="text-xl font-semibold text-slate-800 mb-3">
                                                {cvFile ? cvFile.name : 'Choose your CV file'}
                                            </h4>
                                            <p className="text-slate-600">
                                                {cvFile ? 
                                                    `${(cvFile.size / 1024 / 1024).toFixed(2)} MB  Ready to proceed` :
                                                    'PDF, DOCX, DOC, or TXT format (Max 10MB)'
                                                }
                                            </p>
                                        </div>
                                        
                                        <label
                                            htmlFor="cv-upload"
                                            className="bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-8 py-4 rounded-xl font-semibold cursor-pointer transition-all duration-300 hover:from-emerald-600 hover:to-teal-600 hover:transform hover:scale-105"
                                        >
                                            {cvFile ? 'Change File' : 'Select File'}
                                        </label>
                                    </div>
                                </div>

                                {uploadError && (
                                    <div className="mt-6 bg-red-50 border border-red-200 rounded-2xl p-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-5 h-5 text-red-600"></div>
                                            <p className="text-red-700 font-medium">{uploadError}</p>
                                        </div>
                                    </div>
                                )}

                                {cvFile && (
                                    <div className="mt-6 text-center">
                                        <button
                                            onClick={() => setStep('input')}
                                            className="bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-8 py-4 rounded-xl font-semibold transition-all duration-300 hover:from-emerald-600 hover:to-teal-600 hover:transform hover:scale-105"
                                        >
                                            Continue to Job Information
                                        </button>
                                    </div>
                                )}

                                <div className="mt-6 text-center">
                                    <p className="text-sm text-slate-600">Supported formats: PDF, DOCX, DOC, TXT</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Step 2: Job Information Input */}
                    {step === 'input' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 space-y-6">
                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-8">
                                    <h3 className="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-3">
                                        <div className="w-6 h-6 text-emerald-500"></div>
                                        Company Information
                                    </h3>
                                    
                                    <div>
                                        <label className="block text-sm font-semibold text-slate-800 mb-3">
                                            Company Website or Job Posting URL (Optional)
                                        </label>
                                        <div className="flex gap-2">
                                            <input
                                                type="url"
                                                value={companyUrl}
                                                onChange={(e) => setCompanyUrl(e.target.value)}
                                                placeholder="https://company.com or job posting URL"
                                                className="flex-1 px-4 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 placeholder-slate-500 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 focus:outline-none transition-all duration-300"
                                            />
                                            <button
                                                onClick={handleFetchJobDescription}
                                                disabled={!companyUrl.trim() || isFetchingUrl}
                                                className={`px-6 py-3 rounded-xl font-medium transition-all duration-300 whitespace-nowrap ${
                                                    companyUrl.trim() && !isFetchingUrl 
                                                        ? 'bg-emerald-600 text-white hover:bg-emerald-700' 
                                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                }`}
                                            >
                                                {isFetchingUrl ? ' Fetching...' : ' Fetch Job'}
                                            </button>
                                        </div>
                                        <p className="text-xs text-slate-600 mt-2">
                                            {isFetchingUrl ? 'Fetching job description from URL...' : 'Paste URL and click "Fetch Job" to automatically extract job description'}
                                        </p>
                                    </div>
                                </div>

                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-8">
                                    <h3 className="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-3">
                                        <div className="w-6 h-6 text-teal-500"></div>
                                        Job Description
                                    </h3>
                                    
                                    <div>
                                        <label className="block text-sm font-semibold text-slate-800 mb-3">
                                            Complete Job Posting
                                        </label>
                                        <textarea
                                            value={jobDescription}
                                            onChange={(e) => setJobDescription(e.target.value)}
                                            placeholder="Paste the complete job description here..."
                                            rows={12}
                                            className="w-full px-4 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 placeholder-slate-500 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 focus:outline-none resize-none transition-all duration-300"
                                        />
                                        <div className="flex items-center justify-between mt-3">
                                            <p className="text-xs text-slate-600">
                                                Include job title, requirements, responsibilities, and company information
                                            </p>
                                            <span className="text-xs text-slate-600">
                                                {jobDescription.length} characters
                                            </span>
                                        </div>
                                    </div>

                                    <button
                                        onClick={handleAnalysis}
                                        disabled={!jobDescription.trim() || isAnalyzing}
                                        className="w-full mt-6 bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-6 py-4 rounded-xl font-semibold transition-all duration-300 hover:from-emerald-600 hover:to-teal-600 hover:transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
                                    >
                                        {isAnalyzing ? (
                                            <>
                                                <div className="w-5 h-5 animate-spin"></div>
                                                Analyzing...
                                            </>
                                        ) : (
                                            <>
                                                <div className="w-5 h-5"></div>
                                                Analyze & Continue
                                            </>
                                        )}
                                    </button>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4">CV Summary</h3>
                                    <div className="space-y-4">
                                        <div className="flex items-center gap-3">
                                            <div className="w-5 h-5 text-green-600"></div>
                                            <span className="text-slate-800 text-sm">CV uploaded successfully</span>
                                        </div>
                                        <div className="text-sm text-slate-600">
                                            <strong className="text-slate-800">File:</strong> {cvFile?.name}
                                        </div>
                                        <div className="text-sm text-slate-600">
                                            <strong className="text-slate-800">Size:</strong> {cvFile ? (cvFile.size / 1024 / 1024).toFixed(2) : '0'} MB
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4">Tips for Best Results</h3>
                                    <div className="space-y-4 text-sm">
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-slate-600">Include the complete job posting for better analysis</p>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-slate-600">Company URL helps personalize the cover letter</p>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-slate-600">More details = better customization</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Step 3: Analysis & Generation */}
                    {step === 'generate' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 space-y-6">
                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-8">
                                    <h3 className="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-3">
                                        <div className="w-6 h-6 text-green-500"></div>
                                        Analysis Complete - Ready to Generate
                                    </h3>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="bg-white/70 rounded-xl p-4">
                                            <h4 className="text-green-600 text-sm font-semibold mb-2">Matching Skills</h4>
                                            <div className="flex flex-wrap gap-2">
                                                {analysisData?.matchingSkills?.map((skill, index) => (
                                                    <span key={index} className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                                                        {skill}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <div className="bg-white/70 rounded-xl p-4">
                                            <h4 className="text-blue-600 text-sm font-semibold mb-2">Areas to Address</h4>
                                            <div className="flex flex-wrap gap-2">
                                                {analysisData?.gaps?.map((gap, index) => (
                                                    <span key={index} className="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                                                        {gap}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {companyUrl && (
                                        <div className="mt-6 bg-white/70 rounded-xl p-4">
                                            <h4 className="text-purple-600 text-sm font-semibold mb-2">Company Insights</h4>
                                            <p className="text-slate-600 text-sm">
                                                Based on company research, we'll emphasize cultural fit and company values in your cover letter.
                                            </p>
                                        </div>
                                    )}

                                    <button
                                        onClick={handleGenerate}
                                        disabled={isGenerating}
                                        className="w-full mt-6 bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-6 py-4 rounded-xl font-semibold transition-all duration-300 hover:from-emerald-600 hover:to-teal-600 hover:transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
                                    >
                                        {isGenerating ? (
                                            <>
                                                <div className="w-5 h-5 animate-spin"></div>
                                                Generating Cover Letter...
                                            </>
                                        ) : (
                                            <>
                                                <div className="w-5 h-5"></div>
                                                Generate Cover Letter
                                            </>
                                        )}
                                    </button>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4">Job Analysis</h3>
                                    <div className="space-y-3 text-sm">
                                        <div>
                                            <span className="text-slate-600">Position:</span>
                                            <span className="text-slate-800 font-medium ml-2">{analysisData?.jobTitle}</span>
                                        </div>
                                        <div>
                                            <span className="text-slate-600">Company:</span>
                                            <span className="text-slate-800 font-medium ml-2">{analysisData?.companyInfo}</span>
                                        </div>
                                        <div>
                                            <span className="text-slate-600">Key Requirements:</span>
                                            <div className="mt-1 flex flex-wrap gap-1">
                                                {analysisData?.keyRequirements?.map((req, index) => (
                                                    <span key={index} className="bg-slate-100 text-slate-700 text-xs px-2 py-1 rounded">
                                                        {req}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4">What AI Will Include</h3>
                                    <div className="space-y-2 text-sm text-slate-600">
                                        <div className="flex items-start gap-2">
                                            <div className="w-1.5 h-1.5 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <span>Personalized opening based on company research</span>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-1.5 h-1.5 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <span>Skill alignment with job requirements</span>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-1.5 h-1.5 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <span>Professional closing with clear next steps</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Step 4: Edit Generated Cover Letter */}
                    {step === 'edit' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2">
                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-8">
                                    <div className="flex items-center justify-between mb-6">
                                        <h3 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                            <div className="w-6 h-6 text-emerald-500"></div>
                                            Edit Your Cover Letter
                                        </h3>
                                        <div className="flex gap-3">
                                            <button 
                                                onClick={() => setShowPreview(!showPreview)}
                                                className="bg-white/70 text-slate-800 px-4 py-2 rounded-xl font-medium flex items-center gap-2 hover:bg-white/90 transition-colors"
                                            >
                                                <div className="w-4 h-4">{showPreview ? '' : ''}</div>
                                                {showPreview ? 'Edit' : 'Preview'}
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {showPreview ? (
                                            <div className="bg-white rounded-xl p-6 min-h-96 border">
                                                <div className="whitespace-pre-wrap text-slate-800 leading-relaxed">
                                                    {editedCoverLetter}
                                                </div>
                                            </div>
                                        ) : (
                                            <textarea
                                                value={editedCoverLetter}
                                                onChange={(e) => setEditedCoverLetter(e.target.value)}
                                                className="w-full h-96 px-4 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 placeholder-slate-500 focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 focus:outline-none resize-none transition-all duration-300"
                                                placeholder="Your cover letter will appear here..."
                                            />
                                        )}
                                        
                                        <div className="flex flex-wrap gap-3">
                                            <button
                                                onClick={handleCopy}
                                                className="bg-blue-500 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hover:bg-blue-600 transition-colors"
                                            >
                                                <div className="w-4 h-4"></div>
                                                Copy to Clipboard
                                            </button>
                                            <button
                                                onClick={handleDownload}
                                                className="bg-green-500 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hover:bg-green-600 transition-colors"
                                            >
                                                <div className="w-4 h-4"></div>
                                                Download as TXT
                                            </button>
                                            <button className="bg-purple-500 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hover:bg-purple-600 transition-colors">
                                                <div className="w-4 h-4"></div>
                                                Download as PDF
                                            </button>
                                            <button className="bg-slate-500 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hover:bg-slate-600 transition-colors">
                                                <div className="w-4 h-4"></div>
                                                Save Draft
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4">Cover Letter Quality</h3>
                                    <div className="space-y-4">
                                        <div className="text-center">
                                            <div className="text-4xl font-bold text-green-600 mb-2">94%</div>
                                            <div className="text-sm text-slate-600">Overall Quality Score</div>
                                        </div>
                                        
                                        <div className="space-y-3 text-sm">
                                            <div className="flex justify-between">
                                                <span className="text-slate-800">Professional Tone</span>
                                                <span className="text-green-600 font-semibold">Excellent</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-slate-800">Skill Alignment</span>
                                                <span className="text-green-600 font-semibold">Very Good</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-slate-800">Personalization</span>
                                                <span className="text-green-600 font-semibold">Excellent</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-slate-800">Length</span>
                                                <span className="text-green-600 font-semibold">Perfect</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4">Customization Tips</h3>
                                    <div className="space-y-3 text-sm">
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-slate-600">Personalize the opening with specific company details</p>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-slate-600">Add specific examples from your experience</p>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-2 h-2 bg-emerald-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-slate-600">Adjust tone to match company culture</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <h3 className="text-lg font-bold text-slate-800 mb-4">Quick Actions</h3>
                                    <div className="space-y-2">
                                        <button
                                            onClick={() => setStep('input')}
                                            className="w-full text-left p-3 text-slate-600 hover:text-slate-800 hover:bg-white/70 rounded-xl transition-colors"
                                        >
                                            Edit job description
                                        </button>
                                        <button
                                            onClick={() => setStep('upload')}
                                            className="w-full text-left p-3 text-slate-600 hover:text-slate-800 hover:bg-white/70 rounded-xl transition-colors"
                                        >
                                            Use different CV
                                        </button>
                                        <button className="w-full text-left p-3 text-slate-600 hover:text-slate-800 hover:bg-white/70 rounded-xl transition-colors">
                                            Generate another version
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Cover Letter Generator when cover-letter-content is shown
        window.renderCoverLetterGenerator = function() {
            console.log('renderCoverLetterGenerator called');
            const container = document.getElementById('cover-letter-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Cover Letter Generator...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<CoverLetterGenerator />);
                    console.log('Cover Letter Generator rendered successfully');
                } catch (error) {
                    console.error('Error rendering Cover Letter Generator:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Cover Letter Generator</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('cover-letter-container not found');
            }
        };

        // ============================================================================
        // SHARED JOB TRACKING UTILITIES
        // ============================================================================
        
        // Shared utilities for Job Finder and Job Tracker integration
        const JobTrackingUtils = {
            // Get all tracked jobs from localStorage
            getAllTrackedJobs() {
                try {
                    const stored = localStorage.getItem('tracked_jobs');
                    return stored ? JSON.parse(stored) : [];
                } catch (e) {
                    console.error('Error loading tracked jobs:', e);
                    return [];
                }
            },

            // Save tracked jobs to localStorage
            saveTrackedJobs(jobs) {
                try {
                    localStorage.setItem('tracked_jobs', JSON.stringify(jobs));
                    localStorage.setItem('tracked_jobs_last_updated', Date.now().toString());
                    return true;
                } catch (e) {
                    console.error('Error saving tracked jobs:', e);
                    return false;
                }
            },

            // Add a job to tracker (with duplicate detection)
            addJobToTracker(job, source = 'job-finder', status = 'new-leads') {
                const trackedJobs = this.getAllTrackedJobs();
                
                // Check for duplicates by URL and title+company
                const isDuplicate = trackedJobs.some(tracked => {
                    const urlMatch = tracked.url && job.url && 
                        tracked.url.toLowerCase() === job.url.toLowerCase();
                    const titleCompanyMatch = tracked.title === job.title && 
                        tracked.company === job.company;
                    return urlMatch || titleCompanyMatch;
                });

                if (isDuplicate) {
                    return { success: false, message: 'This job is already being tracked', duplicate: true };
                }

                // Transform job to tracker format
                const trackerJob = {
                    id: Date.now() + Math.random(), // Unique ID
                    title: job.title || 'Untitled Position',
                    company: job.company || 'Unknown Company',
                    location: job.location || 'Not specified',
                    salary: job.salary || 'Competitive',
                    matchScore: job.matchScore || 0,
                    postedDate: job.postedDate || new Date().toISOString().split('T')[0],
                    source: job.source || source,
                    status: status,
                    notes: job.whyMatch ? `Why this matches: ${job.whyMatch}` : '',
                    applicationDate: '',
                    interviewDate: '',
                    contacts: '',
                    url: job.url || '#',
                    whyMatch: job.whyMatch || '',
                    description: job.description || job.snippet || '',
                    addedFrom: source,
                    addedAt: new Date().toISOString()
                };

                trackedJobs.push(trackerJob);
                this.saveTrackedJobs(trackedJobs);

                return { success: true, message: 'Job added to tracker!', job: trackerJob };
            },

            // Check if a job is already tracked
            isJobTracked(job) {
                const trackedJobs = this.getAllTrackedJobs();
                return trackedJobs.some(tracked => {
                    const urlMatch = tracked.url && job.url && 
                        tracked.url.toLowerCase() === job.url.toLowerCase();
                    const titleCompanyMatch = tracked.title === job.title && 
                        tracked.company === job.company;
                    return urlMatch || titleCompanyMatch;
                });
            },

            // Get tracked job by URL
            getTrackedJobByUrl(url) {
                const trackedJobs = this.getAllTrackedJobs();
                return trackedJobs.find(job => 
                    job.url && url && job.url.toLowerCase() === url.toLowerCase()
                );
            },

            // Get tracked job by title and company
            getTrackedJobByTitleAndCompany(title, company) {
                const trackedJobs = this.getAllTrackedJobs();
                return trackedJobs.find(job => 
                    job.title === title && job.company === company
                );
            },

            // Update job status
            updateJobStatus(jobId, newStatus) {
                const trackedJobs = this.getAllTrackedJobs();
                const updated = trackedJobs.map(job => {
                    if (job.id === jobId) {
                        const updated = { ...job, status: newStatus };
                        
                        // Auto-set dates based on status
                        if (newStatus === 'applied' && !updated.applicationDate) {
                            updated.applicationDate = new Date().toISOString().split('T')[0];
                        }
                        if (newStatus === 'interviewing' && !updated.interviewDate) {
                            // Don't auto-set, let user set it
                        }
                        
                        return updated;
                    }
                    return job;
                });
                this.saveTrackedJobs(updated);
                return updated.find(job => job.id === jobId);
            },

            // Bulk add jobs to tracker
            bulkAddJobs(jobs, source = 'job-finder', minMatchScore = 0) {
                const results = [];
                const filteredJobs = minMatchScore > 0 
                    ? jobs.filter(job => (job.matchScore || 0) >= minMatchScore)
                    : jobs;

                filteredJobs.forEach(job => {
                    const result = this.addJobToTracker(job, source, 'new-leads');
                    results.push(result);
                });

                const successCount = results.filter(r => r.success).length;
                return {
                    total: filteredJobs.length,
                    added: successCount,
                    duplicates: results.filter(r => r.duplicate).length,
                    results
                };
            },

            // Get analytics
            getAnalytics() {
                const jobs = this.getAllTrackedJobs();
                const now = new Date();
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);

                const stats = {
                    total: jobs.length,
                    byStatus: {},
                    bySource: {},
                    averageMatchScore: 0,
                    recentActivity: jobs.filter(job => {
                        const addedDate = new Date(job.addedAt || job.postedDate);
                        return addedDate >= weekAgo;
                    }).length,
                    totalApplied: 0,
                    totalInterviews: 0,
                    totalOffers: 0
                };

                let totalMatchScore = 0;
                jobs.forEach(job => {
                    // Count by status
                    stats.byStatus[job.status] = (stats.byStatus[job.status] || 0) + 1;
                    
                    // Count by source
                    stats.bySource[job.source] = (stats.bySource[job.source] || 0) + 1;
                    
                    // Sum match scores
                    if (job.matchScore) {
                        totalMatchScore += job.matchScore;
                    }
                    
                    // Count applications
                    if (job.status === 'applied' || job.status === 'interviewing' || 
                        job.status === 'offer' || job.applicationDate) {
                        stats.totalApplied++;
                    }
                    
                    // Count interviews
                    if (job.status === 'interviewing' || job.status === 'offer' || job.interviewDate) {
                        stats.totalInterviews++;
                    }
                    
                    // Count offers
                    if (job.status === 'offer') {
                        stats.totalOffers++;
                    }
                });

                stats.averageMatchScore = jobs.length > 0 
                    ? Math.round(totalMatchScore / jobs.length) 
                    : 0;

                return stats;
            },

            // Show notification
            showNotification(message, type = 'success', duration = 3000) {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-[10000] px-6 py-4 rounded-xl shadow-2xl ${
                    type === 'success' ? 'bg-green-500 text-white' :
                    type === 'error' ? 'bg-red-500 text-white' :
                    type === 'info' ? 'bg-blue-500 text-white' :
                    'bg-yellow-500 text-white'
                }`;
                notification.style.animation = 'slideInRight 0.3s ease-out';
                notification.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-xl">${type === 'success' ? '' : type === 'error' ? '' : ''}</span>
                        <span class="font-medium">${message}</span>
                    </div>
                `;

                // Add animation style if not exists
                if (!document.getElementById('notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideInRight {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOutRight {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }

                document.body.appendChild(notification);

                // Remove after duration
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.3s ease-out';
                    setTimeout(() => notification.remove(), 300);
                }, duration);

                return notification;
            },

            // Enhanced notification with action buttons
            showNotificationWithAction(message, type = 'info', actions = [], duration = 5000) {
                const notification = document.createElement('div');
                const notificationId = `notification-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                notification.id = notificationId;
                notification.className = `fixed top-4 right-4 z-[10000] px-6 py-4 rounded-xl shadow-2xl ${
                    type === 'success' ? 'bg-green-500' :
                    type === 'error' ? 'bg-red-500' :
                    type === 'info' ? 'bg-blue-500' :
                    'bg-yellow-500'
                } text-white min-w-[400px]`;
                notification.style.animation = 'slideInRight 0.3s ease-out';
                
                notification.innerHTML = `
                    <div class="flex flex-col gap-3">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">${type === 'success' ? '' : type === 'error' ? '' : ''}</span>
                            <span class="font-medium flex-1">${message}</span>
                        </div>
                        ${actions.length > 0 ? `
                            <div class="flex gap-2 mt-2">
                                ${actions.map((action, index) => `
                                    <button 
                                        id="notification-action-${notificationId}-${index}"
                                        class="${action.className || 'px-4 py-2 rounded-lg bg-white/20 hover:bg-white/30 text-white transition-colors'} transition-colors font-medium"
                                    >
                                        ${action.text}
                                    </button>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Attach event listeners to action buttons
                actions.forEach((action, index) => {
                    const button = notification.querySelector(`#notification-action-${notificationId}-${index}`);
                    if (button) {
                        button.addEventListener('click', () => {
                            action.action();
                            notification.style.animation = 'slideOutRight 0.3s ease-out';
                            setTimeout(() => notification.remove(), 300);
                        });
                    }
                });
                
                // Auto-remove after duration
                setTimeout(() => {
                    if (document.getElementById(notificationId)) {
                        notification.style.animation = 'slideOutRight 0.3s ease-out';
                        setTimeout(() => notification.remove(), 300);
                    }
                }, duration);
                
                return notification;
            }
        };

        // Make utils available globally
        window.JobTrackingUtils = JobTrackingUtils;

        // ============================================================================
        // END SHARED UTILITIES
        // ============================================================================

        // Job Finder React Component
        const JobFinder = () => {
            const [activeTab, setActiveTab] = useState('search');
            const [quickSearchJobTitle, setQuickSearchJobTitle] = useState('');
            const [quickSearchLocation, setQuickSearchLocation] = useState('');
            const [isSearching, setIsSearching] = useState(false);
            const [jobResults, setJobResults] = useState([]);
            const [selectedJob, setSelectedJob] = useState(null);
            const [showJobModal, setShowJobModal] = useState(false);
            const [companyDetails, setCompanyDetails] = useState(null);
            const [companyReviews, setCompanyReviews] = useState([]);
            const [companyInterviews, setCompanyInterviews] = useState([]);
            const [isLoadingCompanyData, setIsLoadingCompanyData] = useState(false);
            const [resumeData, setResumeData] = useState(null);
            const [userAlerts, setUserAlerts] = useState([]);
            const [locationSuggestions, setLocationSuggestions] = useState([]);
            const [showLocationSuggestions, setShowLocationSuggestions] = useState(false);
            const [resumeLocationSuggestions, setResumeLocationSuggestions] = useState([]);
            const [showResumeLocationSuggestions, setShowResumeLocationSuggestions] = useState(false);
            const [jobTitleSuggestions, setJobTitleSuggestions] = useState([]);
            const [showJobTitleSuggestions, setShowJobTitleSuggestions] = useState(false);
            
            // IP-based location detection
            const [ipDetectedLocation, setIpDetectedLocation] = useState(null);
            const [isDetectingLocation, setIsDetectingLocation] = useState(false);
            
            // Filter states
            const [filters, setFilters] = useState({
                datePosted: 'Any time',
                experienceLevel: 'Any level',
                remote: 'Any',
                salaryRange: 'Any'
            });
            const [showFilterDropdown, setShowFilterDropdown] = useState({
                datePosted: false,
                experienceLevel: false,
                remote: false,
                salaryRange: false
            });
            const [currentPage, setCurrentPage] = useState(1);
            const [searchHistory, setSearchHistory] = useState([]);
            
            // Resume management states
            const [uploadedResumes, setUploadedResumes] = useState({});
            const [activeResume, setActiveResume] = useState(null);
            const [isUploadingResume, setIsUploadingResume] = useState(false);
            const [aiRecommendations, setAiRecommendations] = useState([]);
            const [isLoadingRecommendations, setIsLoadingRecommendations] = useState(false);
            
            // Resume-based search filter states
            const [resumeFilters, setResumeFilters] = useState({
                workType: 'Full-time',
                remote: 'Any',
                experienceLevel: 'Any level',
                minSalary: 'Any',
                location: '',
                skillsFilter: []
            });
            const [personalizedJobResults, setPersonalizedJobResults] = useState([]);
            const [isSearchingPersonalized, setIsSearchingPersonalized] = useState(false);
            const [selectedSearchStrategy, setSelectedSearchStrategy] = useState(null);
            const [isGeneratingQuery, setIsGeneratingQuery] = useState(false);
            const [aiReasoning, setAiReasoning] = useState(null);
            
            // Tracking integration state
            const [trackedJobIds, setTrackedJobIds] = useState(new Set());
            const [refreshTracking, setRefreshTracking] = useState(0);
            
            // Common locations database - Expanded with global cities
            const locationDatabase = [
                // Remote options
                'Remote',
                'Remote, Worldwide',
                
                // Indian Cities
                'Hyderabad, Telangana, India',
                'Mumbai, Maharashtra, India',
                'Delhi, India',
                'Bangalore, Karnataka, India',
                'Chennai, Tamil Nadu, India',
                'Kolkata, West Bengal, India',
                'Pune, Maharashtra, India',
                'Ahmedabad, Gujarat, India',
                'Jaipur, Rajasthan, India',
                'Lucknow, Uttar Pradesh, India',
                'Kanpur, Uttar Pradesh, India',
                'Nagpur, Maharashtra, India',
                'Visakhapatnam, Andhra Pradesh, India',
                'Bhopal, Madhya Pradesh, India',
                'Chandigarh, India',
                'Coimbatore, Tamil Nadu, India',
                'Patna, Bihar, India',
                'Kochi, Kerala, India',
                'Indore, Madhya Pradesh, India',
                'Guwahati, Assam, India',
                
                // United States
                'New York, NY, United States',
                'Los Angeles, CA, United States',
                'San Francisco, CA, United States',
                'Chicago, IL, United States',
                'Boston, MA, United States',
                'Seattle, WA, United States',
                'Austin, TX, United States',
                'Denver, CO, United States',
                'Philadelphia, PA, United States',
                'San Diego, CA, United States',
                'Portland, OR, United States',
                'Atlanta, GA, United States',
                'Miami, FL, United States',
                'Washington, DC, United States',
                
                // United Kingdom
                'London, England, United Kingdom',
                'Manchester, England, United Kingdom',
                'Birmingham, England, United Kingdom',
                'Leeds, England, United Kingdom',
                'Glasgow, Scotland, United Kingdom',
                'Edinburgh, Scotland, United Kingdom',
                'Liverpool, England, United Kingdom',
                'Bristol, England, United Kingdom',
                'Brighton, England, United Kingdom',
                'Cambridge, England, United Kingdom',
                'Oxford, England, United Kingdom',
                'Belfast, Northern Ireland, United Kingdom',
                
                // Europe
                'Berlin, Germany',
                'Munich, Germany',
                'Hamburg, Germany',
                'Frankfurt, Germany',
                'Paris, France',
                'Lyon, France',
                'Marseille, France',
                'Amsterdam, Netherlands',
                'Rotterdam, Netherlands',
                'Barcelona, Spain',
                'Madrid, Spain',
                'Valencia, Spain',
                'Rome, Italy',
                'Milan, Italy',
                'Zurich, Switzerland',
                'Geneva, Switzerland',
                'Vienna, Austria',
                'Prague, Czech Republic',
                'Stockholm, Sweden',
                'Oslo, Norway',
                'Copenhagen, Denmark',
                'Helsinki, Finland',
                'Dublin, Ireland',
                'Brussels, Belgium',
                'Warsaw, Poland',
                'Budapest, Hungary',
                'Lisbon, Portugal',
                'Athens, Greece',
                
                // Asia Pacific
                'Singapore',
                'Hong Kong',
                'Tokyo, Japan',
                'Seoul, South Korea',
                'Shanghai, China',
                'Beijing, China',
                'Shenzhen, China',
                'Dubai, United Arab Emirates',
                'Abu Dhabi, United Arab Emirates',
                'Riyadh, Saudi Arabia',
                'Jakarta, Indonesia',
                'Manila, Philippines',
                'Bangkok, Thailand',
                'Kuala Lumpur, Malaysia',
                'Ho Chi Minh City, Vietnam',
                'Hanoi, Vietnam',
                
                // Australia & New Zealand
                'Sydney, NSW, Australia',
                'Melbourne, VIC, Australia',
                'Brisbane, QLD, Australia',
                'Perth, WA, Australia',
                'Adelaide, SA, Australia',
                'Auckland, New Zealand',
                'Wellington, New Zealand',
                
                // Canada
                'Toronto, Ontario, Canada',
                'Vancouver, BC, Canada',
                'Montreal, Quebec, Canada',
                'Calgary, Alberta, Canada',
                'Ottawa, Ontario, Canada',
                
                // Latin America
                'So Paulo, Brazil',
                'Rio de Janeiro, Brazil',
                'Mexico City, Mexico',
                'Buenos Aires, Argentina',
                'Santiago, Chile',
                'Bogot, Colombia',
                'Lima, Peru',
                
                // Africa
                'Cape Town, South Africa',
                'Johannesburg, South Africa',
                'Lagos, Nigeria',
                'Nairobi, Kenya',
                'Cairo, Egypt',
                
                // Middle East
                'Tel Aviv, Israel',
                'Jerusalem, Israel',
                'Istanbul, Turkey',
                'Ankara, Turkey',
                
                // Malta
                'Malta',
                'Valletta, Malta',
                
                // Additional US cities
                'Portland, ME, United States',
                'Baltimore, MD, United States',
                'Nashville, TN, United States',
                'Charlotte, NC, United States',
                'Jacksonville, FL, United States'
            ];
            
            // Common job titles database
            const jobTitlesDatabase = [
                'Software Engineer', 'Senior Software Engineer', 'Full Stack Developer',
                'Frontend Developer', 'Backend Developer', 'DevOps Engineer',
                'Data Scientist', 'Data Analyst', 'Business Analyst',
                'Product Manager', 'Senior Product Manager', 'Technical Product Manager',
                'Project Manager', 'Program Manager', 'Scrum Master',
                'UX Designer', 'UI Designer', 'Product Designer',
                'Marketing Manager', 'Digital Marketing Manager', 'Content Marketing Manager',
                'Sales Manager', 'Business Development Manager', 'Account Manager',
                'Customer Success Manager', 'Customer Support Manager',
                'HR Manager', 'Talent Acquisition Manager', 'HR Business Partner',
                'Operations Manager', 'Business Operations Manager',
                'Financial Analyst', 'Investment Analyst', 'Business Intelligence Analyst',
                'QA Engineer', 'Test Engineer', 'Automation Engineer',
                'Security Engineer', 'Cloud Engineer', 'Site Reliability Engineer',
                'Machine Learning Engineer', 'AI Engineer', 'ML Engineer',
                'Systems Engineer', 'Network Engineer', 'Database Administrator',
                'IT Manager', 'IT Director', 'CTO', 'Technical Director',
                'Solutions Architect', 'Enterprise Architect',
                'Business Consultant', 'Management Consultant',
                'Copywriter', 'Content Writer', 'Technical Writer',
                'Social Media Manager', 'Community Manager',
                'Graphic Designer', 'Web Designer', 'Motion Graphics Designer',
                'Video Editor', 'Content Creator', 'Influencer Marketing Manager'
            ];
            
            // Handle job title input change
            const handleJobTitleChange = (value) => {
                setQuickSearchJobTitle(value);
                
                if (value.trim().length > 0) {
                    // Filter job titles based on input
                    const filtered = jobTitlesDatabase.filter(title =>
                        title.toLowerCase().includes(value.toLowerCase())
                    ).slice(0, 10); // Show max 10 suggestions
                    
                    setJobTitleSuggestions(filtered);
                    setShowJobTitleSuggestions(true);
                } else {
                    setJobTitleSuggestions([]);
                    setShowJobTitleSuggestions(false);
                }
            };
            
            // Handle job title suggestion selection
            const handleSelectJobTitle = (title) => {
                setQuickSearchJobTitle(title);
                setShowJobTitleSuggestions(false);
                setJobTitleSuggestions([]);
            };
            
            // Handle location input change
            const handleLocationChange = (value) => {
                setQuickSearchLocation(value);
                
                if (value.trim().length > 0) {
                    // Filter locations based on input
                    const filtered = locationDatabase.filter(loc =>
                        loc.toLowerCase().includes(value.toLowerCase())
                    ).slice(0, 10); // Show max 10 suggestions
                    
                    setLocationSuggestions(filtered);
                    setShowLocationSuggestions(true);
                } else {
                    setLocationSuggestions([]);
                    setShowLocationSuggestions(false);
                }
            };
            
            // Handle location suggestion selection
            const handleSelectLocation = (location) => {
                setQuickSearchLocation(location);
                setShowLocationSuggestions(false);
                setLocationSuggestions([]);
            };
            
            // Handle location input change for resume filter
            const handleResumeLocationChange = (value) => {
                setResumeFilters(prev => ({...prev, location: value}));
                
                if (value.trim().length > 0) {
                    // Filter locations based on input
                    const filtered = locationDatabase.filter(loc =>
                        loc.toLowerCase().includes(value.toLowerCase())
                    ).slice(0, 10); // Show max 10 suggestions
                    
                    setResumeLocationSuggestions(filtered);
                    setShowResumeLocationSuggestions(true);
                } else {
                    setResumeLocationSuggestions([]);
                    setShowResumeLocationSuggestions(false);
                }
            };
            
            // Handle location suggestion selection for resume filter
            const handleSelectResumeLocation = (location) => {
                setResumeFilters(prev => ({...prev, location: location}));
                setShowResumeLocationSuggestions(false);
                setResumeLocationSuggestions([]);
            };
            
            // Detect user location from IP address
            const detectUserLocationFromIP = async () => {
                setIsDetectingLocation(true);
                try {
                    // Try ipapi.co first (HTTPS support, free tier)
                    try {
                        const response = await fetch('https://ipapi.co/json/');
                        const data = await response.json();
                        
                        if (data.city && data.region && data.country_name) {
                            const location = `${data.city}, ${data.region}, ${data.country_name}`;
                            setIpDetectedLocation(location);
                            localStorage.setItem('ip_detected_location', location);
                            localStorage.setItem('ip_location_timestamp', Date.now().toString());
                            console.log('IP Location detected (ipapi.co):', location);
                            setIsDetectingLocation(false);
                            return location;
                        }
                    } catch (apiCoError) {
                        console.log('ipapi.co failed, trying ip-api.com...', apiCoError);
                    }
                    
                    // Fallback to ip-api.com (HTTP, no API key needed for basic usage)
                    // Note: This might cause mixed content warnings in HTTPS, but will work
                    const response = await fetch('http://ip-api.com/json/');
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        // Format: "City, State, Country"
                        let location = '';
                        if (data.city && data.regionName && data.country) {
                            location = `${data.city}, ${data.regionName}, ${data.country}`;
                        } else if (data.city && data.country) {
                            location = `${data.city}, ${data.country}`;
                        } else if (data.country) {
                            location = data.country;
                        }
                        
                        if (location) {
                            setIpDetectedLocation(location);
                            localStorage.setItem('ip_detected_location', location);
                            localStorage.setItem('ip_location_timestamp', Date.now().toString());
                            console.log('IP Location detected (ip-api.com):', location);
                            setIsDetectingLocation(false);
                            return location;
                        }
                    }
                } catch (error) {
                    console.error('Error detecting location from IP:', error);
                    // Try to load from localStorage if available
                    const saved = localStorage.getItem('ip_detected_location');
                    if (saved) {
                        setIpDetectedLocation(saved);
                        setIsDetectingLocation(false);
                        return saved;
                    }
                }
                setIsDetectingLocation(false);
                return null;
            };
            
            // Normalize location for better search results
            const normalizeLocationForSearch = (location) => {
                if (!location) return '';
                
                const loc = location.trim();
                if (!loc) return '';
                
                // Common Indian city mappings with variants
                const cityMappings = {
                    'bangalore': {
                        variants: ['bangalore', 'bengaluru', 'ejipura', 'kormangla', 'koramangala', 'bangalore-47', 'bangalore 47'],
                        standard: 'Bangalore, Karnataka, India'
                    },
                    'mumbai': {
                        variants: ['mumbai', 'bombay'],
                        standard: 'Mumbai, Maharashtra, India'
                    },
                    'delhi': {
                        variants: ['delhi', 'new delhi', 'noida', 'gurgaon', 'gurugram'],
                        standard: 'Delhi, India'
                    },
                    'chennai': {
                        variants: ['chennai', 'madras'],
                        standard: 'Chennai, Tamil Nadu, India'
                    },
                    'hyderabad': {
                        variants: ['hyderabad'],
                        standard: 'Hyderabad, Telangana, India'
                    },
                    'pune': {
                        variants: ['pune', 'puna'],
                        standard: 'Pune, Maharashtra, India'
                    },
                    'kolkata': {
                        variants: ['kolkata', 'calcutta'],
                        standard: 'Kolkata, West Bengal, India'
                    },
                    'ahmedabad': {
                        variants: ['ahmedabad'],
                        standard: 'Ahmedabad, Gujarat, India'
                    },
                    'visakhapatnam': {
                        variants: ['visakhapatnam', 'vizag', 'visakha'],
                        standard: 'Visakhapatnam, Andhra Pradesh, India'
                    },
                    'jaipur': {
                        variants: ['jaipur'],
                        standard: 'Jaipur, Rajasthan, India'
                    },
                    'surat': {
                        variants: ['surat'],
                        standard: 'Surat, Gujarat, India'
                    },
                    'lucknow': {
                        variants: ['lucknow'],
                        standard: 'Lucknow, Uttar Pradesh, India'
                    },
                    'kanpur': {
                        variants: ['kanpur'],
                        standard: 'Kanpur, Uttar Pradesh, India'
                    },
                    'nagpur': {
                        variants: ['nagpur'],
                        standard: 'Nagpur, Maharashtra, India'
                    },
                    'indore': {
                        variants: ['indore'],
                        standard: 'Indore, Madhya Pradesh, India'
                    },
                    'thane': {
                        variants: ['thane'],
                        standard: 'Thane, Maharashtra, India'
                    },
                    'bhopal': {
                        variants: ['bhopal'],
                        standard: 'Bhopal, Madhya Pradesh, India'
                    }
                };
                
                // Check if location contains any city name
                const locLower = loc.toLowerCase();
                
                for (const [city, mapping] of Object.entries(cityMappings)) {
                    for (const variant of mapping.variants) {
                        if (locLower.includes(variant)) {
                            return mapping.standard;
                        }
                    }
                }
                
                // If no match found, try to extract the main city from comma-separated address
                const parts = loc.split(',').map(p => p.trim().replace(/-\d+$/, '').trim()); // Remove pincode suffixes like "-47"
                
                if (parts.length > 0) {
                    // Check if any part matches a known city
                    for (const part of parts) {
                        const partLower = part.toLowerCase();
                        for (const [city, mapping] of Object.entries(cityMappings)) {
                            for (const variant of mapping.variants) {
                                if (partLower === variant || partLower.includes(variant) || variant.includes(partLower)) {
                                    return mapping.standard;
                                }
                            }
                        }
                    }
                    
                    // If no city match, try to use the last non-numeric part as city
                    const lastPart = parts[parts.length - 1];
                    const secondLastPart = parts.length > 1 ? parts[parts.length - 2] : null;
                    
                    // Use second-last if last is a country/state, otherwise use last
                    if (secondLastPart && !['india', 'usa', 'uk', 'canada', 'australia'].includes(lastPart.toLowerCase())) {
                        return secondLastPart + ', India';
                    } else if (lastPart && !/^\d+$/.test(lastPart) && lastPart.length > 2) {
                        return lastPart + ', India';
                    }
                }
                
                // Fallback: return original location if it looks reasonable
                return loc;
            };
            
            // Get final location for search with priority logic
            const getFinalLocationForSearch = (context = 'personalized') => {
                let location = '';
                
                // Priority 1: User explicitly set location filter (for personalized search)
                if (context === 'personalized' && resumeFilters.location && resumeFilters.location.trim()) {
                    location = resumeFilters.location.trim();
                }
                // Priority 2: Quick Search location (if used in quick search context)
                else if (context === 'quick' && quickSearchLocation && quickSearchLocation.trim()) {
                    location = quickSearchLocation.trim();
                }
                // Priority 3: Resume location
                else if (activeResume && uploadedResumes[activeResume]) {
                    const resumeLoc = uploadedResumes[activeResume].personalInfo?.location;
                    if (resumeLoc && resumeLoc.trim()) {
                        location = resumeLoc.trim();
                    }
                }
                // Priority 4: IP-detected location
                else if (ipDetectedLocation) {
                    location = ipDetectedLocation;
                }
                
                // Normalize the location for better search results
                if (location) {
                    const normalized = normalizeLocationForSearch(location);
                    console.log(`Location normalization: "${location}" -> "${normalized}"`);
                    return normalized;
                }
                
                // Priority 5: No location
                return '';
            };
            
            // Helper function for strategy labels
            const getStrategyLabel = (strategyId) => {
                const labels = {
                    'background': 'Your Background',
                    'career_progression': 'Career Progression',
                    'skill_based': 'Skills',
                    'passion_based': 'Your Interests',
                    'industry_switch': 'Industry Switch'
                };
                return labels[strategyId] || 'Strategy';
            };
            
            // Generate search query using OpenAI based on strategy type
            const generateSearchQueryFromStrategy = async (strategyType, resumeData) => {
                const apiKey = localStorage.getItem('openai_api_key');
                if (!apiKey) {
                    throw new Error('OpenAI API key required for strategy-based search. Please set it in Settings.');
                }

                // Prepare resume data for prompt - extract key fields only to avoid large payload
                const resumeSummary = {
                    currentRole: resumeData.experience?.[0]?.position || '',
                    recentJobs: (resumeData.experience || []).slice(0, 2).map(exp => ({
                        position: exp.position || '',
                        company: exp.company || '',
                        duration: exp.duration || ''
                    })),
                    skills: resumeData.skills?.technical || [],
                    industries: resumeData.experience?.map(exp => exp.company).filter(Boolean).slice(0, 3) || [],
                    projects: (resumeData.projects || []).slice(0, 3).map(p => p.name || p.description || '').filter(Boolean),
                    interests: resumeData.skills?.soft || [],
                    education: (resumeData.education || []).slice(0, 2).map(e => e.degree || e.institution || '').filter(Boolean),
                    summary: (resumeData.summary || '').substring(0, 300) // Limit summary length
                };

                const strategyPrompts = {
                    'background': `Using this CV summary, generate:
1. A concise job search query string that finds roles similar to the user's current job title and industry. Include related titles that fit the same skill and experience level.
2. A brief explanation (2-3 sentences) describing how you determined these job matches based on the CV, citing specific evidence like their current role, skills, or experience.

Format your response as JSON with two fields: "query" and "reasoning".

Example response format:
{
  "query": "Software Engineer OR Backend Developer jobs",
  "reasoning": "Based on your CV, you're currently working as a Software Engineer with experience in Python and AWS. We've identified similar roles like Backend Developer that match your technical skills and experience level in software development."
}

CV Summary: ${JSON.stringify(resumeSummary)}`,
                    
                    'career_progression': `Based on this CV summary, predict the user's next logical job titles representing career growth. Use known job hierarchy patterns. Generate:
1. A concise job search query for those next-level roles.
2. A brief explanation (2-3 sentences) describing the career progression logic, citing their current role and explaining why the suggested roles are the next step.

Format your response as JSON with two fields: "query" and "reasoning".

Example response format:
{
  "query": "Senior Software Engineer OR Tech Lead jobs",
  "reasoning": "Your CV shows you're currently working as a Software Engineer with 3 years of experience. Based on typical career progression patterns, the next logical step is a Senior Software Engineer or Tech Lead role, which builds on your current responsibilities and technical expertise."
}

CV Summary: ${JSON.stringify(resumeSummary)}`,
                    
                    'skill_based': `Ignore the user's job title. Use only the skills from this CV summary to generate:
1. A job search query for roles that commonly require these skills.
2. A brief explanation (2-3 sentences) describing which skills from their CV led to these job recommendations.

Format your response as JSON with two fields: "query" and "reasoning".

Example response format:
{
  "query": "Python Developer OR Data Analyst jobs",
  "reasoning": "Your CV highlights strong skills in Python, Data Analysis, and Machine Learning. These technical competencies are directly transferable to roles like Python Developer and Data Analyst, regardless of your current job title."
}

CV Summary: ${JSON.stringify(resumeSummary)}`,
                    
                    'passion_based': `Based on the user's hobbies, projects, and interests from this CV summary, infer potential passion-aligned roles and generate:
1. A job search query for those roles.
2. A brief explanation (2-3 sentences) describing how their interests and projects align with these job opportunities.

Format your response as JSON with two fields: "query" and "reasoning".

Example response format:
{
  "query": "AI Engineer OR Automation Developer jobs",
  "reasoning": "Your CV mentions projects like 'Built AI chatbot' and interests in 'AI tools and automation'. This passion for artificial intelligence and automation aligns well with roles like AI Engineer or Automation Developer, where you can work on projects you're genuinely excited about."
}

CV Summary: ${JSON.stringify(resumeSummary)}`,
                    
                    'industry_switch': `Based on the user's skills and experience from this CV summary, identify transferable industries they could work in. Generate:
1. Job search queries for those industries using their technical background.
2. A brief explanation (2-3 sentences) describing which skills are transferable and which industries would benefit from their background.

Format your response as JSON with two fields: "query" and "reasoning".

Example response format:
{
  "query": "Data Analyst jobs in Healthcare OR Finance",
  "reasoning": "While your background is in Mechanical Engineering, your CV shows strong skills in Data Analysis and Python. These technical skills are highly transferable to industries like Healthcare and Finance, where data-driven insights are crucial for decision-making."
}

CV Summary: ${JSON.stringify(resumeSummary)}`
                };

                try {
                    console.log('Generating query for strategy:', strategyType);
                    
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a career matching assistant. Generate a JSON object with "query" (job search query string) and "reasoning" (brief explanation with evidence from CV) fields. Return ONLY valid JSON, no markdown, no additional text.'
                                },
                                {
                                    role: 'user',
                                    content: strategyPrompts[strategyType]
                                }
                            ],
                            temperature: 0.7,
                            max_tokens: 400
                        })
                    });

                    console.log('OpenAI API response status:', response.status);

                    if (!response.ok) {
                        let errorMessage = 'Failed to generate search query';
                        try {
                            const errorData = await response.json();
                            errorMessage = errorData.error?.message || errorMessage;
                            console.error('OpenAI API error details:', errorData);
                        } catch (e) {
                            const errorText = await response.text();
                            console.error('OpenAI API error (non-JSON):', errorText);
                            errorMessage = `API Error: ${response.status} ${response.statusText}`;
                        }
                        throw new Error(errorMessage);
                    }

                    const data = await response.json();
                    console.log('OpenAI API response data:', data);
                    
                    if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                        console.error('Invalid response structure:', data);
                        throw new Error('Invalid response format from OpenAI');
                    }

                    let responseText = data.choices[0].message.content.trim();
                    
                    if (!responseText) {
                        console.error('Empty response');
                        throw new Error('Empty response from OpenAI');
                    }
                    
                    // Clean up response - remove markdown code blocks if present
                    responseText = responseText.replace(/^```json\n?/g, '');
                    responseText = responseText.replace(/^```\n?/g, '');
                    responseText = responseText.replace(/```$/g, '');
                    responseText = responseText.trim();
                    
                    // Parse JSON response
                    let parsedResponse;
                    try {
                        parsedResponse = JSON.parse(responseText);
                    } catch (parseError) {
                        console.error('Failed to parse JSON response:', responseText);
                        throw new Error('Invalid JSON response from OpenAI');
                    }
                    
                    const query = parsedResponse.query?.trim() || '';
                    const reasoning = parsedResponse.reasoning?.trim() || '';
                    
                    if (!query) {
                        throw new Error('Generated query is empty');
                    }
                    
                    console.log('Successfully generated search query:', query);
                    console.log('AI Reasoning:', reasoning);
                    
                    return { query, reasoning };
                } catch (error) {
                    console.error('Error in generateSearchQueryFromStrategy:', error);
                    console.error('Strategy type:', strategyType);
                    console.error('Resume summary:', resumeSummary);
                    throw error;
                }
            };
            
            // Handle filter toggle
            const handleToggleFilter = (filterType) => {
                setShowFilterDropdown(prev => ({
                    ...prev,
                    [filterType]: !prev[filterType]
                }));
            };
            
            // Handle filter selection
            const handleSelectFilter = (filterType, value) => {
                setFilters(prev => ({
                    ...prev,
                    [filterType]: value
                }));
                setShowFilterDropdown(prev => ({
                    ...prev,
                    [filterType]: false
                }));
            };
            
            // Resume management functions
            const handleResumeUpload = async (event) => {
                const file = event.target.files?.[0];
                if (!file) return;
                
                if (!file.type.includes('pdf') && !file.type.includes('text') && !file.name.endsWith('.docx')) {
                    alert('Please upload a PDF, DOCX, or TXT file');
                    return;
                }
                
                setIsUploadingResume(true);
                
                try {
                    // Read file as text
                    const reader = new FileReader();
                    const fileContent = await new Promise((resolve, reject) => {
                        reader.onload = (e) => resolve(e.target.result);
                        reader.onerror = reject;
                        reader.readAsText(file);
                    });
                    
                    // Parse resume - try OpenAI first, fall back to simple parser
                    let parsedData;
                    const apiKey = localStorage.getItem('openai_api_key');
                    
                    if (apiKey) {
                        try {
                            parsedData = await parseResumeWithOpenAI(fileContent);
                        } catch (aiError) {
                            console.error('OpenAI parsing failed, using simple parser:', aiError);
                            parsedData = parseResumeText(fileContent);
                        }
                    } else {
                        parsedData = parseResumeText(fileContent);
                    }
                    
                    // Save to localStorage
                    const savedResumes = JSON.parse(localStorage.getItem('parsed_resumes') || '{}');
                    savedResumes[file.name] = parsedData;
                    localStorage.setItem('parsed_resumes', JSON.stringify(savedResumes));
                    
                    // Update state
                    setUploadedResumes(savedResumes);
                    
                    // Set as active resume
                    setActiveResume(file.name);
                    setResumeData(parsedData);
                    
                    // Save to localStorage
                    localStorage.setItem('active_resume_for_job_search', file.name);
                    
                    // Generate AI recommendations
                    generateAIRecommendations(parsedData);
                    
                    alert('Resume uploaded successfully!');
                } catch (error) {
                    console.error('Error uploading resume:', error);
                    alert('Failed to upload resume. ' + (error.message || 'Please try again.'));
                } finally {
                    setIsUploadingResume(false);
                    event.target.value = ''; // Reset file input
                }
            };
            
            // OpenAI-powered resume parser for accurate extraction
            const parseResumeWithOpenAI = async (text) => {
                const apiKey = localStorage.getItem('openai_api_key');
                
                if (!apiKey) {
                    throw new Error('OpenAI API key not found. Please set it in Settings.');
                }
                
                const prompt = `Extract structured data from this resume text and return valid JSON only. The JSON should include:

{
  "personalInfo": {
    "name": "Full Name",
    "email": "email@example.com",
    "phone": "+1234567890",
    "location": "City, State, Country",
    "linkedIn": "linkedin.com/in/username",
    "portfolio": "website.com"
  },
  "summary": "Professional summary or objective",
  "skills": {
    "technical": ["skill1", "skill2", "skill3"],
    "soft": ["communication", "leadership", "teamwork"],
    "languages": ["English", "Spanish"]
  },
  "experience": [{
    "company": "Company Name",
    "position": "Job Title",
    "startDate": "YYYY-MM",
    "endDate": "YYYY-MM or Present",
    "description": "Job description",
    "achievements": ["achievement1", "achievement2"]
  }],
  "education": [{
    "institution": "University Name",
    "degree": "Degree Type",
    "field": "Field of Study",
    "graduationDate": "YYYY-MM"
  }],
  "certifications": [{
    "name": "Certification Name",
    "issuer": "Issuing Organization",
    "date": "YYYY-MM",
    "expiryDate": "YYYY-MM or null"
  }],
  "projects": [{
    "name": "Project Name",
    "description": "Project description",
    "technologies": ["tech1", "tech2"],
    "link": "project-url.com"
  }]
}

Resume text:
${text}

Return only valid JSON, no additional text. Be comprehensive and extract all skills, experiences, and relevant information.`;

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a resume parser. Extract all relevant information from resumes accurately and return valid JSON only.'
                                },
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            temperature: 0.3,
                            max_tokens: 4000
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'Failed to parse resume');
                    }

                    const data = await response.json();
                    const content = data.choices[0]?.message?.content;
                    
                    if (!content) {
                        throw new Error('No response from OpenAI');
                    }

                    // Try to extract JSON from the response
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        return JSON.parse(jsonMatch[0]);
                    }

                    // If no JSON found, try parsing the whole content
                    return JSON.parse(content);
                } catch (error) {
                    console.error('Error parsing resume with OpenAI:', error);
                    throw error;
                }
            };
            
            // Simple resume parser (fallback when OpenAI is not available)
            const parseResumeText = (text) => {
                const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                // Extract basic information
                const personalInfo = {
                    name: '',
                    email: '',
                    phone: '',
                    location: '',
                    linkedIn: '',
                    portfolio: ''
                };
                
                const skills = {
                    technical: [],
                    soft: [],
                    languages: []
                };
                
                const experience = [];
                const education = [];
                
                // Extract email
                const emailMatch = text.match(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/);
                if (emailMatch) personalInfo.email = emailMatch[0];
                
                // Extract phone
                const phoneMatch = text.match(/(\+?1[-.\s]?)?\(?([0-9]{3})\)?[-.\s]?([0-9]{3})[-.\s]?([0-9]{4})/);
                if (phoneMatch) personalInfo.phone = phoneMatch[0];
                
                // Extract LinkedIn
                const linkedinMatch = text.match(/linkedin\.com\/in\/[a-zA-Z0-9-]+/i);
                if (linkedinMatch) personalInfo.linkedIn = linkedinMatch[0];
                
                // Extract location (common patterns) - IMPROVED VERSION
                const locationPatterns = [
                    // Pattern 1: "live/located/based in/at [Location]"
                    /(?:live|located|based|stay|reside|address|from)\s+(?:in|at|near)\s+([^,\n]+(?:,\s*[^,\n]+)*)/i,
                    // Pattern 2: "City, State, Country" format
                    /([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?(?:\s*,\s*[A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)*),\s*(?:India|USA|UK|United Kingdom|Canada|Australia|United States)/i,
                    // Pattern 3: Indian address format "Area, Locality, City-Pincode" or "Area, City-Pincode"
                    /([A-Z][a-z]+(?:\s+[A-Z][a-z]+)?(?:\s*,\s*[A-Z][a-z]+(?:\s+[A-Z][a-z]+)?)*),\s*([A-Z][a-z]+)(?:[-]\s*\d+)?/i,
                    // Pattern 4: Standalone city names (for Indian cities)
                    /\b(?:Bangalore|Bengaluru|Mumbai|Bombay|Delhi|New Delhi|Chennai|Madras|Kolkata|Calcutta|Hyderabad|Pune|Ahmedabad|Jaipur|Lucknow|Kanpur|Nagpur|Indore|Thane|Bhopal|Visakhapatnam|Vizag|Surat|Patna|Vadodara|Ghaziabad|Ludhiana|Coimbatore|Agra|Madurai|Nashik|Meerut|Rajkot|Varanasi|Srinagar|Amritsar|Noida|Ranchi|Chandigarh|Raipur|Gwalior|Jabalpur|Kormangla|Koramangala|Ejipura)\b/i
                ];
                
                locationPatterns.forEach(pattern => {
                    const match = text.match(pattern);
                    if (match) {
                        // Get the matched location
                        let extractedLocation = match[1] || match[2] || match[0];
                        
                        // Clean up common prefixes
                        extractedLocation = extractedLocation.replace(/^(?:live|located|based|stay|reside|address|from|in|at|near)\s+/i, '');
                        extractedLocation = extractedLocation.trim();
                        
                        if (extractedLocation && extractedLocation.length > 2) {
                            personalInfo.location = extractedLocation;
                        }
                    }
                });
                
                // Extract common technical skills (expanded list)
                const commonSkills = [
                    'JavaScript', 'Python', 'Java', 'React', 'Node.js', 'SQL', 'HTML', 'CSS',
                    'TypeScript', 'Angular', 'Vue.js', 'PHP', 'C++', 'C#', 'Ruby', 'Go',
                    'AWS', 'Azure', 'Docker', 'Kubernetes', 'Git', 'MongoDB', 'PostgreSQL',
                    'Machine Learning', 'Data Science', 'AI', 'DevOps', 'Agile', 'Scrum',
                    'Express', 'Django', 'Flask', 'Spring', 'REST API', 'GraphQL', 'MongoDB',
                    'Redis', 'RabbitMQ', 'Microservices', 'CI/CD', 'Jenkins', 'Terraform',
                    'Redux', 'Next.js', 'Nuxt', 'Svelte', 'jQuery', 'Bootstrap', 'Tailwind',
                    'SASS', 'LESS', 'Webpack', 'Vite', 'npm', 'yarn', 'pip', 'conda',
                    'Postman', 'Swagger', 'Jira', 'Confluence', 'Slack', 'Trello', 'Asana'
                ];
                
                const textLower = text.toLowerCase();
                commonSkills.forEach(skill => {
                    if (textLower.includes(skill.toLowerCase()) || textLower.includes(skill.toLowerCase().replace('.', ''))) {
                        skills.technical.push(skill);
                    }
                });
                
                // Extract job titles and companies (simple pattern matching)
                const jobTitles = [
                    'Software Engineer', 'Developer', 'Programmer', 'Analyst', 'Manager',
                    'Designer', 'Consultant', 'Specialist', 'Coordinator', 'Director',
                    'Senior', 'Junior', 'Lead', 'Principal', 'Architect', 'Tech Lead'
                ];
                
                let currentJob = null;
                lines.forEach(line => {
                    const lineLower = line.toLowerCase();
                    jobTitles.forEach(title => {
                        if (lineLower.includes(title.toLowerCase()) && line.length < 100 && line.length > 10) {
                            if (currentJob) experience.push(currentJob);
                            currentJob = {
                                position: line,
                                company: '',
                                startDate: '',
                                endDate: 'Present',
                                description: '',
                                achievements: []
                            };
                        }
                    });
                });
                
                if (currentJob) experience.push(currentJob);
                
                return {
                    personalInfo,
                    summary: lines.slice(0, 3).join(' ') || 'Professional with relevant experience and skills.',
                    skills,
                    experience: experience.slice(0, 5), // Limit to 5 most recent
                    education: [],
                    certifications: [],
                    projects: []
                };
            };
            
            const handleSelectResume = (resumeName) => {
                const savedResumes = JSON.parse(localStorage.getItem('parsed_resumes') || '{}');
                if (savedResumes[resumeName]) {
                    setActiveResume(resumeName);
                    setResumeData(savedResumes[resumeName]);
                    localStorage.setItem('active_resume_for_job_search', resumeName);
                    generateAIRecommendations(savedResumes[resumeName]);
                }
            };
            
            const handleDeleteResume = (resumeName) => {
                if (!confirm(`Are you sure you want to delete "${resumeName}"?`)) {
                    return;
                }
                
                const savedResumes = JSON.parse(localStorage.getItem('parsed_resumes') || '{}');
                delete savedResumes[resumeName];
                localStorage.setItem('parsed_resumes', JSON.stringify(savedResumes));
                
                setUploadedResumes(savedResumes);
                
                if (activeResume === resumeName) {
                    const remainingResumes = Object.keys(savedResumes);
                    if (remainingResumes.length > 0) {
                        const firstResume = remainingResumes[0];
                        handleSelectResume(firstResume);
                    } else {
                        setActiveResume(null);
                        setResumeData(null);
                        setAiRecommendations([]);
                        localStorage.removeItem('active_resume_for_job_search');
                    }
                }
            };
            
            const generateAIRecommendations = async (resumeData) => {
                setIsLoadingRecommendations(true);
                
                try {
                    // Extract key information from resume
                    const skills = resumeData.skills?.technical || [];
                    const experience = resumeData.experience || [];
                    const recentJob = experience[0]?.position || '';
                    const recentCompany = experience[0]?.company || '';
                    
                    // Build search query based on resume with better skill extraction
                    let searchQuery = recentJob || 'jobs';
                    
                    // Use top 5 most relevant skills for better matching
                    if (skills.length > 0) {
                        const topSkills = skills.slice(0, 5).join(' ');
                        searchQuery += ` ${topSkills}`;
                    }
                    
                    // Add location for better results - use IP location as fallback
                    const rawLocation = resumeData.personalInfo?.location || ipDetectedLocation || '';
                    const location = normalizeLocationForSearch(rawLocation);
                    
                    console.log('Searching for real job recommendations with Serper.dev...');
                    if (location) {
                        console.log('Using normalized location:', location, '(original:', rawLocation + ')');
                    }
                    
                    try {
                        // Use Serper API to get real job listings
                        const searchData = await SerperSearch.searchJobs(
                            searchQuery,
                            location
                        );
                        
                        if (searchData && searchData.organic && searchData.organic.length > 0) {
                            console.log(`Found ${searchData.organic.length} real job recommendations`);
                            
                            // Transform Serper.dev results to recommendation format
                            const recommendations = searchData.organic.slice(0, 10).map((result, index) => {
                                const company = serperExtractCompany(result);
                                const title = serperExtractJobTitle(result.title);
                                const salary = serperExtractSalary(result.snippet);
                                
                                // Calculate match score based on resume skills
                                const matchScore = calculateResumeMatchScore(result, resumeData);
                                
                                return {
                                    id: index + 1,
                                    title: title,
                                    company: company,
                                    location: resumeData.personalInfo?.location || 'Various',
                                    salary: salary,
                                    type: serperExtractJobType(result.snippet),
                                    description: result.snippet,
                                    requirements: serperExtractRequirements(result.snippet),
                                    postedDate: new Date().toISOString().split('T')[0],
                                    url: result.link,
                                    source: new URL(result.link).hostname.replace('www.', ''),
                                    matchScore: matchScore,
                                    whyMatch: generateResumeMatchReason(result, resumeData)
                                };
                            });
                            
                            setAiRecommendations(recommendations);
                        } else {
                            console.log('No job recommendations found from Serper.dev');
                            setAiRecommendations([]);
                        }
                    } catch (serperError) {
                        console.error('Serper.dev error:', serperError);
                        setAiRecommendations([]);
                    }
                } catch (error) {
                    console.error('Error generating recommendations:', error);
                    setAiRecommendations([]);
                } finally {
                    setIsLoadingRecommendations(false);
                }
            };
            
            // Helper function to calculate match score based on resume
            const calculateResumeMatchScore = (jobResult, resumeData) => {
                let score = 60; // Base score
                
                const jobText = (jobResult.title + ' ' + jobResult.snippet).toLowerCase();
                const resumeSkills = resumeData.skills?.technical || [];
                const resumeExperience = resumeData.experience || [];
                const resumeLocation = resumeData.personalInfo?.location || '';
                
                // Check for skill matches with higher weight for top skills
                let skillMatches = 0;
                resumeSkills.forEach((skill, index) => {
                    if (jobText.includes(skill.toLowerCase())) {
                        skillMatches++;
                        // Give more weight to top skills
                        const weight = index < 3 ? 8 : 5;
                        score += weight;
                    }
                });
                
                // Check for experience level match
                const recentJob = resumeExperience[0]?.position || '';
                if (recentJob && jobText.includes(recentJob.toLowerCase())) {
                    score += 15;
                }
                
                // Check for location match
                if (resumeLocation && jobText.includes(resumeLocation.toLowerCase().split(',')[0])) {
                    score += 10;
                }
                
                // Check for soft skills mentioned in summary
                const summary = resumeData.summary || '';
                if (summary.length > 50 && jobText.includes(summary.toLowerCase().substring(0, 50))) {
                    score += 5;
                }
                
                return Math.min(score, 95); // Cap at 95%
            };
            
            // Helper function to generate match reason
            const generateResumeMatchReason = (jobResult, resumeData) => {
                const jobText = (jobResult.title + ' ' + jobResult.snippet).toLowerCase();
                const resumeSkills = resumeData.skills?.technical || [];
                const matchedSkills = resumeSkills.filter(skill => 
                    jobText.includes(skill.toLowerCase())
                );
                
                // Get top matched skills
                if (matchedSkills.length > 0) {
                    const topSkills = matchedSkills.slice(0, 3).join(', ');
                    const count = matchedSkills.length;
                    if (count > 3) {
                        return `Matches your skills: ${topSkills} (+${count - 3} more)`;
                    }
                    return `Matches your skills: ${topSkills}`;
                }
                
                // Check for job title match
                const recentJob = resumeData.experience?.[0]?.position || '';
                if (recentJob && jobText.includes(recentJob.toLowerCase())) {
                    return `Matches your experience as ${recentJob}`;
                }
                
                // Check for soft skills match
                const softSkills = resumeData.skills?.soft || [];
                const matchedSoftSkills = softSkills.filter(skill => 
                    jobText.includes(skill.toLowerCase())
                );
                
                if (matchedSoftSkills.length > 0) {
                    return `Matches your ${matchedSoftSkills[0]} skills`;
                }
                
                // Check for location match
                const location = resumeData.personalInfo?.location || '';
                if (location && jobText.includes(location.toLowerCase().split(',')[0])) {
                    return `Located in ${location.split(',')[0]}`;
                }
                
                return 'Good match for your background';
            };
            
            // Handle personalized job search based on resume and filters
            const handlePersonalizedSearch = async (strategyType = null) => {
                if (!activeResume) {
                    alert('Please select a resume first');
                    return;
                }
                
                const savedResumes = JSON.parse(localStorage.getItem('parsed_resumes') || '{}');
                const resumeData = savedResumes[activeResume];
                
                if (!resumeData) {
                    alert('Resume data not found');
                    return;
                }
                
                setIsSearchingPersonalized(true);
                
                try {
                    // Build search query from resume
                    const skills = resumeData.skills?.technical || [];
                    const experience = resumeData.experience || [];
                    const recentJob = experience[0]?.position || 'jobs';
                    // Use priority-based location logic
                    const location = getFinalLocationForSearch('personalized');
                    
                    let searchQuery;
                    
                    // If strategy is selected, use OpenAI to generate query
                    const strategyToUse = strategyType || selectedSearchStrategy;
                    if (strategyToUse) {
                        setIsGeneratingQuery(true);
                        try {
                            const result = await generateSearchQueryFromStrategy(strategyToUse, resumeData);
                            searchQuery = result.query;
                            setAiReasoning(result.reasoning); // Store the reasoning
                            console.log(`Generated search query for ${strategyToUse}:`, searchQuery);
                            console.log('AI Reasoning:', result.reasoning);
                            
                            // If OpenAI returns empty query, fall back to default
                            if (!searchQuery || searchQuery.trim() === '') {
                                console.log('OpenAI returned empty query, using default');
                                searchQuery = recentJob;
                                if (skills.length > 0) {
                                    searchQuery += ` ${skills.slice(0, 5).join(' ')}`;
                                }
                                setAiReasoning(null); // Clear reasoning if fallback
                            }
                        } catch (error) {
                            console.error('Error generating query:', error);
                            const errorMsg = error.message || 'Unknown error';
                            console.error('Full error details:', error);
                            alert(`Failed to generate search query: ${errorMsg}. Using default search.`);
                            // Fallback to default query building
                            searchQuery = recentJob;
                            if (skills.length > 0) {
                                searchQuery += ` ${skills.slice(0, 5).join(' ')}`;
                            }
                            setAiReasoning(null); // Clear reasoning on error
                        } finally {
                            setIsGeneratingQuery(false);
                        }
                    } else {
                        // Use existing default logic (no strategy selected)
                        searchQuery = recentJob;
                        // Add top 3 skills only (not 5) to keep query shorter
                        if (skills.length > 0) {
                            searchQuery += ` ${skills.slice(0, 3).join(' ')}`;
                        }
                        setAiReasoning(null); // Clear reasoning when no strategy is selected
                    }
                    
                    // Limit query length to prevent API errors (max 200 chars)
                    if (searchQuery.length > 200) {
                        console.warn('Query too long, truncating:', searchQuery);
                        searchQuery = searchQuery.substring(0, 200).trim();
                    }
                    
                    // Enhance query with better filter phrases (simplified)
                    const enhancedQuery = enhanceQueryWithFilters(searchQuery, resumeFilters);
                    
                    // Limit enhanced query length too (max 250 chars)
                    const finalQuery = enhancedQuery.length > 250 ? enhancedQuery.substring(0, 250).trim() : enhancedQuery;
                    
                    console.log('Searching personalized jobs with Serper.dev...');
                    console.log('Final search query:', finalQuery);
                    console.log('Query length:', finalQuery.length);
                    if (location) {
                        console.log('Using normalized location for personalized search:', location);
                        console.log('Resume location from data:', resumeData.personalInfo?.location);
                    }
                    
                    // Fetch more results for better client-side filtering (request 50-80 results)
                    let searchData;
                    try {
                        searchData = await SerperSearch.searchJobs(finalQuery, location, { num: 40 });
                        console.log('Serper API response:', searchData);
                    } catch (serperError) {
                        console.error('Serper API error:', serperError);
                        throw new Error(`Job search API failed: ${serperError.message || 'Unknown error'}`);
                    }
                    
                    if (!searchData) {
                        throw new Error('No response from job search API');
                    }
                    
                    // Also try fetching with options to get more results
                    let allResults = [];
                    if (searchData && searchData.organic && searchData.organic.length > 0) {
                        allResults = searchData.organic;
                        console.log(`Received ${allResults.length} results from Serper API`);
                        
                        // If we got results but less than 40, try to fetch more pages
                        if (allResults.length > 0 && allResults.length < 40) {
                            try {
                                // Try fetching page 2 for more results
                                const searchOptions = { num: 40, page: 2 };
                                const page2Data = await SerperSearch.searchJobs(finalQuery, location, searchOptions);
                                if (page2Data && page2Data.organic && page2Data.organic.length > 0) {
                                    allResults = [...allResults, ...page2Data.organic];
                                    console.log(`Added ${page2Data.organic.length} more results from page 2. Total: ${allResults.length}`);
                                }
                            } catch (e) {
                                console.log('Could not fetch additional page, using available results:', e);
                            }
                        }
                    } else {
                        console.warn('No results from Serper API. Response:', searchData);
                    }
                    
                    if (allResults.length > 0) {
                        // First, transform all results to job objects with extracted data
                        // Filter out any null/undefined results first
                        const validResults = allResults.filter(result => result && typeof result === 'object');
                        console.log(`Processing ${validResults.length} valid results out of ${allResults.length} total`);
                        
                        if (validResults.length === 0) {
                            throw new Error('Received results from API but none were valid');
                        }
                        
                        const allJobs = validResults.map((result, index) => {
                            try {
                                if (!result || typeof result !== 'object') {
                                    throw new Error('Invalid result object');
                                }
                                
                                const company = serperExtractCompany(result);
                                const title = serperExtractJobTitle(result.title);
                                const salary = serperExtractSalary(result.snippet);
                                const jobType = serperExtractJobType(result.snippet); // Extract from snippet
                                
                                // Safely extract source from URL
                                let source = 'Unknown';
                                if (result.link) {
                                    try {
                                        source = new URL(result.link).hostname.replace('www.', '');
                                    } catch (urlError) {
                                        console.warn('Invalid URL:', result.link, urlError);
                                        // Try to extract domain manually
                                        const urlMatch = result.link.match(/https?:\/\/([^\/]+)/);
                                        if (urlMatch) {
                                            source = urlMatch[1].replace('www.', '');
                                        }
                                    }
                                }
                                
                                // Create job object with all data needed for filtering
                                const jobObj = {
                                    id: index + 1,
                                    title: title || 'Untitled',
                                    company: company || 'Unknown Company',
                                    location: location || 'Various',
                                    salary: salary || 'Competitive',
                                    type: jobType || 'Full-time', // Use extracted type
                                    description: result.snippet || '',
                                    snippet: result.snippet || '', // Keep snippet for filtering
                                    requirements: serperExtractRequirements(result.snippet),
                                    postedDate: new Date().toISOString().split('T')[0],
                                    url: result.link || '#',
                                    source: source,
                                    rawResult: result // Keep raw result for additional parsing if needed
                                };
                                
                                return jobObj;
                            } catch (jobError) {
                                console.error('Error processing job result:', jobError, result);
                                // Return a minimal valid job object
                                return {
                                    id: index + 1,
                                    title: result.title || 'Untitled',
                                    company: 'Unknown Company',
                                    location: location || 'Various',
                                    salary: 'Competitive',
                                    type: 'Full-time',
                                    description: result.snippet || '',
                                    snippet: result.snippet || '',
                                    requirements: 'See details in job description.',
                                    postedDate: new Date().toISOString().split('T')[0],
                                    url: result.link || '#',
                                    source: 'Unknown',
                                    rawResult: result
                                };
                            }
                        });
                        
                        // Client-side filtering based on filters
                        let filteredJobs = allJobs.filter(job => filterJobByCriteria(job, resumeFilters));
                        
                        console.log(`Fetched ${allJobs.length} jobs, filtered to ${filteredJobs.length} matching criteria`);
                        
                        // If filtering removed all results, show all jobs but warn the user
                        if (filteredJobs.length === 0 && allJobs.length > 0) {
                            console.warn(`No jobs matched strict filter criteria. Showing all ${allJobs.length} jobs.`);
                            // Still show results, just without strict filtering
                            filteredJobs = allJobs.slice(0, 50); // Take more to ensure variety
                        }
                        
                        // Take top 30 filtered jobs and add match scores
                        const finalJobs = filteredJobs.slice(0, 30).map((job, index) => ({
                            ...job,
                            id: index + 1,
                            whyMatch: generateResumeMatchReason(job.rawResult || { title: job.title, snippet: job.snippet }, resumeData),
                            matchScore: calculateResumeMatchScore(job.rawResult || { title: job.title, snippet: job.snippet }, resumeData)
                        }));
                        
                        setPersonalizedJobResults(finalJobs);
                        console.log(` Successfully set ${finalJobs.length} personalized job results`);
                        console.log('Sample job:', finalJobs[0]);
                        
                        // Only show alert if we truly got no results from API
                        if (finalJobs.length === 0 && allJobs.length === 0) {
                            // This case is already handled by the "else" block below
                        }
                    } else {
                        alert('No jobs found. Try adjusting your search criteria or filters.');
                        setPersonalizedJobResults([]);
                    }
                } catch (error) {
                    console.error('Error searching personalized jobs:', error);
                    console.error('Error stack:', error.stack);
                    // Safely get searchQuery - it might not be defined if error happens early
                    let searchQueryValue = 'not set';
                    try {
                        if (typeof searchQuery !== 'undefined') {
                            searchQueryValue = searchQuery;
                        }
                    } catch (e) {
                        // searchQuery not accessible
                    }
                    
                    console.error('Error details:', {
                        message: error.message,
                        name: error.name,
                        activeResume: activeResume,
                        searchQuery: searchQueryValue,
                        location: location || 'not set',
                        strategy: strategyToUse || 'none'
                    });
                    
                    // Show more specific error message
                    let errorMessage = 'Failed to search for jobs. ';
                    if (error.message) {
                        errorMessage += `Error: ${error.message}`;
                    } else {
                        errorMessage += 'Please check the console for details.';
                    }
                    alert(errorMessage);
                    setPersonalizedJobResults([]);
                } finally {
                    setIsSearchingPersonalized(false);
                    setIsGeneratingQuery(false);
                }
            };
            
            // Helper to get currency symbol for a location
            const getCurrencySymbol = (location) => {
                if (!location) return '$';
                const loc = location.toLowerCase();
                if (loc.includes('india')) return '';
                if (loc.includes('uk') || loc.includes('united kingdom')) return '';
                if (loc.includes('europe')) return '';
                if (loc.includes('australia')) return 'A$';
                if (loc.includes('canada')) return 'C$';
                return '$';
            };
            
            // Enhanced query construction with better filter phrases (simplified to avoid long queries)
            const enhanceQueryWithFilters = (baseQuery, filters) => {
                let enhancedQuery = baseQuery;
                
                // Simplified work type filter (shorter phrases)
                if (filters.workType && filters.workType !== 'Any') {
                    const workTypeMap = {
                        'Full-time': 'full-time',
                        'Part-time': 'part-time',
                        'Contract': 'contract',
                        'Internship': 'internship'
                    };
                    const workTypePhrase = workTypeMap[filters.workType] || filters.workType.toLowerCase();
                    enhancedQuery += ` ${workTypePhrase}`;
                }
                
                // Simplified remote/on-site filter
                if (filters.remote && filters.remote !== 'Any') {
                    if (filters.remote === 'Remote') {
                        enhancedQuery += ' remote';
                    } else if (filters.remote === 'On-site') {
                        enhancedQuery += ' on-site';
                    } else if (filters.remote === 'Hybrid') {
                        enhancedQuery += ' hybrid';
                    }
                }
                
                // Simplified experience level filter
                if (filters.experienceLevel && filters.experienceLevel !== 'Any level') {
                    const experienceMap = {
                        'Entry Level': 'entry-level',
                        'Mid Level': 'mid-level',
                        'Senior Level': 'senior',
                        'Executive': 'executive'
                    };
                    const experiencePhrase = experienceMap[filters.experienceLevel] || filters.experienceLevel.toLowerCase();
                    enhancedQuery += ` ${experiencePhrase}`;
                }
                
                return enhancedQuery;
            };
            
            // Client-side filtering based on job description
            const filterJobByCriteria = (job, filters) => {
                const jobText = ((job.title || '') + ' ' + (job.description || '') + ' ' + (job.snippet || '')).toLowerCase();
                
                // Check work type
                if (filters.workType && filters.workType !== 'Any') {
                    const workTypePatterns = {
                        'Full-time': ['full-time', 'full time', 'permanent', 'fulltime'],
                        'Part-time': ['part-time', 'part time', 'parttime'],
                        'Contract': ['contract', 'contractor', 'contract role', 'freelance'],
                        'Internship': ['intern', 'internship', 'intern position', 'co-op']
                    };
                    const patterns = workTypePatterns[filters.workType] || [];
                    const matchesWorkType = patterns.some(pattern => jobText.includes(pattern));
                    if (!matchesWorkType) return false;
                }
                
                // Check remote/on-site/hybrid
                if (filters.remote && filters.remote !== 'Any') {
                    if (filters.remote === 'Remote') {
                        const remotePatterns = ['remote', 'work from home', 'wfh', 'work remotely', 'remote position', 'work from anywhere'];
                        const matchesRemote = remotePatterns.some(pattern => jobText.includes(pattern));
                        // Exclude if it mentions on-site or hybrid
                        const excludesOnsite = !jobText.includes('on-site') && !jobText.includes('on site') && !jobText.includes('office-based');
                        if (!matchesRemote || !excludesOnsite) return false;
                    } else if (filters.remote === 'On-site') {
                        const onsitePatterns = ['on-site', 'on site', 'office-based', 'in office', 'in-person'];
                        const matchesOnsite = onsitePatterns.some(pattern => jobText.includes(pattern));
                        // Exclude if it clearly mentions remote
                        const excludesRemote = !jobText.includes('remote') && !jobText.includes('work from home');
                        if (!matchesOnsite || !excludesRemote) return false;
                    } else if (filters.remote === 'Hybrid') {
                        const hybridPatterns = ['hybrid', 'hybrid work', 'hybrid position', 'flexible work', 'combination'];
                        const matchesHybrid = hybridPatterns.some(pattern => jobText.includes(pattern));
                        if (!matchesHybrid) {
                            // If not explicitly hybrid but has both remote and on-site mentions, consider it hybrid
                            const hasRemote = jobText.includes('remote') || jobText.includes('work from home');
                            const hasOnsite = jobText.includes('on-site') || jobText.includes('office');
                            if (!hasRemote || !hasOnsite) return false;
                        }
                    }
                }
                
                // Check experience level
                if (filters.experienceLevel && filters.experienceLevel !== 'Any level') {
                    const experiencePatterns = {
                        'Entry Level': ['entry-level', 'entry level', 'junior', 'graduate', 'new graduate', 'recent graduate', 'associate', '0-2 years', '0-1 years'],
                        'Mid Level': ['mid-level', 'mid level', 'experienced', '2-5 years', '3+ years', '3-7 years', 'intermediate'],
                        'Senior Level': ['senior', 'senior level', '5+ years', '7+ years', 'lead', 'expert', 'principal'],
                        'Executive': ['executive', 'director', 'vp', 'vice president', 'c-level', 'chief', 'head of']
                    };
                    const patterns = experiencePatterns[filters.experienceLevel] || [];
                    const matchesExperience = patterns.some(pattern => jobText.includes(pattern));
                    
                    // If no explicit experience match, check for disqualifying patterns
                    if (!matchesExperience && filters.experienceLevel === 'Entry Level') {
                        // Exclude if it mentions senior, lead, director, etc.
                        const disqualifying = ['senior', 'lead', 'principal', 'director', 'manager', '5+ years', '7+ years'];
                        if (disqualifying.some(pattern => jobText.includes(pattern))) return false;
                    }
                    
                    // Only return false if we're strict about experience and no match found
                    // For more lenient matching, we can allow jobs through even without explicit experience match
                    // This helps when job descriptions don't explicitly state experience level
                    if (!matchesExperience && patterns.length > 0) {
                        // Give it a chance - maybe the job title indicates the level
                        const titleLower = (job.title || '').toLowerCase();
                        const titleMatch = patterns.some(pattern => titleLower.includes(pattern));
                        if (!titleMatch) {
                            // Last chance: check if experience requirements are in a format we can parse
                            const yearPattern = /\d+\s*\+?\s*years?/g;
                            const yearsMatch = jobText.match(yearPattern);
                            if (yearsMatch) {
                                const years = yearsMatch.map(m => parseInt(m.match(/\d+/)?.[0] || '0'));
                                const maxYears = Math.max(...years);
                                if (filters.experienceLevel === 'Entry Level' && maxYears > 3) return false;
                                if (filters.experienceLevel === 'Mid Level' && (maxYears < 2 || maxYears > 8)) return false;
                                if (filters.experienceLevel === 'Senior Level' && maxYears < 5) return false;
                                if (filters.experienceLevel === 'Executive' && maxYears < 8) return false;
                            } else {
                                // No explicit experience found - allow through for better coverage
                                // This helps jobs that don't explicitly state requirements
                            }
                        }
                    }
                }
                
                return true; // Passed all filters
            };
            
            // Track job function
            const handleTrackJob = (job, source = 'job-finder') => {
                const result = window.JobTrackingUtils.addJobToTracker(job, source, 'new-leads');
                
                if (result.success) {
                    window.JobTrackingUtils.showNotification(
                        `Job "${job.title}" added to tracker! View in Job Tracker `,
                        'success',
                        4000
                    );
                    
                    // Update tracked jobs set
                    const tracked = window.JobTrackingUtils.getAllTrackedJobs();
                    const trackedSet = new Set(tracked.map(j => j.url));
                    setTrackedJobIds(trackedSet);
                    setRefreshTracking(prev => prev + 1);
                    
                    // Optional: Navigate to tracker
                    setTimeout(() => {
                        const trackerLink = document.querySelector('[data-id="job-tracker"]');
                        if (trackerLink && confirm('Job added! Would you like to view it in Job Tracker?')) {
                            trackerLink.click();
                        }
                    }, 1000);
                } else if (result.duplicate) {
                    window.JobTrackingUtils.showNotification(
                        result.message + ' Would you like to view it in Job Tracker?',
                        'info',
                        4000
                    );
                    
                    // Optional: Navigate to tracker
                    setTimeout(() => {
                        if (confirm('View this job in Job Tracker?')) {
                            const trackerLink = document.querySelector('[data-id="job-tracker"]');
                            if (trackerLink) trackerLink.click();
                        }
                    }, 1000);
                } else {
                    window.JobTrackingUtils.showNotification(
                        'Failed to add job to tracker. Please try again.',
                        'error'
                    );
                }
            };

            // Apply & Track function
            const handleApplyAndTrack = (job) => {
                // First track the job
                const result = window.JobTrackingUtils.addJobToTracker(job, 'job-finder', 'applied');
                
                if (result.success) {
                    window.JobTrackingUtils.updateJobStatus(result.job.id, 'applied');
                    window.JobTrackingUtils.showNotification(
                        `Job tracked and marked as Applied! Opening application page...`,
                        'success'
                    );
                    
                    // Open application page
                    setTimeout(() => {
                        window.open(job.url, '_blank');
                    }, 500);
                    
                    // Update tracked jobs
                    const tracked = window.JobTrackingUtils.getAllTrackedJobs();
                    const trackedSet = new Set(tracked.map(j => j.url));
                    setTrackedJobIds(trackedSet);
                    setRefreshTracking(prev => prev + 1);
                } else if (result.duplicate) {
                    // Update existing job to applied
                    const trackedJob = window.JobTrackingUtils.getTrackedJobByUrl(job.url);
                    if (trackedJob) {
                        window.JobTrackingUtils.updateJobStatus(trackedJob.id, 'applied');
                    }
                    window.open(job.url, '_blank');
                }
            };

            // Bulk track high matches
            const handleBulkTrackHighMatches = (jobs, minScore = 80) => {
                const result = window.JobTrackingUtils.bulkAddJobs(jobs, 'job-finder', minScore);
                
                window.JobTrackingUtils.showNotification(
                    `Added ${result.added} jobs to tracker${result.duplicates > 0 ? ` (${result.duplicates} duplicates skipped)` : ''}`,
                    result.added > 0 ? 'success' : 'info'
                );
                
                // Refresh tracked jobs
                const tracked = window.JobTrackingUtils.getAllTrackedJobs();
                const trackedSet = new Set(tracked.map(j => j.url));
                setTrackedJobIds(trackedSet);
                setRefreshTracking(prev => prev + 1);
            };

            // Check if job is tracked
            const isJobTracked = (job) => {
                return window.JobTrackingUtils.isJobTracked(job);
            };

            // Get tracked job status for display
            const getTrackedJobStatus = (job) => {
                const trackedJob = window.JobTrackingUtils.getTrackedJobByUrl(job.url) ||
                                  window.JobTrackingUtils.getTrackedJobByTitleAndCompany(job.title, job.company);
                
                if (!trackedJob) return null;
                
                const statusLabels = {
                    'new-leads': 'New Lead',
                    'reviewing': 'Reviewing',
                    'applied': `Applied on ${trackedJob.applicationDate || 'recently'}`,
                    'interviewing': `Interview scheduled${trackedJob.interviewDate ? `: ${trackedJob.interviewDate}` : ''}`,
                    'offer': 'Offer Received',
                    'rejected': 'Rejected',
                    'archived': 'Archived'
                };
                
                return {
                    status: trackedJob.status,
                    label: statusLabels[trackedJob.status] || 'Tracked',
                    applicationDate: trackedJob.applicationDate,
                    interviewDate: trackedJob.interviewDate
                };
            };
            
            // Check for saved resume and detect IP location
            React.useEffect(() => {
                const savedResumes = JSON.parse(localStorage.getItem('parsed_resumes') || '{}');
                setUploadedResumes(savedResumes);
                
                // Load active resume
                const activeResumeName = localStorage.getItem('active_resume_for_job_search');
                if (activeResumeName && savedResumes[activeResumeName]) {
                    setActiveResume(activeResumeName);
                    setResumeData(savedResumes[activeResumeName]);
                    // Generate recommendations asynchronously
                    setTimeout(() => {
                        generateAIRecommendations(savedResumes[activeResumeName]);
                    }, 100);
                } else if (Object.keys(savedResumes).length > 0) {
                    // Fall back to first resume
                    const firstResumeName = Object.keys(savedResumes)[0];
                    setActiveResume(firstResumeName);
                    setResumeData(savedResumes[firstResumeName]);
                    setTimeout(() => {
                        generateAIRecommendations(savedResumes[firstResumeName]);
                    }, 100);
                }
                
                // Load saved alerts
                const savedAlerts = JSON.parse(localStorage.getItem('job_alerts') || '[]');
                setUserAlerts(savedAlerts);
                
                // Detect user location from IP
                const savedLocation = localStorage.getItem('ip_detected_location');
                const timestamp = localStorage.getItem('ip_location_timestamp');
                
                if (savedLocation && timestamp) {
                    const age = Date.now() - parseInt(timestamp);
                    const twentyFourHours = 24 * 60 * 60 * 1000;
                    
                    if (age < twentyFourHours) {
                        // Use cached location (valid for 24 hours)
                        setIpDetectedLocation(savedLocation);
                        console.log('Using cached IP location:', savedLocation);
                    } else {
                        // Refresh location after 24 hours
                        detectUserLocationFromIP();
                    }
                } else {
                    // First time - detect location
                    detectUserLocationFromIP();
                }
                
                // Load search history
                const savedHistory = JSON.parse(localStorage.getItem('job_search_history') || '[]');
                setSearchHistory(savedHistory);
                
                // Load tracked jobs for duplicate detection
                const tracked = window.JobTrackingUtils.getAllTrackedJobs();
                const trackedSet = new Set(tracked.map(j => j.url));
                setTrackedJobIds(trackedSet);
                
                // Close dropdowns when clicking outside
                const handleClickOutside = (event) => {
                    if (!event.target.closest('.filter-dropdown-container') && 
                        !event.target.closest('.job-title-suggestions-container') &&
                        !event.target.closest('.location-suggestions-container')) {
                        setShowFilterDropdown({
                            datePosted: false,
                            experienceLevel: false,
                            remote: false,
                            salaryRange: false
                        });
                        setShowLocationSuggestions(false);
                        setShowJobTitleSuggestions(false);
                    }
                };
                
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, []);

            // Quick search function with Serper.dev (real job listings)
            const handleQuickSearch = async () => {
                if (!quickSearchJobTitle.trim()) {
                    alert('Please enter a job title');
                    return;
                }
                
                setIsSearching(true);
                setCurrentPage(1);
                
                try {
                    // Build search query with filters and resume context
                    let searchQuery = `${quickSearchJobTitle} jobs`;
                    
                    // Enhance search query if resume is available
                    if (resumeData) {
                        const skills = resumeData.skills?.technical?.slice(0, 3).join(', ') || '';
                        if (skills) {
                            searchQuery += ` with ${skills}`;
                        }
                    }
                    
                    if (quickSearchLocation) {
                        searchQuery += ` in ${quickSearchLocation}`;
                    }
                    
                    // Add experience level filter
                    if (filters.experienceLevel !== 'Any level') {
                        searchQuery += ` ${filters.experienceLevel}`;
                    }
                    
                    // Add remote filter
                    if (filters.remote === 'Remote') {
                        searchQuery += ' remote';
                    } else if (filters.remote === 'On-site') {
                        searchQuery += ' on-site';
                    } else if (filters.remote === 'Hybrid') {
                        searchQuery += ' hybrid';
                    }
                    
                    // Add salary filter
                    if (filters.salaryRange !== 'Any') {
                        searchQuery += ` ${filters.salaryRange} salary`;
                    }
                    
                    console.log('Searching for real job listings with Serper.dev...');
                    let finalJobs = [];
                    
                    // Get final location with priority logic (Quick Search location or IP location)
                    const finalLocation = getFinalLocationForSearch('quick');
                    if (finalLocation) {
                        console.log('Using location for quick search:', finalLocation);
                    }
                    
                    try {
                        // STEP 1: Get REAL job listings from Serper.dev
                        const searchData = await SerperSearch.searchJobs(
                            quickSearchJobTitle,
                            finalLocation
                        );
                        
                        if (searchData && searchData.organic && searchData.organic.length > 0) {
                            console.log(`Found ${searchData.organic.length} real job listings`);
                            
                            // STEP 2: Transform Serper.dev results to your job format
                            finalJobs = searchData.organic.map((result, index) => {
                                const company = serperExtractCompany(result);
                                const title = serperExtractJobTitle(result.title);
                                const salary = serperExtractSalary(result.snippet);
                                
                                return {
                                    id: index + 1,
                                    title: title,
                                    company: company,
                                    location: quickSearchLocation || 'Various',
                                    salary: salary,
                                    type: serperExtractJobType(result.snippet),
                                    description: result.snippet,
                                    requirements: serperExtractRequirements(result.snippet),
                                    postedDate: new Date().toISOString().split('T')[0],
                                    url: result.link,
                                    source: new URL(result.link).hostname.replace('www.', ''),
                                    whyMatch: generateWhyMatch(quickSearchJobTitle),
                                    matchScore: serperCalculateMatchScore(result, filters)
                                };
                            });
                        } else {
                            console.log('No job listings found from Serper.dev');
                        }
                    } catch (serperError) {
                        console.error('Serper.dev error:', serperError);
                        // Fallback to OpenAI-generated listings if Serper fails
                    }
                    
                    // Fallback if Serper.dev didn't return results - use OpenAI
                    if (finalJobs.length === 0) {
                        console.log('Falling back to AI-generated job listings...');
                        const openAIApiKey = localStorage.getItem('openai_api_key');
                        
                        if (openAIApiKey) {
                            try {
                                const aiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Authorization': `Bearer ${openAIApiKey}`
                                    },
                                    body: JSON.stringify({
                                        model: 'gpt-4o-mini',
                                        messages: [
                                            {
                                                role: 'system',
                                                content: 'Generate realistic job listings with real company names and proper URLs to real job boards.'
                                            },
                                            {
                                                role: 'user',
                                                content: `Generate 10 realistic ${quickSearchJobTitle} job listings for ${quickSearchLocation || 'any location'}. Include real company names and proper job board URLs (linkedin.com, indeed.com, glassdoor.com). Return ONLY a valid JSON array with complete URLs.`
                                            }
                                        ],
                                        temperature: 0.7,
                                        max_tokens: 3000
                                    })
                                });
                                
                                const aiData = await aiResponse.json();
                                const content = aiData.choices[0]?.message?.content;
                                const jsonMatch = content.match(/\[[\s\S]*\]/);
                                
                                if (jsonMatch) {
                                    finalJobs = JSON.parse(jsonMatch[0]).map((job, index) => ({
                                        id: index + 1,
                                        title: job.title || quickSearchJobTitle,
                                        company: job.company || 'Company',
                                        location: job.location || quickSearchLocation || 'Remote',
                                        salary: job.salary || generateSalaryRange(filters.salaryRange),
                                        type: job.type || 'Full-time',
                                        description: job.description || `We are looking for a ${quickSearchJobTitle} to join our team.`,
                                        requirements: job.requirements || 'Relevant experience and skills required.',
                                        postedDate: job.postedDate || new Date().toISOString().split('T')[0],
                                        url: job.url || '#',
                                        source: extractSource(job.url),
                                        whyMatch: generateWhyMatch(quickSearchJobTitle),
                                        matchScore: calculateSimpleMatchScore(filters)
                                    }));
                                }
                            } catch (e) {
                                console.error('OpenAI error:', e);
                            }
                        }
                    }
                    
                    // Final fallback to mock data if all else fails
                    if (finalJobs.length === 0) {
                        finalJobs = generateFallbackJobs(quickSearchJobTitle, quickSearchLocation, filters);
                    }
                    
                    // Save to search history
                    const historyItem = {
                        jobTitle: quickSearchJobTitle,
                        location: quickSearchLocation,
                        filters: filters,
                        timestamp: new Date().toISOString(),
                        resultsCount: finalJobs.length
                    };
                    const updatedHistory = [historyItem, ...searchHistory.slice(0, 9)];
                    setSearchHistory(updatedHistory);
                    localStorage.setItem('job_search_history', JSON.stringify(updatedHistory));
                    
                    setJobResults(finalJobs);
                } catch (error) {
                    console.error('Error searching jobs:', error);
                    alert('Failed to search for jobs. Please try again.');
                } finally {
                    setIsSearching(false);
                }
            };
            
            // Helper functions for Serper.dev integration
            const serperExtractCompany = (result) => {
                // Extract from title like "Software Engineer - Google | LinkedIn"
                const titleParts = result.title.split(' - ');
                if (titleParts.length > 1 && titleParts[1].includes('|')) {
                    const company = titleParts[1].split('|')[0].trim();
                    return company;
                }
                
                // Or extract from displayedLink: "jobs.google.com"
                try {
                    const host = new URL(result.link).hostname;
                    const domain = host.split('.')[1];
                    if (domain) {
                        return domain.charAt(0).toUpperCase() + domain.slice(1);
                    }
                } catch (e) {
                    console.error('Error extracting company:', e);
                }
                
                return 'Company';
            };
            
            const serperExtractJobTitle = (title) => {
                // Remove company names and job boards: "Software Engineer - Google | Indeed"
                return title.split(' - ')[0].split('|')[0].trim();
            };
            
            const serperExtractSalary = (snippet) => {
                if (!snippet) return 'Competitive';
                
                // Use regex to find salary ranges in snippet
                const salaryPatterns = [
                    /\$[\d,]+(\s*-\s*\$[\d,]+)?/g,
                    /([\d,]+)\s*-\s*([\d,]+)\s*(USD|dollars)/gi,
                    /(salary|pay):\s*\$?[\d,]+(-\$?[\d,]+)?/gi
                ];
                
                for (const pattern of salaryPatterns) {
                    const match = snippet.match(pattern);
                    if (match && match[0]) {
                        return match[0].trim();
                    }
                }
                
                return 'Competitive';
            };
            
            const serperExtractJobType = (snippet) => {
                if (!snippet) return 'Full-time';
                
                const lowerSnippet = snippet.toLowerCase();
                if (lowerSnippet.includes('full-time') || lowerSnippet.includes('fulltime')) {
                    return 'Full-time';
                } else if (lowerSnippet.includes('part-time') || lowerSnippet.includes('parttime')) {
                    return 'Part-time';
                } else if (lowerSnippet.includes('contract')) {
                    return 'Contract';
                } else if (lowerSnippet.includes('intern')) {
                    return 'Internship';
                }
                return 'Full-time'; // Default
            };
            
            const serperExtractRequirements = (snippet) => {
                // Extract key requirements from snippet (first 200 chars)
                if (!snippet) return 'See details in job description.';
                
                if (snippet.length > 200) {
                    return snippet.substring(0, 197) + '...';
                }
                return snippet;
            };
            
            const serperCalculateMatchScore = (result, filters) => {
                let score = 85; // Base score for real listings
                
                // Increase score for premium job boards
                const link = result.link.toLowerCase();
                if (link.includes('linkedin.com')) score += 10;
                if (link.includes('indeed.com')) score += 8;
                if (link.includes('glassdoor.com')) score += 7;
                if (link.includes('monster.com')) score += 6;
                if (link.includes('dice.com')) score += 5;
                
                // Increase score if title/snippet matches filters
                const lowerTitle = result.title.toLowerCase();
                const lowerSnippet = (result.snippet || '').toLowerCase();
                
                if (filters.remote !== 'Any') {
                    if (lowerTitle.includes('remote') || lowerSnippet.includes('remote')) score += 5;
                    if (filters.remote === 'On-site' && !lowerTitle.includes('remote')) score += 3;
                }
                
                return Math.min(score, 100);
            };
            
            // Parse web search results into job format
            const parseWebSearchResults = (searchResults, jobTitle, location, activeFilters) => {
                const jobs = [];
                
                if (searchResults && Array.isArray(searchResults) && searchResults.length > 0) {
                    // Process real web search results
                    searchResults.slice(0, 10).forEach((result, index) => {
                        // Extract title and company from result
                        let title = result.title || '';
                        let company = 'Company';
                        
                        // Try to extract company name from title (e.g., "Software Engineer - TechCorp Inc - San Francisco, CA")
                        if (title.includes(' - ')) {
                            const parts = title.split(' - ');
                            title = parts[0] || title;
                            company = parts[1] || 'Company';
                        }
                        
                        // Extract location from title or use provided location
                        let extractedLocation = location;
                        if (!extractedLocation && result.title) {
                            const locationMatch = result.title.match(/[-,\s]+([A-Z][a-z]+,\s*[A-Z]{2})\s*$/);
                            if (locationMatch) extractedLocation = locationMatch[1];
                        }
                        
                        // Extract salary from snippet if available
                        let salary = generateSalaryRange(activeFilters.salaryRange);
                        if (result.snippet) {
                            const salaryMatch = result.snippet.match(/\$[\d,]+(?:k|\d+)(?:\s*-\s*\$[\d,]+(?:k|\d+))?/);
                            if (salaryMatch) salary = salaryMatch[0];
                        }
                        
                        const job = {
                            id: index + 1,
                            title: title || jobTitle,
                            company: company,
                            location: extractedLocation || 'View listing',
                            salary: salary,
                            type: extractJobType(result.snippet) || 'Full-time',
                            description: result.snippet || result.description || `We are looking for a ${jobTitle} to join our team.`,
                            requirements: extractRequirements(result.snippet || jobTitle),
                            postedDate: new Date().toISOString().split('T')[0],
                            url: result.url || result.link || '#',
                            source: extractSource(result.url || result.link),
                            whyMatch: generateWhyMatch(jobTitle),
                            matchScore: calculateSimpleMatchScore(activeFilters)
                        };
                        jobs.push(job);
                    });
                }
                
                // If no results, generate placeholder jobs
                if (jobs.length === 0) {
                    for (let i = 0; i < 5; i++) {
                        jobs.push({
                            id: i + 1,
                            title: jobTitle,
                            company: `Company ${i + 1}`,
                            location: location || 'Remote',
                            salary: generateSalaryRange(activeFilters.salaryRange),
                            type: 'Full-time',
                            description: `We are looking for a ${jobTitle} to join our growing team.`,
                            requirements: 'Relevant experience and skills required.',
                            postedDate: new Date().toISOString().split('T')[0],
                            url: '#',
                            source: 'Job Board',
                            whyMatch: 'This role matches your experience and skills.',
                            matchScore: calculateSimpleMatchScore(activeFilters)
                        });
                    }
                }
                
                return jobs;
            };
            
            // Helper functions
            const extractJobType = (text) => {
                if (!text) return 'Full-time';
                const lowerText = text.toLowerCase();
                if (lowerText.includes('part-time') || lowerText.includes('part time')) return 'Part-time';
                if (lowerText.includes('contract') || lowerText.includes('contractor')) return 'Contract';
                if (lowerText.includes('intern')) return 'Internship';
                return 'Full-time';
            };
            
            const extractJobTitle = (result) => {
                return result.title?.split('-')[0]?.trim() || result.title;
            };
            
            const extractCompany = (result) => {
                return result.title?.split('-').pop()?.trim() || 'Company';
            };
            
            const extractLocation = (result) => {
                if (result.location) return result.location;
                if (result.url?.includes('indeed.com')) return 'View on Indeed';
                if (result.url?.includes('linkedin.com')) return 'View on LinkedIn';
                return 'Remote';
            };
            
            const extractRequirements = (text) => {
                if (!text) return 'Relevant experience and skills required.';
                
                // Try to extract requirements from text
                const requirements = [];
                const techKeywords = ['experience', 'skills', 'knowledge', 'proficiency', 'ability'];
                
                if (text.toLowerCase().includes('engineer') || text.toLowerCase().includes('developer')) {
                    requirements.push('Programming skills', 'Technical expertise', 'Problem-solving');
                }
                if (text.toLowerCase().includes('manage')) {
                    requirements.push('Leadership skills', 'Team management', 'Strategic thinking');
                }
                if (text.toLowerCase().includes('data') || text.toLowerCase().includes('analyst')) {
                    requirements.push('Analytical skills', 'Data analysis', 'Statistical knowledge');
                }
                
                // Base requirements
                if (!requirements.length) {
                    requirements.push('Relevant experience', 'Strong communication skills', 'Team collaboration');
                }
                
                return requirements.join(', ');
            };
            
            const extractSource = (url) => {
                if (!url) return 'Job Board';
                if (url.includes('linkedin.com')) return 'LinkedIn';
                if (url.includes('indeed.com')) return 'Indeed';
                if (url.includes('glassdoor.com')) return 'Glassdoor';
                if (url.includes('monster.com')) return 'Monster';
                return 'Job Board';
            };
            
            const generateSalaryRange = (filter) => {
                switch (filter) {
                    case '$50k - $80k': return '$50k - $80k';
                    case '$80k - $120k': return '$80k - $120k';
                    case '$120k+': return '$120k - $180k';
                    default: return '$60k - $100k';
                }
            };
            
            const generateWhyMatch = (jobTitle) => {
                const reasons = [
                    `This ${jobTitle} role aligns with your skills and experience.`,
                    `Your background matches the requirements for this ${jobTitle} position.`,
                    `This opportunity offers growth in the ${jobTitle} field.`,
                    `Your expertise makes you a strong candidate for this ${jobTitle} role.`
                ];
                return reasons[Math.floor(Math.random() * reasons.length)];
            };
            
            const calculateSimpleMatchScore = (filters) => {
                let score = 70;
                if (filters.experienceLevel !== 'Any level') score += 10;
                if (filters.remote !== 'Any') score += 5;
                if (filters.salaryRange !== 'Any') score += 5;
                return Math.min(score, 98);
            };
            
            // Format salary from JSearch API
            const formatSalary = (minSalary, maxSalary, currency = 'USD') => {
                if (!minSalary && !maxSalary) return null;
                const formatAmount = (amt) => {
                    if (amt >= 1000) return `$${(amt / 1000).toFixed(0)}k`;
                    return `$${amt}`;
                };
                
                if (minSalary && maxSalary) {
                    return `${formatAmount(minSalary)} - ${formatAmount(maxSalary)}`;
                }
                if (minSalary) return `${formatAmount(minSalary)}+`;
                if (maxSalary) return `Up to ${formatAmount(maxSalary)}`;
                return null;
            };
            
            // Format date from JSearch API
            const formatDate = (dateString) => {
                if (!dateString) return new Date().toISOString().split('T')[0];
                const date = new Date(dateString);
                return date.toISOString().split('T')[0];
            };
            
            // Extract job requirements from description
            const extractJobRequirements = (description, highlights) => {
                if (!description && !highlights) return 'Relevant experience and skills required.';
                
                const reqs = [];
                const text = description || (highlights?.map(h => h).join(' ') || '');
                
                // Extract key requirements
                if (text.toLowerCase().includes('experience') || text.toLowerCase().includes('years')) {
                    reqs.push('Relevant experience');
                }
                if (text.toLowerCase().includes('degree') || text.toLowerCase().includes('education')) {
                    reqs.push('Education/degree');
                }
                if (text.toLowerCase().includes('skill') || text.toLowerCase().includes('proficient')) {
                    reqs.push('Technical skills');
                }
                if (text.toLowerCase().includes('communicat') || text.toLowerCase().includes('team')) {
                    reqs.push('Communication skills');
                }
                
                return reqs.length > 0 ? reqs.join(', ') : 'Experience and skills required';
            };
            
            // Generate fallback jobs if web search fails
            const generateFallbackJobs = (jobTitle, location, filters) => {
                const companies = ['TechCorp', 'StartupXYZ', 'Global Solutions', 'Innovation Labs', 'Data Systems Inc'];
                const jobs = [];
                
                for (let i = 0; i < 5; i++) {
                    jobs.push({
                        id: i + 1,
                        title: jobTitle,
                        company: companies[i] || `Company ${i + 1}`,
                        location: location || 'Remote',
                        salary: generateSalaryRange(filters.salaryRange),
                        type: 'Full-time',
                        description: `We are looking for a ${jobTitle} to join our growing team. This role offers an exciting opportunity to work on challenging projects and advance your career.`,
                        requirements: 'Relevant experience and skills required.',
                        postedDate: new Date().toISOString().split('T')[0],
                        url: `https://example.com/job/${i + 1}`,
                        source: ['LinkedIn', 'Indeed', 'Glassdoor'][i % 3],
                        whyMatch: 'This role matches your experience and skills.',
                        matchScore: calculateSimpleMatchScore(filters)
                    });
                }
                return jobs;
            };
            
            // Calculate AI match score
            const calculateMatchScore = async (jobDescription, jobRequirements) => {
                if (!resumeData) return 75; // Default if no resume
                
                try {
                    const apiKey = localStorage.getItem('openai_api_key');
                    if (!apiKey) return 75;
                    
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [{
                                role: 'user',
                                content: `Compare this resume with this job posting and calculate a match score 0-100.

RESUME: ${JSON.stringify(resumeData)}
JOB DESCRIPTION: ${jobDescription}
REQUIREMENTS: ${jobRequirements}

Return ONLY a number between 0-100 representing the match percentage.`
                            }],
                            temperature: 0.3,
                            max_tokens: 50
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const score = parseInt(data.choices[0]?.message?.content || '75');
                        return isNaN(score) ? 75 : score;
                    }
                } catch (error) {
                    console.error('Error calculating match:', error);
                }
                
                return 75;
            };
            
            // Generate or fetch company data
            const fetchCompanyData = async (companyName) => {
                setIsLoadingCompanyData(true);
                try {
                    // Generate realistic company data based on company name
                    // In production, this would fetch from an API like Glassdoor, LinkedIn, or Serper
                    const generateCompanyDetails = (name) => {
                        const industries = ['Technology', 'Finance', 'Healthcare', 'Retail', 'Manufacturing', 'Consulting', 'Education', 'Entertainment'];
                        const sizes = ['1-50 Employees', '51-200 Employees', '201-500 Employees', '501-1000 Employees', '1001-5000 Employees', '5001-10000 Employees', '10000+ Employees'];
                        const locations = ['San Francisco, CA', 'New York, NY', 'Austin, TX', 'Seattle, WA', 'Boston, MA', 'Chicago, IL', 'Los Angeles, CA'];
                        
                        const industry = industries[Math.floor(Math.random() * industries.length)];
                        const size = sizes[Math.floor(Math.random() * sizes.length)];
                        const location = locations[Math.floor(Math.random() * locations.length)];
                        const rating = (Math.random() * 1.5 + 3.5).toFixed(1); // 3.5-5.0
                        
                        return {
                            name: name,
                            rating: parseFloat(rating),
                            review_count: Math.floor(Math.random() * 50000 + 1000),
                            salary_count: Math.floor(Math.random() * 200000 + 10000),
                            job_count: Math.floor(Math.random() * 5000 + 100),
                            headquarters_location: location,
                            company_size: size,
                            industry: industry,
                            website: `https://www.${name.toLowerCase().replace(/\s+/g, '')}.com`,
                            company_type: Math.random() > 0.5 ? 'Company - Public' : 'Company - Private',
                            revenue: Math.random() > 0.5 ? '$10M - $50M' : Math.random() > 0.5 ? '$50M - $200M' : '$200M+',
                            year_founded: Math.floor(Math.random() * 60 + 1960),
                            ceo: 'Chief Executive Officer',
                            ceo_rating: (Math.random() * 0.5 + 0.7).toFixed(2),
                            compensation_and_benefits_rating: (Math.random() * 1 + 3.5).toFixed(1),
                            culture_and_values_rating: (Math.random() * 1 + 3.5).toFixed(1),
                            work_life_balance_rating: (Math.random() * 1 + 3.5).toFixed(1),
                            career_opportunities_rating: (Math.random() * 1 + 3.5).toFixed(1),
                            company_description: `${name} is a leading company in the ${industry} sector, committed to innovation and excellence. We provide outstanding career opportunities and value our employees' growth and development.`
                        };
                    };
                    
                    const generateReviews = () => {
                        const reviews = [];
                        const pros = [
                            'Great work-life balance and flexible hours',
                            'Excellent benefits package and competitive salary',
                            'Supportive management and team environment',
                            'Opportunities for professional growth and development',
                            'Innovative projects and cutting-edge technology',
                            'Collaborative and inclusive company culture'
                        ];
                        const cons = [
                            'Fast-paced environment can be challenging',
                            'Some departments need better communication',
                            'Occasional overtime required during peak periods',
                            'Limited remote work options in some roles'
                        ];
                        const summaries = [
                            'Great company with amazing culture',
                            'Solid place to grow your career',
                            'Challenging but rewarding work',
                            'Good benefits and supportive team',
                            'Room for improvement but overall positive'
                        ];
                        
                        for (let i = 0; i < 3; i++) {
                            reviews.push({
                                summary: summaries[Math.floor(Math.random() * summaries.length)],
                                pros: pros[Math.floor(Math.random() * pros.length)],
                                cons: cons[Math.floor(Math.random() * cons.length)],
                                rating: Math.floor(Math.random() * 3 + 2), // 2-5
                                job_title: 'Various Positions',
                                review_datetime: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString(),
                                is_current_employee: Math.random() > 0.3,
                                years_of_employment: Math.floor(Math.random() * 5 + 1),
                                location: 'Various Locations'
                            });
                        }
                        return reviews;
                    };
                    
                    const generateInterviews = () => {
                        const interviews = [];
                        const difficulties = ['easy', 'average', 'difficult'];
                        const experiences = ['positive', 'neutral', 'negative'];
                        const processes = [
                            'Initial phone screen with HR, followed by technical interview with team lead, and final round with hiring manager.',
                            'Online application, assessment test, phone interview, and in-person panel interview.',
                            'Recruiter call, technical assessment, behavioral interview, and culture fit discussion.',
                            'Initial screening call, take-home assignment, technical interview, and final discussion with leadership team.'
                        ];
                        
                        for (let i = 0; i < 3; i++) {
                            interviews.push({
                                job_title: 'Various Positions',
                                location: 'Various Locations',
                                review_datetime: new Date(Date.now() - Math.random() * 180 * 24 * 60 * 60 * 1000).toISOString(),
                                process_description: processes[Math.floor(Math.random() * processes.length)],
                                difficulty: difficulties[Math.floor(Math.random() * difficulties.length)],
                                experience: experiences[Math.floor(Math.random() * experiences.length)]
                            });
                        }
                        return interviews;
                    };
                    
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    setCompanyDetails(generateCompanyDetails(companyName));
                    setCompanyReviews(generateReviews());
                    setCompanyInterviews(generateInterviews());
                } catch (error) {
                    console.error('Error fetching company data:', error);
                } finally {
                    setIsLoadingCompanyData(false);
                }
            };
            
            // Handle opening job details
            const handleOpenJobDetails = (job) => {
                setSelectedJob(job);
                setShowJobModal(true);
                if (job.company) {
                    fetchCompanyData(job.company);
                }
            };
            
            // Handle tailoring resume for a job
            const handleTailorResume = (job) => {
                // Store job data in localStorage for Application Tailor
                localStorage.setItem('tailor_target_job', JSON.stringify({
                    jobDescription: `${job.description}\n\nRequirements: ${job.requirements}`,
                    companyUrl: job.url,
                    timestamp: new Date().toISOString()
                }));
                
                // Navigate to Application Tailor
                window.showContent('application-tailor');
            };

            const isLightMode = !document.documentElement.classList.contains('dark');
            
            const getMatchScoreColor = (score) => {
                if (score >= 90) return 'text-green-600 bg-green-100';
                if (score >= 80) return 'text-blue-600 bg-blue-100';
                if (score >= 70) return 'text-yellow-600 bg-yellow-100';
                return 'text-red-600 bg-red-100';
            };

            return (
                <div className="space-y-6">
                    {/* Tab Navigation */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex gap-2">
                            <button
                                onClick={() => setActiveTab('search')}
                                className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                                    activeTab === 'search'
                                        ? 'bg-blue-600 text-white'
                                        : isLightMode ? 'text-slate-700 hover:bg-gray-100' : 'text-gray-400 hover:bg-gray-800'
                                }`}
                            >
                                 Quick Search
                            </button>
                            <button
                                onClick={() => setActiveTab('resumes')}
                                className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                                    activeTab === 'resumes'
                                        ? 'bg-blue-600 text-white'
                                        : isLightMode ? 'text-slate-700 hover:bg-gray-100' : 'text-gray-400 hover:bg-gray-800'
                                }`}
                            >
                                 Personalized Jobs
                            </button>
                            <button
                                onClick={() => setActiveTab('results')}
                                className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                                    activeTab === 'results'
                                        ? 'bg-blue-600 text-white'
                                        : isLightMode ? 'text-slate-700 hover:bg-gray-100' : 'text-gray-400 hover:bg-gray-800'
                                }`}
                            >
                                 Search History{jobResults.length > 0 ? ` (${jobResults.length})` : ''}
                            </button>
                            <button
                                onClick={() => setActiveTab('resume-results')}
                                className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                                    activeTab === 'resume-results'
                                        ? 'bg-blue-600 text-white'
                                        : isLightMode ? 'text-slate-700 hover:bg-gray-100' : 'text-gray-400 hover:bg-gray-800'
                                }`}
                            >
                                 Personalized Jobs History{personalizedJobResults.length > 0 ? ` (${personalizedJobResults.length})` : ''}
                            </button>
                        </div>
                    </div>

                    {/* Quick Search Tab */}
                    {activeTab === 'search' && (
                        <div className="space-y-8">
                            {/* Search Header */}
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8 relative z-10`}>
                                <h2 className="text-3xl font-bold text-slate-800 mb-2">Find Your Dream Job</h2>
                                <p className="text-slate-600 mb-8">Enter your job title and location to get AI-powered job recommendations</p>
                                
                                {/* Search Form */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div className="md:col-span-2 relative job-title-suggestions-container">
                                        <label className="block text-sm font-semibold text-slate-700 mb-2">Job Title</label>
                                        <div className="relative">
                                            <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                                                
                                            </span>
                                            <input
                                                type="text"
                                                value={quickSearchJobTitle}
                                                onChange={(e) => handleJobTitleChange(e.target.value)}
                                                onFocus={() => quickSearchJobTitle.trim() && setShowJobTitleSuggestions(true)}
                                                placeholder="e.g., Software Engineer, Product Manager, Data Scientist"
                                                className="w-full pl-10 pr-8 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 placeholder-slate-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none transition-all duration-300"
                                            />
                                            {quickSearchJobTitle && (
                                                <button
                                                    onClick={() => {
                                                        setQuickSearchJobTitle('');
                                                        setShowJobTitleSuggestions(false);
                                                        setJobTitleSuggestions([]);
                                                    }}
                                                    className="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600"
                                                >
                                                    
                                                </button>
                                            )}
                                        </div>
                                        
                                        {/* Job Title Suggestions Dropdown */}
                                        {showJobTitleSuggestions && jobTitleSuggestions.length > 0 && (
                                            <div className="absolute z-[9999] w-full mt-1 bg-white border border-slate-300 rounded-xl shadow-2xl max-h-60 overflow-y-auto">
                                                {jobTitleSuggestions.map((suggestion, index) => (
                                                    <button
                                                        key={index}
                                                        onClick={() => handleSelectJobTitle(suggestion)}
                                                        className="w-full px-4 py-3 text-left text-slate-800 hover:bg-blue-50 transition-colors border-b border-slate-100 last:border-b-0"
                                                    >
                                                        {suggestion}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    <div className="relative">
                                        <label className="block text-sm font-semibold text-slate-700 mb-2">Location (Optional)</label>
                                        <div className="relative location-suggestions-container">
                                            <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                                                
                                            </span>
                                            <input
                                                type="text"
                                                value={quickSearchLocation}
                                                onChange={(e) => handleLocationChange(e.target.value)}
                                                onFocus={() => quickSearchLocation.trim() && setShowLocationSuggestions(true)}
                                                placeholder="City, State"
                                                className="w-full pl-10 pr-8 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 placeholder-slate-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none transition-all duration-300"
                                            />
                                            {quickSearchLocation && (
                                                <button
                                                    onClick={() => {
                                                        setQuickSearchLocation('');
                                                        setShowLocationSuggestions(false);
                                                        setLocationSuggestions([]);
                                                    }}
                                                    className="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600"
                                                >
                                                    
                                                </button>
                                            )}
                                        </div>
                                        
                                        {/* Location Suggestions Dropdown */}
                                        {showLocationSuggestions && locationSuggestions.length > 0 && (
                                            <div className="absolute z-[9999] w-full mt-1 bg-white border border-slate-300 rounded-xl shadow-2xl max-h-60 overflow-y-auto">
                                                {locationSuggestions.map((suggestion, index) => (
                                                    <button
                                                        key={index}
                                                        onClick={() => handleSelectLocation(suggestion)}
                                                        className="w-full px-4 py-3 text-left text-slate-800 hover:bg-blue-50 transition-colors border-b border-slate-100 last:border-b-0"
                                                    >
                                                        {suggestion}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <button
                                    onClick={handleQuickSearch}
                                    disabled={!quickSearchJobTitle.trim() || isSearching}
                                    className={`w-full px-6 py-4 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-3 ${
                                        quickSearchJobTitle.trim() && !isSearching
                                            ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600'
                                            : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                    }`}
                                >
                                    {isSearching ? (
                                        <>
                                            <div className="w-5 h-5 animate-spin"></div>
                                            Searching for jobs...
                                        </>
                                    ) : (
                                        <>
                                            <div className="w-5 h-5"></div>
                                            Search Jobs
                                        </>
                                    )}
                                </button>
                                
                                {/* Filter Buttons */}
                                <div className="mt-6 flex flex-wrap gap-3">
                                    {/* Date Posted Filter */}
                                    <div className="relative filter-dropdown-container">
                                        <button
                                            onClick={() => handleToggleFilter('datePosted')}
                                            className={`px-4 py-2 rounded-lg border text-sm font-medium transition-colors ${
                                                filters.datePosted !== 'Any time' 
                                                    ? 'bg-blue-50 border-blue-500 text-blue-700'
                                                    : 'bg-white border-gray-300 text-gray-700 hover:border-gray-400'
                                            }`}
                                        >
                                            Date posted <span className="ml-1"></span>
                                        </button>
                                        
                                        {showFilterDropdown.datePosted && (
                                            <div className="absolute z-[9999] top-full left-0 mt-1 w-48 bg-white border border-gray-300 rounded-lg shadow-xl max-h-60 overflow-y-auto">
                                                {['Any time', 'Past 24 hours', 'Past week', 'Past month', 'Past 3 months'].map((option) => (
                                                    <button
                                                        key={option}
                                                        onClick={() => handleSelectFilter('datePosted', option)}
                                                        className={`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 transition-colors ${
                                                            filters.datePosted === option ? 'bg-blue-50 text-blue-700 font-medium' : 'text-gray-700'
                                                        }`}
                                                    >
                                                        {option}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Experience Level Filter */}
                                    <div className="relative filter-dropdown-container">
                                        <button
                                            onClick={() => handleToggleFilter('experienceLevel')}
                                            className={`px-4 py-2 rounded-lg border text-sm font-medium transition-colors ${
                                                filters.experienceLevel !== 'Any level' 
                                                    ? 'bg-blue-50 border-blue-500 text-blue-700'
                                                    : 'bg-white border-gray-300 text-gray-700 hover:border-gray-400'
                                            }`}
                                        >
                                            Experience level <span className="ml-1"></span>
                                        </button>
                                        
                                        {showFilterDropdown.experienceLevel && (
                                            <div className="absolute z-[9999] top-full left-0 mt-1 w-48 bg-white border border-gray-300 rounded-lg shadow-xl max-h-60 overflow-y-auto">
                                                {['Any level', 'Intern', 'Entry level', 'Mid-Senior level', 'Associate', 'Executive', 'Director'].map((option) => (
                                                    <button
                                                        key={option}
                                                        onClick={() => handleSelectFilter('experienceLevel', option)}
                                                        className={`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 transition-colors ${
                                                            filters.experienceLevel === option ? 'bg-blue-50 text-blue-700 font-medium' : 'text-gray-700'
                                                        }`}
                                                    >
                                                        {option}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Remote Filter */}
                                    <div className="relative filter-dropdown-container">
                                        <button
                                            onClick={() => handleToggleFilter('remote')}
                                            className={`px-4 py-2 rounded-lg border text-sm font-medium transition-colors ${
                                                filters.remote !== 'Any' 
                                                    ? 'bg-blue-50 border-blue-500 text-blue-700'
                                                    : 'bg-white border-gray-300 text-gray-700 hover:border-gray-400'
                                            }`}
                                        >
                                            Remote <span className="ml-1"></span>
                                        </button>
                                        
                                        {showFilterDropdown.remote && (
                                            <div className="absolute z-[9999] top-full left-0 mt-1 w-48 bg-white border border-gray-300 rounded-lg shadow-xl max-h-60 overflow-y-auto">
                                                {['Any', 'Remote', 'On-site', 'Hybrid'].map((option) => (
                                                    <button
                                                        key={option}
                                                        onClick={() => handleSelectFilter('remote', option)}
                                                        className={`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 transition-colors ${
                                                            filters.remote === option ? 'bg-blue-50 text-blue-700 font-medium' : 'text-gray-700'
                                                        }`}
                                                    >
                                                        {option}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* Salary Range Filter */}
                                    <div className="relative filter-dropdown-container">
                                        <button
                                            onClick={() => handleToggleFilter('salaryRange')}
                                            className={`px-4 py-2 rounded-lg border text-sm font-medium transition-colors ${
                                                filters.salaryRange !== 'Any' 
                                                    ? 'bg-blue-50 border-blue-500 text-blue-700'
                                                    : 'bg-white border-gray-300 text-gray-700 hover:border-gray-400'
                                            }`}
                                        >
                                            Salary Range <span className="ml-1"></span>
                                        </button>
                                        
                                        {showFilterDropdown.salaryRange && (
                                            <div className="absolute z-[9999] top-full left-0 mt-1 w-48 bg-white border border-gray-300 rounded-lg shadow-xl max-h-60 overflow-y-auto">
                                                {['Any', '$50k - $80k', '$80k - $120k', '$120k+', '$150k+'].map((option) => (
                                                    <button
                                                        key={option}
                                                        onClick={() => handleSelectFilter('salaryRange', option)}
                                                        className={`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 transition-colors ${
                                                            filters.salaryRange === option ? 'bg-blue-50 text-blue-700 font-medium' : 'text-gray-700'
                                                        }`}
                                                    >
                                                        {option}
                                                    </button>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                {/* Active Filters Display */}
                                {(filters.datePosted !== 'Any time' || filters.experienceLevel !== 'Any level' || filters.remote !== 'Any' || filters.salaryRange !== 'Any') && (
                                    <div className="mt-4 flex flex-wrap gap-2">
                                        <span className="text-sm text-slate-600 font-medium">Active filters:</span>
                                        {filters.datePosted !== 'Any time' && (
                                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium flex items-center gap-2">
                                                 {filters.datePosted}
                                                <button onClick={() => handleSelectFilter('datePosted', 'Any time')} className="hover:bg-blue-200 rounded-full"></button>
                                            </span>
                                        )}
                                        {filters.experienceLevel !== 'Any level' && (
                                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium flex items-center gap-2">
                                                 {filters.experienceLevel}
                                                <button onClick={() => handleSelectFilter('experienceLevel', 'Any level')} className="hover:bg-blue-200 rounded-full"></button>
                                            </span>
                                        )}
                                        {filters.remote !== 'Any' && (
                                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium flex items-center gap-2">
                                                 {filters.remote}
                                                <button onClick={() => handleSelectFilter('remote', 'Any')} className="hover:bg-blue-200 rounded-full"></button>
                                            </span>
                                        )}
                                        {filters.salaryRange !== 'Any' && (
                                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium flex items-center gap-2">
                                                 {filters.salaryRange}
                                                <button onClick={() => handleSelectFilter('salaryRange', 'Any')} className="hover:bg-blue-200 rounded-full"></button>
                                            </span>
                                        )}
                                        <button
                                            onClick={() => {
                                                setFilters({ datePosted: 'Any time', experienceLevel: 'Any level', remote: 'Any', salaryRange: 'Any' });
                                            }}
                                            className="px-3 py-1 text-red-600 hover:bg-red-50 rounded-full text-xs font-medium"
                                        >
                                            Clear all
                                        </button>
                                    </div>
                                )}
                                
                                {resumeData && (
                                    <div className="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
                                        <div className="flex items-center gap-3">
                                            <div className="w-5 h-5 text-blue-600"></div>
                                            <p className="text-sm text-blue-700">
                                                <strong>Resume detected!</strong> We'll match jobs to your skills and experience for better results.
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            {/* Job Results Display */}
                            {jobResults.length > 0 && (
                                <div className="mt-6">
                                    <div className="flex items-center justify-between mb-4 flex-wrap gap-3">
                                        <h3 className="text-xl font-bold text-slate-800"> Search Results ({jobResults.length})</h3>
                                        <div className="flex items-center gap-2 flex-wrap">
                                            <button
                                                onClick={() => handleBulkTrackHighMatches(jobResults, 80)}
                                                className="px-4 py-2 bg-purple-100 text-purple-700 rounded-lg font-medium hover:bg-purple-200 transition-colors flex items-center gap-2 text-sm"
                                                title="Track all jobs with 80%+ match score"
                                            >
                                                 Track All High Matches (80%+)
                                            </button>
                                        <button
                                            onClick={() => {
                                                const csv = jobResults.map(job => 
                                                    `"${job.title}","${job.company}","${job.location}","${job.salary}","${job.type}","${job.url}"`
                                                ).join('\n');
                                                const csvContent = 'data:text/csv;charset=utf-8,' + encodeURIComponent('Title,Company,Location,Salary,Type,URL\n' + csv);
                                                const link = document.createElement('a');
                                                link.href = csvContent;
                                                link.download = `job-search-results-${Date.now()}.csv`;
                                                link.click();
                                            }}
                                            className="px-4 py-2 bg-green-100 text-green-700 rounded-lg font-medium hover:bg-green-200 transition-colors flex items-center gap-2 text-sm"
                                        >
                                             Export CSV
                                        </button>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {jobResults.map((job, index) => (
                                            <div key={index} className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6 hover:shadow-lg transition-all`}>
                                                <div className="flex items-start justify-between">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-3">
                                                            <h3 className="text-xl font-bold text-slate-800">{job.title}</h3>
                                                            {job.matchScore && (
                                                                <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getMatchScoreColor(job.matchScore)}`}>
                                                                    {job.matchScore}% match
                                                                </span>
                                                            )}
                                                        </div>
                                                        
                                                        <div className="flex items-center gap-6 text-sm text-slate-600 mb-4">
                                                            <span className="flex items-center gap-1">
                                                                 {job.company}
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                 {job.location}
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                 {job.salary}
                                                            </span>
                                                            <span className="flex items-center gap-1">
                                                                 {job.postedDate}
                                                            </span>
                                                        </div>
                                                        
                                                        <p className="text-slate-700 mb-4">{job.description}</p>
                                                        
                                                        {job.whyMatch && (
                                                            <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                                                <p className="text-sm text-blue-700">
                                                                    <strong>Why this matches:</strong> {job.whyMatch}
                                                                </p>
                                                            </div>
                                                        )}

                                                       {/* Tracked Status Indicator */}
                                                       {(() => {
                                                           const trackedStatus = getTrackedJobStatus(job);
                                                           return trackedStatus ? (
                                                               <div className="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                                                                   <p className="text-sm text-green-700 font-medium">
                                                                        {trackedStatus.label}
                                                                   </p>
                                                               </div>
                                                           ) : null;
                                                       })()}

                                                       <div className="flex flex-wrap gap-2 mt-2">
                                                            {isJobTracked(job) ? (
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        const trackerLink = document.querySelector('[data-id="job-tracker"]');
                                                                        if (trackerLink) {
                                                                            window.JobTrackingUtils.showNotification('Opening Job Tracker...', 'info');
                                                                            trackerLink.click();
                                                                        }
                                                                    }}
                                                                    className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-semibold hover:bg-indigo-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                >
                                                                     View in Tracker
                                                                </button>
                                                            ) : (
                                                                <>
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            handleTrackJob(job, 'job-finder');
                                                                        }}
                                                                        className="px-4 py-2 bg-purple-100 text-purple-700 rounded-xl font-semibold hover:bg-purple-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                    >
                                                                         Track This Job
                                                                    </button>
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            handleApplyAndTrack(job);
                                                                        }}
                                                                        className="px-4 py-2 bg-green-100 text-green-700 rounded-xl font-semibold hover:bg-green-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                    >
                                                                         Apply & Track
                                                                    </button>
                                                                </>
                                                            )}
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handleOpenJobDetails(job);
                                                                }}
                                                                className="px-4 py-2 bg-blue-100 text-blue-700 rounded-xl font-semibold hover:bg-blue-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                            >
                                                                 View Details
                                                            </button>
                                                            <button
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    handleTailorResume(job);
                                                                }}
                                                                className="px-4 py-2 bg-purple-100 text-purple-700 rounded-xl font-semibold hover:bg-purple-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                            >
                                                                 Tailor Resume
                                                            </button>
                                                            <a
                                                                href={job.url}
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                onClick={(e) => e.stopPropagation()}
                                                                className="px-4 py-2 bg-green-100 text-green-700 rounded-xl font-semibold hover:bg-green-200 transition-all text-center whitespace-nowrap"
                                                            >
                                                                Apply Now 
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                            
                            {/* How It Works - Only show when no results */}
                            {jobResults.length === 0 && (
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 relative z-0">
                                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                        <div className="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4">
                                            <div className="w-6 h-6 text-blue-600 text-2xl"></div>
                                        </div>
                                        <h3 className="text-lg font-bold text-slate-800 mb-2">AI Search</h3>
                                        <p className="text-sm text-slate-600">Our AI searches across multiple job boards and generates realistic job listings</p>
                                    </div>
                                    
                                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                        <div className="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mb-4">
                                            <div className="w-6 h-6 text-green-600 text-2xl"></div>
                                        </div>
                                        <h3 className="text-lg font-bold text-slate-800 mb-2">Smart Matching</h3>
                                        <p className="text-sm text-slate-600">Jobs are matched against your resume to show relevance and fit</p>
                                    </div>
                                    
                                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                        <div className="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4">
                                            <div className="w-6 h-6 text-purple-600 text-2xl"></div>
                                        </div>
                                        <h3 className="text-lg font-bold text-slate-800 mb-2">Quick Actions</h3>
                                        <p className="text-sm text-slate-600">Tailor your resume or generate a cover letter with one click</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Search History Tab */}
                    {activeTab === 'results' && (
                        <div className="space-y-6">
                            {jobResults.length > 0 && (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold text-slate-800 mb-2"> Search History ({jobResults.length})</h2>
                                            <p className="text-slate-600">Searching for: "{quickSearchJobTitle}"</p>
                                        </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => {
                                                    const csv = jobResults.map(job => 
                                                        `"${job.title}","${job.company}","${job.location}","${job.salary}","${job.type}","${job.url}"`
                                                    ).join('\n');
                                                    const csvContent = 'data:text/csv;charset=utf-8,' + encodeURIComponent('Title,Company,Location,Salary,Type,URL\n' + csv);
                                                    const link = document.createElement('a');
                                                    link.href = csvContent;
                                                    link.download = `job-search-results-${Date.now()}.csv`;
                                                    link.click();
                                                }}
                                                className="px-4 py-2 bg-green-100 text-green-700 rounded-xl font-medium hover:bg-green-200 transition-colors flex items-center gap-2"
                                            >
                                                 Export CSV
                                            </button>
                                            <button
                                                onClick={() => setActiveTab('search')}
                                                className="px-4 py-2 bg-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-300 transition-colors"
                                            >
                                                 New Search
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* Job Results */}
                            {jobResults.length > 0 ? (
                                <div className="space-y-4">
                                    {jobResults.map((job, index) => (
                                    <div key={index} className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                        <div className="flex items-start justify-between">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-3 mb-3">
                                                    <h3 className="text-xl font-bold text-slate-800">{job.title}</h3>
                                                    {job.matchScore && (
                                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getMatchScoreColor(job.matchScore)}`}>
                                                            {job.matchScore}% match
                                                        </span>
                                                    )}
                                                </div>
                                                
                                                <div className="flex items-center gap-6 text-sm text-slate-600 mb-4">
                                                    <span className="flex items-center gap-1">
                                                         {job.company}
                                                    </span>
                                                    <span className="flex items-center gap-1">
                                                         {job.location}
                                                    </span>
                                                    <span className="flex items-center gap-1">
                                                         {job.salary}
                                                    </span>
                                                    <span className="flex items-center gap-1">
                                                         {job.postedDate}
                                                    </span>
                                                </div>
                                                
                                                <p className="text-slate-700 mb-4">{job.description}</p>
                                                
                                                {job.whyMatch && (
                                                    <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                                        <p className="text-sm text-blue-800">
                                                            <strong>Why this matches:</strong> {job.whyMatch}
                                                        </p>
                                                    </div>
                                                )}
                                                
                                               <div className="flex flex-wrap gap-2 mt-2">
                                                    <button
                                                        onClick={() => handleOpenJobDetails(job)}
                                                        className="px-4 py-2 bg-blue-100 text-blue-700 rounded-xl font-semibold hover:bg-blue-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                    >
                                                         View Details
                                                    </button>
                                                    <button
                                                        onClick={() => handleTailorResume(job)}
                                                        className="px-4 py-2 bg-purple-100 text-purple-700 rounded-xl font-semibold hover:bg-purple-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                    >
                                                         Tailor Resume
                                                    </button>
                                                    <a
                                                        href={job.url}
                                                        target="_blank"
                                                        rel="noopener noreferrer"
                                                        className="px-4 py-2 bg-green-100 text-green-700 rounded-xl font-semibold hover:bg-green-200 transition-all text-center whitespace-nowrap"
                                                    >
                                                        Apply Now 
                                                    </a>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    ))}
                                </div>
                            ) : (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-12 text-center`}>
                                    <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <div className="w-8 h-8 text-slate-400 text-2xl"></div>
                                    </div>
                                    <h3 className="text-lg font-semibold text-slate-800 mb-2">No search history yet</h3>
                                    <p className="text-slate-600 mb-6">Your search results will appear here after you search for jobs</p>
                                    <button 
                                        onClick={() => setActiveTab('search')}
                                        className="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-indigo-600 transition-all duration-300"
                                    >
                                        Start Searching
                                    </button>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Personalized Jobs Tab */}
                    {activeTab === 'resumes' && (
                        <div className="space-y-6">
                            {/* Upload Section - Only show when no resumes uploaded */}
                            {Object.keys(uploadedResumes).length === 0 && (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h2 className="text-2xl font-bold text-slate-800 mb-4">Upload Your Resume</h2>
                                    <p className="text-slate-600 mb-6">Upload your CV/resume and get AI-powered job recommendations. We'll analyze your resume and match you with real job postings tailored to your skills and experience.</p>
                                    
                                    <div className="flex flex-col items-center">
                                        <label className="cursor-pointer">
                                            <input
                                                type="file"
                                                accept=".pdf,.docx,.txt"
                                                onChange={handleResumeUpload}
                                                className="hidden"
                                                id="resume-upload"
                                                disabled={isUploadingResume}
                                            />
                                            <div className={`px-6 py-3 rounded-xl font-semibold transition-all duration-300 flex items-center gap-2 ${
                                                isUploadingResume
                                                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                    : 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600'
                                            }`}>
                                                {isUploadingResume ? (
                                                    <>
                                                        <div className="w-5 h-5 animate-spin"></div>
                                                        Uploading...
                                                    </>
                                                ) : (
                                                    <>
                                                         Upload Resume
                                                    </>
                                                )}
                                            </div>
                                        </label>
                                        <span className="text-sm text-slate-600 mt-2">Supports PDF, DOCX, and TXT files</span>
                                    </div>
                                </div>
                            )}

                            {/* Uploaded Resumes */}
                            {Object.keys(uploadedResumes).length > 0 && (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h2 className="text-2xl font-bold text-slate-800 mb-4">Your Resumes</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                        {Object.entries(uploadedResumes).map(([name, data]) => (
                                            <div
                                                key={name}
                                                className={`p-4 rounded-xl border-2 transition-all cursor-pointer ${
                                                    activeResume === name
                                                        ? 'border-blue-500 bg-blue-50'
                                                        : isLightMode ? 'border-slate-200 bg-slate-50' : 'border-gray-700 bg-gray-800'
                                                }`}
                                                onClick={() => handleSelectResume(name)}
                                            >
                                                <div className="flex items-start justify-between mb-2">
                                                    <div className="flex items-start gap-3">
                                                        <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                                            <span className="text-xl"></span>
                                                        </div>
                                                        <div className="flex-1">
                                                            <h3 className="font-semibold text-slate-800 truncate">{name}</h3>
                                                            {activeResume === name && (
                                                                <span className="inline-block mt-1 px-2 py-0.5 bg-blue-500 text-white text-xs rounded-full">Active</span>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            handleDeleteResume(name);
                                                        }}
                                                        className="text-red-500 hover:text-red-700 text-lg font-bold px-2"
                                                    >
                                                        
                                                    </button>
                                                </div>
                                                {data.skills?.technical && (
                                                    <div className="mt-3 flex flex-wrap gap-1">
                                                        {data.skills.technical.slice(0, 3).map((skill, idx) => (
                                                            <span key={idx} className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded">
                                                                {skill}
                                                            </span>
                                                        ))}
                                                        {data.skills.technical.length > 3 && (
                                                            <span className="text-xs text-slate-500">+{data.skills.technical.length - 3} more</span>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Filter & Search Section */}
                            {activeResume && uploadedResumes[activeResume] && (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h2 className="text-2xl font-bold text-slate-800 mb-4">Customize Your Job Search</h2>
                                    <p className="text-slate-600 mb-6">Narrow down your job search based on your preferences</p>
                                    
                                    {/* Search Strategy Buttons */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-semibold text-slate-700 mb-3">
                                            Search jobs based on
                                        </label>
                                        <div className="flex flex-wrap gap-3">
                                            {[
                                                { id: 'background', label: 'Your Background' },
                                                { id: 'career_progression', label: 'Next Career Progression' },
                                                { id: 'skill_based', label: 'Skill-Based Match' },
                                                { id: 'passion_based', label: 'Passion or Interest-Based' },
                                                { id: 'industry_switch', label: 'Industry Switch' }
                                            ].map(strategy => (
                                                <button
                                                    key={strategy.id}
                                                onClick={() => {
                                                    setSelectedSearchStrategy(
                                                        selectedSearchStrategy === strategy.id ? null : strategy.id
                                                    );
                                                    setAiReasoning(null); // Clear previous reasoning
                                                }}
                                                    disabled={isGeneratingQuery || isSearchingPersonalized}
                                                    className={`px-4 py-2 rounded-xl font-semibold transition-all duration-300 ${
                                                        selectedSearchStrategy === strategy.id
                                                            ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-lg ring-2 ring-blue-300'
                                                            : isLightMode 
                                                                ? 'bg-white/70 border border-slate-300 text-slate-700 hover:border-blue-500 hover:bg-blue-50'
                                                                : 'bg-gray-800 border border-gray-700 text-gray-300 hover:border-blue-500 hover:bg-gray-700'
                                                    } ${isGeneratingQuery || isSearchingPersonalized ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                >
                                                    {strategy.label}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    {/* Filters Grid */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                        {/* Work Type Filter */}
                                        <div className="relative filter-dropdown-container">
                                            <label className="block text-sm font-semibold text-slate-700 mb-2">Work Type</label>
                                            <div className="relative">
                                                <select
                                                    value={resumeFilters.workType}
                                                    onChange={(e) => setResumeFilters(prev => ({...prev, workType: e.target.value}))}
                                                    className="w-full px-4 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"
                                                >
                                                    <option>Full-time</option>
                                                    <option>Part-time</option>
                                                    <option>Contract</option>
                                                    <option>Internship</option>
                                                    <option>Any</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        {/* Remote/O Hybrid Filter */}
                                        <div className="relative filter-dropdown-container">
                                            <label className="block text-sm font-semibold text-slate-700 mb-2">Work Style</label>
                                            <div className="relative">
                                                <select
                                                    value={resumeFilters.remote}
                                                    onChange={(e) => setResumeFilters(prev => ({...prev, remote: e.target.value}))}
                                                    className="w-full px-4 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"
                                                >
                                                    <option>Any</option>
                                                    <option>Remote</option>
                                                    <option>Hybrid</option>
                                                    <option>On-site</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        {/* Experience Level Filter */}
                                        <div className="relative filter-dropdown-container">
                                            <label className="block text-sm font-semibold text-slate-700 mb-2">Experience Level</label>
                                            <div className="relative">
                                                <select
                                                    value={resumeFilters.experienceLevel}
                                                    onChange={(e) => setResumeFilters(prev => ({...prev, experienceLevel: e.target.value}))}
                                                    className="w-full px-4 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none"
                                                >
                                                    <option>Any level</option>
                                                    <option>Entry Level</option>
                                                    <option>Mid Level</option>
                                                    <option>Senior Level</option>
                                                    <option>Executive</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        {/* Location Filter */}
                                        <div className="relative location-suggestions-container">
                                            <label className="block text-sm font-semibold text-slate-700 mb-2">Location (Optional)</label>
                                            <div className="relative">
                                                <span className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400">
                                                    
                                                </span>
                                                <input
                                                    type="text"
                                                    value={resumeFilters.location}
                                                    onChange={(e) => handleResumeLocationChange(e.target.value)}
                                                    onFocus={() => resumeFilters.location.trim() && setShowResumeLocationSuggestions(true)}
                                                    placeholder="City, State"
                                                    className="w-full pl-10 pr-8 py-3 bg-white/70 border border-slate-300 rounded-xl text-slate-800 placeholder-slate-500 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none transition-all duration-300"
                                                />
                                                {resumeFilters.location && (
                                                    <button
                                                        onClick={() => {
                                                            setResumeFilters(prev => ({...prev, location: ''}));
                                                            setShowResumeLocationSuggestions(false);
                                                            setResumeLocationSuggestions([]);
                                                        }}
                                                        className="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600"
                                                    >
                                                        
                                                    </button>
                                                )}
                                            </div>
                                            
                                            {/* Location Suggestions Dropdown */}
                                            {showResumeLocationSuggestions && resumeLocationSuggestions.length > 0 && (
                                                <div className="absolute z-[9999] w-full mt-1 bg-white border border-slate-300 rounded-xl shadow-2xl max-h-60 overflow-y-auto">
                                                    {resumeLocationSuggestions.map((suggestion, index) => (
                                                        <button
                                                            key={index}
                                                            onClick={() => handleSelectResumeLocation(suggestion)}
                                                            className="w-full px-4 py-3 text-left text-slate-800 hover:bg-blue-50 transition-colors border-b border-slate-100 last:border-b-0"
                                                        >
                                                            {suggestion}
                                                        </button>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* Search Button */}
                                    <button
                                        onClick={() => handlePersonalizedSearch(selectedSearchStrategy || null)}
                                        disabled={isSearchingPersonalized || isGeneratingQuery}
                                        className={`w-full px-6 py-4 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-3 ${
                                            !isSearchingPersonalized && !isGeneratingQuery
                                                ? 'bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600'
                                                : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                        }`}
                                    >
                                        {isGeneratingQuery ? (
                                            <>
                                                <div className="w-5 h-5 animate-spin"></div>
                                                Generating search query...
                                            </>
                                        ) : isSearchingPersonalized ? (
                                            <>
                                                <div className="w-5 h-5 animate-spin"></div>
                                                Searching personalized jobs...
                                            </>
                                        ) : selectedSearchStrategy ? (
                                            <>
                                                <span className="text-xl"></span>
                                                Search with {getStrategyLabel(selectedSearchStrategy)}
                                            </>
                                        ) : (
                                            <>
                                                <span className="text-xl"></span>
                                                Search Personalized Jobs History
                                            </>
                                        )}
                                    </button>
                                    
                                    {/* AI Reasoning Section */}
                                    {aiReasoning && personalizedJobResults.length > 0 && selectedSearchStrategy && (
                                        <div className={`mt-6 ${isLightMode ? 'bg-blue-50/80 border-blue-200' : 'bg-blue-900/20 border-blue-800/50'} border rounded-xl p-6`}>
                                            <div className="flex items-start gap-4">
                                                <div className="flex-shrink-0 w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-lg">
                                                    
                                                </div>
                                                <div className="flex-1">
                                                    <h4 className="text-lg font-bold text-slate-800 mb-2">
                                                        How We Matched These Jobs
                                                    </h4>
                                                    <p className="text-slate-700 leading-relaxed whitespace-pre-line">
                                                        {aiReasoning}
                                                    </p>
                                                    <div className="mt-3 pt-3 border-t border-blue-200/50">
                                                        <p className="text-sm text-slate-600 italic">
                                                            Strategy: <span className="font-semibold">{getStrategyLabel(selectedSearchStrategy)}</span>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* Search Results Display */}
                                    {personalizedJobResults.length > 0 && (
                                        <div className="mt-6">
                                            <div className="flex items-center justify-between mb-4 flex-wrap gap-3">
                                                    <h3 className="text-xl font-bold text-slate-800">Found {personalizedJobResults.length} Jobs</h3>
                                                <div className="flex items-center gap-2 flex-wrap">
                                                    <button
                                                        onClick={() => handleBulkTrackHighMatches(personalizedJobResults, 80)}
                                                        className="px-4 py-2 bg-purple-100 text-purple-700 rounded-lg font-medium hover:bg-purple-200 transition-colors flex items-center gap-2 text-sm"
                                                        title="Track all jobs with 80%+ match score"
                                                    >
                                                         Track All High Matches (80%+)
                                                    </button>
                                                <button
                                                    onClick={() => {
                                                        const csv = personalizedJobResults.map(job => 
                                                            `"${job.title}","${job.company}","${job.location}","${job.salary}","${job.type}","${job.url}"`
                                                        ).join('\n');
                                                        const csvContent = 'data:text/csv;charset=utf-8,' + encodeURIComponent('Title,Company,Location,Salary,Type,URL\n' + csv);
                                                        const link = document.createElement('a');
                                                        link.href = csvContent;
                                                        link.download = `personalized-job-results-${Date.now()}.csv`;
                                                        link.click();
                                                    }}
                                                    className="px-4 py-2 bg-green-100 text-green-700 rounded-lg font-medium hover:bg-green-200 transition-colors flex items-center gap-2 text-sm"
                                                >
                                                     Export CSV
                                                </button>
                                                </div>
                                            </div>
                                            
                                            <div className="space-y-4">
                                                {personalizedJobResults.map((job, index) => (
                                                    <div key={index} className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6 hover:shadow-lg transition-all`}>
                                                        <div className="flex items-start justify-between">
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-3 mb-3">
                                                                    <h3 className="text-xl font-bold text-slate-800">{job.title}</h3>
                                                                    {job.matchScore && (
                                                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getMatchScoreColor(job.matchScore)}`}>
                                                                            {job.matchScore}% match
                                                                        </span>
                                                                    )}
                                                                </div>
                                                                
                                                                <div className="flex items-center gap-6 text-sm text-slate-600 mb-4">
                                                                    <span className="flex items-center gap-1">
                                                                         {job.company}
                                                                    </span>
                                                                    <span className="flex items-center gap-1">
                                                                         {job.location}
                                                                    </span>
                                                                    <span className="flex items-center gap-1">
                                                                         {job.salary}
                                                                    </span>
                                                                    <span className="flex items-center gap-1">
                                                                         {job.postedDate}
                                                                    </span>
                                                                </div>
                                                                
                                                                <p className="text-slate-700 mb-4">{job.description}</p>
                                                                
                                                                {job.whyMatch && (
                                                                    <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                                                        <p className="text-sm text-blue-700">
                                                                            <strong>Why this matches:</strong> {job.whyMatch}
                                                                        </p>
                                                                    </div>
                                                                )}

                                                               {/* Tracked Status Indicator */}
                                                               {(() => {
                                                                   const trackedStatus = getTrackedJobStatus(job);
                                                                   return trackedStatus ? (
                                                                       <div className="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                                                                           <p className="text-sm text-green-700 font-medium">
                                                                                {trackedStatus.label}
                                                                           </p>
                                                                       </div>
                                                                   ) : null;
                                                               })()}

                                                               <div className="flex flex-wrap gap-2 mt-2">
                                                                    {isJobTracked(job) ? (
                                                                        <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                const trackerLink = document.querySelector('[data-id="job-tracker"]');
                                                                                if (trackerLink) {
                                                                                    window.JobTrackingUtils.showNotification('Opening Job Tracker...', 'info');
                                                                                    trackerLink.click();
                                                                                }
                                                                            }}
                                                                            className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-xl font-semibold hover:bg-indigo-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                        >
                                                                             View in Tracker
                                                                        </button>
                                                                    ) : (
                                                                        <>
                                                                            <button
                                                                                onClick={(e) => {
                                                                                    e.stopPropagation();
                                                                                    handleTrackJob(job, 'job-finder');
                                                                                }}
                                                                                className="px-4 py-2 bg-purple-100 text-purple-700 rounded-xl font-semibold hover:bg-purple-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                            >
                                                                                 Track This Job
                                                                            </button>
                                                                            <button
                                                                                onClick={(e) => {
                                                                                    e.stopPropagation();
                                                                                    handleApplyAndTrack(job);
                                                                                }}
                                                                                className="px-4 py-2 bg-green-100 text-green-700 rounded-xl font-semibold hover:bg-green-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                            >
                                                                                 Apply & Track
                                                                            </button>
                                                                        </>
                                                                    )}
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            handleOpenJobDetails(job);
                                                                        }}
                                                                        className="px-4 py-2 bg-blue-100 text-blue-700 rounded-xl font-semibold hover:bg-blue-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                    >
                                                                         View Details
                                                                    </button>
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            handleTailorResume(job);
                                                                        }}
                                                                        className="px-4 py-2 bg-purple-100 text-purple-700 rounded-xl font-semibold hover:bg-purple-200 transition-all whitespace-nowrap flex items-center gap-1"
                                                                    >
                                                                         Tailor Resume
                                                                    </button>
                                                                    <a
                                                                        href={job.url}
                                                                        target="_blank"
                                                                        rel="noopener noreferrer"
                                                                        onClick={(e) => e.stopPropagation()}
                                                                        className="px-4 py-2 bg-green-100 text-green-700 rounded-xl font-semibold hover:bg-green-200 transition-all text-center whitespace-nowrap"
                                                                    >
                                                                        Apply Now 
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Empty State */}
                            {Object.keys(uploadedResumes).length === 0 && (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-12 text-center`}>
                                    <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <span className="text-2xl"></span>
                                    </div>
                                    <h3 className="text-lg font-semibold text-slate-800 mb-2">No resumes uploaded yet</h3>
                                    <p className="text-slate-600 mb-6">Upload your resume to get real job recommendations based on your skills and experience</p>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Personalized Results Tab */}
                    {activeTab === 'resume-results' && (
                        <div className="space-y-6">
                            {personalizedJobResults.length > 0 && (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <div>
                                            <h2 className="text-2xl font-bold text-slate-800 mb-2">Found {personalizedJobResults.length} Personalized Jobs History</h2>
                                            <p className="text-slate-600">Based on your resume and selected filters</p>
                                        </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => setActiveTab('resumes')}
                                                className="px-4 py-2 bg-slate-200 text-slate-700 rounded-xl font-medium hover:bg-slate-300 transition-colors"
                                            >
                                                 New Search
                                            </button>
                                            <button
                                                onClick={() => {
                                                    const csv = personalizedJobResults.map(job => 
                                                        `"${job.title}","${job.company}","${job.location}","${job.salary}","${job.type}","${job.url}"`
                                                    ).join('\n');
                                                    const csvContent = 'data:text/csv;charset=utf-8,' + encodeURIComponent('Title,Company,Location,Salary,Type,URL\n' + csv);
                                                    const link = document.createElement('a');
                                                    link.href = csvContent;
                                                    link.download = `personalized-job-results-${Date.now()}.csv`;
                                                    link.click();
                                                }}
                                                className="px-4 py-2 bg-green-100 text-green-700 rounded-xl font-medium hover:bg-green-200 transition-colors flex items-center gap-2"
                                            >
                                                 Export CSV
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* Job Results */}
                            {personalizedJobResults.length > 0 ? (
                                <div className="space-y-4">
                                    {personalizedJobResults.map((job, index) => (
                                    <div key={index} className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6 hover:shadow-lg transition-all cursor-pointer`}
                                         onClick={() => {
                                             setSelectedJob(job);
                                             setShowJobModal(true);
                                         }}>
                                        <div className="flex items-start justify-between">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-3 mb-3">
                                                    <h3 className="text-xl font-bold text-slate-800">{job.title}</h3>
                                                    {job.matchScore && (
                                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${getMatchScoreColor(job.matchScore)}`}>
                                                            {job.matchScore}% match
                                                        </span>
                                                    )}
                                                </div>
                                                
                                                <div className="flex items-center gap-6 text-sm text-slate-600 mb-4">
                                                    <span className="flex items-center gap-1">
                                                         {job.company}
                                                    </span>
                                                    <span className="flex items-center gap-1">
                                                         {job.location}
                                                    </span>
                                                    <span className="flex items-center gap-1">
                                                         {job.salary}
                                                    </span>
                                                    <span className="flex items-center gap-1">
                                                         {job.postedDate}
                                                    </span>
                                                </div>
                                                
                                                <p className="text-slate-700 line-clamp-2">{job.description}</p>
                                                
                                                {job.whyMatch && (
                                                    <div className="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                                        <p className="text-sm text-blue-700"> {job.whyMatch}</p>
                                                    </div>
                                                )}
                                            </div>
                                            
                                           <div className="ml-4"></div>
                                        </div>
                                    </div>
                                    ))}
                                </div>
                            ) : (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-12 text-center`}>
                                    <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <div className="w-8 h-8 text-slate-400 text-2xl"></div>
                                    </div>
                                    <h3 className="text-lg font-semibold text-slate-800 mb-2">No personalized job history yet</h3>
                                    <p className="text-slate-600 mb-6">Your personalized job results will appear here after you search</p>
                                    <button 
                                        onClick={() => setActiveTab('resumes')}
                                        className="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-indigo-600 transition-all duration-300"
                                    >
                                        Search Personalized Jobs History
                                    </button>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Job Details Modal */}
                    {showJobModal && selectedJob && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4" style={{paddingTop: '120px', paddingBottom: '40px', backgroundColor: 'rgba(240, 243, 254, 0.8)', backdropFilter: 'blur(8px)'}}>
                            <div className={`${isLightMode ? 'bg-white' : 'bg-slate-900'} w-full max-w-2xl shadow-2xl max-h-[80vh] flex flex-col`} style={{borderRadius: '0.75rem', overflow: 'hidden'}}>
                                <div className="overflow-y-auto flex-1">
                                    <div className="p-5 border-b border-slate-200 flex items-center justify-between">
                                    <h2 className="text-xl font-bold text-slate-800">{selectedJob.title}</h2>
                                    <button
                                        onClick={() => {
                                            setShowJobModal(false);
                                            setCompanyDetails(null);
                                            setCompanyReviews([]);
                                            setCompanyInterviews([]);
                                        }}
                                        className="p-2 hover:bg-slate-100 rounded-lg transition-colors"
                                    >
                                        
                                    </button>
                                </div>
                                
                                <div className="p-5 space-y-5">
                                    {/* Key Information Grid */}
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div>
                                            <p className="text-sm text-slate-600 mb-1">Company</p>
                                            <p className="font-semibold text-slate-800">{selectedJob.company}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-slate-600 mb-1">Location</p>
                                            <p className="font-semibold text-slate-800">{selectedJob.location || 'Not specified'}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-slate-600 mb-1">Salary</p>
                                            <p className="font-semibold text-slate-800">{selectedJob.salary || 'Not disclosed'}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-slate-600 mb-1">Posted</p>
                                            <p className="font-semibold text-slate-800">{selectedJob.postedDate || 'Recently'}</p>
                                        </div>
                                    </div>
                                    
                                    {/* Additional Job Details */}
                                    {(selectedJob.type || selectedJob.source) && (
                                        <div className="grid grid-cols-2 gap-4 pt-2 border-t border-slate-200">
                                            {selectedJob.type && (
                                    <div>
                                                    <p className="text-sm text-slate-600 mb-1">Employment Type</p>
                                                    <p className="font-semibold text-slate-800">{selectedJob.type}</p>
                                    </div>
                                            )}
                                            {selectedJob.source && (
                                    <div>
                                                    <p className="text-sm text-slate-600 mb-1">Source</p>
                                                    <p className="font-semibold text-slate-800">{selectedJob.source}</p>
                                    </div>
                                            )}
                                            {selectedJob.matchScore && (
                                                <div>
                                                    <p className="text-sm text-slate-600 mb-1">Match Score</p>
                                                    <p className={`font-semibold ${getMatchScoreColor(selectedJob.matchScore).split(' ')[0]}`}>
                                                        {selectedJob.matchScore}%
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                    
                                    {/* Job Description */}
                                    <div className="pt-4 border-t border-slate-200">
                                        <h3 className="font-bold text-lg text-slate-800 mb-3 flex items-center gap-2">
                                             Job Description
                                        </h3>
                                        <div className={`${isLightMode ? 'bg-slate-50' : 'bg-slate-800'} rounded-lg p-4`}>
                                            <p className="text-slate-700 whitespace-pre-wrap leading-relaxed">{selectedJob.description || 'No description available.'}</p>
                                        </div>
                                    </div>
                                    
                                    {/* Requirements */}
                                    {selectedJob.requirements && (
                                        <div className="pt-4 border-t border-slate-200">
                                            <h3 className="font-bold text-lg text-slate-800 mb-3 flex items-center gap-2">
                                                 Requirements
                                            </h3>
                                            <div className={`${isLightMode ? 'bg-slate-50' : 'bg-slate-800'} rounded-lg p-4`}>
                                                <p className="text-slate-700 leading-relaxed">{selectedJob.requirements}</p>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {selectedJob.whyMatch && (
                                        <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                            <h3 className="font-bold text-blue-800 mb-2">Why This Matches</h3>
                                            <p className="text-blue-700">{selectedJob.whyMatch}</p>
                                        </div>
                                    )}
                                    
                                    {/* Company Insights */}
                                    <div className="p-4 bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-lg">
                                        <h3 className="font-bold text-lg text-slate-800 mb-3 flex items-center gap-2">
                                             Company Insights
                                        </h3>
                                        <p className="text-slate-700 text-sm mb-4">
                                            Learn more about <strong>{selectedJob.company}</strong> including company culture, employee reviews, salary information, and interview experiences.
                                        </p>
                                        
                                        {/* Quick Stats */}
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3 mb-4">
                                            <div className="bg-white rounded-lg p-3 border border-blue-100">
                                                <p className="text-xs text-slate-600 mb-1">Company Rating</p>
                                                <p className="text-lg font-bold text-blue-600">
                                                    {companyDetails ? `${companyDetails.rating.toFixed(1)} ` : 'N/A'}
                                                </p>
                                            </div>
                                            <div className="bg-white rounded-lg p-3 border border-blue-100">
                                                <p className="text-xs text-slate-600 mb-1">Reviews</p>
                                                <p className="text-lg font-bold text-blue-600">
                                                    {companyDetails ? `${(companyDetails.review_count / 1000).toFixed(0)}K+` : 'N/A'}
                                                </p>
                                            </div>
                                            <div className="bg-white rounded-lg p-3 border border-blue-100">
                                                <p className="text-xs text-slate-600 mb-1">Salaries</p>
                                                <p className="text-lg font-bold text-blue-600">
                                                    {companyDetails ? `${(companyDetails.salary_count / 1000).toFixed(0)}K+` : 'N/A'}
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <p className="text-slate-600 text-xs mb-3 italic">
                                             Tip: Use company insights to better understand the work environment and prepare for interviews.
                                        </p>

                                        <details className="mb-3">
                                            <summary className="cursor-pointer text-slate-800 font-semibold hover:text-blue-600 transition-colors">
                                                 Company Details
                                            </summary>
                                            {isLoadingCompanyData ? (
                                                <div className="mt-3 p-4 bg-white rounded-lg border border-slate-200 text-center">
                                                    <div className="inline-block animate-spin text-blue-600 text-xl"></div>
                                                    <p className="mt-2 text-slate-600 text-sm">Loading company information...</p>
                                                </div>
                                            ) : companyDetails ? (
                                                <div className="mt-3 bg-white rounded-lg border border-slate-200 p-4 space-y-4">
                                                    {/* Company Overview */}
                                                    <div className="grid grid-cols-2 gap-4 pb-4 border-b border-slate-200">
                                                        <div>
                                                            <p className="text-xs text-slate-600 mb-1">Industry</p>
                                                            <p className="font-semibold text-slate-800">{companyDetails.industry}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-slate-600 mb-1">Company Size</p>
                                                            <p className="font-semibold text-slate-800">{companyDetails.company_size}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-slate-600 mb-1">Headquarters</p>
                                                            <p className="font-semibold text-slate-800">{companyDetails.headquarters_location}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-slate-600 mb-1">Founded</p>
                                                            <p className="font-semibold text-slate-800">{companyDetails.year_founded}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-slate-600 mb-1">Company Type</p>
                                                            <p className="font-semibold text-slate-800">{companyDetails.company_type}</p>
                                                        </div>
                                                        <div>
                                                            <p className="text-xs text-slate-600 mb-1">Revenue</p>
                                                            <p className="font-semibold text-slate-800">{companyDetails.revenue}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Company Description */}
                                                    <div>
                                                        <p className="text-xs text-slate-600 mb-2">About</p>
                                                        <p className="text-sm text-slate-700 leading-relaxed">{companyDetails.company_description}</p>
                                                    </div>
                                    
                                                    {/* Ratings Breakdown */}
                                                    <div className="pt-3 border-t border-slate-200">
                                                        <p className="text-xs text-slate-600 mb-3">Company Ratings</p>
                                                        <div className="space-y-2">
                                                            <div className="flex items-center justify-between">
                                                                <span className="text-sm text-slate-700">Compensation & Benefits</span>
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-24 h-2 bg-slate-200 rounded-full overflow-hidden">
                                                                        <div className="h-full bg-blue-500" style={{width: `${(companyDetails.compensation_and_benefits_rating / 5) * 100}%`}}></div>
                                                                    </div>
                                                                    <span className="text-sm font-semibold text-slate-800">{companyDetails.compensation_and_benefits_rating}/5.0</span>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center justify-between">
                                                                <span className="text-sm text-slate-700">Culture & Values</span>
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-24 h-2 bg-slate-200 rounded-full overflow-hidden">
                                                                        <div className="h-full bg-blue-500" style={{width: `${(companyDetails.culture_and_values_rating / 5) * 100}%`}}></div>
                                                                    </div>
                                                                    <span className="text-sm font-semibold text-slate-800">{companyDetails.culture_and_values_rating}/5.0</span>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center justify-between">
                                                                <span className="text-sm text-slate-700">Work-Life Balance</span>
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-24 h-2 bg-slate-200 rounded-full overflow-hidden">
                                                                        <div className="h-full bg-blue-500" style={{width: `${(companyDetails.work_life_balance_rating / 5) * 100}%`}}></div>
                                                                    </div>
                                                                    <span className="text-sm font-semibold text-slate-800">{companyDetails.work_life_balance_rating}/5.0</span>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center justify-between">
                                                                <span className="text-sm text-slate-700">Career Opportunities</span>
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-24 h-2 bg-slate-200 rounded-full overflow-hidden">
                                                                        <div className="h-full bg-blue-500" style={{width: `${(companyDetails.career_opportunities_rating / 5) * 100}%`}}></div>
                                                                    </div>
                                                                    <span className="text-sm font-semibold text-slate-800">{companyDetails.career_opportunities_rating}/5.0</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                    
                                                    {/* Links */}
                                                    {companyDetails.website && (
                                                        <div className="pt-3 border-t border-slate-200">
                                                            <a href={companyDetails.website} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                                                Visit Company Website 
                                                            </a>
                                                        </div>
                                                    )}
                                                </div>
                                            ) : (
                                                <div className="mt-3 p-4 bg-white rounded-lg border border-slate-200 text-center">
                                                    <p className="text-slate-600 text-sm">Company details not available</p>
                                                </div>
                                            )}
                                        </details>

                                        <details className="mb-3">
                                            <summary className="cursor-pointer text-slate-800 font-semibold hover:text-blue-600 transition-colors">
                                                 Company Reviews
                                                {companyDetails && (
                                                    <span className="ml-2 text-sm text-slate-600 font-normal">
                                                        ({companyDetails.review_count.toLocaleString()} reviews)
                                                    </span>
                                                )}
                                            </summary>
                                            {isLoadingCompanyData ? (
                                                <div className="mt-3 p-4 bg-white rounded-lg border border-slate-200 text-center">
                                                    <div className="inline-block animate-spin text-blue-600 text-xl"></div>
                                                    <p className="mt-2 text-slate-600 text-sm">Loading reviews...</p>
                                                </div>
                                            ) : companyReviews.length > 0 ? (
                                                <div className="mt-3 space-y-3">
                                                    {companyReviews.map((review, index) => (
                                                        <div key={index} className="bg-white rounded-lg border border-slate-200 p-4">
                                                            <div className="flex items-start justify-between mb-3">
                                                                <div>
                                                                    <div className="flex items-center gap-2 mb-1">
                                                                        <div className="flex items-center">
                                                                            {[...Array(5)].map((_, i) => (
                                                                                <span key={i} className={i < review.rating ? 'text-yellow-400' : 'text-slate-300'}>
                                                                                    
                                                                                </span>
                                                                            ))}
                                                                        </div>
                                                                        <span className="text-sm font-semibold text-slate-800">{review.rating}/5</span>
                                                                    </div>
                                                                    <p className="text-sm font-semibold text-slate-800">{review.summary}</p>
                                                                </div>
                                                                <span className="text-xs text-slate-500">
                                                                    {new Date(review.review_datetime).toLocaleDateString()}
                                                                </span>
                                                            </div>
                                                            
                                                            <div className="grid md:grid-cols-2 gap-3 mb-3">
                                                                <div className="bg-green-50 border border-green-200 rounded-lg p-3">
                                                                    <p className="text-xs font-semibold text-green-800 mb-1"> Pros</p>
                                                                    <p className="text-sm text-green-700">{review.pros}</p>
                                                                </div>
                                                                <div className="bg-red-50 border border-red-200 rounded-lg p-3">
                                                                    <p className="text-xs font-semibold text-red-800 mb-1"> Cons</p>
                                                                    <p className="text-sm text-red-700">{review.cons}</p>
                                                                </div>
                                                            </div>
                                                            
                                                            <div className="flex items-center gap-4 text-xs text-slate-600 pt-2 border-t border-slate-200">
                                                                <span>{review.job_title}</span>
                                                                {review.is_current_employee && (
                                                                    <span className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded-full">
                                                                        Current Employee
                                                                    </span>
                                                                )}
                                                                <span>{review.years_of_employment} {review.years_of_employment === 1 ? 'year' : 'years'}</span>
                                                                <span>{review.location}</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    {companyDetails && (
                                                        <div className="text-center pt-2">
                                                            <p className="text-xs text-slate-500">
                                                                Showing 3 of {companyDetails.review_count.toLocaleString()} reviews
                                                            </p>
                                                        </div>
                                                    )}
                                                </div>
                                            ) : (
                                                <div className="mt-3 p-4 bg-white rounded-lg border border-slate-200 text-center">
                                                    <p className="text-slate-600 text-sm">No reviews available</p>
                                                </div>
                                            )}
                                        </details>

                                        <details>
                                            <summary className="cursor-pointer text-slate-800 font-semibold hover:text-blue-600 transition-colors">
                                                 Interview Experiences
                                            </summary>
                                            {isLoadingCompanyData ? (
                                                <div className="mt-3 p-4 bg-white rounded-lg border border-slate-200 text-center">
                                                    <div className="inline-block animate-spin text-blue-600 text-xl"></div>
                                                    <p className="mt-2 text-slate-600 text-sm">Loading interview experiences...</p>
                                                </div>
                                            ) : companyInterviews.length > 0 ? (
                                                <div className="mt-3 space-y-3">
                                                    {companyInterviews.map((interview, index) => (
                                                        <div key={index} className="bg-white rounded-lg border border-slate-200 p-4">
                                                            <div className="flex items-start justify-between mb-3">
                                                                <div>
                                                                    <p className="font-semibold text-slate-800 mb-1">{interview.job_title}</p>
                                                                    <p className="text-sm text-slate-600">{interview.location}</p>
                                                                </div>
                                                                <span className="text-xs text-slate-500">
                                                                    {new Date(interview.review_datetime).toLocaleDateString()}
                                                                </span>
                                                            </div>
                                                            
                                                            <div className="mb-3">
                                                                <p className="text-xs text-slate-600 mb-2">Interview Process</p>
                                                                <p className="text-sm text-slate-700 leading-relaxed">{interview.process_description}</p>
                                                            </div>
                                                            
                                                            <div className="flex items-center gap-4 pt-2 border-t border-slate-200">
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-xs text-slate-600">Difficulty:</span>
                                                                    <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${
                                                                        interview.difficulty === 'easy' ? 'bg-green-100 text-green-700' :
                                                                        interview.difficulty === 'average' ? 'bg-yellow-100 text-yellow-700' :
                                                                        'bg-red-100 text-red-700'
                                                                    }`}>
                                                                        {interview.difficulty.charAt(0).toUpperCase() + interview.difficulty.slice(1)}
                                                                    </span>
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-xs text-slate-600">Experience:</span>
                                                                    <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${
                                                                        interview.experience === 'positive' ? 'bg-green-100 text-green-700' :
                                                                        interview.experience === 'neutral' ? 'bg-gray-100 text-gray-700' :
                                                                        'bg-red-100 text-red-700'
                                                                    }`}>
                                                                        {interview.experience.charAt(0).toUpperCase() + interview.experience.slice(1)}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <div className="mt-3 p-4 bg-white rounded-lg border border-slate-200 text-center">
                                                    <p className="text-slate-600 text-sm">No interview experiences available</p>
                                                </div>
                                            )}
                                        </details>
                                    </div>
                                    
                                    <div className="flex gap-3 pt-4 border-t">
                                        <button
                                            onClick={() => handleTailorResume(selectedJob)}
                                            className="flex-1 px-4 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl font-semibold hover:from-indigo-600 hover:to-purple-600 transition-all"
                                        >
                                             Tailor Resume
                                        </button>
                                        <a
                                            href={selectedJob.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="flex-1 px-4 py-3 bg-green-500 text-white rounded-xl font-semibold hover:bg-green-600 transition-all text-center"
                                        >
                                            Apply Now 
                                        </a>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Job Finder when job-finder-content is shown
        window.renderJobFinder = function() {
            console.log('renderJobFinder called');
            const container = document.getElementById('job-finder-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Job Finder...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<JobFinder />);
                    console.log('Job Finder rendered successfully');
                } catch (error) {
                    console.error('Error rendering Job Finder:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Job Finder</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('job-finder-container not found');
            }
        };

        // Job Tracker React Component
        const JobTracker = () => {
            const [selectedCard, setSelectedCard] = useState(null);
            const [showCardModal, setShowCardModal] = useState(false);
            const [activeModalTab, setActiveModalTab] = useState('details');
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            // Helper function to open Interview Prep Kit with job data
            const openInterviewPrepKit = (jobCard) => {
                // Store job data for Interview Prep Kit to use
                localStorage.setItem('current_interview_job', JSON.stringify({
                    jobTitle: jobCard.title,
                    company: jobCard.company,
                    location: jobCard.location,
                    jobDescription: jobCard.notes || jobCard.description || '',
                    matchScore: jobCard.matchScore,
                    applicationDate: jobCard.applicationDate,
                    interviewDate: jobCard.interviewDate || new Date().toISOString().split('T')[0],
                    jobId: jobCard.id,
                    source: jobCard.source || '',
                    salary: jobCard.salary || ''
                }));
                
                // Navigate to Interview Prep Kit
                const interviewPrepLink = document.querySelector('[data-id="interview-prep"]');
                if (interviewPrepLink) {
                    interviewPrepLink.click();
                    
                    // Trigger Interview Prep Kit to load with this job's data
                    setTimeout(() => {
                        window.dispatchEvent(new CustomEvent('interview-prep:load-job', {
                            detail: jobCard
                        }));
                    }, 500);
                } else {
                    window.JobTrackingUtils.showNotification('Could not find Interview Prep Kit link', 'error');
                }
            };

            // Load job cards from localStorage
            const [jobCards, setJobCards] = useState(() => {
                try {
                    const stored = localStorage.getItem('tracked_jobs');
                    if (stored) {
                        const jobs = JSON.parse(stored);
                        return jobs.length > 0 ? jobs : [
                            // Fallback empty state
                        ];
                    }
                } catch (e) {
                    console.error('Error loading tracked jobs:', e);
                }
                return [];
            });

            const columns = [
                { id: 'new-leads', title: 'New Leads (from AI)', color: 'bg-blue-500', count: 0 },
                { id: 'reviewing', title: 'To Apply / Reviewing', color: 'bg-yellow-500', count: 0 },
                { id: 'applied', title: 'Applied', color: 'bg-purple-500', count: 0 },
                { id: 'interviewing', title: 'Interviewing', color: 'bg-orange-500', count: 0 },
                { id: 'offer', title: 'Offer', color: 'bg-green-500', count: 0 },
                { id: 'rejected', title: 'Rejected', color: 'bg-red-500', count: 0 },
                { id: 'archived', title: 'Archived / Not a Fit', color: 'bg-gray-500', count: 0 }
            ];

            // Calculate column counts
            const getColumnCount = (status) => {
                return jobCards.filter(card => card.status === status).length;
            };

            const getMatchScoreColor = (score) => {
                if (score >= 90) return 'text-green-400 bg-green-500/20';
                if (score >= 80) return 'text-blue-400 bg-blue-500/20';
                if (score >= 70) return 'text-yellow-400 bg-yellow-500/20';
                return 'text-red-400 bg-red-500/20';
            };

            const handleDragStart = (e, cardId) => {
                e.dataTransfer.setData('text/plain', cardId);
            };

            const handleDragOver = (e) => {
                e.preventDefault();
            };

            const handleDrop = (e, newStatus) => {
                e.preventDefault();
                const cardId = parseFloat(e.dataTransfer.getData('text/plain')); // Use parseFloat for IDs
                
                const updatedCards = jobCards.map(card => {
                    if (card.id === cardId) {
                        const updated = { ...card, status: newStatus };
                        
                        // Auto-set dates based on status
                        if (newStatus === 'applied' && !updated.applicationDate) {
                            updated.applicationDate = new Date().toISOString().split('T')[0];
                        }
                        if (newStatus === 'interviewing') {
                            // Suggest setting interview date
                            if (!updated.interviewDate) {
                                window.JobTrackingUtils.showNotification(
                                    'Job moved to Interviewing! Consider setting an interview date.',
                                    'info'
                                );
                            }
                        }
                        
                        return updated;
                    }
                    return card;
                });
                
                setJobCards(updatedCards);
                window.JobTrackingUtils.saveTrackedJobs(updatedCards);

                // Generate interview prep kit if moving to interviewing
                if (newStatus === 'interviewing') {
                    const card = updatedCards.find(c => c.id === cardId);
                    
                    if (card) {
                        // Enhanced notification with action buttons
                        window.JobTrackingUtils.showNotificationWithAction(
                            `Job moved to Interviewing! Would you like to prepare for the interview at ${card.company}?`,
                            'info',
                            [
                                {
                                    text: 'Yes, Prepare Now',
                                    action: () => {
                                        openInterviewPrepKit(card);
                                    },
                                    className: 'px-4 py-2 rounded-lg bg-white text-blue-600 hover:bg-blue-50 font-semibold'
                                },
                                {
                                    text: 'Maybe Later',
                                    action: () => {},
                                    className: 'px-4 py-2 rounded-lg bg-white/20 hover:bg-white/30 text-white'
                                }
                            ],
                            8000 // Longer duration for user to decide
                        );
                    }
                    
                    console.log('Generating interview prep kit for job:', cardId);
                }
            };

            const handleCardClick = (card) => {
                setSelectedCard(card);
                setShowCardModal(true);
                setActiveModalTab('details');
            };

            const handleCloseModal = () => {
                setShowCardModal(false);
                setSelectedCard(null);
            };

            const handleSaveNotes = () => {
                if (selectedCard) {
                    const updated = jobCards.map(card =>
                        card.id === selectedCard.id ? { ...card, ...selectedCard } : card
                    );
                    setJobCards(updated);
                    window.JobTrackingUtils.saveTrackedJobs(updated);
                    window.JobTrackingUtils.showNotification('Notes saved!', 'success');
                }
            };

            // Find similar jobs function
            const handleFindSimilarJobs = (card) => {
                // Navigate to Job Finder with pre-filled search
                const jobFinderLink = document.querySelector('[data-id="job-finder"]');
                if (jobFinderLink) {
                    jobFinderLink.click();
                    // Store search query in localStorage for Job Finder to pick up
                    setTimeout(() => {
                        localStorage.setItem('similar_job_search', JSON.stringify({
                            title: card.title,
                            location: card.location,
                            excludeCompany: card.company
                        }));
                        window.location.reload(); // Refresh to trigger search
                    }, 500);
                }
            };

            // Refresh job cards from localStorage
            React.useEffect(() => {
                const loadJobs = () => {
                    const jobs = window.JobTrackingUtils.getAllTrackedJobs();
                    if (jobs.length > 0) {
                        setJobCards(jobs);
                    }
                };
                
                loadJobs();
                
                // Listen for storage changes (when jobs are added from Job Finder)
                const handleStorageChange = (e) => {
                    if (e.key === 'tracked_jobs') {
                        loadJobs();
                    }
                };
                
                window.addEventListener('storage', handleStorageChange);
                
                // Also check periodically for updates (for same-tab updates)
                const interval = setInterval(loadJobs, 2000);
                
                return () => {
                    window.removeEventListener('storage', handleStorageChange);
                    clearInterval(interval);
                };
            }, []);

            // Get analytics
            const analytics = React.useMemo(() => {
                return window.JobTrackingUtils.getAnalytics();
            }, [jobCards]);

            return (
                <div className="space-y-8">
                    {/* Analytics Dashboard */}
                    {jobCards.length > 0 && (
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border shadow-lg rounded-2xl p-6`}>
                            <div className="flex items-center justify-between mb-6">
                                <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}> Job Search Analytics</h3>
                                <div className="flex gap-3">
                                    <button 
                                        onClick={() => {
                                            // Simple manual add - could be enhanced with a modal
                                            const title = prompt('Enter job title:');
                                            const company = prompt('Enter company name:');
                                            if (title && company) {
                                                const newJob = {
                                                    id: Date.now() + Math.random(),
                                                    title: title,
                                                    company: company,
                                                    location: prompt('Enter location (optional):') || 'Not specified',
                                                    salary: prompt('Enter salary (optional):') || 'Competitive',
                                                    matchScore: 0,
                                                    postedDate: new Date().toISOString().split('T')[0],
                                                    source: 'Manual Entry',
                                                    status: 'new-leads',
                                                    notes: '',
                                                    applicationDate: '',
                                                    interviewDate: '',
                                                    contacts: '',
                                                    url: '#',
                                                    addedFrom: 'manual',
                                                    addedAt: new Date().toISOString()
                                                };
                                                const updated = [...jobCards, newJob];
                                                setJobCards(updated);
                                                window.JobTrackingUtils.saveTrackedJobs(updated);
                                                window.JobTrackingUtils.showNotification('Job added manually!', 'success');
                                            }
                                        }}
                                        className="bg-gradient-to-r from-indigo-500 to-violet-600 text-white px-4 py-2 rounded-xl font-semibold flex items-center gap-2 hover:from-indigo-600 hover:to-violet-700 transition-all duration-300 text-sm"
                                    >
                                        <div className="w-4 h-4"></div>
                                Add Job Manually
                            </button>
                                    <button
                                        onClick={() => {
                                            const finderLink = document.querySelector('[data-id="job-finder"]');
                                            if (finderLink) finderLink.click();
                                        }}
                                        className="bg-blue-500 text-white px-4 py-2 rounded-xl font-semibold flex items-center gap-2 hover:bg-blue-600 transition-all duration-300 text-sm"
                                    >
                                         Find More Jobs
                                    </button>
                        </div>
                    </div>
                            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                <div className="bg-blue-100/70 border border-blue-200/50 rounded-xl p-4 text-center shadow-sm">
                                    <div className="text-2xl mb-2"></div>
                                    <div className={`text-2xl font-bold text-blue-700 mb-1`}>{getColumnCount('new-leads')}</div>
                                    <div className={`text-xs font-medium text-blue-600`}>New Leads</div>
                                </div>
                                <div className="bg-emerald-100/70 border border-emerald-200/50 rounded-xl p-4 text-center shadow-sm">
                                    <div className="text-2xl mb-2"></div>
                                    <div className={`text-2xl font-bold text-emerald-700 mb-1`}>{analytics.totalApplied}</div>
                                    <div className={`text-xs font-medium text-emerald-600`}>Applied</div>
                                </div>
                                <div className="bg-amber-100/70 border border-amber-200/50 rounded-xl p-4 text-center shadow-sm">
                                    <div className="text-2xl mb-2"></div>
                                    <div className={`text-2xl font-bold text-amber-700 mb-1`}>{analytics.totalInterviews}</div>
                                    <div className={`text-xs font-medium text-amber-600`}>Interviews</div>
                            </div>
                                <div className="bg-teal-100/70 border border-teal-200/50 rounded-xl p-4 text-center shadow-sm">
                                    <div className="text-2xl mb-2"></div>
                                    <div className={`text-2xl font-bold text-teal-700 mb-1`}>{analytics.totalOffers}</div>
                                    <div className={`text-xs font-medium text-teal-600`}>Offers</div>
                        </div>
                                <div className="bg-purple-100/70 border border-purple-200/50 rounded-xl p-4 text-center shadow-sm">
                                    <div className="text-2xl mb-2"></div>
                                    <div className={`text-2xl font-bold text-purple-700 mb-1`}>{analytics.total}</div>
                                    <div className={`text-xs font-medium text-purple-600`}>Total Tracked</div>
                                </div>
                                <div className="bg-pink-100/70 border border-pink-200/50 rounded-xl p-4 text-center shadow-sm">
                                    <div className="text-2xl mb-2"></div>
                                    <div className={`text-2xl font-bold text-pink-700 mb-1`}>{analytics.averageMatchScore}%</div>
                                    <div className={`text-xs font-medium text-pink-600`}>Avg. Match Score</div>
                                </div>
                            </div>
                            {analytics.bySource && Object.keys(analytics.bySource).length > 0 && (
                                <div className="mt-6 pt-6 border-t border-slate-200">
                                    <div className={`text-sm font-semibold ${isLightMode ? 'text-slate-700' : 'text-gray-300'} mb-3`}>Top Sources:</div>
                                    <div className="flex flex-wrap gap-2">
                                        {Object.entries(analytics.bySource)
                                            .sort((a, b) => b[1] - a[1])
                                            .slice(0, 5)
                                            .map(([source, count]) => (
                                                <span key={source} className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">
                                                    {source}: {count}
                                                </span>
                                            ))}
                        </div>
                                </div>
                            )}
                                </div>
                    )}

                    {/* Kanban Board */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border shadow-lg rounded-2xl p-6`}>
                        <div className="flex gap-6 overflow-x-auto pb-4">
                            {columns.map((column) => (
                                <div key={column.id} className="flex-shrink-0 w-80">
                                    <div className={`${isLightMode ? 'bg-white/70' : 'bg-gray-800/70'} rounded-2xl p-4 min-h-96`}>
                                        <div className="flex items-center gap-3 mb-4">
                                            <div className={`w-3 h-3 rounded-full ${column.color}`}></div>
                                            <h3 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>{column.title}</h3>
                                            <span className={`text-sm ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}>({getColumnCount(column.id)})</span>
                                        </div>
                                        
                                        <div
                                            className="space-y-3 min-h-80"
                                            onDragOver={handleDragOver}
                                            onDrop={(e) => handleDrop(e, column.id)}
                                        >
                                            {jobCards
                                                .filter(card => card.status === column.id)
                                                .map((card) => (
                                                    <div
                                                        key={card.id}
                                                        draggable
                                                        onDragStart={(e) => handleDragStart(e, card.id)}
                                                        onClick={() => handleCardClick(card)}
                                                        className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-slate-800 border-slate-700'} border rounded-2xl p-4 cursor-pointer hover:scale-105 transition-all duration-300 hover:shadow-lg`}
                                                    >
                                                        <div className="flex items-start justify-between mb-3">
                                                            <div className="flex-1">
                                                                <h4 className={`font-semibold text-sm mb-1 ${isLightMode ? 'text-slate-800' : 'text-white'}`}>{card.title}</h4>
                                                                <p className={`text-xs ${isLightMode ? 'text-slate-600' : 'text-slate-300'}`}>{card.company}</p>
                                                            </div>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-semibold ${getMatchScoreColor(card.matchScore)}`}>
                                                                {card.matchScore}%
                                                            </span>
                                                        </div>
                                                        
                                                        <div className={`space-y-2 text-xs ${isLightMode ? 'text-slate-500' : 'text-slate-400'}`}>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-3 h-3"></div>
                                                                <span>{card.location}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-3 h-3"></div>
                                                                <span>{card.salary}</span>
                                                            </div>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-3 h-3"></div>
                                                                <span>Posted: {card.postedDate}</span>
                                                            </div>
                                                            {card.applicationDate && (
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-3 h-3"></div>
                                                                    <span>Applied: {card.applicationDate}</span>
                                                                </div>
                                                            )}
                                                            {card.interviewDate && (
                                                                <div className="flex items-center gap-2">
                                                                    <div className="w-3 h-3"></div>
                                                                    <span>Interview: {card.interviewDate}</span>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                ))}
                                            
                                            {getColumnCount(column.id) === 0 && (
                                                <div className="text-center py-8 text-slate-500 text-sm">
                                                    No jobs in this stage
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Job Card Modal */}
                    {showCardModal && selectedCard && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className={`${isLightMode ? 'bg-white/95 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border shadow-2xl rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden`}>
                                <div className={`flex items-center justify-between p-6 border-b ${isLightMode ? 'border-slate-200' : 'border-gray-700'}`}>
                                    <h2 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>{selectedCard.title}</h2>
                                    <button
                                        onClick={handleCloseModal}
                                        className={`${isLightMode ? 'text-slate-600 hover:text-slate-800' : 'text-gray-400 hover:text-gray-200'}`}
                                    >
                                        <div className="w-6 h-6"></div>
                                    </button>
                                </div>

                                {/* Quick Action for Interviewing Jobs */}
                                {selectedCard?.status === 'interviewing' && (
                                    <div className={`${isLightMode ? 'bg-blue-50 border-blue-200' : 'bg-blue-900/30 border-blue-700/50'} border-t border-b mx-6 py-4`}>
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h4 className={`font-semibold ${isLightMode ? 'text-blue-900' : 'text-blue-100'}`}>Ready to prepare?</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>Start your interview prep for this role</p>
                                            </div>
                                            <button
                                                onClick={() => {
                                                    openInterviewPrepKit(selectedCard);
                                                    handleCloseModal();
                                                }}
                                                className={`${isLightMode ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-indigo-500 hover:bg-indigo-600'} text-white px-4 py-2 rounded-lg transition-colors font-medium flex items-center gap-2`}
                                            >
                                                Start Prep
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Modal Tabs */}
                                <div className={`flex border-b ${isLightMode ? 'border-slate-200' : 'border-gray-700'}`}>
                                    {[
                                        { id: 'details', label: 'Job Details', icon: '' },
                                        { id: 'ai-assistant', label: 'AI Assistant', icon: '' },
                                        { id: 'notes', label: 'My Notes & Activity', icon: '' }
                                    ].map((tab) => (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveModalTab(tab.id)}
                                            className={`flex items-center gap-2 px-6 py-4 font-medium transition-colors ${
                                                activeModalTab === tab.id
                                                    ? 'text-indigo-600 border-b-2 border-indigo-600'
                                                    : (isLightMode ? 'text-slate-600 hover:text-slate-800' : 'text-gray-400 hover:text-gray-200')
                                            }`}
                                        >
                                            <div className="w-4 h-4">{tab.icon}</div>
                                            {tab.label}
                                        </button>
                                    ))}
                                </div>

                                {/* Modal Content */}
                                <div className="p-6 max-h-96 overflow-y-auto">
                                    {activeModalTab === 'details' && (
                                        <div className="space-y-6">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>Job Information</h3>
                                                    <div className="space-y-3">
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                            <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>{selectedCard.company}</span>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                            <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>{selectedCard.location}</span>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                            <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>{selectedCard.salary}</span>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                            <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>Posted: {selectedCard.postedDate}</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div>
                                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>Application Status</h3>
                                                    <div className="space-y-3">
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                            <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>Match Score: {selectedCard.matchScore}%</span>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                            <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>Source: {selectedCard.source}</span>
                                                        </div>
                                                        {selectedCard.applicationDate && (
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                                <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>Applied: {selectedCard.applicationDate}</span>
                                                            </div>
                                                        )}
                                                        {selectedCard.interviewDate && (
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-5 h-5 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}></div>
                                                                <span className={`${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>Interview: {selectedCard.interviewDate}</span>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>

                                            <div>
                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>Job Description</h3>
                                                <div className={`${isLightMode ? 'bg-slate-50' : 'bg-gray-800'} rounded-xl p-4`}>
                                                    <p className={`text-sm leading-relaxed ${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>
                                                        We are looking for a {selectedCard.title} to join our growing team. 
                                                        This role involves working on cutting-edge projects and collaborating 
                                                        with talented engineers to build scalable solutions.
                                                    </p>
                                                </div>
                                                <div className="flex gap-3 mt-4">
                                                    <button className="bg-gradient-to-r from-indigo-500 to-violet-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-indigo-600 hover:to-violet-700 transition-all duration-300">
                                                    Apply Now
                                                </button>
                                                    <button
                                                        onClick={() => handleFindSimilarJobs(selectedCard)}
                                                        className="bg-blue-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-600 transition-all duration-300 flex items-center gap-2"
                                                    >
                                                         Find Similar Jobs
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {activeModalTab === 'ai-assistant' && (
                                        <div className="space-y-6">
                                            <div>
                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>Generated Cover Letter</h3>
                                                <div className={`${isLightMode ? 'bg-slate-50' : 'bg-gray-800'} rounded-xl p-4 mb-4`}>
                                                    <p className={`text-sm leading-relaxed ${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>
                                                        Dear Hiring Manager,<br/><br/>
                                                        I am writing to express my strong interest in the {selectedCard.title} position at {selectedCard.company}...
                                                    </p>
                                                </div>
                                                <div className="flex gap-3">
                                                    <button className="bg-blue-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                                                        Copy
                                                    </button>
                                                    <button className="bg-slate-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-slate-600 transition-colors">
                                                        Edit
                                                    </button>
                                                </div>
                                            </div>

                                            <div>
                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>Tailored CV Highlights</h3>
                                                <div className="space-y-2">
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 text-green-600"></div>
                                                        <span className={`${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>React and TypeScript experience</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 text-green-600"></div>
                                                        <span className={`${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>Full-stack development background</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <div className="w-4 h-4 text-green-600"></div>
                                                        <span className={`${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>Team leadership experience</span>
                                                    </div>
                                                </div>
                                                <button className="mt-4 bg-gradient-to-r from-indigo-500 to-violet-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-indigo-600 hover:to-violet-700 transition-all duration-300">
                                                    Generate Tailored Resume
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {activeModalTab === 'notes' && (
                                        <div className="space-y-6">
                                            <div>
                                                <label className={`block text-sm font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-3`}>Contacts</label>
                                                <input
                                                    type="text"
                                                    value={selectedCard.contacts}
                                                    onChange={(e) => setSelectedCard({...selectedCard, contacts: e.target.value})}
                                                    placeholder="hr@company.com, recruiter@company.com"
                                                    className={`w-full px-4 py-3 ${isLightMode ? 'bg-white/70 border-slate-300 text-slate-800 placeholder-slate-500' : 'bg-gray-800/70 border-gray-600 text-gray-50 placeholder-gray-400'} border rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none transition-all duration-300`}
                                                />
                                            </div>

                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className={`block text-sm font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-3`}>Application Deadline</label>
                                                    <input
                                                        type="date"
                                                        className={`w-full px-4 py-3 ${isLightMode ? 'bg-white/70 border-slate-300 text-slate-800' : 'bg-gray-800/70 border-gray-600 text-gray-50'} border rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none transition-all duration-300`}
                                                    />
                                                </div>
                                                <div>
                                                    <label className={`block text-sm font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-3`}>Follow-up Date</label>
                                                    <input
                                                        type="date"
                                                        className={`w-full px-4 py-3 ${isLightMode ? 'bg-white/70 border-slate-300 text-slate-800' : 'bg-gray-800/70 border-gray-600 text-gray-50'} border rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none transition-all duration-300`}
                                                    />
                                                </div>
                                            </div>

                                            <div>
                                                <label className={`block text-sm font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-3`}>Notes</label>
                                                <textarea
                                                    value={selectedCard.notes}
                                                    onChange={(e) => setSelectedCard({...selectedCard, notes: e.target.value})}
                                                    placeholder="Add your notes about this job application..."
                                                    rows={4}
                                                    className={`w-full px-4 py-3 ${isLightMode ? 'bg-white/70 border-slate-300 text-slate-800 placeholder-slate-500' : 'bg-gray-800/70 border-gray-600 text-gray-50 placeholder-gray-400'} border rounded-xl focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 focus:outline-none resize-none transition-all duration-300`}
                                                />
                                            </div>

                                            <div className="flex gap-3">
                                                <button
                                                    onClick={handleSaveNotes}
                                                    className="bg-gradient-to-r from-indigo-500 to-violet-600 text-white px-6 py-3 rounded-xl font-semibold hover:from-indigo-600 hover:to-violet-700 transition-all duration-300"
                                                >
                                                    Save Notes
                                                </button>
                                                <button className="bg-slate-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-slate-600 transition-colors">
                                                    Set Reminder
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Job Tracker when job-tracker-content is shown
        window.renderJobTracker = function() {
            console.log('renderJobTracker called');
            const container = document.getElementById('job-tracker-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Job Tracker...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<JobTracker />);
                    console.log('Job Tracker rendered successfully');
                } catch (error) {
                    console.error('Error rendering Job Tracker:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Job Tracker</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('job-tracker-container not found');
            }
        };

        // Interview Prep Kit Storage Utilities
        const InterviewPrepStorage = {
            getStorageKey(jobId) {
                return `interview_prep_${jobId || 'default'}`;
            },
            savePrepData(jobId, data) {
                try {
                    const key = this.getStorageKey(jobId);
                    localStorage.setItem(key, JSON.stringify({
                        ...data,
                        lastUpdated: new Date().toISOString()
                    }));
                    return true;
                } catch (e) {
                    console.error('Error saving prep data:', e);
                    return false;
                }
            },
            loadPrepData(jobId) {
                try {
                    const key = this.getStorageKey(jobId);
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Error loading prep data:', e);
                    return null;
                }
            },
            saveSession(session) {
                try {
                    const sessions = this.getAllSessions();
                    sessions.push({...session, id: Date.now().toString()});
                    localStorage.setItem('interview_prep_sessions', JSON.stringify(sessions));
                    return true;
                } catch (e) {
                    console.error('Error saving session:', e);
                    return false;
                }
            },
            getAllSessions() {
                try {
                    const data = localStorage.getItem('interview_prep_sessions');
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    return [];
                }
            },
            saveCustomQuestion(jobId, question) {
                const data = this.loadPrepData(jobId) || { customQuestions: [] };
                if (!data.customQuestions) data.customQuestions = [];
                data.customQuestions.push({...question, id: Date.now().toString()});
                return this.savePrepData(jobId, data);
            },
            getResumeData() {
                try {
                    const resumeText = localStorage.getItem('resume_content') || '';
                    const parsedResume = localStorage.getItem('parsed_resume_data');
                    return parsedResume ? JSON.parse(parsedResume) : null;
                } catch (e) {
                    return null;
                }
            },
            saveAnxietyData(jobId, data) {
                try {
                    const key = `interview_prep_anxiety_${jobId || 'default'}`;
                    localStorage.setItem(key, JSON.stringify({
                        ...data,
                        lastUpdated: new Date().toISOString()
                    }));
                    return true;
                } catch (e) {
                    console.error('Error saving anxiety data:', e);
                    return false;
                }
            },
            loadAnxietyData(jobId) {
                try {
                    const key = `interview_prep_anxiety_${jobId || 'default'}`;
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('Error loading anxiety data:', e);
                    return null;
                }
            },
            saveStoryBank(jobId, stories) {
                try {
                    const key = `interview_prep_stories_${jobId || 'default'}`;
                    localStorage.setItem(key, JSON.stringify({
                        stories: stories || [],
                        lastUpdated: new Date().toISOString()
                    }));
                    return true;
                } catch (e) {
                    console.error('Error saving story bank:', e);
                    return false;
                }
            },
            loadStoryBank(jobId) {
                try {
                    const key = `interview_prep_stories_${jobId || 'default'}`;
                    const data = localStorage.getItem(key);
                    if (data) {
                        const parsed = JSON.parse(data);
                        return parsed.stories || [];
                    }
                    return [];
                } catch (e) {
                    console.error('Error loading story bank:', e);
                    return [];
                }
            },
            saveConfidenceScore(jobId, score, metadata = {}) {
                try {
                    const key = `interview_prep_confidence_${jobId || 'default'}`;
                    const existing = this.loadConfidenceHistory(jobId);
                    const history = existing.history || [];
                    history.push({
                        score,
                        date: new Date().toISOString(),
                        ...metadata
                    });
                    localStorage.setItem(key, JSON.stringify({
                        currentScore: score,
                        history: history.slice(-30), // Keep last 30 entries
                        lastUpdated: new Date().toISOString()
                    }));
                    return true;
                } catch (e) {
                    console.error('Error saving confidence score:', e);
                    return false;
                }
            },
            loadConfidenceHistory(jobId) {
                try {
                    const key = `interview_prep_confidence_${jobId || 'default'}`;
                    const data = localStorage.getItem(key);
                    if (data) {
                        const parsed = JSON.parse(data);
                        return {
                            currentScore: parsed.currentScore || 50,
                            history: parsed.history || []
                        };
                    }
                    return { currentScore: 50, history: [] };
                } catch (e) {
                    console.error('Error loading confidence history:', e);
                    return { currentScore: 50, history: [] };
                }
            },
            buildStoryBankFromResume() {
                try {
                    const resumeData = this.getResumeData();
                    if (!resumeData) {
                        return [];
                    }
                    
                    const stories = [];
                    let storyId = 1;
                    
                    // Extract stories from work experience
                    if (resumeData.experience && Array.isArray(resumeData.experience)) {
                        resumeData.experience.forEach((exp, idx) => {
                            if (exp.achievements && Array.isArray(exp.achievements)) {
                                exp.achievements.forEach((achievement) => {
                                    stories.push({
                                        id: `story_${storyId++}`,
                                        title: `${achievement} at ${exp.company || 'Previous Role'}`,
                                        source: 'resume',
                                        category: 'work_experience',
                                        company: exp.company || '',
                                        position: exp.position || '',
                                        date: exp.endDate || exp.startDate || '',
                                        achievement: achievement,
                                        description: exp.description || '',
                                        starFormat: {
                                            Situation: `While working as ${exp.position || 'an employee'} at ${exp.company || 'my previous company'}`,
                                            Task: achievement,
                                            Action: exp.description || 'Took initiative and executed effectively',
                                            Result: achievement
                                        }
                                    });
                                });
                            }
                            
                            // Also create story from position itself
                            if (exp.description || exp.position) {
                                stories.push({
                                    id: `story_${storyId++}`,
                                    title: `${exp.position || 'Role'} at ${exp.company || 'Previous Company'}`,
                                    source: 'resume',
                                    category: 'work_experience',
                                    company: exp.company || '',
                                    position: exp.position || '',
                                    date: `${exp.startDate || ''} - ${exp.endDate || 'Present'}`,
                                    achievement: exp.achievements?.[0] || exp.description || '',
                                    description: exp.description || '',
                                    starFormat: {
                                        Situation: `In my role as ${exp.position || 'an employee'} at ${exp.company || 'my previous company'}`,
                                        Task: `My responsibilities included ${exp.description || 'various duties'}`,
                                        Action: exp.achievements?.[0] || 'I executed my responsibilities effectively',
                                        Result: exp.achievements?.[0] || 'Achieved positive results'
                                    }
                                });
                            }
                        });
                    }
                    
                    // Extract stories from projects
                    if (resumeData.projects && Array.isArray(resumeData.projects)) {
                        resumeData.projects.forEach((project) => {
                            stories.push({
                                id: `story_${storyId++}`,
                                title: project.name || 'Project',
                                source: 'resume',
                                category: 'project',
                                company: '',
                                position: '',
                                date: '',
                                achievement: project.description || '',
                                description: project.description || '',
                                technologies: project.technologies || [],
                                starFormat: {
                                    Situation: `While working on the ${project.name || 'project'}`,
                                    Task: `The goal was to ${project.description || 'deliver a successful project'}`,
                                    Action: `I utilized ${(project.technologies || []).join(', ') || 'various technologies'} to build the solution`,
                                    Result: project.description || 'Successfully completed the project'
                                }
                            });
                        });
                    }
                    
                    return stories;
                } catch (e) {
                    console.error('Error building story bank from resume:', e);
                    return [];
                }
            }
        };

        // Interview Prep Kit React Component - ENHANCED VERSION
        const InterviewPrepKit = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [currentJob, setCurrentJob] = useState(null);
            const [isJobLoaded, setIsJobLoaded] = useState(false);
            const [interviewQuestions, setInterviewQuestions] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [selectedQuestion, setSelectedQuestion] = useState(null);
            const [showSampleAnswer, setShowSampleAnswer] = useState(false);
            const [showPracticeModal, setShowPracticeModal] = useState(false);
            const [practiceAnswer, setPracticeAnswer] = useState('');
            const [showMockInterview, setShowMockInterview] = useState(false);
            const [mockInterviewState, setMockInterviewState] = useState({currentQuestion: 0, answers: []});
            const [searchQuery, setSearchQuery] = useState('');
            const [filterCategory, setFilterCategory] = useState('all');
            const [filterDifficulty, setFilterDifficulty] = useState('all');
            const [filterPriority, setFilterPriority] = useState('all');
            const [sortBy, setSortBy] = useState('id');
            const [showTips, setShowTips] = useState(false);
            const [showChecklist, setShowChecklist] = useState(false);
            const [showCompanyResearch, setShowCompanyResearch] = useState(false);
            const [companyResearch, setCompanyResearch] = useState(null);
            const [questionProgress, setQuestionProgress] = useState({});
            const [userAnswers, setUserAnswers] = useState({});
            const [answerFeedback, setAnswerFeedback] = useState({});
            const [practiceSessions, setPracticeSessions] = useState([]);
            
            // New state variables for Interview Prep Kit 2.0 features
            const [starMode, setStarMode] = useState(false);
            const [starAnswers, setStarAnswers] = useState({
                Situation: '',
                Task: '',
                Action: '',
                Result: ''
            });
            const [anxietyLevel, setAnxietyLevel] = useState(null);
            const [confidenceScore, setConfidenceScore] = useState(50);
            const [userStories, setUserStories] = useState([]);
            const [questionPriorities, setQuestionPriorities] = useState({});
            const [showAnxietyAssessment, setShowAnxietyAssessment] = useState(false);
            const [anxietyAssessmentAnswers, setAnxietyAssessmentAnswers] = useState({});
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            // AI-Enhanced Question Generation (with caching)
            const generateQuestionsForRole = async (jobTitle, company, jobDescription = '') => {
                const cacheKey = `questions_${jobTitle}_${company}`;
                const cached = sessionStorage.getItem(cacheKey);
                if (cached) {
                    try {
                        return JSON.parse(cached);
                    } catch (e) {}
                }

                const apiKey = localStorage.getItem('openai_api_key');
                if (apiKey && jobDescription) {
                    setLoading(true);
                    try {
                        const prompt = `Generate 15-20 interview questions for a ${jobTitle} position at ${company}. 
Job Description: ${jobDescription.substring(0, 1000)}

Include:
- 8-10 general behavioral questions
- 7-10 role-specific technical/behavioral questions tailored to ${jobTitle}

For each question, assign:
- A difficulty level: Easy, Medium, or Hard
- A category: General, Technical, Behavioral, or Role-Specific

Return as JSON array: [{"question": "...", "category": "...", "difficulty": "...", "id": 1}, ...]`;

                        const response = await fetch('https://api.openai.com/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${apiKey}`
                            },
                            body: JSON.stringify({
                                model: 'gpt-4o-mini',
                                messages: [{ role: 'user', content: prompt }],
                                temperature: 0.7,
                                max_tokens: 2000
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            const content = data.choices[0]?.message?.content;
                            const jsonMatch = content.match(/\[[\s\S]*\]/);
                            if (jsonMatch) {
                                const questions = JSON.parse(jsonMatch[0]);
                                sessionStorage.setItem(cacheKey, JSON.stringify(questions));
                                setLoading(false);
                                return questions;
                            }
                        }
                    } catch (e) {
                        console.error('AI question generation failed:', e);
                    }
                    setLoading(false);
                }

                // Fallback to rule-based generation
                const commonQuestions = [
                    { question: "Tell me about yourself.", category: "General", difficulty: "Easy", id: 1 },
                    { question: `Why do you want to work at ${company}?`, category: "General", difficulty: "Medium", id: 2 },
                    { question: `Why are you interested in this ${jobTitle} role?`, category: "General", difficulty: "Medium", id: 3 },
                    { question: "What are your greatest strengths?", category: "General", difficulty: "Easy", id: 4 },
                    { question: "What is your greatest weakness?", category: "General", difficulty: "Medium", id: 5 },
                    { question: "Where do you see yourself in 5 years?", category: "General", difficulty: "Medium", id: 6 },
                    { question: "Why should we hire you?", category: "General", difficulty: "Medium", id: 7 },
                    { question: "How do you handle stress and pressure?", category: "Behavioral", difficulty: "Medium", id: 8 },
                    { question: "Tell me about a challenging project you worked on.", category: "Behavioral", difficulty: "Hard", id: 9 },
                    { question: "What questions do you have for us?", category: "General", difficulty: "Easy", id: 10 }
                ];
                
                const roleSpecific = [];
                const titleLower = jobTitle.toLowerCase();
                
                if (titleLower.includes('engineer') || titleLower.includes('developer') || titleLower.includes('programmer')) {
                    roleSpecific.push(
                        { question: "Walk me through your technical background.", category: "Technical", difficulty: "Medium", id: 11 },
                        { question: "Describe a complex technical problem you solved.", category: "Technical", difficulty: "Hard", id: 12 },
                        { question: "How do you stay updated with new technologies?", category: "Technical", difficulty: "Easy", id: 13 },
                        { question: "Explain a time when you had to learn a new technology quickly.", category: "Technical", difficulty: "Hard", id: 14 }
                    );
                } else if (titleLower.includes('manager') || titleLower.includes('lead')) {
                    roleSpecific.push(
                        { question: "Describe your management style.", category: "Role-Specific", difficulty: "Medium", id: 11 },
                        { question: "How do you handle conflict within your team?", category: "Role-Specific", difficulty: "Hard", id: 12 },
                        { question: "Tell me about a time you had to make a difficult decision.", category: "Behavioral", difficulty: "Hard", id: 13 },
                        { question: "How do you motivate your team members?", category: "Role-Specific", difficulty: "Medium", id: 14 }
                    );
                } else if (titleLower.includes('designer')) {
                    roleSpecific.push(
                        { question: "Walk me through your design process.", category: "Technical", difficulty: "Medium", id: 11 },
                        { question: "How do you approach user research?", category: "Technical", difficulty: "Medium", id: 12 },
                        { question: "Tell me about a design challenge you overcame.", category: "Behavioral", difficulty: "Hard", id: 13 },
                        { question: "What design tools do you prefer and why?", category: "Technical", difficulty: "Easy", id: 14 }
                    );
                } else if (titleLower.includes('analyst') || titleLower.includes('data')) {
                    roleSpecific.push(
                        { question: "How do you approach data analysis?", category: "Technical", difficulty: "Medium", id: 11 },
                        { question: "Describe a time when your analysis led to a significant insight.", category: "Behavioral", difficulty: "Hard", id: 12 },
                        { question: "What data visualization tools are you familiar with?", category: "Technical", difficulty: "Easy", id: 13 },
                        { question: "How do you ensure data accuracy in your work?", category: "Technical", difficulty: "Medium", id: 14 }
                    );
                } else {
                    // Generic role-specific questions
                    roleSpecific.push(
                        { question: `What skills make you a good fit for this ${jobTitle} role?`, category: "Role-Specific", difficulty: "Medium", id: 11 },
                        { question: `Describe a relevant project or experience for this ${jobTitle} position.`, category: "Role-Specific", difficulty: "Hard", id: 12 },
                        { question: "How do you approach learning new skills required for a role?", category: "Behavioral", difficulty: "Medium", id: 13 },
                        { question: `What interests you most about working as a ${jobTitle}?`, category: "Role-Specific", difficulty: "Easy", id: 14 }
                    );
                }
                
                const allQuestions = [...commonQuestions, ...roleSpecific];
                sessionStorage.setItem(cacheKey, JSON.stringify(allQuestions));
                return allQuestions;
            };

            // Generate sample answer for a question
            const generateSampleAnswer = async (question, jobTitle, company) => {
                const apiKey = localStorage.getItem('openai_api_key');
                if (!apiKey) {
                    return "Please set your OpenAI API key in Settings to generate sample answers. For now, focus on being specific, providing examples from your experience, and showing enthusiasm for the role.";
                }

                try {
                    const prompt = `Provide a sample answer (2-3 paragraphs) for this interview question:
Question: "${question}"
Job Title: ${jobTitle}
Company: ${company}

Make it professional, specific, and demonstrate strong communication skills. Include the STAR method (Situation, Task, Action, Result) if applicable.`;

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [{ role: 'user', content: prompt }],
                            temperature: 0.7,
                            max_tokens: 500
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        return data.choices[0]?.message?.content || "Unable to generate sample answer.";
                    }
                } catch (e) {
                    console.error('Error generating sample answer:', e);
                }
                return "Unable to generate sample answer. Please try again or set your OpenAI API key.";
            };

            // Get company research
            const fetchCompanyResearch = async (company) => {
                const apiKey = localStorage.getItem('openai_api_key');
                if (!apiKey) {
                    setCompanyResearch({
                        culture: "Set your OpenAI API key to get company insights.",
                        values: [],
                        tips: []
                    });
                    return;
                }

                try {
                    const prompt = `Provide information about ${company} for interview preparation:
1. Company culture and values (2-3 sentences)
2. Key values they emphasize (list)
3. Interview tips specific to this company (list 5-7 tips)

Format as JSON: {"culture": "...", "values": [...], "tips": [...]}`;

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [{ role: 'user', content: prompt }],
                            temperature: 0.7,
                            max_tokens: 800
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const content = data.choices[0]?.message?.content;
                        const jsonMatch = content.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            setCompanyResearch(JSON.parse(jsonMatch[0]));
                            return;
                        }
                    }
                } catch (e) {
                    console.error('Error fetching company research:', e);
                }
                setCompanyResearch({
                    culture: "Unable to fetch company information. Please try again.",
                    values: [],
                    tips: []
                });
            };

            // Evaluate answer quality
            const evaluateAnswer = async (question, answer) => {
                const apiKey = localStorage.getItem('openai_api_key');
                if (!apiKey) return null;

                try {
                    const prompt = `Evaluate this interview answer:
Question: "${question}"
Answer: "${answer}"

Provide:
1. A score out of 10
2. 2-3 strengths
3. 2-3 areas for improvement
4. Overall feedback (2-3 sentences)

Format as JSON: {"score": 8, "strengths": [...], "improvements": [...], "feedback": "..."}`;

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-4o-mini',
                            messages: [{ role: 'user', content: prompt }],
                            temperature: 0.7,
                            max_tokens: 600
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        const content = data.choices[0]?.message?.content;
                        const jsonMatch = content.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            return JSON.parse(jsonMatch[0]);
                        }
                    }
                } catch (e) {
                    console.error('Error evaluating answer:', e);
                }
                return null;
            };

            // Helper Functions for Interview Prep Kit 2.0
            
            // Build story bank from resume data
            const buildStoryBankFromResume = () => {
                try {
                    const stories = InterviewPrepStorage.buildStoryBankFromResume();
                    // Also load any manually added stories
                    const savedStories = currentJob?.jobId ? InterviewPrepStorage.loadStoryBank(currentJob.jobId) : [];
                    // Merge and deduplicate
                    const allStories = [...stories, ...savedStories.filter(s => s.source === 'manual')];
                    // Remove duplicates based on title
                    const uniqueStories = allStories.filter((story, index, self) => 
                        index === self.findIndex(s => s.title === story.title)
                    );
                    return uniqueStories;
                } catch (e) {
                    console.error('Error building story bank:', e);
                    return [];
                }
            };

            // Prioritize questions based on statistics and context
            const prioritizeQuestions = (questions, job, interviewDate) => {
                if (!questions || !Array.isArray(questions)) return {};
                
                const priorities = {};
                const now = new Date();
                const interview = interviewDate ? new Date(interviewDate) : null;
                const daysUntilInterview = interview ? Math.ceil((interview - now) / (1000 * 60 * 60 * 24)) : null;
                
                questions.forEach((q) => {
                    let priority = 'Medium'; // Default
                    const questionLower = q.question.toLowerCase();
                    
                    // Critical priority: "Tell me about yourself" (70% struggle with this)
                    if (questionLower.includes('tell me about yourself') || 
                        questionLower === 'tell me about yourself.') {
                        priority = 'Critical';
                    }
                    // High priority: Common behavioral questions
                    else if (q.category === 'Behavioral' || 
                             questionLower.includes('tell me about a time') ||
                             questionLower.includes('describe a time') ||
                             questionLower.includes('give me an example')) {
                        priority = 'High';
                    }
                    // High priority: Company-specific if interview is soon
                    else if ((questionLower.includes((job?.company || '').toLowerCase()) || 
                             questionLower.includes('why do you want to work')) && 
                             daysUntilInterview !== null && daysUntilInterview <= 7) {
                        priority = 'High';
                    }
                    // High priority: Weakness questions (common struggle)
                    else if (questionLower.includes('weakness') || 
                             questionLower.includes('greatest weakness')) {
                        priority = 'High';
                    }
                    // Medium-High: Role-specific based on match score
                    else if (q.category === 'Role-Specific' || q.category === 'Technical') {
                        priority = job?.matchScore && job.matchScore >= 80 ? 'High' : 'Medium';
                    }
                    // Low priority: Easy questions that are straightforward
                    else if (q.difficulty === 'Easy' && q.category === 'General') {
                        priority = 'Low';
                    }
                    
                    priorities[q.id] = priority;
                });
                
                return priorities;
            };

            // Anxiety assessment function
            const assessAnxietyLevel = () => {
                // 5-question assessment based on common fears
                const questions = [
                    {
                        id: 'nervous',
                        question: 'How nervous do you feel about the interview?',
                        fear: 'Being too nervous'
                    },
                    {
                        id: 'stumped',
                        question: 'How worried are you about being stumped by questions?',
                        fear: 'Being stumped by questions'
                    },
                    {
                        id: 'late',
                        question: 'How concerned are you about being late?',
                        fear: 'Being late'
                    },
                    {
                        id: 'underqualified',
                        question: 'Do you feel underqualified for this role?',
                        fear: 'Being underqualified'
                    },
                    {
                        id: 'unprepared',
                        question: 'How prepared do you feel?',
                        fear: 'Not being prepared',
                        reverse: true // Lower score = more anxiety
                    }
                ];
                
                // Calculate anxiety level from assessment answers
                if (Object.keys(anxietyAssessmentAnswers).length === questions.length) {
                    let totalScore = 0;
                    questions.forEach(q => {
                        const answer = anxietyAssessmentAnswers[q.id] || 3;
                        totalScore += q.reverse ? (6 - answer) : answer; // Reverse scale for preparedness
                    });
                    const averageScore = totalScore / questions.length;
                    // Convert to 1-10 anxiety scale (1 = low anxiety, 10 = high anxiety)
                    const anxiety = Math.round(averageScore);
                    return {
                        level: anxiety,
                        fears: questions.filter(q => {
                            const answer = anxietyAssessmentAnswers[q.id] || 3;
                            const score = q.reverse ? (6 - answer) : answer;
                            return score >= 4; // Identify significant fears
                        }).map(q => q.fear)
                    };
                }
                return null;
            };

            // Calculate confidence score based on preparation progress
            const calculateConfidenceScore = () => {
                if (!currentJob || !interviewQuestions.length) return 50;
                
                let score = 0;
                const maxScore = 100;
                
                // Questions reviewed (30% weight)
                const reviewedCount = Object.keys(questionProgress).filter(k => questionProgress[k].reviewed).length;
                const reviewProgress = (reviewedCount / interviewQuestions.length) * 100;
                score += (reviewProgress * 0.3);
                
                // Answers saved (25% weight)
                const answersCount = Object.keys(userAnswers).length;
                const answersProgress = Math.min((answersCount / interviewQuestions.length) * 100, 100);
                score += (answersProgress * 0.25);
                
                // Critical questions reviewed (20% weight)
                const criticalQuestions = interviewQuestions.filter(q => (questionPriorities[q.id] || 'Medium') === 'Critical');
                const criticalReviewed = criticalQuestions.filter(q => questionProgress[q.id]?.reviewed).length;
                const criticalProgress = criticalQuestions.length > 0 ? (criticalReviewed / criticalQuestions.length) * 100 : 50;
                score += (criticalProgress * 0.2);
                
                // Practice sessions (15% weight)
                const sessionsCount = practiceSessions.length;
                const sessionsScore = Math.min(sessionsCount * 10, 100); // 1 session = 10 points, max 100
                score += (sessionsScore * 0.15);
                
                // Story bank prepared (10% weight)
                const storiesCount = userStories.length;
                const storiesScore = Math.min(storiesCount * 5, 100); // 1 story = 5 points, max 100
                score += (storiesScore * 0.1);
                
                return Math.round(Math.min(Math.max(score, 0), 100)); // Clamp between 0-100
            };

            // Enhanced function to mark interview as prepared with progress tracking
            const markInterviewPrepared = () => {
                if (!currentJob) return;
                
                const prepData = {
                    jobId: currentJob.jobId,
                    jobTitle: currentJob.jobTitle || currentJob.title,
                    company: currentJob.company,
                    completedDate: new Date().toISOString().split('T')[0],
                    questionsReviewed: Object.keys(questionProgress).filter(k => questionProgress[k].reviewed).length,
                    totalQuestions: interviewQuestions.length,
                    practiceSessions: practiceSessions.length,
                    userAnswers: userAnswers
                };
                
                InterviewPrepStorage.savePrepData(currentJob.jobId, prepData);
                
                if (currentJob.jobId && window.JobTrackingUtils) {
                    const jobs = window.JobTrackingUtils.getAllTrackedJobs();
                    const updatedJobs = jobs.map(job => {
                        if (job.id === currentJob.jobId || (job.title === currentJob.jobTitle && job.company === currentJob.company)) {
                            return {
                                ...job,
                                interviewPrepared: true,
                                interviewPrepDate: new Date().toISOString().split('T')[0],
                                interviewPrepNotes: `Completed interview preparation. Reviewed ${prepData.questionsReviewed}/${prepData.totalQuestions} questions.`
                            };
                        }
                        return job;
                    });
                    window.JobTrackingUtils.saveTrackedJobs(updatedJobs);
                    window.JobTrackingUtils.showNotification('Interview prep completed and saved to Job Tracker!', 'success');
                } else if (!window.JobTrackingUtils) {
                    if (window.JobTrackingUtils) {
                        window.JobTrackingUtils.showNotification('Prep status saved locally.', 'info');
                    }
                }
            };

            // Save user answer
            const saveAnswer = (questionId, answer) => {
                setUserAnswers(prev => {
                    const updated = {...prev, [questionId]: {
                        answer,
                        savedAt: new Date().toISOString(),
                        version: (prev[questionId]?.version || 0) + 1
                    }};
                    if (currentJob?.jobId) {
                        InterviewPrepStorage.savePrepData(currentJob.jobId, {
                            userAnswers: updated,
                            questionProgress
                        });
                        // Recalculate and save confidence
                        setTimeout(() => {
                            const newConfidence = calculateConfidenceScore();
                            setConfidenceScore(newConfidence);
                            InterviewPrepStorage.saveConfidenceScore(currentJob.jobId, newConfidence, {
                                answersSaved: Object.keys(updated).length
                            });
                        }, 100);
                    }
                    return updated;
                });
            };

            // Update question progress
            const updateProgress = (questionId, field, value) => {
                setQuestionProgress(prev => {
                    const updated = {...prev, [questionId]: {...prev[questionId], [field]: value}};
                    if (currentJob?.jobId) {
                        InterviewPrepStorage.savePrepData(currentJob.jobId, {
                            userAnswers,
                            questionProgress: updated
                        });
                        // Recalculate and save confidence
                        setTimeout(() => {
                            const newConfidence = calculateConfidenceScore();
                            setConfidenceScore(newConfidence);
                            InterviewPrepStorage.saveConfidenceScore(currentJob.jobId, newConfidence, {
                                questionsReviewed: Object.keys(updated).filter(k => updated[k].reviewed).length
                            });
                        }, 100);
                    }
                    return updated;
                });
            };

            // Auto-update confidence score when progress changes
            React.useEffect(() => {
                if (currentJob && interviewQuestions.length > 0) {
                    const newConfidence = calculateConfidenceScore();
                    if (Math.abs(newConfidence - confidenceScore) > 1) { // Only update if significant change
                        setConfidenceScore(newConfidence);
                        if (currentJob.jobId) {
                            InterviewPrepStorage.saveConfidenceScore(currentJob.jobId, newConfidence, {
                                questionsReviewed: Object.keys(questionProgress).filter(k => questionProgress[k].reviewed).length,
                                answersSaved: Object.keys(userAnswers).length,
                                storiesCount: userStories.length
                            });
                        }
                    }
                }
            }, [questionProgress, userAnswers, practiceSessions, userStories, interviewQuestions.length, currentJob?.jobId]);

            // Load job data from localStorage or event (with error handling and data persistence)
            React.useEffect(() => {
                const loadJobData = async (jobData) => {
                    try {
                        setError(null);
                        setLoading(true);
                        
                        if (!jobData || !jobData.jobTitle) {
                            throw new Error('Invalid job data provided');
                        }

                        setCurrentJob(jobData);
                        setIsJobLoaded(true);
                        
                        // Load saved prep data
                        if (jobData.jobId) {
                            const savedData = InterviewPrepStorage.loadPrepData(jobData.jobId);
                            if (savedData) {
                                if (savedData.userAnswers) setUserAnswers(savedData.userAnswers);
                                if (savedData.questionProgress) setQuestionProgress(savedData.questionProgress);
                            }
                        }
                        
                        // Generate questions (with AI if available)
                        const questions = await generateQuestionsForRole(
                            jobData.jobTitle || jobData.title, 
                            jobData.company,
                            jobData.jobDescription || ''
                        );
                        setInterviewQuestions(questions);
                        
                        // Prioritize questions
                        const priorities = prioritizeQuestions(questions, jobData, jobData.interviewDate);
                        setQuestionPriorities(priorities);
                        
                        // Build story bank from resume
                        const stories = buildStoryBankFromResume();
                        setUserStories(stories);
                        
                        // Load saved story bank and merge
                        if (jobData.jobId) {
                            const savedStories = InterviewPrepStorage.loadStoryBank(jobData.jobId);
                            if (savedStories.length > 0) {
                                const mergedStories = [...stories, ...savedStories.filter(s => s.source === 'manual')];
                                const uniqueStories = mergedStories.filter((story, index, self) => 
                                    index === self.findIndex(s => s.title === story.title)
                                );
                                setUserStories(uniqueStories);
                            }
                        }
                        
                        // Load anxiety and confidence data
                        if (jobData.jobId) {
                            const anxietyData = InterviewPrepStorage.loadAnxietyData(jobData.jobId);
                            if (anxietyData) {
                                setAnxietyLevel(anxietyData.level || null);
                                setAnxietyAssessmentAnswers(anxietyData.assessmentAnswers || {});
                            }
                            
                            const confidenceData = InterviewPrepStorage.loadConfidenceHistory(jobData.jobId);
                            if (confidenceData && confidenceData.currentScore !== undefined) {
                                setConfidenceScore(confidenceData.currentScore);
                            }
                        }
                        
                        // Calculate initial confidence score
                        setTimeout(() => {
                            const calculatedConfidence = calculateConfidenceScore();
                            if (calculatedConfidence !== confidenceScore) {
                                setConfidenceScore(calculatedConfidence);
                                if (jobData.jobId) {
                                    InterviewPrepStorage.saveConfidenceScore(jobData.jobId, calculatedConfidence, {
                                        questionsReviewed: Object.keys(questionProgress).filter(k => questionProgress[k].reviewed).length,
                                        answersSaved: Object.keys(userAnswers).length
                                    });
                                }
                            }
                        }, 100);
                        
                        // Load practice sessions
                        const sessions = InterviewPrepStorage.getAllSessions().filter(
                            s => s.jobId === jobData.jobId
                        );
                        setPracticeSessions(sessions);
                        
                        // Check if anxiety assessment needed (if not done yet)
                        if (!anxietyLevel && jobData.jobId) {
                            const anxietyData = InterviewPrepStorage.loadAnxietyData(jobData.jobId);
                            if (!anxietyData) {
                                // Show anxiety assessment after a short delay
                                setTimeout(() => {
                                    setShowAnxietyAssessment(true);
                                }, 1000);
                            }
                        }
                        
                        setLoading(false);
                        
                        if (window.JobTrackingUtils) {
                            window.JobTrackingUtils.showNotification(
                                `Loaded interview prep for ${jobData.company} - ${jobData.jobTitle || jobData.title}`,
                                'success'
                            );
                        }
                    } catch (e) {
                        console.error('Error loading job data:', e);
                        setError(e.message || 'Failed to load job data. Please try again.');
                        setLoading(false);
                        if (window.JobTrackingUtils) {
                            window.JobTrackingUtils.showNotification(
                                'Error loading interview prep data: ' + (e.message || 'Unknown error'),
                                'error'
                            );
                        }
                    }
                };

                // Check localStorage for job data from Job Tracker
                const storedJob = localStorage.getItem('current_interview_job');
                if (storedJob) {
                    try {
                        const jobData = JSON.parse(storedJob);
                        loadJobData(jobData);
                        localStorage.removeItem('current_interview_job');
                    } catch (e) {
                        setError('Invalid job data format');
                        console.error('Error parsing stored job data:', e);
                    }
                }
                
                // Listen for custom event (in case localStorage wasn't used)
                const handleLoadJob = (e) => {
                    const jobCard = e.detail;
                    const jobData = {
                        jobTitle: jobCard.title,
                        company: jobCard.company,
                        location: jobCard.location,
                        jobDescription: jobCard.notes || jobCard.description || '',
                        matchScore: jobCard.matchScore,
                        applicationDate: jobCard.applicationDate,
                        interviewDate: jobCard.interviewDate || new Date().toISOString().split('T')[0],
                        jobId: jobCard.id,
                        source: jobCard.source || '',
                        salary: jobCard.salary || ''
                    };
                    loadJobData(jobData);
                };
                
                window.addEventListener('interview-prep:load-job', handleLoadJob);
                return () => window.removeEventListener('interview-prep:load-job', handleLoadJob);
            }, []);

            const features = [
                {
                    icon: '',
                    title: 'AI Mock Interviews',
                    description: 'Practice with AI-powered interviewers that adapt to your responses and provide real-time feedback.'
                },
                {
                    icon: '',
                    title: 'Question Bank',
                    description: 'Access thousands of interview questions organized by role, company, and difficulty level.'
                },
                {
                    icon: '',
                    title: 'Answer Templates',
                    description: 'Get structured templates and examples for common interview questions and scenarios.'
                },
                {
                    icon: '',
                    title: 'Performance Analytics',
                    description: 'Track your progress with detailed analytics on your interview performance and improvement areas.'
                }
            ];

            const quickStartSteps = [
                {
                    number: 1,
                    title: 'Set Your Goals',
                    description: 'Define your target role and company preferences to personalize your preparation.'
                },
                {
                    number: 2,
                    title: 'Practice Sessions',
                    description: 'Start with AI mock interviews tailored to your specific role and industry.'
                },
                {
                    number: 3,
                    title: 'Track Progress',
                    description: 'Monitor your improvement and refine your approach based on detailed analytics.'
                }
            ];

            const tabs = [
                { id: 'overview', label: 'Overview', icon: '' },
                { id: 'practice', label: 'Practice', icon: '' },
                { id: 'questions', label: 'Questions', icon: '' },
                { id: 'stories', label: 'Story Bank', icon: '' },
                { id: 'wellness', label: 'Wellness', icon: '' },
                { id: 'analytics', label: 'Analytics', icon: '' },
                { id: 'tips', label: 'Tips & Guides', icon: '' },
                { id: 'checklist', label: 'Checklist', icon: '' }
            ];

            // Filter and sort questions
            const filteredQuestions = React.useMemo(() => {
                let filtered = [...interviewQuestions];
                
                // Apply search
                if (searchQuery) {
                    filtered = filtered.filter(q => 
                        q.question.toLowerCase().includes(searchQuery.toLowerCase())
                    );
                }
                
                // Apply category filter
                if (filterCategory !== 'all') {
                    filtered = filtered.filter(q => q.category === filterCategory);
                }
                
                // Apply difficulty filter
                if (filterDifficulty !== 'all') {
                    filtered = filtered.filter(q => q.difficulty === filterDifficulty);
                }
                
                // Apply priority filter
                if (filterPriority !== 'all') {
                    filtered = filtered.filter(q => {
                        const priority = questionPriorities[q.id] || 'Medium';
                        return priority === filterPriority;
                    });
                }
                
                // Apply sorting
                if (sortBy === 'category') {
                    filtered.sort((a, b) => a.category.localeCompare(b.category));
                } else if (sortBy === 'difficulty') {
                    const diffOrder = { Easy: 1, Medium: 2, Hard: 3 };
                    filtered.sort((a, b) => (diffOrder[a.difficulty] || 0) - (diffOrder[b.difficulty] || 0));
                } else if (sortBy === 'priority') {
                    const priorityOrder = { Critical: 1, High: 2, Medium: 3, Low: 4 };
                    filtered.sort((a, b) => {
                        const aPriority = questionPriorities[a.id] || 'Medium';
                        const bPriority = questionPriorities[b.id] || 'Medium';
                        return (priorityOrder[aPriority] || 3) - (priorityOrder[bPriority] || 3);
                    });
                } else {
                    filtered.sort((a, b) => a.id - b.id);
                }
                
                return filtered;
            }, [interviewQuestions, searchQuery, filterCategory, filterDifficulty, filterPriority, sortBy, questionPriorities]);

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-slate-900'} border rounded-lg p-1`}>
                        <div className="flex space-x-1">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
                                        activeTab === tab.id
                                            ? 'bg-blue-600 text-white'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-slate-400 hover:text-white hover:bg-slate-800'
                                    }`}
                                >
                                    <div className="w-4 h-4">{tab.icon}</div>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Error Display */}
                    {error && (
                        <div className={`${isLightMode ? 'bg-red-50 border-red-200' : 'bg-red-900/20 border-red-700/50'} border rounded-xl p-4`}>
                            <div className="flex items-center gap-3">
                                <span className="text-red-500 text-xl"></span>
                                <div className="flex-1">
                                    <h4 className={`font-semibold ${isLightMode ? 'text-red-900' : 'text-red-100'}`}>Error</h4>
                                    <p className={`text-sm ${isLightMode ? 'text-red-700' : 'text-red-300'}`}>{error}</p>
                                </div>
                                <button
                                    onClick={() => setError(null)}
                                    className={`${isLightMode ? 'text-red-600 hover:text-red-800' : 'text-red-300 hover:text-red-100'}`}
                                >
                                    
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Loading State */}
                    {loading && (
                        <div className={`${isLightMode ? 'bg-blue-50 border-blue-200' : 'bg-blue-900/20 border-blue-700/50'} border rounded-xl p-6 text-center`}>
                            <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-3"></div>
                            <p className={`${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>Loading interview preparation data...</p>
                        </div>
                    )}

                    {/* Job Info Banner - Shows when job is loaded from Job Tracker */}
                    {currentJob && !loading && (
                        <div className={`${isLightMode ? 'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200' : 'bg-gradient-to-r from-blue-900/30 to-indigo-900/30 border-blue-700/50'} border rounded-2xl p-6`}>
                            <div className="flex items-start justify-between">
                                <div className="flex-1">
                                    <div className="flex items-center gap-3 mb-2">
                                        <h3 className={`text-xl font-bold ${isLightMode ? 'text-blue-900' : 'text-blue-100'}`}>
                                            {currentJob.jobTitle || currentJob.title}
                                        </h3>
                                        {currentJob.matchScore && (
                                            <span className={`px-3 py-1 rounded-full text-xs font-semibold ${
                                                currentJob.matchScore >= 90 ? 'bg-green-500/20 text-green-700' :
                                                currentJob.matchScore >= 80 ? 'bg-blue-500/20 text-blue-700' :
                                                'bg-yellow-500/20 text-yellow-700'
                                            }`}>
                                                {currentJob.matchScore}% Match
                                            </span>
                                        )}
                                    </div>
                                    <p className={`${isLightMode ? 'text-blue-700' : 'text-blue-300'} font-medium mb-2`}>
                                        {currentJob.company} {currentJob.location ? ` ${currentJob.location}` : ''}
                                    </p>
                                    {currentJob.interviewDate && (
                                        <p className={`${isLightMode ? 'text-blue-600' : 'text-blue-400'} text-sm`}>
                                             Interview scheduled for: {new Date(currentJob.interviewDate).toLocaleDateString()}
                                        </p>
                                    )}
                                    {currentJob.jobDescription && currentJob.jobDescription.length > 0 && (
                                        <div className={`mt-3 ${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-lg p-3 max-h-24 overflow-y-auto`}>
                                            <p className={`text-xs ${isLightMode ? 'text-slate-600' : 'text-gray-300'}`}>
                                                {currentJob.jobDescription.length > 300 
                                                    ? currentJob.jobDescription.substring(0, 300) + '...'
                                                    : currentJob.jobDescription}
                                            </p>
                                        </div>
                                    )}
                                </div>
                                <div className="flex gap-2 ml-4">
                                    <button
                                        onClick={() => {
                                            setShowCompanyResearch(true);
                                            fetchCompanyResearch(currentJob.company);
                                        }}
                                        className={`${isLightMode ? 'text-purple-600 hover:text-purple-800 border-purple-300' : 'text-purple-300 hover:text-purple-100 border-purple-600'} px-3 py-2 rounded-lg border hover:bg-purple-100/50 transition-colors text-sm font-medium`}
                                    >
                                        Company Info 
                                    </button>
                                    <button
                                        onClick={() => {
                                            const jobTrackerLink = document.querySelector('[data-id="job-tracker"]');
                                            if (jobTrackerLink) {
                                                jobTrackerLink.click();
                                            }
                                        }}
                                        className={`${isLightMode ? 'text-blue-600 hover:text-blue-800 border-blue-300' : 'text-blue-300 hover:text-blue-100 border-blue-600'} px-4 py-2 rounded-lg border hover:bg-blue-100/50 transition-colors text-sm font-medium`}
                                    >
                                        View in Tracker 
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Tab Content */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border shadow-lg rounded-2xl p-8`}>
                        {activeTab === 'overview' && (
                            <div className="space-y-8">
                                {/* Features Grid */}
                                <div>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-6`}>Key Features</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                        {features.map((feature, index) => (
                                            <div key={index} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-slate-900 border-slate-800'} border rounded-xl p-6 hover:border-blue-500/50 transition-all duration-300`}>
                                                <div className="flex items-center gap-3 mb-4">
                                                    <div className="w-10 h-10 bg-blue-600/20 rounded-lg flex items-center justify-center">
                                                        <div className="w-5 h-5 text-blue-400 text-xl">{feature.icon}</div>
                                                    </div>
                                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>{feature.title}</h3>
                                                </div>
                                                <p className={`${isLightMode ? 'text-slate-600' : 'text-slate-400'} text-sm leading-relaxed`}>{feature.description}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Quick Start Guide */}
                                <div>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-6`}>Quick Start Guide</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        {quickStartSteps.map((step, index) => (
                                            <div key={index} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-slate-900 border-slate-800'} border rounded-xl p-6`}>
                                                <div className="flex items-start gap-4">
                                                    <div className="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                                        <span className="text-white font-bold text-sm">{step.number}</span>
                                                    </div>
                                                    <div>
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>{step.title}</h3>
                                                        <p className={`${isLightMode ? 'text-slate-600' : 'text-slate-400'} text-sm leading-relaxed`}>{step.description}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'practice' && (
                            <div className="space-y-6">
                                {currentJob ? (
                                    <>
                                        <div className={`${isLightMode ? 'bg-blue-50 border-blue-200' : 'bg-blue-900/20 border-blue-700/50'} border rounded-xl p-6`}>
                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>
                                                Prepare for your interview at {currentJob.company}
                                            </h3>
                                            <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-300'} mb-4`}>
                                                Role: <span className="font-semibold">{currentJob.jobTitle || currentJob.title}</span>
                                            </p>
                                            {currentJob.jobDescription && currentJob.jobDescription.length > 0 && (
                                                <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-lg p-4 mb-4`}>
                                                    <p className={`text-sm ${isLightMode ? 'text-slate-700' : 'text-gray-300'} line-clamp-3`}>
                                                        {currentJob.jobDescription.length > 200 
                                                            ? currentJob.jobDescription.substring(0, 200) + '...'
                                                            : currentJob.jobDescription}
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <button 
                                                onClick={() => setActiveTab('questions')}
                                                className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6 hover:border-blue-500 transition-all duration-300 text-left`}
                                            >
                                                <div className="text-3xl mb-3"></div>
                                                <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>
                                                    Review Common Questions
                                                </h4>
                                                <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'} text-sm`}>
                                                    Browse questions typically asked for {currentJob.jobTitle || currentJob.title} roles
                                                </p>
                                            </button>
                                            
                                            <button 
                                                onClick={() => {
                                                    setShowMockInterview(true);
                                                    setMockInterviewState({
                                                        currentQuestion: 0,
                                                        answers: [],
                                                        currentAnswer: '',
                                                        startTime: new Date()
                                                    });
                                                }}
                                                className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6 hover:border-blue-500 transition-all duration-300 text-left`}
                                            >
                                                <div className="text-3xl mb-3"></div>
                                                <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>
                                                    Start AI Mock Interview
                                                </h4>
                                                <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'} text-sm`}>
                                                    Practice with AI interviewer tailored to this role
                                                </p>
                                            </button>
                                        </div>
                                    </>
                                ) : (
                                    <div className="text-center py-12">
                                        <div className="w-16 h-16 text-blue-400 mx-auto mb-6 text-6xl"></div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>
                                            Start Your Practice Session
                                        </h2>
                                        <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'} mb-8 max-w-md mx-auto`}>
                                            Select a job from your Job Tracker to start personalized interview preparation.
                                        </p>
                                        <button 
                                            onClick={() => {
                                                const jobTrackerLink = document.querySelector('[data-id="job-tracker"]');
                                                if (jobTrackerLink) jobTrackerLink.click();
                                            }}
                                            className="bg-blue-600 text-white px-8 py-4 rounded-lg font-semibold flex items-center gap-2 mx-auto hover:bg-blue-700 transition-all duration-300"
                                        >
                                            Go to Job Tracker 
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'questions' && (
                            <div className="space-y-6">
                                {currentJob ? (
                                    <>
                                        <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                                            <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>
                                                Interview Questions for {currentJob.jobTitle || currentJob.title}
                                            </h3>
                                            <button 
                                                onClick={async () => {
                                                    setLoading(true);
                                                    const questions = await generateQuestionsForRole(
                                                        currentJob.jobTitle || currentJob.title, 
                                                        currentJob.company,
                                                        currentJob.jobDescription || ''
                                                    );
                                                    setInterviewQuestions(questions);
                                                    setLoading(false);
                                                    if (window.JobTrackingUtils) {
                                                        window.JobTrackingUtils.showNotification('Questions refreshed!', 'success');
                                                    }
                                                }}
                                                className="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors"
                                                disabled={loading}
                                            >
                                                {loading ? 'Refreshing...' : 'Refresh Questions '}
                                            </button>
                                        </div>

                                        {/* Search and Filters */}
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-4 space-y-4`}>
                                            <div className="flex flex-col md:flex-row gap-4">
                                                <input
                                                    type="text"
                                                    placeholder="Search questions..."
                                                    value={searchQuery}
                                                    onChange={(e) => setSearchQuery(e.target.value)}
                                                    className={`flex-1 px-4 py-2 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white' : 'border-gray-600 bg-gray-700'} ${isLightMode ? 'text-slate-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                                />
                                                <select
                                                    value={filterCategory}
                                                    onChange={(e) => setFilterCategory(e.target.value)}
                                                    className={`px-4 py-2 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white' : 'border-gray-600 bg-gray-700'} ${isLightMode ? 'text-slate-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                                >
                                                    <option value="all">All Categories</option>
                                                    <option value="General">General</option>
                                                    <option value="Technical">Technical</option>
                                                    <option value="Behavioral">Behavioral</option>
                                                    <option value="Role-Specific">Role-Specific</option>
                                                </select>
                                                <select
                                                    value={filterDifficulty}
                                                    onChange={(e) => setFilterDifficulty(e.target.value)}
                                                    className={`px-4 py-2 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white' : 'border-gray-600 bg-gray-700'} ${isLightMode ? 'text-slate-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                                >
                                                    <option value="all">All Difficulties</option>
                                                    <option value="Easy">Easy</option>
                                                    <option value="Medium">Medium</option>
                                                    <option value="Hard">Hard</option>
                                                </select>
                                                <select
                                                    value={filterPriority}
                                                    onChange={(e) => setFilterPriority(e.target.value)}
                                                    className={`px-4 py-2 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white' : 'border-gray-600 bg-gray-700'} ${isLightMode ? 'text-slate-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                                >
                                                    <option value="all">All Priorities</option>
                                                    <option value="Critical">Critical</option>
                                                    <option value="High">High</option>
                                                    <option value="Medium">Medium</option>
                                                    <option value="Low">Low</option>
                                                </select>
                                                <select
                                                    value={sortBy}
                                                    onChange={(e) => setSortBy(e.target.value)}
                                                    className={`px-4 py-2 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white' : 'border-gray-600 bg-gray-700'} ${isLightMode ? 'text-slate-800' : 'text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                                >
                                                    <option value="id">Sort by ID</option>
                                                    <option value="priority">Sort by Priority</option>
                                                    <option value="category">Sort by Category</option>
                                                    <option value="difficulty">Sort by Difficulty</option>
                                                </select>
                                            </div>
                                            <div className="flex items-center justify-between">
                                                <div className="text-sm text-gray-500">
                                                    Showing {filteredQuestions.length} of {interviewQuestions.length} questions
                                                </div>
                                                {interviewQuestions.filter(q => (questionPriorities[q.id] || 'Medium') === 'Critical').length > 0 && (
                                                    <button
                                                        onClick={() => {
                                                            setFilterPriority('Critical');
                                                            setFilterCategory('all');
                                                            setFilterDifficulty('all');
                                                            setSearchQuery('');
                                                        }}
                                                        className={`text-sm px-3 py-1.5 rounded-lg font-medium ${isLightMode ? 'bg-red-50 text-red-600 hover:bg-red-100' : 'bg-red-900/30 text-red-300 hover:bg-red-900/50'} transition-colors`}
                                                    >
                                                         Start with Critical ({interviewQuestions.filter(q => (questionPriorities[q.id] || 'Medium') === 'Critical').length})
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        
                                        <div className="space-y-4">
                                            {filteredQuestions.length > 0 ? (
                                                filteredQuestions.map((q) => {
                                                    const progress = questionProgress[q.id] || {};
                                                    const savedAnswer = userAnswers[q.id];
                                                    return (
                                                        <div 
                                                            key={q.id}
                                                            className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6 hover:shadow-lg transition-all duration-300 ${
                                                                progress.reviewed ? (isLightMode ? 'border-green-300 bg-green-50/50' : 'border-green-700/50 bg-green-900/20') : ''
                                                            } ${
                                                                (questionPriorities[q.id] || 'Medium') === 'Critical' 
                                                                    ? (isLightMode ? 'border-l-4 border-l-red-500' : 'border-l-4 border-l-red-600')
                                                                    : (questionPriorities[q.id] || 'Medium') === 'High'
                                                                    ? (isLightMode ? 'border-l-4 border-l-orange-500' : 'border-l-4 border-l-orange-600')
                                                                    : ''
                                                            }`}
                                                        >
                                                            <div className="flex items-start justify-between mb-3">
                                                                <div className="flex items-start gap-3 flex-1">
                                                                    <div className="flex items-center gap-2">
                                                                        <input
                                                                            type="checkbox"
                                                                            checked={progress.reviewed || false}
                                                                            onChange={(e) => updateProgress(q.id, 'reviewed', e.target.checked)}
                                                                            className="w-4 h-4 text-blue-600 rounded"
                                                                        />
                                                                        <span className={`text-lg font-bold ${isLightMode ? 'text-slate-400' : 'text-gray-500'}`}>
                                                                            {q.id}.
                                                                        </span>
                                                                    </div>
                                                                    <div className="flex-1">
                                                                        <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>
                                                                            {q.question}
                                                                        </h4>
                                                                        {savedAnswer && (
                                                                            <p className={`text-xs ${isLightMode ? 'text-green-700' : 'text-green-300'} mb-1`}>
                                                                                 Answer saved
                                                                            </p>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                                <div className="flex gap-2 ml-2 flex-wrap">
                                                                    <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                                        (questionPriorities[q.id] || 'Medium') === 'Critical' ? (isLightMode ? 'bg-red-500 text-white font-bold' : 'bg-red-600 text-white font-bold') :
                                                                        (questionPriorities[q.id] || 'Medium') === 'High' ? (isLightMode ? 'bg-orange-500 text-white' : 'bg-orange-600 text-white') :
                                                                        (questionPriorities[q.id] || 'Medium') === 'Low' ? (isLightMode ? 'bg-gray-300 text-gray-700' : 'bg-gray-600 text-gray-300') :
                                                                        (isLightMode ? 'bg-yellow-200 text-yellow-800' : 'bg-yellow-600/50 text-yellow-200')
                                                                    }`}>
                                                                        {(questionPriorities[q.id] || 'Medium') === 'Critical' && ' '}
                                                                        {questionPriorities[q.id] || 'Medium'}
                                                                    </span>
                                                                    <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                                        q.category === 'General' ? (isLightMode ? 'bg-blue-100 text-blue-700' : 'bg-blue-900/50 text-blue-300') :
                                                                        q.category === 'Technical' ? (isLightMode ? 'bg-purple-100 text-purple-700' : 'bg-purple-900/50 text-purple-300') :
                                                                        q.category === 'Behavioral' ? (isLightMode ? 'bg-amber-100 text-amber-700' : 'bg-amber-900/50 text-amber-300') :
                                                                        (isLightMode ? 'bg-green-100 text-green-700' : 'bg-green-900/50 text-green-300')
                                                                    }`}>
                                                                        {q.category}
                                                                    </span>
                                                                    <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                                        q.difficulty === 'Easy' ? (isLightMode ? 'bg-green-100 text-green-700' : 'bg-green-900/50 text-green-300') :
                                                                        q.difficulty === 'Medium' ? (isLightMode ? 'bg-yellow-100 text-yellow-700' : 'bg-yellow-900/50 text-yellow-300') :
                                                                        (isLightMode ? 'bg-red-100 text-red-700' : 'bg-red-900/50 text-red-300')
                                                                    }`}>
                                                                        {q.difficulty}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div className="flex flex-wrap gap-2 mt-4">
                                                                <button 
                                                                    onClick={async () => {
                                                                        setSelectedQuestion(q);
                                                                        setShowSampleAnswer(true);
                                                                        setLoading(true);
                                                                        const answer = await generateSampleAnswer(q.question, currentJob.jobTitle || currentJob.title, currentJob.company);
                                                                        setSelectedQuestion({...q, sampleAnswer: answer});
                                                                        setLoading(false);
                                                                    }}
                                                                    className={`text-sm font-medium px-3 py-1.5 rounded-lg ${isLightMode ? 'bg-blue-50 text-blue-600 hover:bg-blue-100' : 'bg-blue-900/30 text-blue-300 hover:bg-blue-900/50'} transition-colors`}
                                                                >
                                                                    View Sample Answer 
                                                                </button>
                                                                <button 
                                                                    onClick={() => {
                                                                        setSelectedQuestion(q);
                                                                        setPracticeAnswer(savedAnswer?.answer || '');
                                                                        setShowPracticeModal(true);
                                                                    }}
                                                                    className={`text-sm font-medium px-3 py-1.5 rounded-lg ${isLightMode ? 'bg-purple-50 text-purple-600 hover:bg-purple-100' : 'bg-purple-900/30 text-purple-300 hover:bg-purple-900/50'} transition-colors`}
                                                                >
                                                                    Practice Answer 
                                                                </button>
                                                                {savedAnswer && (
                                                                    <button 
                                                                        onClick={() => {
                                                                            setSelectedQuestion(q);
                                                                            setPracticeAnswer(savedAnswer.answer);
                                                                            setShowPracticeModal(true);
                                                                        }}
                                                                        className={`text-sm font-medium px-3 py-1.5 rounded-lg ${isLightMode ? 'bg-green-50 text-green-600 hover:bg-green-100' : 'bg-green-900/30 text-green-300 hover:bg-green-900/50'} transition-colors`}
                                                                    >
                                                                        View My Answer 
                                                                    </button>
                                                                )}
                                                            </div>
                                                        </div>
                                                    );
                                                })
                                            ) : (
                                                <div className="text-center py-8">
                                                    <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}>
                                                        {searchQuery || filterCategory !== 'all' || filterDifficulty !== 'all' 
                                                            ? 'No questions match your filters. Try adjusting your search.'
                                                            : `Generating questions for ${currentJob.jobTitle || currentJob.title}...`}
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    <div className="text-center py-12">
                                        <div className="w-16 h-16 text-blue-400 mx-auto mb-6 text-6xl"></div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>
                                            Browse Interview Questions
                                        </h2>
                                        <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'} mb-8 max-w-md mx-auto`}>
                                            Select a job from your Job Tracker to see personalized interview questions.
                                        </p>
                                        <button 
                                            onClick={() => {
                                                const jobTrackerLink = document.querySelector('[data-id="job-tracker"]');
                                                if (jobTrackerLink) jobTrackerLink.click();
                                            }}
                                            className="bg-blue-600 text-white px-8 py-4 rounded-lg font-semibold flex items-center gap-2 mx-auto hover:bg-blue-700 transition-all duration-300"
                                        >
                                            Go to Job Tracker 
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'analytics' && (
                            <div className="space-y-6">
                                {currentJob ? (
                                    <>
                                        <div>
                                            <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-6`}>
                                                Interview Preparation Analytics
                                            </h3>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                                                <div className={`${isLightMode ? 'bg-blue-50 border-blue-200' : 'bg-blue-900/20 border-blue-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-blue-900' : 'text-blue-100'} mb-1`}>
                                                        {interviewQuestions.length}
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>
                                                        Total Questions
                                                    </div>
                                                </div>
                                                
                                                <div className={`${isLightMode ? 'bg-green-50 border-green-200' : 'bg-green-900/20 border-green-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-green-900' : 'text-green-100'} mb-1`}>
                                                        {Object.keys(questionProgress).filter(k => questionProgress[k].reviewed).length}
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-green-700' : 'text-green-300'}`}>
                                                        Questions Reviewed
                                                    </div>
                                                    <div className={`text-xs ${isLightMode ? 'text-green-600' : 'text-green-400'} mt-1`}>
                                                        {interviewQuestions.length > 0 ? Math.round((Object.keys(questionProgress).filter(k => questionProgress[k].reviewed).length / interviewQuestions.length) * 100) : 0}% Complete
                                                    </div>
                                                </div>
                                                
                                                <div className={`${isLightMode ? 'bg-purple-50 border-purple-200' : 'bg-purple-900/20 border-purple-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-purple-900' : 'text-purple-100'} mb-1`}>
                                                        {Object.keys(userAnswers).length}
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-purple-700' : 'text-purple-300'}`}>
                                                        Answers Saved
                                                    </div>
                                                </div>
                                                
                                                <div className={`${isLightMode ? 'bg-amber-50 border-amber-200' : 'bg-amber-900/20 border-amber-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-amber-900' : 'text-amber-100'} mb-1`}>
                                                        {practiceSessions.length}
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-amber-700' : 'text-amber-300'}`}>
                                                        Practice Sessions
                                                    </div>
                                                </div>
                                                
                                                <div className={`${isLightMode ? 'bg-indigo-50 border-indigo-200' : 'bg-indigo-900/20 border-indigo-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-indigo-900' : 'text-indigo-100'} mb-1`}>
                                                        {currentJob.matchScore || 'N/A'}%
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-indigo-700' : 'text-indigo-300'}`}>
                                                        Job Match Score
                                                    </div>
                                                </div>

                                                <div className={`${isLightMode ? 'bg-pink-50 border-pink-200' : 'bg-pink-900/20 border-pink-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-pink-900' : 'text-pink-100'} mb-1`}>
                                                        {interviewQuestions.filter(q => q.category === 'Role-Specific').length}
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-pink-700' : 'text-pink-300'}`}>
                                                        Role-Specific Qs
                                                    </div>
                                                </div>

                                                <div className={`${isLightMode ? 'bg-teal-50 border-teal-200' : 'bg-teal-900/20 border-teal-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-teal-900' : 'text-teal-100'} mb-1`}>
                                                        {Object.keys(answerFeedback).length}
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-teal-700' : 'text-teal-300'}`}>
                                                        AI Evaluations
                                                    </div>
                                                    {Object.keys(answerFeedback).length > 0 && (
                                                        <div className={`text-xs ${isLightMode ? 'text-teal-600' : 'text-teal-400'} mt-1`}>
                                                            Avg: {Math.round(Object.values(answerFeedback).reduce((sum, f) => sum + (f.score || 0), 0) / Object.keys(answerFeedback).length)}/10
                                                        </div>
                                                    )}
                                                </div>

                                                <div className={`${isLightMode ? 'bg-red-50 border-red-200' : 'bg-red-900/20 border-red-700/50'} border rounded-xl p-6`}>
                                                    <div className="text-3xl mb-2"></div>
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-red-900' : 'text-red-100'} mb-1`}>
                                                        {practiceSessions.reduce((sum, s) => sum + (s.duration || 0), 0)}
                                                    </div>
                                                    <div className={`text-sm ${isLightMode ? 'text-red-700' : 'text-red-300'}`}>
                                                        Minutes Practiced
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {currentJob.interviewDate && (
                                                <div className={`${isLightMode ? 'bg-amber-50 border-amber-200' : 'bg-amber-900/20 border-amber-700/50'} border rounded-xl p-6 mb-6`}>
                                                    <h4 className={`font-semibold ${isLightMode ? 'text-amber-900' : 'text-amber-100'} mb-2`}>
                                                         Interview Date
                                                    </h4>
                                                    <p className={`${isLightMode ? 'text-amber-700' : 'text-amber-300'}`}>
                                                        {new Date(currentJob.interviewDate).toLocaleDateString('en-US', { 
                                                            weekday: 'long', 
                                                            year: 'numeric', 
                                                            month: 'long', 
                                                            day: 'numeric' 
                                                        })}
                                                    </p>
                                                    <p className={`text-sm ${isLightMode ? 'text-amber-600' : 'text-amber-400'} mt-2`}>
                                                        {Math.ceil((new Date(currentJob.interviewDate) - new Date()) / (1000 * 60 * 60 * 24))} days until interview
                                                    </p>
                                                </div>
                                            )}

                                            {/* Practice Session History */}
                                            {practiceSessions.length > 0 && (
                                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                                                    <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-4`}>
                                                         Practice Session History
                                                    </h4>
                                                    <div className="space-y-3 max-h-64 overflow-y-auto">
                                                        {practiceSessions.slice().reverse().map((session, idx) => (
                                                            <div key={idx} className={`p-4 rounded-lg ${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'}`}>
                                                                <div className="flex items-center justify-between mb-2">
                                                                    <span className={`text-sm font-medium ${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>
                                                                        {new Date(session.date).toLocaleDateString()}
                                                                    </span>
                                                                    <span className={`text-xs ${isLightMode ? 'text-slate-500' : 'text-gray-400'}`}>
                                                                        {session.duration} minutes
                                                                    </span>
                                                                </div>
                                                                <p className={`text-xs ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}>
                                                                    {session.answers?.length || 0} questions answered
                                                                </p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    <div className="text-center py-12">
                                        <div className="w-16 h-16 text-blue-400 mx-auto mb-6 text-6xl"></div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>Track Your Progress</h2>
                                        <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'} mb-8 max-w-md mx-auto`}>
                                            Select a job from your Job Tracker to see personalized interview analytics and track your preparation progress.
                                        </p>
                                        <button 
                                            onClick={() => {
                                                const jobTrackerLink = document.querySelector('[data-id="job-tracker"]');
                                                if (jobTrackerLink) jobTrackerLink.click();
                                            }}
                                            className="bg-blue-600 text-white px-8 py-4 rounded-lg font-semibold flex items-center gap-2 mx-auto hover:bg-blue-700 transition-all duration-300"
                                        >
                                            Go to Job Tracker 
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Tips & Guides Tab */}
                        {activeTab === 'tips' && (
                            <div className="space-y-6">
                                <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-6`}>
                                    Interview Tips & Guides
                                </h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className={`${isLightMode ? 'bg-blue-50 border-blue-200' : 'bg-blue-900/20 border-blue-700/50'} border rounded-xl p-6`}>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-blue-900' : 'text-blue-100'} mb-3`}> Before the Interview</h4>
                                        <ul className={`space-y-2 text-sm ${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>
                                            <li> Research the company thoroughly</li>
                                            <li> Review the job description</li>
                                            <li> Prepare questions to ask</li>
                                            <li> Plan your outfit (business professional)</li>
                                            <li> Test your technology (for virtual interviews)</li>
                                            <li> Prepare your interview space (quiet, professional)</li>
                                        </ul>
                                    </div>

                                    <div className={`${isLightMode ? 'bg-green-50 border-green-200' : 'bg-green-900/20 border-green-700/50'} border rounded-xl p-6`}>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-green-900' : 'text-green-100'} mb-3`}> During the Interview</h4>
                                        <ul className={`space-y-2 text-sm ${isLightMode ? 'text-green-700' : 'text-green-300'}`}>
                                            <li> Maintain eye contact</li>
                                            <li> Use the STAR method for behavioral questions</li>
                                            <li> Listen carefully before answering</li>
                                            <li> Show enthusiasm and interest</li>
                                            <li> Ask thoughtful questions</li>
                                            <li> Be yourself and authentic</li>
                                        </ul>
                                    </div>

                                    <div className={`${isLightMode ? 'bg-purple-50 border-purple-200' : 'bg-purple-900/20 border-purple-700/50'} border rounded-xl p-6`}>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-purple-900' : 'text-purple-100'} mb-3`}> After the Interview</h4>
                                        <ul className={`space-y-2 text-sm ${isLightMode ? 'text-purple-700' : 'text-purple-300'}`}>
                                            <li> Send a thank-you email within 24 hours</li>
                                            <li> Reference specific discussion points</li>
                                            <li> Reiterate your interest</li>
                                            <li> Follow up if you haven't heard back in 1-2 weeks</li>
                                        </ul>
                                    </div>

                                    <div className={`${isLightMode ? 'bg-amber-50 border-amber-200' : 'bg-amber-900/20 border-amber-700/50'} border rounded-xl p-6`}>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-amber-900' : 'text-amber-100'} mb-3`}> General Tips</h4>
                                        <ul className={`space-y-2 text-sm ${isLightMode ? 'text-amber-700' : 'text-amber-300'}`}>
                                            <li> Practice common questions</li>
                                            <li> Prepare examples from your experience</li>
                                            <li> Quantify your achievements</li>
                                            <li> Research salary ranges</li>
                                            <li> Be prepared to negotiate</li>
                                        </ul>
                                    </div>
                                </div>

                                {currentJob && (
                                    <div className={`${isLightMode ? 'bg-indigo-50 border-indigo-200' : 'bg-indigo-900/20 border-indigo-700/50'} border rounded-xl p-6 mt-6`}>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-indigo-900' : 'text-indigo-100'} mb-3`}>
                                             Follow-up Email Template
                                        </h4>
                                        <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-lg p-4 mb-3`}>
                                            <p className={`text-sm ${isLightMode ? 'text-slate-700' : 'text-gray-300'} font-mono whitespace-pre-wrap`}>
{`Subject: Thank You - ${currentJob.jobTitle || currentJob.title} Position

Dear [Interviewer Name],

Thank you for taking the time to speak with me today about the ${currentJob.jobTitle || currentJob.title} position at ${currentJob.company}. I enjoyed learning more about [specific topic discussed].

I'm particularly excited about [specific aspect of role/company mentioned]. I believe my experience in [relevant experience] aligns well with what you're looking for.

I look forward to hearing from you and the next steps in the process.

Best regards,
[Your Name]`}
                                            </p>
                                        </div>
                                        <button
                                            onClick={() => {
                                                navigator.clipboard.writeText(`Subject: Thank You - ${currentJob.jobTitle || currentJob.title} Position

Dear [Interviewer Name],

Thank you for taking the time to speak with me today about the ${currentJob.jobTitle || currentJob.title} position at ${currentJob.company}. I enjoyed learning more about the role and company.

I'm particularly excited about the opportunity to contribute to [specific aspect]. I believe my experience aligns well with what you're looking for.

I look forward to hearing from you.

Best regards,
[Your Name]`);
                                                if (window.JobTrackingUtils) {
                                                    window.JobTrackingUtils.showNotification('Email template copied to clipboard!', 'success');
                                                }
                                            }}
                                            className={`text-sm ${isLightMode ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-indigo-500 hover:bg-indigo-600'} text-white px-4 py-2 rounded-lg transition-colors`}
                                        >
                                            Copy Template
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Checklist Tab */}
                        {activeTab === 'checklist' && (
                            <div className="space-y-6">
                                <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-6`}>
                                    Interview Preparation Checklist
                                </h3>
                                
                                {currentJob && currentJob.interviewDate ? (
                                    <div className={`${isLightMode ? 'bg-amber-50 border-amber-200' : 'bg-amber-900/20 border-amber-700/50'} border rounded-xl p-6 mb-6`}>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-amber-900' : 'text-amber-100'} mb-2`}>
                                             Interview Date: {new Date(currentJob.interviewDate).toLocaleDateString('en-US', { 
                                                weekday: 'long', 
                                                year: 'numeric', 
                                                month: 'long', 
                                                day: 'numeric' 
                                            })}
                                        </h4>
                                        <p className={`text-sm ${isLightMode ? 'text-amber-700' : 'text-amber-300'}`}>
                                            Days until interview: {Math.ceil((new Date(currentJob.interviewDate) - new Date()) / (1000 * 60 * 60 * 24))}
                                        </p>
                                    </div>
                                ) : null}

                                <div className="space-y-4">
                                    {[
                                        { category: ' Preparation', items: [
                                            'Research company culture and values',
                                            'Review job description thoroughly',
                                            'Prepare questions to ask interviewers',
                                            'Review your resume and be ready to discuss it',
                                            'Practice answers to common questions'
                                        ]},
                                        { category: ' Professional Materials', items: [
                                            'Prepare multiple copies of your resume',
                                            'Bring portfolio/work samples (if applicable)',
                                            'Prepare references list',
                                            'Bring notebook and pen for notes'
                                        ]},
                                        { category: ' Attire & Appearance', items: [
                                            'Plan professional outfit',
                                            'Ensure outfit is clean and pressed',
                                            'Groom professionally',
                                            'Check appearance in mirror'
                                        ]},
                                        { category: ' Technology (Virtual Interviews)', items: [
                                            'Test video/camera setup',
                                            'Test microphone and audio',
                                            'Check internet connection',
                                            'Close unnecessary applications',
                                            'Prepare quiet, professional space',
                                            'Have backup plan if technology fails'
                                        ]},
                                        { category: ' Logistics (In-Person)', items: [
                                            'Confirm interview location',
                                            'Plan route and check traffic',
                                            'Arrive 10-15 minutes early',
                                            'Bring parking money/transit fare',
                                            'Have interviewer contact information'
                                        ]},
                                        { category: ' Day Before', items: [
                                            'Review your prepared answers',
                                            'Get a good night\'s sleep',
                                            'Set multiple alarms',
                                            'Prepare everything you need',
                                            'Review company website one more time'
                                        ]},
                                        { category: ' Day Of', items: [
                                            'Eat a good breakfast',
                                            'Leave with plenty of time',
                                            'Arrive 10-15 minutes early',
                                            'Turn off phone or set to silent',
                                            'Bring positive attitude and confidence'
                                        ]}
                                    ].map((section, idx) => (
                                        <div key={idx} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                                            <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-4`}>
                                                {section.category}
                                            </h4>
                                            <div className="space-y-2">
                                                {section.items.map((item, itemIdx) => (
                                                    <label key={itemIdx} className="flex items-center gap-3 cursor-pointer">
                                                        <input
                                                            type="checkbox"
                                                            className="w-4 h-4 text-blue-600 rounded"
                                                        />
                                                        <span className={`text-sm ${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>
                                                            {item}
                                                        </span>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Story Bank Tab */}
                        {activeTab === 'stories' && (
                            <div className="space-y-6">
                                <div className="flex items-center justify-between mb-6">
                                    <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'}`}>
                                        Story Bank
                                    </h3>
                                    <button
                                        onClick={() => {
                                            // Build story bank from resume
                                            const stories = buildStoryBankFromResume();
                                            setUserStories(stories);
                                            if (currentJob?.jobId) {
                                                InterviewPrepStorage.saveStoryBank(currentJob.jobId, stories);
                                            }
                                            if (window.JobTrackingUtils) {
                                                window.JobTrackingUtils.showNotification(`Loaded ${stories.length} stories from your resume!`, 'success');
                                            }
                                        }}
                                        className={`text-sm px-4 py-2 rounded-lg font-medium ${isLightMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'} text-white transition-colors`}
                                    >
                                         Refresh from Resume
                                    </button>
                                </div>

                                {userStories.length > 0 ? (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {userStories.map((story) => (
                                            <div 
                                                key={story.id}
                                                className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6 hover:shadow-lg transition-all duration-300`}
                                            >
                                                <div className="flex items-start justify-between mb-3">
                                                    <div className="flex-1">
                                                        <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>
                                                            {story.title}
                                                        </h4>
                                                        {story.company && (
                                                            <p className={`text-sm ${isLightMode ? 'text-slate-600' : 'text-gray-400'} mb-1`}>
                                                                {story.company} {story.position ? ` ${story.position}` : ''}
                                                            </p>
                                                        )}
                                                        <span className={`inline-block px-2 py-1 rounded text-xs font-medium ${
                                                            story.source === 'resume' 
                                                                ? (isLightMode ? 'bg-blue-100 text-blue-700' : 'bg-blue-900/50 text-blue-300')
                                                                : (isLightMode ? 'bg-green-100 text-green-700' : 'bg-green-900/50 text-green-300')
                                                        }`}>
                                                            {story.source === 'resume' ? ' From Resume' : ' Manual'}
                                                        </span>
                                                    </div>
                                                </div>
                                                
                                                {story.description && (
                                                    <p className={`text-sm ${isLightMode ? 'text-slate-600' : 'text-gray-300'} mb-4 line-clamp-2`}>
                                                        {story.description}
                                                    </p>
                                                )}
                                                
                                                {story.starFormat && (
                                                    <div className={`${isLightMode ? 'bg-blue-50' : 'bg-blue-900/20'} rounded-lg p-4 mb-4`}>
                                                        <div className="text-xs font-semibold mb-2 text-blue-600">STAR Format:</div>
                                                        <div className="space-y-1 text-xs">
                                                            <div><strong>Situation:</strong> {story.starFormat.Situation}</div>
                                                            <div><strong>Task:</strong> {story.starFormat.Task}</div>
                                                            <div><strong>Action:</strong> {story.starFormat.Action}</div>
                                                            <div><strong>Result:</strong> {story.starFormat.Result}</div>
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                <button
                                                    onClick={() => {
                                                        // Use this story for practice
                                                        if (story.starFormat) {
                                                            setStarAnswers(story.starFormat);
                                                            setStarMode(true);
                                                            setShowPracticeModal(true);
                                                            // Set a dummy question for practice
                                                            setSelectedQuestion({ id: 'story', question: 'Tell me about a time when...' });
                                                        }
                                                    }}
                                                    className={`w-full text-sm px-4 py-2 rounded-lg font-medium ${isLightMode ? 'bg-purple-600 hover:bg-purple-700' : 'bg-purple-500 hover:bg-purple-600'} text-white transition-colors`}
                                                >
                                                    Practice with STAR 
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="text-center py-12">
                                        <div className="w-16 h-16 text-blue-400 mx-auto mb-6 text-6xl"></div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-4`}>
                                            No Stories Yet
                                        </h2>
                                        <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'} mb-8 max-w-md mx-auto`}>
                                            {InterviewPrepStorage.getResumeData() 
                                                ? 'Click "Refresh from Resume" to extract stories from your resume, or add stories manually.'
                                                : 'Upload your resume first, or add stories manually to prepare for behavioral questions.'}
                                        </p>
                                        <button
                                            onClick={() => {
                                                const stories = buildStoryBankFromResume();
                                                if (stories.length > 0) {
                                                    setUserStories(stories);
                                                    if (currentJob?.jobId) {
                                                        InterviewPrepStorage.saveStoryBank(currentJob.jobId, stories);
                                                    }
                                                } else {
                                                    if (window.JobTrackingUtils) {
                                                        window.JobTrackingUtils.showNotification('No resume data found. Please upload your resume first.', 'error');
                                                    }
                                                }
                                            }}
                                            className={`px-6 py-3 rounded-lg font-semibold ${isLightMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'} text-white transition-colors`}
                                        >
                                            {InterviewPrepStorage.getResumeData() ? 'Refresh from Resume' : 'Go to Resume Studio '}
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Wellness Tab - Anxiety & Confidence Dashboard */}
                        {activeTab === 'wellness' && (
                            <div className="space-y-6">
                                <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-gray-50'} mb-6`}>
                                    Interview Wellness & Confidence
                                </h3>

                                {/* Confidence Meter */}
                                <div className={`${isLightMode ? 'bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200' : 'bg-gradient-to-r from-blue-900/30 to-indigo-900/30 border-blue-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center justify-between mb-4">
                                        <h4 className={`text-lg font-semibold ${isLightMode ? 'text-blue-900' : 'text-blue-100'}`}>
                                            Confidence Level
                                        </h4>
                                        <span className={`text-2xl font-bold ${
                                            confidenceScore >= 80 ? (isLightMode ? 'text-green-600' : 'text-green-400') :
                                            confidenceScore >= 60 ? (isLightMode ? 'text-blue-600' : 'text-blue-400') :
                                            confidenceScore >= 40 ? (isLightMode ? 'text-yellow-600' : 'text-yellow-400') :
                                            (isLightMode ? 'text-red-600' : 'text-red-400')
                                        }`}>
                                            {confidenceScore}%
                                        </span>
                                    </div>
                                    <div className={`w-full h-6 rounded-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} overflow-hidden`}>
                                        <div 
                                            className={`h-full transition-all duration-500 ${
                                                confidenceScore >= 80 ? 'bg-gradient-to-r from-green-500 to-green-600' :
                                                confidenceScore >= 60 ? 'bg-gradient-to-r from-blue-500 to-blue-600' :
                                                confidenceScore >= 40 ? 'bg-gradient-to-r from-yellow-500 to-yellow-600' :
                                                'bg-gradient-to-r from-red-500 to-red-600'
                                            }`}
                                            style={{ width: `${confidenceScore}%` }}
                                        ></div>
                                    </div>
                                    <p className={`text-sm mt-2 ${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>
                                        {confidenceScore >= 80 ? 'Excellent! You\'re well prepared.' :
                                         confidenceScore >= 60 ? 'Good progress! Keep practicing.' :
                                         confidenceScore >= 40 ? 'You\'re on the right track. Focus on critical questions.' :
                                         'Start with critical questions to build confidence.'}
                                    </p>
                                </div>

                                {/* Anxiety Assessment */}
                                <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                                    <div className="flex items-center justify-between mb-4">
                                        <h4 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                            Anxiety Assessment
                                        </h4>
                                        {anxietyLevel && (
                                            <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                                anxietyLevel <= 3 ? (isLightMode ? 'bg-green-100 text-green-700' : 'bg-green-900/50 text-green-300') :
                                                anxietyLevel <= 6 ? (isLightMode ? 'bg-yellow-100 text-yellow-700' : 'bg-yellow-900/50 text-yellow-300') :
                                                (isLightMode ? 'bg-red-100 text-red-700' : 'bg-red-900/50 text-red-300')
                                            }`}>
                                                Level {anxietyLevel}/10
                                            </span>
                                        )}
                                    </div>
                                    
                                    {anxietyLevel === null ? (
                                        <div>
                                            <p className={`${isLightMode ? 'text-slate-600' : 'text-gray-400'} mb-4`}>
                                                Take a quick assessment to identify your specific interview fears and get personalized coping strategies.
                                            </p>
                                            <button
                                                onClick={() => setShowAnxietyAssessment(true)}
                                                className={`${isLightMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'} text-white px-6 py-2 rounded-lg transition-colors`}
                                            >
                                                Start Assessment
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <div>
                                                <p className={`${isLightMode ? 'text-slate-700' : 'text-gray-300'} mb-2`}>
                                                    Your anxiety level: <strong>{anxietyLevel}/10</strong>
                                                </p>
                                                {assessAnxietyLevel()?.fears && assessAnxietyLevel().fears.length > 0 && (
                                                    <div className={`mt-3 p-4 rounded-lg ${isLightMode ? 'bg-amber-50' : 'bg-amber-900/20'}`}>
                                                        <p className={`text-sm font-semibold ${isLightMode ? 'text-amber-900' : 'text-amber-100'} mb-2`}>
                                                            Top Concerns:
                                                        </p>
                                                        <ul className="list-disc list-inside space-y-1">
                                                            {assessAnxietyLevel().fears.map((fear, idx) => (
                                                                <li key={idx} className={`text-sm ${isLightMode ? 'text-amber-700' : 'text-amber-300'}`}>
                                                                    {fear}
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                )}
                                            </div>
                                            <button
                                                onClick={() => setShowAnxietyAssessment(true)}
                                                className={`text-sm ${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} text-gray-700 px-4 py-2 rounded-lg transition-colors`}
                                            >
                                                Retake Assessment
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Progress Indicators */}
                                {currentJob && interviewQuestions.length > 0 && (
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div className={`${isLightMode ? 'bg-green-50 border-green-200' : 'bg-green-900/20 border-green-700/50'} border rounded-xl p-4`}>
                                            <div className="text-2xl mb-2"></div>
                                            <div className={`text-xl font-bold ${isLightMode ? 'text-green-900' : 'text-green-100'}`}>
                                                {interviewQuestions.filter(q => (questionPriorities[q.id] || 'Medium') === 'Critical').filter(q => questionProgress[q.id]?.reviewed).length} / {interviewQuestions.filter(q => (questionPriorities[q.id] || 'Medium') === 'Critical').length}
                                            </div>
                                            <div className={`text-xs ${isLightMode ? 'text-green-700' : 'text-green-300'}`}>
                                                Critical Questions Reviewed
                                            </div>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-purple-50 border-purple-200' : 'bg-purple-900/20 border-purple-700/50'} border rounded-xl p-4`}>
                                            <div className="text-2xl mb-2"></div>
                                            <div className={`text-xl font-bold ${isLightMode ? 'text-purple-900' : 'text-purple-100'}`}>
                                                {userStories.length}
                                            </div>
                                            <div className={`text-xs ${isLightMode ? 'text-purple-700' : 'text-purple-300'}`}>
                                                Stories Prepared
                                            </div>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-blue-50 border-blue-200' : 'bg-blue-900/20 border-blue-700/50'} border rounded-xl p-4`}>
                                            <div className="text-2xl mb-2"></div>
                                            <div className={`text-xl font-bold ${isLightMode ? 'text-blue-900' : 'text-blue-100'}`}>
                                                {Object.keys(userAnswers).length}
                                            </div>
                                            <div className={`text-xs ${isLightMode ? 'text-blue-700' : 'text-blue-300'}`}>
                                                Answers Saved
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Sample Answer Modal */}
                    {showSampleAnswer && selectedQuestion && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[10000] p-4">
                            <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-3xl w-full max-h-[80vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                        Sample Answer
                                    </h3>
                                    <button
                                        onClick={() => {
                                            setShowSampleAnswer(false);
                                            setSelectedQuestion(null);
                                        }}
                                        className={`${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'}`}
                                    >
                                        
                                    </button>
                                </div>
                                <div className={`mb-4 p-4 rounded-lg ${isLightMode ? 'bg-blue-50' : 'bg-blue-900/20'}`}>
                                    <p className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                        {selectedQuestion.question}
                                    </p>
                                </div>
                                {loading ? (
                                    <div className="text-center py-8">
                                        <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                                        <p className={`mt-2 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}>Generating sample answer...</p>
                                    </div>
                                ) : selectedQuestion.sampleAnswer ? (
                                    <div className={`${isLightMode ? 'text-slate-700' : 'text-gray-300'} whitespace-pre-wrap`}>
                                        {selectedQuestion.sampleAnswer}
                                    </div>
                                ) : null}
                            </div>
                        </div>
                    )}

                    {/* Practice Modal */}
                    {showPracticeModal && selectedQuestion && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[10000] p-4">
                            <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-3xl w-full max-h-[80vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                        Practice Your Answer
                                    </h3>
                                    <button
                                        onClick={() => {
                                            setShowPracticeModal(false);
                                            setSelectedQuestion(null);
                                            setPracticeAnswer('');
                                        }}
                                        className={`${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'}`}
                                    >
                                        
                                    </button>
                                </div>
                                <div className={`mb-4 p-4 rounded-lg ${isLightMode ? 'bg-purple-50' : 'bg-purple-900/20'}`}>
                                    <p className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                        {selectedQuestion.question}
                                    </p>
                                </div>

                                {/* STAR Framework Toggle */}
                                <div className="mb-4 flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                        <button
                                            onClick={() => {
                                                setStarMode(!starMode);
                                                if (starMode) {
                                                    // When disabling STAR mode, combine into answer if all fields filled
                                                    const allFilled = starAnswers.Situation && starAnswers.Task && starAnswers.Action && starAnswers.Result;
                                                    if (allFilled) {
                                                        const combined = `Situation: ${starAnswers.Situation}\n\nTask: ${starAnswers.Task}\n\nAction: ${starAnswers.Action}\n\nResult: ${starAnswers.Result}`;
                                                        setPracticeAnswer(combined);
                                                    }
                                                }
                                            }}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                starMode 
                                                    ? `${isLightMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'}`
                                                    : `${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`
                                            }`}
                                        >
                                            {starMode ? ' STAR Mode Active' : ' Use STAR Framework'}
                                        </button>
                                        {starMode && (
                                            <button
                                                onClick={() => {
                                                    // View STAR guide
                                                    if (window.JobTrackingUtils) {
                                                        window.JobTrackingUtils.showNotification('STAR Method: Situation (context), Task (your role), Action (what you did), Result (outcome with numbers)', 'info');
                                                    }
                                                }}
                                                className={`px-3 py-2 rounded-lg text-xs font-medium ${isLightMode ? 'bg-blue-50 text-blue-600 hover:bg-blue-100' : 'bg-blue-900/30 text-blue-300 hover:bg-blue-900/50'} transition-colors`}
                                            >
                                                 View Guide
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* STAR Framework Builder */}
                                {starMode ? (
                                    <div className="space-y-4">
                                        {Object.entries({
                                            Situation: "What was the situation or context? Set the scene.",
                                            Task: "What was your responsibility or task? What needed to be done?",
                                            Action: "What specific actions did YOU take? Be detailed and use \"I\" statements.",
                                            Result: "What was the outcome? Use numbers, percentages, or measurable results!"
                                        }).map(([key, prompt]) => (
                                            <div key={key}>
                                                <label className={`block text-sm font-semibold mb-2 ${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>
                                                    {key} <span className="text-xs font-normal text-gray-500">({prompt})</span>
                                                </label>
                                                <textarea
                                                    value={starAnswers[key]}
                                                    onChange={(e) => setStarAnswers({...starAnswers, [key]: e.target.value})}
                                                    placeholder={prompt}
                                                    className={`w-full h-24 px-4 py-2 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white text-slate-800' : 'border-gray-600 bg-gray-700 text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                                />
                                                {starAnswers[key] && (
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        {starAnswers[key].length} characters
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                        <button
                                            onClick={() => {
                                                const allFilled = starAnswers.Situation && starAnswers.Task && starAnswers.Action && starAnswers.Result;
                                                if (allFilled) {
                                                    const combined = `Situation: ${starAnswers.Situation}\n\nTask: ${starAnswers.Task}\n\nAction: ${starAnswers.Action}\n\nResult: ${starAnswers.Result}`;
                                                    setPracticeAnswer(combined);
                                                    if (window.JobTrackingUtils) {
                                                        window.JobTrackingUtils.showNotification('Answer combined! Review and edit if needed.', 'success');
                                                    }
                                                } else {
                                                    if (window.JobTrackingUtils) {
                                                        window.JobTrackingUtils.showNotification('Please fill in all STAR components before combining.', 'error');
                                                    }
                                                }
                                            }}
                                            className={`w-full py-2 rounded-lg font-medium transition-colors ${
                                                starAnswers.Situation && starAnswers.Task && starAnswers.Action && starAnswers.Result
                                                    ? `${isLightMode ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-green-500 hover:bg-green-600 text-white'}`
                                                    : `${isLightMode ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-gray-600 text-gray-400 cursor-not-allowed'}`
                                            }`}
                                            disabled={!starAnswers.Situation || !starAnswers.Task || !starAnswers.Action || !starAnswers.Result}
                                        >
                                             Combine into Complete Answer
                                        </button>
                                    </div>
                                ) : (
                                    <textarea
                                        value={practiceAnswer}
                                        onChange={(e) => setPracticeAnswer(e.target.value)}
                                        placeholder="Write your answer here..."
                                        className={`w-full h-64 px-4 py-3 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white text-slate-800' : 'border-gray-600 bg-gray-700 text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                    />
                                )}
                                
                                <div className="flex gap-3 mt-4">
                                    <button
                                        onClick={() => {
                                            if (practiceAnswer.trim()) {
                                                saveAnswer(selectedQuestion.id, practiceAnswer);
                                                setShowPracticeModal(false);
                                                if (window.JobTrackingUtils) {
                                                    window.JobTrackingUtils.showNotification('Answer saved!', 'success');
                                                }
                                            }
                                        }}
                                        className={`${isLightMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'} text-white px-6 py-2 rounded-lg transition-colors`}
                                    >
                                        Save Answer
                                    </button>
                                    <button
                                        onClick={async () => {
                                            if (practiceAnswer.trim() && selectedQuestion) {
                                                setLoading(true);
                                                const feedback = await evaluateAnswer(selectedQuestion.question, practiceAnswer);
                                                setLoading(false);
                                                if (feedback) {
                                                    setAnswerFeedback({...answerFeedback, [selectedQuestion.id]: feedback});
                                                    if (window.JobTrackingUtils) {
                                                        window.JobTrackingUtils.showNotification('Answer evaluated! Scroll down to see feedback.', 'success');
                                                    }
                                                }
                                            }
                                        }}
                                        className={`${isLightMode ? 'bg-green-600 hover:bg-green-700' : 'bg-green-500 hover:bg-green-600'} text-white px-6 py-2 rounded-lg transition-colors`}
                                    >
                                        {loading ? 'Evaluating...' : 'Get AI Feedback'}
                                    </button>
                                </div>
                                {answerFeedback[selectedQuestion.id] && (
                                    <div className={`mt-4 p-4 rounded-lg ${isLightMode ? 'bg-green-50 border-green-200' : 'bg-green-900/20 border-green-700/50'} border`}>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-green-900' : 'text-green-100'} mb-2`}>
                                            AI Feedback (Score: {answerFeedback[selectedQuestion.id].score}/10)
                                        </h4>
                                        <div className={`text-sm ${isLightMode ? 'text-green-800' : 'text-green-200'} space-y-2`}>
                                            <div>
                                                <strong>Strengths:</strong>
                                                <ul className="list-disc list-inside ml-2">
                                                    {answerFeedback[selectedQuestion.id].strengths?.map((s, i) => (
                                                        <li key={i}>{s}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                            <div>
                                                <strong>Areas for Improvement:</strong>
                                                <ul className="list-disc list-inside ml-2">
                                                    {answerFeedback[selectedQuestion.id].improvements?.map((i, idx) => (
                                                        <li key={idx}>{i}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                            <div>
                                                <strong>Overall:</strong> {answerFeedback[selectedQuestion.id].feedback}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Company Research Modal */}
                    {showCompanyResearch && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[10000] p-4">
                            <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-3xl w-full max-h-[80vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                        Company Research: {currentJob?.company}
                                    </h3>
                                    <button
                                        onClick={() => setShowCompanyResearch(false)}
                                        className={`${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'}`}
                                    >
                                        
                                    </button>
                                </div>
                                {loading ? (
                                    <div className="text-center py-8">
                                        <div className="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                                        <p className={`mt-2 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}>Researching company...</p>
                                    </div>
                                ) : companyResearch ? (
                                    <div className="space-y-4">
                                        <div>
                                            <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>Culture & Values</h4>
                                            <p className={`${isLightMode ? 'text-slate-700' : 'text-gray-300'}`}>{companyResearch.culture}</p>
                                        </div>
                                        {companyResearch.values && companyResearch.values.length > 0 && (
                                            <div>
                                                <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>Key Values</h4>
                                                <ul className="list-disc list-inside space-y-1">
                                                    {companyResearch.values.map((value, i) => (
                                                        <li key={i} className={isLightMode ? 'text-slate-700' : 'text-gray-300'}>{value}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                        )}
                                        {companyResearch.tips && companyResearch.tips.length > 0 && (
                                            <div>
                                                <h4 className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'} mb-2`}>Interview Tips</h4>
                                                <ul className="list-disc list-inside space-y-1">
                                                    {companyResearch.tips.map((tip, i) => (
                                                        <li key={i} className={isLightMode ? 'text-slate-700' : 'text-gray-300'}>{tip}</li>
                                                    ))}
                                                </ul>
                                            </div>
                                        )}
                                    </div>
                                ) : null}
                            </div>
                        </div>
                    )}

                    {/* Anxiety Assessment Modal */}
                    {showAnxietyAssessment && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[10000] p-4">
                            <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-6">
                                    <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                        Interview Anxiety Assessment
                                    </h3>
                                    <button
                                        onClick={() => {
                                            setShowAnxietyAssessment(false);
                                        }}
                                        className={`${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'}`}
                                    >
                                        
                                    </button>
                                </div>
                                
                                <p className={`text-sm mb-6 ${isLightMode ? 'text-slate-600' : 'text-gray-400'}`}>
                                    Rate each statement on a scale of 1-5 (1 = Not worried at all, 5 = Very worried)
                                </p>

                                <div className="space-y-6">
                                    {[
                                        { id: 'nervous', question: 'How nervous do you feel about the interview?', fear: 'Being too nervous' },
                                        { id: 'stumped', question: 'How worried are you about being stumped by questions?', fear: 'Being stumped by questions' },
                                        { id: 'late', question: 'How concerned are you about being late?', fear: 'Being late' },
                                        { id: 'underqualified', question: 'Do you feel underqualified for this role?', fear: 'Being underqualified' },
                                        { id: 'unprepared', question: 'How prepared do you feel?', fear: 'Not being prepared', reverse: true }
                                    ].map((item) => (
                                        <div key={item.id} className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-4`}>
                                            <p className={`font-semibold mb-3 ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                                {item.question}
                                            </p>
                                            <div className="flex gap-2 justify-between">
                                                {[1, 2, 3, 4, 5].map((value) => (
                                                    <button
                                                        key={value}
                                                        onClick={() => {
                                                            setAnxietyAssessmentAnswers({
                                                                ...anxietyAssessmentAnswers,
                                                                [item.id]: value
                                                            });
                                                        }}
                                                        className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ${
                                                            anxietyAssessmentAnswers[item.id] === value
                                                                ? `${isLightMode ? 'bg-blue-600 text-white' : 'bg-blue-500 text-white'}`
                                                                : `${isLightMode ? 'bg-white border-gray-300 text-gray-700 hover:bg-gray-50' : 'bg-gray-600 border-gray-500 text-gray-300 hover:bg-gray-500'} border`
                                                        }`}
                                                    >
                                                        {value}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-6 flex gap-3">
                                    <button
                                        onClick={() => {
                                            const assessment = assessAnxietyLevel();
                                            if (assessment) {
                                                setAnxietyLevel(assessment.level);
                                                if (currentJob?.jobId) {
                                                    InterviewPrepStorage.saveAnxietyData(currentJob.jobId, {
                                                        level: assessment.level,
                                                        fears: assessment.fears,
                                                        assessmentAnswers: anxietyAssessmentAnswers,
                                                        date: new Date().toISOString()
                                                    });
                                                }
                                                setShowAnxietyAssessment(false);
                                                if (window.JobTrackingUtils) {
                                                    window.JobTrackingUtils.showNotification(`Assessment complete! Your anxiety level is ${assessment.level}/10.`, 'success');
                                                }
                                            } else {
                                                if (window.JobTrackingUtils) {
                                                    window.JobTrackingUtils.showNotification('Please answer all questions.', 'error');
                                                }
                                            }
                                        }}
                                        disabled={Object.keys(anxietyAssessmentAnswers).length < 5}
                                        className={`flex-1 py-3 rounded-lg font-semibold transition-colors ${
                                            Object.keys(anxietyAssessmentAnswers).length === 5
                                                ? `${isLightMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'} text-white`
                                                : `${isLightMode ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-gray-600 text-gray-400 cursor-not-allowed'}`
                                        }`}
                                    >
                                        Complete Assessment
                                    </button>
                                    <button
                                        onClick={() => {
                                            setShowAnxietyAssessment(false);
                                            setAnxietyAssessmentAnswers({});
                                        }}
                                        className={`px-6 py-3 rounded-lg font-medium ${isLightMode ? 'bg-gray-200 hover:bg-gray-300 text-gray-700' : 'bg-gray-700 hover:bg-gray-600 text-gray-300'} transition-colors`}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* AI Mock Interview Modal */}
                    {showMockInterview && currentJob && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[10000] p-4">
                            <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-xl font-bold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                        AI Mock Interview - {currentJob.jobTitle || currentJob.title}
                                    </h3>
                                    <button
                                        onClick={() => {
                                            setShowMockInterview(false);
                                            setMockInterviewState({currentQuestion: 0, answers: []});
                                        }}
                                        className={`${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'}`}
                                    >
                                        
                                    </button>
                                </div>
                                
                                {mockInterviewState.currentQuestion < Math.min(5, filteredQuestions.length) ? (
                                    <div className="space-y-4">
                                        <div className={`p-4 rounded-lg ${isLightMode ? 'bg-blue-50' : 'bg-blue-900/20'}`}>
                                            <p className={`text-sm ${isLightMode ? 'text-blue-700' : 'text-blue-300'} mb-2`}>
                                                Question {mockInterviewState.currentQuestion + 1} of {Math.min(5, filteredQuestions.length)}
                                            </p>
                                            <p className={`font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                                {filteredQuestions[mockInterviewState.currentQuestion]?.question || 'Loading...'}
                                            </p>
                                        </div>
                                        <textarea
                                            value={mockInterviewState.currentAnswer || ''}
                                            onChange={(e) => setMockInterviewState({...mockInterviewState, currentAnswer: e.target.value})}
                                            placeholder="Type your answer here..."
                                            className={`w-full h-48 px-4 py-3 rounded-lg border ${isLightMode ? 'border-gray-300 bg-white text-slate-800' : 'border-gray-600 bg-gray-700 text-white'} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                        />
                                        <div className="flex gap-3">
                                            <button
                                                onClick={() => {
                                                    const newAnswers = [...mockInterviewState.answers, {
                                                        question: filteredQuestions[mockInterviewState.currentQuestion]?.question,
                                                        answer: mockInterviewState.currentAnswer
                                                    }];
                                                    setMockInterviewState({
                                                        ...mockInterviewState,
                                                        currentQuestion: mockInterviewState.currentQuestion + 1,
                                                        answers: newAnswers,
                                                        currentAnswer: ''
                                                    });
                                                }}
                                                disabled={!mockInterviewState.currentAnswer?.trim()}
                                                className={`${isLightMode ? 'bg-blue-600 hover:bg-blue-700' : 'bg-blue-500 hover:bg-blue-600'} text-white px-6 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed`}
                                            >
                                                Next Question 
                                            </button>
                                            <button
                                                onClick={() => {
                                                    setShowMockInterview(false);
                                                    setMockInterviewState({currentQuestion: 0, answers: []});
                                                }}
                                                className={`${isLightMode ? 'bg-gray-300 hover:bg-gray-400' : 'bg-gray-600 hover:bg-gray-500'} text-white px-6 py-2 rounded-lg transition-colors`}
                                            >
                                                End Interview
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        <h4 className={`text-lg font-semibold ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                            Interview Complete! 
                                        </h4>
                                        <p className={isLightMode ? 'text-slate-600' : 'text-gray-400'}>
                                            You've completed the mock interview. Review your answers below.
                                        </p>
                                        <div className="space-y-4 max-h-96 overflow-y-auto">
                                            {mockInterviewState.answers.map((item, idx) => (
                                                <div key={idx} className={`p-4 rounded-lg border ${isLightMode ? 'bg-gray-50 border-gray-200' : 'bg-gray-700 border-gray-600'}`}>
                                                    <p className={`font-semibold mb-2 ${isLightMode ? 'text-slate-800' : 'text-white'}`}>
                                                        Q{idx + 1}: {item.question}
                                                    </p>
                                                    <p className={`text-sm ${isLightMode ? 'text-slate-600' : 'text-gray-300'}`}>
                                                        {item.answer}
                                                    </p>
                                                </div>
                                            ))}
                                        </div>
                                        <button
                                            onClick={() => {
                                                const session = {
                                                    jobId: currentJob.jobId,
                                                    jobTitle: currentJob.jobTitle || currentJob.title,
                                                    company: currentJob.company,
                                                    date: new Date().toISOString(),
                                                    answers: mockInterviewState.answers,
                                                    duration: Math.round((new Date() - mockInterviewState.startTime) / 1000 / 60)
                                                };
                                                InterviewPrepStorage.saveSession(session);
                                                setPracticeSessions([...practiceSessions, session]);
                                                setShowMockInterview(false);
                                                if (window.JobTrackingUtils) {
                                                    window.JobTrackingUtils.showNotification('Mock interview session saved!', 'success');
                                                }
                                            }}
                                            className={`${isLightMode ? 'bg-green-600 hover:bg-green-700' : 'bg-green-500 hover:bg-green-600'} text-white px-6 py-2 rounded-lg transition-colors`}
                                        >
                                            Save Session
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Floating Action Button - Mark as Prepared */}
                    {currentJob && (
                        <div className="fixed bottom-6 right-6 z-[9999]">
                            <button
                                onClick={markInterviewPrepared}
                                className={`${isLightMode ? 'bg-green-600 hover:bg-green-700' : 'bg-green-500 hover:bg-green-600'} text-white px-6 py-3 rounded-full shadow-lg transition-all duration-300 flex items-center gap-2 hover:scale-105`}
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                </svg>
                                Mark as Prepared
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        // Render Interview Prep Kit when interview-prep-content is shown
        window.renderInterviewPrepKit = function() {
            console.log('renderInterviewPrepKit called');
            const container = document.getElementById('interview-prep-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Interview Prep Kit...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<InterviewPrepKit />);
                    console.log('Interview Prep Kit rendered successfully');
                } catch (error) {
                    console.error('Error rendering Interview Prep Kit:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Interview Prep Kit</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('interview-prep-container not found');
            }
        };

        // Work History Storage Service
        const WorkHistoryStorage = {
            supabaseUrl: 'https://bialelscmftlquykreij.supabase.co',
            supabaseAnonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpYWxlbHNjbWZ0bHF1eWtyZWlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NzgxMTgsImV4cCI6MjA3NTQ1NDExOH0.wUywvxuTxDlgwVi6y8KaT9E64D4iVRKFFoqUx8wAalI',
            supabaseClient: null,
            tableName: 'work_history_documents',
            
            // Initialize Supabase client
            init() {
                if (typeof supabase !== 'undefined') {
                    this.supabaseClient = supabase.createClient(this.supabaseUrl, this.supabaseAnonKey);
                }
            },
            
            // Get current user ID
            async getUserId() {
                if (!this.supabaseClient) {
                    this.init();
                }
                if (this.supabaseClient) {
                    try {
                        const { data: { user } } = await this.supabaseClient.auth.getUser();
                        return user ? user.id : null;
                    } catch (error) {
                        console.warn('Error getting user from Supabase:', error);
                        return null;
                    }
                }
                return null;
            },
            
            // Get localStorage key for current user
            getLocalStorageKey(userId) {
                return userId ? `work_history_documents_${userId}` : 'work_history_documents_guest';
            },
            
            // Get all documents
            async getAllDocuments() {
                try {
                    const userId = await this.getUserId();
                    const storageKey = this.getLocalStorageKey(userId);
                    
                    // Try Supabase first if user is authenticated
                    if (userId && this.supabaseClient) {
                        try {
                            const { data, error } = await this.supabaseClient
                                .from(this.tableName)
                                .select('*')
                                .eq('user_id', userId)
                                .order('updated_at', { ascending: false });
                            
                            if (error) throw error;
                            
                            if (data && data.length > 0) {
                                // Sync to localStorage as backup
                                localStorage.setItem(storageKey, JSON.stringify(data));
                                return data.map(doc => this.formatDocument(doc));
                            }
                        } catch (supabaseError) {
                            console.warn('Supabase fetch failed, falling back to localStorage:', supabaseError);
                        }
                    }
                    
                    // Fallback to localStorage
                    const stored = localStorage.getItem(storageKey);
                    if (stored) {
                        const documents = JSON.parse(stored);
                        return documents.map(doc => this.formatDocument(doc));
                    }
                    
                    return [];
                } catch (error) {
                    console.error('Error getting documents:', error);
                    return [];
                }
            },
            
            // Get document by ID
            async getDocumentById(id) {
                try {
                    const userId = await this.getUserId();
                    const storageKey = this.getLocalStorageKey(userId);
                    
                    // Try Supabase first
                    if (userId && this.supabaseClient) {
                        try {
                            const { data, error } = await this.supabaseClient
                                .from(this.tableName)
                                .select('*')
                                .eq('id', id)
                                .eq('user_id', userId)
                                .single();
                            
                            if (!error && data) {
                                return this.formatDocument(data);
                            }
                        } catch (supabaseError) {
                            console.warn('Supabase fetch failed, falling back to localStorage:', supabaseError);
                        }
                    }
                    
                    // Fallback to localStorage
                    const stored = localStorage.getItem(storageKey);
                    if (stored) {
                        const documents = JSON.parse(stored);
                        const doc = documents.find(d => d.id === id);
                        return doc ? this.formatDocument(doc) : null;
                    }
                    
                    return null;
                } catch (error) {
                    console.error('Error getting document:', error);
                    return null;
                }
            },
            
            // Save document (create or update)
            async saveDocument(document) {
                try {
                    const userId = await this.getUserId();
                    const storageKey = this.getLocalStorageKey(userId);
                    
                    // Validate document
                    if (!document.title || !document.type) {
                        throw new Error('Title and type are required');
                    }
                    
                    // Validate type
                    const validTypes = ['resume', 'tailored-resume', 'application-tailor', 'cover-letter'];
                    if (!validTypes.includes(document.type)) {
                        throw new Error('Invalid document type');
                    }
                    
                    // Validate status
                    if (document.status && !['draft', 'completed'].includes(document.status)) {
                        throw new Error('Invalid status');
                    }
                    
                    // Validate ATS score
                    if (document.atsScore !== undefined && document.atsScore !== null) {
                        const score = parseInt(document.atsScore);
                        if (isNaN(score) || score < 0 || score > 100) {
                            throw new Error('ATS score must be between 0 and 100');
                        }
                    }
                    
                    const now = new Date().toISOString();
                    const isUpdate = !!document.id;
                    
                    const docData = {
                        title: document.title.trim(),
                        type: document.type,
                        content: document.content || '',
                        job_title: document.jobTitle || '',
                        company: document.company || '',
                        status: document.status || 'draft',
                        ats_score: document.atsScore !== undefined ? parseInt(document.atsScore) : null,
                        updated_at: now
                    };
                    
                    // Try Supabase first if user is authenticated
                    if (userId && this.supabaseClient && isUpdate) {
                        try {
                            const { data, error } = await this.supabaseClient
                                .from(this.tableName)
                                .update({
                                    ...docData,
                                    user_id: userId
                                })
                                .eq('id', document.id)
                                .eq('user_id', userId)
                                .select()
                                .single();
                            
                            if (error) throw error;
                            
                            // Sync to localStorage
                            const stored = localStorage.getItem(storageKey);
                            const documents = stored ? JSON.parse(stored) : [];
                            const index = documents.findIndex(d => d.id === document.id);
                            if (index >= 0) {
                                documents[index] = { ...data, ...docData, id: data.id };
                            } else {
                                documents.push({ ...data, ...docData, id: data.id });
                            }
                            localStorage.setItem(storageKey, JSON.stringify(documents));
                            
                            return this.formatDocument(data);
                        } catch (supabaseError) {
                            console.warn('Supabase update failed, using localStorage:', supabaseError);
                        }
                    } else if (userId && this.supabaseClient && !isUpdate) {
                        try {
                            const { data, error } = await this.supabaseClient
                                .from(this.tableName)
                                .insert({
                                    ...docData,
                                    user_id: userId
                                })
                                .select()
                                .single();
                            
                            if (error) throw error;
                            
                            // Sync to localStorage
                            const stored = localStorage.getItem(storageKey);
                            const documents = stored ? JSON.parse(stored) : [];
                            documents.push({ ...data, ...docData, id: data.id });
                            localStorage.setItem(storageKey, JSON.stringify(documents));
                            
                            return this.formatDocument(data);
                        } catch (supabaseError) {
                            console.warn('Supabase insert failed, using localStorage:', supabaseError);
                        }
                    }
                    
                    // Fallback to localStorage
                    const stored = localStorage.getItem(storageKey);
                    const documents = stored ? JSON.parse(stored) : [];
                    
                    if (isUpdate) {
                        const index = documents.findIndex(d => d.id === document.id);
                        if (index >= 0) {
                            documents[index] = { ...documents[index], ...docData, id: document.id };
                        } else {
                            documents.push({ ...docData, id: document.id, created_at: now });
                        }
                    } else {
                        const newId = `doc_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                        documents.push({ ...docData, id: newId, created_at: now });
                    }
                    
                    localStorage.setItem(storageKey, JSON.stringify(documents));
                    return isUpdate ? 
                        documents.find(d => d.id === document.id) : 
                        documents[documents.length - 1];
                } catch (error) {
                    console.error('Error saving document:', error);
                    throw error;
                }
            },
            
            // Update document
            async updateDocument(id, updates) {
                try {
                    const userId = await this.getUserId();
                    const doc = await this.getDocumentById(id);
                    if (!doc) {
                        throw new Error('Document not found');
                    }
                    return await this.saveDocument({ ...doc, ...updates, id });
                } catch (error) {
                    console.error('Error updating document:', error);
                    throw error;
                }
            },
            
            // Delete document
            async deleteDocument(id) {
                try {
                    const userId = await this.getUserId();
                    const storageKey = this.getLocalStorageKey(userId);
                    
                    // Try Supabase first if user is authenticated
                    if (userId && this.supabaseClient) {
                        try {
                            const { error } = await this.supabaseClient
                                .from(this.tableName)
                                .delete()
                                .eq('id', id)
                                .eq('user_id', userId);
                            
                            if (error) throw error;
                        } catch (supabaseError) {
                            console.warn('Supabase delete failed, using localStorage:', supabaseError);
                        }
                    }
                    
                    // Always update localStorage
                    const stored = localStorage.getItem(storageKey);
                    if (stored) {
                        const documents = JSON.parse(stored);
                        const filtered = documents.filter(d => d.id !== id);
                        localStorage.setItem(storageKey, JSON.stringify(filtered));
                        return true;
                    }
                    
                    return false;
                } catch (error) {
                    console.error('Error deleting document:', error);
                    throw error;
                }
            },
            
            // Format document from database to component format
            formatDocument(dbDoc) {
                return {
                    id: dbDoc.id,
                    title: dbDoc.title,
                    type: dbDoc.type,
                    content: dbDoc.content || '',
                    createdAt: dbDoc.created_at || dbDoc.createdAt,
                    updatedAt: dbDoc.updated_at || dbDoc.updatedAt,
                    jobTitle: dbDoc.job_title || dbDoc.jobTitle || '',
                    company: dbDoc.company || '',
                    status: dbDoc.status || 'draft',
                    atsScore: dbDoc.ats_score !== null && dbDoc.ats_score !== undefined ? dbDoc.ats_score : dbDoc.atsScore
                };
            }
        };
        
        // Initialize storage service
        WorkHistoryStorage.init();
        
        /*
         * WORK HISTORY MANAGER - TESTING CHECKLIST
         * ==========================================
         * 
         * MANUAL TESTING SCENARIOS:
         * 
         * 1. BASIC FUNCTIONALITY TESTS
         *     Component loads without errors
         *     Documents load from storage on mount
         *     Loading skeleton displays during fetch
         *     Empty state shows when no documents exist
         *     Statistics cards display correct counts
         * 
         * 2. CREATE DOCUMENT TESTS
         *     "Create New" button opens modal
         *     Can create document with all fields
         *     Can create document with minimal fields (title + type)
         *     Validation prevents empty title
         *     Validation prevents invalid document type
         *     Validation prevents invalid ATS score (< 0 or > 100)
         *     Document appears in list after creation
         *     Toast notification shows on success
         *     Modal closes after successful create
         * 
         * 3. VIEW DOCUMENT TESTS
         *     View button opens modal
         *     Document content displays correctly
         *     Document metadata shows (status, type, dates)
         *     Modal closes with X button
         *     Modal closes with Esc key
         *     Modal closes when clicking outside
         * 
         * 4. EDIT DOCUMENT TESTS
         *     Edit button opens modal with document data
         *     Can update all fields
         *     Can update individual fields
         *     Validation works on save
         *     Changes persist after save
         *     Document updates in list after save
         *     Toast notification shows on success
         *     Error messages display on validation failure
         * 
         * 5. DELETE DOCUMENT TESTS
         *     Delete button shows confirmation
         *     Document removed after confirmation
         *     Document persists if cancel is clicked
         *     List updates immediately after delete
         *     Toast notification shows on success
         *     Statistics update after delete
         * 
         * 6. DOWNLOAD DOCUMENT TESTS
         *     Download creates .txt file
         *     Filename is sanitized (special characters removed)
         *     File contains document content
         *     Download works with empty content
         *     Error handling for failed downloads
         * 
         * 7. SEARCH & FILTER TESTS
         *     Search finds documents by title
         *     Search finds documents by job title
         *     Search finds documents by company
         *     Search finds documents by content
         *     Search is case-insensitive
         *     Search debounces (waits 300ms)
         *     Tab filters work (All, Resumes, Tailored, Cover Letters)
         *     Status filter works (All, Completed, Drafts)
         *     Sort by date works correctly
         *     Sort by title works correctly
         *     Sort by type works correctly
         *     Combined filters work together
         *     Search result count displays correctly
         * 
         * 8. PAGINATION TESTS
         *     Shows 12 documents per page
         *     Next/Previous buttons work
         *     Page numbers display correctly
         *     Pagination resets on search/filter change
         *     Pagination doesn't show for < 12 documents
         *     Current page highlights correctly
         * 
         * 9. STORAGE & PERSISTENCE TESTS
         *     Documents persist after page refresh
         *     Documents sync to Supabase (if authenticated)
         *     Falls back to localStorage if Supabase fails
         *     User-specific storage (different users see different documents)
         *     Guest users use localStorage
         * 
         * 10. INTEGRATION TESTS
         *      Resume Studio documents auto-appear in Work History
         *      Application Tailor documents can be added (via helper function)
         *      Cover Letter documents can be added (via helper function)
         *      Duplicate prevention works
         *      Toast notifications show on auto-add
         * 
         * 11. KEYBOARD SHORTCUTS TESTS
         *      "/" key focuses search input
         *      Esc key closes open modals
         *      Shortcuts don't trigger when typing in inputs
         * 
         * 12. ERROR HANDLING TESTS
         *      Network errors show user-friendly message
         *      Invalid data validation errors display
         *      Supabase offline falls back to localStorage
         *      Error state displays correctly
         *      Application doesn't crash on errors
         * 
         * 13. MEMORY LEAK TESTS
         *      No console errors when navigating away
         *      React root unmounts correctly
         *      Event listeners cleaned up
         *      No memory leaks after multiple create/edit/delete cycles
         *      Component cleanup on unmount
         * 
         * 14. UI/UX TESTS
         *      Loading states show during operations
         *      Empty states are helpful and actionable
         *      Toast notifications auto-dismiss
         *      Modals are accessible (keyboard navigation)
         *      Responsive design works on mobile
         *      Dark mode works correctly
         *      Light mode works correctly
         * 
         * 15. CROSS-BROWSER TESTS
         *      Chrome/Edge
         *      Firefox
         *      Safari
         *      Mobile browsers
         * 
         * 16. PERFORMANCE TESTS
         *      Loads quickly with 100+ documents
         *      Pagination works smoothly
         *      Search is responsive (debounced)
         *      No lag when filtering
         *      Memory usage is reasonable
         * 
         * AUTOMATED TESTING:
         * 
         * Run in browser console:
         * - await WorkHistoryTesting.runHealthChecks()
         * - await WorkHistoryTesting.performanceTest(50)
         * - WorkHistoryTesting.validateDocument({ title: 'Test', type: 'resume' })
         * 
         * EDGE CASES TO TEST:
         * - Very long document titles (> 200 chars)
         * - Special characters in titles
         * - Empty content documents
         * - Documents with null/undefined fields
         * - Rapid create/edit/delete operations
         * - Network disconnection scenarios
         * - Supabase authentication expired
         * - LocalStorage quota exceeded
         * - Invalid date formats
         * - Large content (> 50,000 chars)
         */
        
        // Testing & Validation Utilities
        const WorkHistoryTesting = {
            // Run comprehensive health checks
            async runHealthChecks() {
                const results = {
                    timestamp: new Date().toISOString(),
                    checks: {},
                    passed: 0,
                    failed: 0,
                    warnings: 0
                };
                
                // Check 1: Storage Service Initialization
                results.checks.storageService = this.checkStorageService();
                if (results.checks.storageService.status === 'pass') results.passed++;
                else if (results.checks.storageService.status === 'fail') results.failed++;
                else results.warnings++;
                
                // Check 2: Supabase Connection
                results.checks.supabaseConnection = await this.checkSupabaseConnection();
                if (results.checks.supabaseConnection.status === 'pass') results.passed++;
                else if (results.checks.supabaseConnection.status === 'fail') results.failed++;
                else results.warnings++;
                
                // Check 3: LocalStorage Availability
                results.checks.localStorage = this.checkLocalStorage();
                if (results.checks.localStorage.status === 'pass') results.passed++;
                else if (results.checks.localStorage.status === 'fail') results.failed++;
                else results.warnings++;
                
                // Check 4: React Availability
                results.checks.react = this.checkReact();
                if (results.checks.react.status === 'pass') results.passed++;
                else if (results.checks.react.status === 'fail') results.failed++;
                else results.warnings++;
                
                // Check 5: Integration System
                results.checks.integration = this.checkIntegration();
                if (results.checks.integration.status === 'pass') results.passed++;
                else if (results.checks.integration.status === 'fail') results.failed++;
                else results.warnings++;
                
                // Check 6: Data Integrity
                results.checks.dataIntegrity = await this.checkDataIntegrity();
                if (results.checks.dataIntegrity.status === 'pass') results.passed++;
                else if (results.checks.dataIntegrity.status === 'fail') results.failed++;
                else results.warnings++;
                
                return results;
            },
            
            // Check Storage Service
            checkStorageService() {
                try {
                    if (typeof WorkHistoryStorage === 'undefined') {
                        return { status: 'fail', message: 'WorkHistoryStorage is not defined' };
                    }
                    if (typeof WorkHistoryStorage.init !== 'function') {
                        return { status: 'fail', message: 'WorkHistoryStorage.init is not a function' };
                    }
                    if (typeof WorkHistoryStorage.getAllDocuments !== 'function') {
                        return { status: 'fail', message: 'WorkHistoryStorage.getAllDocuments is not a function' };
                    }
                    return { status: 'pass', message: 'Storage service is properly initialized' };
                } catch (error) {
                    return { status: 'fail', message: `Storage service check failed: ${error.message}` };
                }
            },
            
            // Check Supabase Connection
            async checkSupabaseConnection() {
                try {
                    if (!WorkHistoryStorage.supabaseClient) {
                        return { status: 'warn', message: 'Supabase client not initialized (will use localStorage fallback)' };
                    }
                    
                    const userId = await WorkHistoryStorage.getUserId();
                    if (userId) {
                        return { status: 'pass', message: 'Supabase connection successful, user authenticated' };
                    } else {
                        return { status: 'warn', message: 'Supabase available but user not authenticated (using localStorage)' };
                    }
                } catch (error) {
                    return { status: 'warn', message: `Supabase check failed: ${error.message} (will use localStorage)` };
                }
            },
            
            // Check LocalStorage
            checkLocalStorage() {
                try {
                    if (typeof Storage === 'undefined') {
                        return { status: 'fail', message: 'localStorage is not available' };
                    }
                    
                    const testKey = '__work_history_test__';
                    localStorage.setItem(testKey, 'test');
                    const value = localStorage.getItem(testKey);
                    localStorage.removeItem(testKey);
                    
                    if (value !== 'test') {
                        return { status: 'fail', message: 'localStorage read/write test failed' };
                    }
                    
                    return { status: 'pass', message: 'localStorage is available and functional' };
                } catch (error) {
                    return { status: 'fail', message: `localStorage check failed: ${error.message}` };
                }
            },
            
            // Check React
            checkReact() {
                try {
                    if (typeof React === 'undefined') {
                        return { status: 'fail', message: 'React is not loaded' };
                    }
                    if (typeof ReactDOM === 'undefined') {
                        return { status: 'fail', message: 'ReactDOM is not loaded' };
                    }
                    if (typeof React.useState !== 'function') {
                        return { status: 'fail', message: 'React hooks are not available' };
                    }
                    return { status: 'pass', message: 'React and ReactDOM are properly loaded' };
                } catch (error) {
                    return { status: 'fail', message: `React check failed: ${error.message}` };
                }
            },
            
            // Check Integration System
            checkIntegration() {
                try {
                    if (typeof WorkHistoryIntegration === 'undefined') {
                        return { status: 'fail', message: 'WorkHistoryIntegration is not defined' };
                    }
                    if (typeof WorkHistoryIntegration.dispatchDocumentCreated !== 'function') {
                        return { status: 'fail', message: 'dispatchDocumentCreated is not a function' };
                    }
                    if (typeof WorkHistoryIntegration.onDocumentCreated !== 'function') {
                        return { status: 'fail', message: 'onDocumentCreated is not a function' };
                    }
                    return { status: 'pass', message: 'Integration system is properly initialized' };
                } catch (error) {
                    return { status: 'fail', message: `Integration check failed: ${error.message}` };
                }
            },
            
            // Check Data Integrity
            async checkDataIntegrity() {
                try {
                    const documents = await WorkHistoryStorage.getAllDocuments();
                    const issues = [];
                    
                    for (const doc of documents) {
                        // Validate document structure
                        if (!doc.id) issues.push(`Document missing ID: ${doc.title || 'Unknown'}`);
                        if (!doc.title) issues.push(`Document missing title: ${doc.id}`);
                        if (!doc.type) issues.push(`Document missing type: ${doc.id}`);
                        
                        // Validate type values
                        const validTypes = ['resume', 'tailored-resume', 'application-tailor', 'cover-letter'];
                        if (!validTypes.includes(doc.type)) {
                            issues.push(`Invalid document type: ${doc.type} (${doc.id})`);
                        }
                        
                        // Validate status values
                        if (doc.status && !['draft', 'completed'].includes(doc.status)) {
                            issues.push(`Invalid document status: ${doc.status} (${doc.id})`);
                        }
                        
                        // Validate ATS score
                        if (doc.atsScore !== null && doc.atsScore !== undefined) {
                            const score = parseInt(doc.atsScore);
                            if (isNaN(score) || score < 0 || score > 100) {
                                issues.push(`Invalid ATS score: ${doc.atsScore} (${doc.id})`);
                            }
                        }
                    }
                    
                    if (issues.length > 0) {
                        return { 
                            status: 'warn', 
                            message: `Found ${issues.length} data integrity issue(s)`,
                            details: issues
                        };
                    }
                    
                    return { 
                        status: 'pass', 
                        message: `All ${documents.length} documents passed integrity checks` 
                    };
                } catch (error) {
                    return { status: 'fail', message: `Data integrity check failed: ${error.message}` };
                }
            },
            
            // Validate document before save
            validateDocument(doc) {
                const errors = [];
                const warnings = [];
                
                // Required fields
                if (!doc.title || typeof doc.title !== 'string' || !doc.title.trim()) {
                    errors.push('Title is required');
                } else if (doc.title.length > 200) {
                    errors.push('Title must be 200 characters or less');
                }
                
                if (!doc.type) {
                    errors.push('Document type is required');
                } else {
                    const validTypes = ['resume', 'tailored-resume', 'application-tailor', 'cover-letter'];
                    if (!validTypes.includes(doc.type)) {
                        errors.push(`Invalid document type. Must be one of: ${validTypes.join(', ')}`);
                    }
                }
                
                // Optional but validated fields
                if (doc.status && !['draft', 'completed'].includes(doc.status)) {
                    errors.push('Status must be either "draft" or "completed"');
                }
                
                if (doc.atsScore !== undefined && doc.atsScore !== null) {
                    const score = parseInt(doc.atsScore);
                    if (isNaN(score)) {
                        errors.push('ATS score must be a number');
                    } else if (score < 0 || score > 100) {
                        errors.push('ATS score must be between 0 and 100');
                    }
                }
                
                if (doc.jobTitle && doc.jobTitle.length > 100) {
                    warnings.push('Job title is longer than recommended (100 chars)');
                }
                
                if (doc.company && doc.company.length > 100) {
                    warnings.push('Company name is longer than recommended (100 chars)');
                }
                
                if (doc.content && doc.content.length > 50000) {
                    warnings.push('Content is very long (50,000+ chars), may affect performance');
                }
                
                return {
                    isValid: errors.length === 0,
                    errors,
                    warnings
                };
            },
            
            // Performance test
            async performanceTest(docCount = 100) {
                const startTime = performance.now();
                const results = {
                    createTime: 0,
                    readTime: 0,
                    updateTime: 0,
                    deleteTime: 0,
                    totalTime: 0,
                    averageTime: 0
                };
                
                try {
                    // Create test documents
                    const createStart = performance.now();
                    const testDocs = [];
                    for (let i = 0; i < docCount; i++) {
                        const doc = {
                            title: `Test Document ${i}`,
                            type: 'resume',
                            content: `Test content ${i}`,
                    status: 'draft',
                            atsScore: Math.floor(Math.random() * 100)
                        };
                        const saved = await WorkHistoryStorage.saveDocument(doc);
                        testDocs.push(saved);
                    }
                    results.createTime = performance.now() - createStart;
                    
                    // Read all documents
                    const readStart = performance.now();
                    await WorkHistoryStorage.getAllDocuments();
                    results.readTime = performance.now() - readStart;
                    
                    // Update documents
                    const updateStart = performance.now();
                    for (let i = 0; i < Math.min(10, testDocs.length); i++) {
                        await WorkHistoryStorage.updateDocument(testDocs[i].id, { title: `Updated ${i}` });
                    }
                    results.updateTime = performance.now() - updateStart;
                    
                    // Delete documents
                    const deleteStart = performance.now();
                    for (const doc of testDocs) {
                        await WorkHistoryStorage.deleteDocument(doc.id);
                    }
                    results.deleteTime = performance.now() - deleteStart;
                    
                    results.totalTime = performance.now() - startTime;
                    results.averageTime = results.totalTime / docCount;
                    
                    return { status: 'pass', results };
                } catch (error) {
                    return { status: 'fail', message: `Performance test failed: ${error.message}` };
                }
            },
            
            // Log test results
            logResults(results) {
                console.group(' Work History Manager - Health Check Results');
                console.log(`Timestamp: ${results.timestamp}`);
                console.log(` Passed: ${results.passed}`);
                console.log(`  Warnings: ${results.warnings}`);
                console.log(` Failed: ${results.failed}`);
                
                Object.entries(results.checks).forEach(([checkName, result]) => {
                    const icon = result.status === 'pass' ? '' : result.status === 'warn' ? '' : '';
                    console.log(`${icon} ${checkName}: ${result.message}`);
                    if (result.details) {
                        console.log('   Details:', result.details);
                    }
                });
                
                console.groupEnd();
                return results;
            }
        };
        
        // Make testing utilities available globally for console access
        window.WorkHistoryTesting = WorkHistoryTesting;
        
        // Auto-run health checks in development (console only)
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            window.addEventListener('load', () => {
                setTimeout(async () => {
                    const results = await WorkHistoryTesting.runHealthChecks();
                    WorkHistoryTesting.logResults(results);
                }, 2000); // Wait 2 seconds after page load
            });
        }

        // Global Event System for Cross-Module Integration
        const WorkHistoryIntegration = {
            // Dispatch event when document is created in other modules
            dispatchDocumentCreated(documentData) {
                const event = new CustomEvent('workHistory:documentCreated', {
                    detail: documentData
                });
                window.dispatchEvent(event);
                console.log('Work History: Document created event dispatched', documentData);
            },
            
            // Listen for document creation events
            onDocumentCreated(callback) {
                window.addEventListener('workHistory:documentCreated', (event) => {
                    callback(event.detail);
                });
            },
            
            // Convert Resume Studio data to Work History document format
            convertResumeStudioToDocument(resumeData, fileName) {
                try {
                    // Extract content as JSON string
                    const content = JSON.stringify(resumeData, null, 2);
                    
                    // Extract job title from experience if available
                    let jobTitle = '';
                    if (resumeData.experience && resumeData.experience.length > 0) {
                        jobTitle = resumeData.experience[0].position || '';
                    }
                    
                    // Extract company from experience if available
                    let company = '';
                    if (resumeData.experience && resumeData.experience.length > 0) {
                        company = resumeData.experience[0].company || '';
                    }
                    
                    return {
                        title: fileName || 'Resume from Resume Studio',
                    type: 'resume',
                        content: content,
                        jobTitle: jobTitle,
                        company: company,
                    status: 'completed',
                        atsScore: null
                    };
                } catch (error) {
                    console.error('Error converting Resume Studio data:', error);
                    return null;
                }
            },
            
            // Convert Application Tailor data to Work History document format
            convertApplicationTailorToDocument(tailoredData, jobTitle, company) {
                try {
                    const content = typeof tailoredData === 'string' 
                        ? tailoredData 
                        : JSON.stringify(tailoredData, null, 2);
                    
                    return {
                        title: `Tailored Resume - ${company || 'Application'}`,
                        type: 'application-tailor',
                        content: content,
                        jobTitle: jobTitle || '',
                        company: company || '',
                        status: 'completed',
                        atsScore: null
                    };
                } catch (error) {
                    console.error('Error converting Application Tailor data:', error);
                    return null;
                }
            }
        };

        // Monitor Resume Studio localStorage changes with duplicate prevention
        (function() {
            const processedResumes = new Set(); // Track processed resumes to prevent duplicates
            let lastResumeCheck = Date.now();
            
            const originalSetItem = Storage.prototype.setItem;
            Storage.prototype.setItem = function(key, value) {
                originalSetItem.apply(this, arguments);
                
                // Listen for resume saves from Resume Studio
                if (key === 'parsed_resumes') {
                    // Throttle checks to avoid too many events
                    const now = Date.now();
                    if (now - lastResumeCheck < 1000) {
                        return; // Skip if checked recently
                    }
                    lastResumeCheck = now;
                    
                    try {
                        const resumes = JSON.parse(value);
                        const resumeKeys = Object.keys(resumes);
                        
                        // Check for new resumes (ones we haven't processed)
                        for (const resumeName of resumeKeys) {
                            if (!processedResumes.has(resumeName)) {
                                const resume = resumes[resumeName];
                                
                                if (resume && resume.personalInfo) {
                                    // This is a new parsed resume from Resume Studio
                                    processedResumes.add(resumeName);
                                    
                                    const document = WorkHistoryIntegration.convertResumeStudioToDocument(
                                        resume,
                                        resumeName
                                    );
                                    
                                    if (document) {
                                        // Small delay to ensure Resume Studio save is complete
                                        setTimeout(() => {
                                            WorkHistoryIntegration.dispatchDocumentCreated(document);
                                        }, 500);
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error processing resume save event:', error);
                    }
                }
            };
            
            // Initialize processed list from existing resumes
            try {
                const existingResumes = JSON.parse(localStorage.getItem('parsed_resumes') || '{}');
                Object.keys(existingResumes).forEach(key => processedResumes.add(key));
            } catch (error) {
                console.error('Error initializing processed resumes:', error);
            }
        })();
        
        // Helper function for Application Tailor to dispatch completion event
        // Usage: window.dispatchApplicationTailorComplete(tailoredContent, jobTitle, company)
        window.dispatchApplicationTailorComplete = function(tailoredContent, jobTitle, company) {
            if (typeof WorkHistoryIntegration !== 'undefined') {
                const document = WorkHistoryIntegration.convertApplicationTailorToDocument(
                    tailoredContent,
                    jobTitle,
                    company
                );
                
                if (document) {
                    WorkHistoryIntegration.dispatchDocumentCreated(document);
                }
            } else {
                console.warn('WorkHistoryIntegration not available. Document not added to work history.');
            }
        };
        
        // Helper function for Cover Letter Generator to dispatch completion event
        // Usage: window.dispatchCoverLetterComplete(coverLetterContent, jobTitle, company)
        window.dispatchCoverLetterComplete = function(coverLetterContent, jobTitle, company) {
            if (typeof WorkHistoryIntegration !== 'undefined') {
                const document = {
                    title: `Cover Letter - ${company || 'Application'}`,
                    type: 'cover-letter',
                    content: typeof coverLetterContent === 'string' 
                        ? coverLetterContent 
                        : JSON.stringify(coverLetterContent, null, 2),
                    jobTitle: jobTitle || '',
                    company: company || '',
                    status: 'completed',
                    atsScore: null
                };
                
                WorkHistoryIntegration.dispatchDocumentCreated(document);
            } else {
                console.warn('WorkHistoryIntegration not available. Document not added to work history.');
            }
        };

        // Work History Manager React Component
        const WorkHistoryManager = () => {
            const { useState, useEffect, useRef } = React;
            
            const [activeTab, setActiveTab] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [sortBy, setSortBy] = useState('date');
            const [filterStatus, setFilterStatus] = useState('all');
            const [documents, setDocuments] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [error, setError] = useState(null);
            const [viewingDoc, setViewingDoc] = useState(null);
            const [editingDoc, setEditingDoc] = useState(null);
            const [creatingDoc, setCreatingDoc] = useState(false);
            const [saveError, setSaveError] = useState(null);
            const [currentPage, setCurrentPage] = useState(1);
            const [toast, setToast] = useState(null);
            const [debouncedSearchQuery, setDebouncedSearchQuery] = useState('');
            
            const DOCUMENTS_PER_PAGE = 12;
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');
            
            // Toast notification system with cleanup
            const toastTimeoutRef = React.useRef(null);
            
            const showToast = (message, type = 'success') => {
                // Clear existing timeout
                if (toastTimeoutRef.current) {
                    clearTimeout(toastTimeoutRef.current);
                }
                
                setToast({ message, type });
                toastTimeoutRef.current = setTimeout(() => {
                    setToast(null);
                    toastTimeoutRef.current = null;
                }, 3000);
            };
            
            // Cleanup toast timeout on unmount
            useEffect(() => {
                return () => {
                    if (toastTimeoutRef.current) {
                        clearTimeout(toastTimeoutRef.current);
                    }
                };
            }, []);
            
            // Debounce search query
            useEffect(() => {
                const timer = setTimeout(() => {
                    setDebouncedSearchQuery(searchQuery);
                    setCurrentPage(1); // Reset to first page on search
                }, 300);
                
                return () => clearTimeout(timer);
            }, [searchQuery]);
            
            // Keyboard shortcuts
            useEffect(() => {
                const handleKeyDown = (e) => {
                    // Focus search with /
                    if (e.key === '/' && !e.ctrlKey && !e.metaKey && document.activeElement?.tagName !== 'INPUT' && document.activeElement?.tagName !== 'TEXTAREA') {
                        e.preventDefault();
                        const searchInput = document.querySelector('input[placeholder*="Search documents"]');
                        if (searchInput) {
                            searchInput.focus();
                        }
                    }
                    
                    // Close modals with Esc
                    if (e.key === 'Escape') {
                        if (viewingDoc) {
                            handleCloseView();
                        } else if (editingDoc) {
                            handleCloseEdit();
                        } else if (creatingDoc) {
                            handleCloseCreate();
                        }
                    }
                };
                
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [viewingDoc, editingDoc, creatingDoc]);
            
            // Utility: Sanitize input to prevent XSS
            const sanitizeInput = (input) => {
                if (!input || typeof input !== 'string') return '';
                const div = document.createElement('div');
                div.textContent = input;
                return div.innerHTML.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            };

            // Utility: Sanitize for search (allow basic characters, strip dangerous ones)
            const sanitizeSearch = (input) => {
                if (!input || typeof input !== 'string') return '';
                // Remove HTML tags and script content
                return input.replace(/<[^>]*>/g, '').replace(/[<>\"']/g, '').trim();
            };

            // Utility: Validate document data (uses WorkHistoryTesting for consistency)
            const validateDocument = (doc) => {
                if (typeof WorkHistoryTesting !== 'undefined' && WorkHistoryTesting.validateDocument) {
                    const result = WorkHistoryTesting.validateDocument(doc);
                    // Convert warnings to errors for strict validation
                    return {
                        isValid: result.isValid,
                        errors: [...result.errors, ...result.warnings]
                    };
                }
                
                // Fallback validation if testing utility not available
                const errors = [];
                
                // Title validation
                if (!doc.title || typeof doc.title !== 'string' || !doc.title.trim()) {
                    errors.push('Title is required and cannot be empty');
                } else if (doc.title.trim().length > 200) {
                    errors.push('Title must be 200 characters or less');
                }

                // Type validation
                const validTypes = ['resume', 'tailored-resume', 'application-tailor', 'cover-letter'];
                if (!doc.type || !validTypes.includes(doc.type)) {
                    errors.push(`Document type must be one of: ${validTypes.join(', ')}`);
                }

                // Status validation
                if (doc.status && !['draft', 'completed'].includes(doc.status)) {
                    errors.push('Status must be either "draft" or "completed"');
                }

                // ATS Score validation
                if (doc.atsScore !== undefined && doc.atsScore !== null) {
                    const score = parseInt(doc.atsScore);
                    if (isNaN(score) || score < 0 || score > 100) {
                        errors.push('ATS score must be a number between 0 and 100');
                    }
                }

                // Content length validation (optional, but warn if too long)
                if (doc.content && doc.content.length > 50000) {
                    errors.push('Content is too long. Maximum 50,000 characters allowed.');
                }

                // Job Title and Company length validation
                if (doc.jobTitle && doc.jobTitle.length > 100) {
                    errors.push('Job title must be 100 characters or less');
                }
                if (doc.company && doc.company.length > 100) {
                    errors.push('Company name must be 100 characters or less');
                }

                return {
                    isValid: errors.length === 0,
                    errors
                };
            };

            // Utility: Format date safely
            const formatDateSafe = (dateString) => {
                if (!dateString) return 'N/A';
                try {
                    const date = new Date(dateString);
                    if (isNaN(date.getTime())) {
                        return 'Invalid Date';
                    }
                    return date.toLocaleDateString();
                } catch (err) {
                    console.error('Error formatting date:', err);
                    return 'Invalid Date';
                }
            };

            // Refresh documents from storage
            const refreshDocuments = async () => {
                try {
                    setIsLoading(true);
                    const loadedDocuments = await WorkHistoryStorage.getAllDocuments();
                    setDocuments(loadedDocuments || []);
                    setError(null);
                } catch (err) {
                    console.error('Error refreshing documents:', err);
                    const errorMessage = err.message || 'Failed to refresh documents';
                    setError(errorMessage);
                    
                    // Try to load from localStorage as fallback
                    try {
                        const userId = await WorkHistoryStorage.getUserId();
                        const storageKey = WorkHistoryStorage.getLocalStorageKey(userId);
                        const stored = localStorage.getItem(storageKey);
                        if (stored) {
                            const documents = JSON.parse(stored);
                            setDocuments(documents.map(doc => WorkHistoryStorage.formatDocument(doc)));
                            setError('Using cached data. Some features may be limited.');
                        }
                    } catch (fallbackErr) {
                        console.error('Error loading from localStorage fallback:', fallbackErr);
                        setError('Unable to load documents. Please refresh the page.');
                    }
                } finally {
                    setIsLoading(false);
                }
            };

            // Listen for document creation events from other modules
            useEffect(() => {
                let isMounted = true;
                
                const handleDocumentCreated = async (event) => {
                    if (!isMounted) return;
                    
                    const documentData = event.detail;
                    
                    // Check if document already exists (prevent duplicates)
                    try {
                        const existingDocs = await WorkHistoryStorage.getAllDocuments();
                        const duplicate = existingDocs.find(doc => 
                            doc.title === documentData.title &&
                            doc.type === documentData.type &&
                            Math.abs(new Date(doc.createdAt).getTime() - Date.now()) < 5000 // Within 5 seconds
                        );
                        
                        if (!duplicate) {
                            await WorkHistoryStorage.saveDocument(documentData);
                            if (isMounted) {
                                await refreshDocuments();
                                showToast(`Document "${documentData.title}" added to Work History!`, 'success');
                            }
                        }
                    } catch (error) {
                        console.error('Error auto-adding document to work history:', error);
                        // Don't show error toast for auto-adds to avoid spam
                    }
                };
                
                WorkHistoryIntegration.onDocumentCreated(handleDocumentCreated);
                
                return () => {
                    isMounted = false;
                    // Note: We don't remove the event listener to allow it to persist
                    // The event listener will only fire when component is mounted due to isMounted check
                };
            }, []);

            // Load documents on component mount
            useEffect(() => {
                let isMounted = true;
                let abortController = new AbortController();
                
                const loadDocuments = async () => {
                    try {
                        setIsLoading(true);
                        setError(null);
                        const loadedDocuments = await WorkHistoryStorage.getAllDocuments();
                        if (isMounted && !abortController.signal.aborted) {
                            setDocuments(loadedDocuments || []);
                        }
                    } catch (err) {
                        console.error('Error loading documents:', err);
                        if (isMounted && !abortController.signal.aborted) {
                            let errorMessage = 'Failed to load documents';
                            
                            if (err.name === 'AbortError') {
                                // Component unmounted, ignore
                                return;
                            } else if (err.message) {
                                errorMessage = err.message;
                            } else if (err.name === 'NetworkError' || err.message?.includes('network')) {
                                errorMessage = 'Network error. Please check your connection.';
                            }
                            
                            setError(errorMessage);
                            
                            // Try localStorage fallback
                            try {
                                const userId = await WorkHistoryStorage.getUserId();
                                const storageKey = WorkHistoryStorage.getLocalStorageKey(userId);
                                const stored = localStorage.getItem(storageKey);
                                if (stored && isMounted) {
                                    const documents = JSON.parse(stored);
                                    setDocuments(documents.map(doc => WorkHistoryStorage.formatDocument(doc)));
                                    setError('Using cached data. Some features may be limited.');
                                }
                            } catch (fallbackErr) {
                                console.error('Fallback load error:', fallbackErr);
                            }
                        }
                    } finally {
                        if (isMounted && !abortController.signal.aborted) {
                            setIsLoading(false);
                        }
                    }
                };
                
                loadDocuments();
                
                // Cleanup function to prevent state updates on unmounted component
                return () => {
                    isMounted = false;
                    abortController.abort();
                };
            }, []);


            const getTypeIcon = (type) => {
                switch (type) {
                    case 'resume':
                        return '';
                    case 'tailored-resume':
                        return '';
                    case 'application-tailor':
                        return '';
                    case 'cover-letter':
                        return '';
                    default:
                        return '';
                }
            };

            const getTypeLabel = (type) => {
                switch (type) {
                    case 'resume':
                        return 'Resume';
                    case 'tailored-resume':
                        return 'Tailored Resume';
                    case 'application-tailor':
                        return 'Application Tailor';
                    case 'cover-letter':
                        return 'Cover Letter';
                    default:
                        return 'Document';
                }
            };

            const getScoreColor = (score) => {
                if (score >= 90) return 'text-green-400';
                if (score >= 70) return 'text-yellow-400';
                return 'text-red-400';
            };

            const getStatusColor = (status) => {
                return status === 'completed' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400';
            };

            const getTypeColor = (type) => {
                switch (type) {
                    case 'resume':
                        return 'text-yellow-400';
                    case 'tailored-resume':
                        return 'text-orange-400';
                    case 'application-tailor':
                        return 'text-orange-400';
                    case 'cover-letter':
                        return 'text-blue-400';
                    default:
                        return 'text-gray-400';
                }
            };

            const filteredDocuments = documents.filter(doc => {
                const matchesTab = activeTab === 'all' || 
                    (activeTab === 'resumes' && doc.type === 'resume') ||
                    (activeTab === 'tailored' && (doc.type === 'tailored-resume' || doc.type === 'application-tailor')) ||
                    (activeTab === 'cover-letters' && doc.type === 'cover-letter');
                
                const searchLower = debouncedSearchQuery.toLowerCase();
                const matchesSearch = debouncedSearchQuery === '' || 
                    (doc.title && doc.title.toLowerCase().includes(searchLower)) ||
                    (doc.jobTitle && doc.jobTitle.toLowerCase().includes(searchLower)) ||
                    (doc.company && doc.company.toLowerCase().includes(searchLower)) ||
                    (doc.content && doc.content.toLowerCase().includes(searchLower));
                
                const matchesStatus = filterStatus === 'all' || doc.status === filterStatus;
                
                return matchesTab && matchesSearch && matchesStatus;
            });

            // Helper function to validate and parse date
            const parseDate = (dateString) => {
                if (!dateString) return new Date(0);
                const date = new Date(dateString);
                return isNaN(date.getTime()) ? new Date(0) : date;
            };

            const sortedDocuments = [...filteredDocuments].sort((a, b) => {
                switch (sortBy) {
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'type':
                        return a.type.localeCompare(b.type);
                    case 'date':
                    default:
                        // Fixed: Use getTime() for proper date comparison
                        const dateA = parseDate(a.updatedAt);
                        const dateB = parseDate(b.updatedAt);
                        return dateB.getTime() - dateA.getTime();
                }
            });

            // Pagination calculations
            const totalPages = Math.ceil(sortedDocuments.length / DOCUMENTS_PER_PAGE);
            const startIndex = (currentPage - 1) * DOCUMENTS_PER_PAGE;
            const endIndex = startIndex + DOCUMENTS_PER_PAGE;
            const paginatedDocuments = sortedDocuments.slice(startIndex, endIndex);
            
            // Reset to page 1 if current page is out of bounds
            useEffect(() => {
                if (currentPage > totalPages && totalPages > 0) {
                    setCurrentPage(1);
                }
            }, [currentPage, totalPages]);

            // Sanitize filename for download
            const sanitizeFilename = (filename) => {
                return filename.replace(/[^a-z0-9]/gi, '_').toLowerCase();
            };

            const handleView = async (doc) => {
                if (!doc || !doc.id) {
                    setError('Invalid document selected');
                    return;
                }

                try {
                    setError(null);
                    // Fetch full document from storage
                    const fullDoc = await WorkHistoryStorage.getDocumentById(doc.id);
                    if (fullDoc) {
                        setViewingDoc(fullDoc);
                    } else {
                        // Fallback to provided doc if not found in storage
                        setViewingDoc(doc);
                    }
                } catch (err) {
                    console.error('Error loading document:', err);
                    const errorMessage = err.message || 'Failed to load document';
                    setError(errorMessage);
                    // Still show the document if we have it locally
                    setViewingDoc(doc);
                }
            };

            const handleEdit = async (doc) => {
                if (!doc || !doc.id) {
                    setSaveError('Invalid document selected');
                    return;
                }

                try {
                    setSaveError(null);
                    setError(null);
                    // Fetch full document from storage
                    const fullDoc = await WorkHistoryStorage.getDocumentById(doc.id);
                    if (fullDoc) {
                        setEditingDoc({ ...fullDoc });
                    } else {
                        // Fallback to provided doc if not found in storage
                        setEditingDoc({ ...doc });
                    }
                } catch (err) {
                    console.error('Error loading document for editing:', err);
                    const errorMessage = err.message || 'Failed to load document';
                    setSaveError(errorMessage);
                    // Still allow editing with provided doc as fallback
                    setEditingDoc({ ...doc });
                }
            };

            const handleSaveEdit = async () => {
                if (!editingDoc) {
                    setSaveError('No document to save');
                    return;
                }
                
                try {
                    setSaveError(null);
                    
                    // Sanitize inputs
                    const sanitizedDoc = {
                        ...editingDoc,
                        title: sanitizeSearch(editingDoc.title),
                        jobTitle: editingDoc.jobTitle ? sanitizeSearch(editingDoc.jobTitle) : '',
                        company: editingDoc.company ? sanitizeSearch(editingDoc.company) : '',
                        content: editingDoc.content || ''
                    };

                    // Validate document
                    const validation = validateDocument(sanitizedDoc);
                    if (!validation.isValid) {
                        setSaveError(validation.errors.join('. '));
                        return;
                    }
                    
                    await WorkHistoryStorage.saveDocument(sanitizedDoc);
                    await refreshDocuments();
                    setEditingDoc(null);
                    showToast('Document saved successfully!', 'success');
                } catch (err) {
                    console.error('Error saving document:', err);
                    let errorMessage = 'Failed to save document';
                    
                    if (err.message) {
                        errorMessage = err.message;
                    } else if (err.name === 'NetworkError' || err.message?.includes('network')) {
                        errorMessage = 'Network error. Please check your connection and try again.';
                    } else if (err.message?.includes('permission') || err.message?.includes('unauthorized')) {
                        errorMessage = 'You do not have permission to save this document.';
                    }
                    
                    setSaveError(errorMessage);
                }
            };

            const handleDownload = (doc) => {
                try {
                    if (!doc.content) {
                        alert('No content to download');
                        return;
                    }
                    
                const blob = new Blob([doc.content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                    // Sanitize filename
                    const safeFilename = sanitizeFilename(doc.title) || 'document';
                    a.download = `${safeFilename}.txt`;
                    document.body.appendChild(a);
                a.click();
                    document.body.removeChild(a);
                URL.revokeObjectURL(url);
                } catch (err) {
                    console.error('Error downloading document:', err);
                    alert('Failed to download document');
                }
            };

            const handleDelete = async (doc) => {
                if (!doc || !doc.id) {
                    setError('Invalid document selected');
                    return;
                }

                // Use browser confirm (will replace with custom modal in Phase 5)
                const confirmMessage = `Are you sure you want to delete "${doc.title || 'this document'}"? This action cannot be undone.`;
                if (window.confirm(confirmMessage)) {
                    try {
                        setError(null);
                        await WorkHistoryStorage.deleteDocument(doc.id);
                        await refreshDocuments();
                        showToast('Document deleted successfully!', 'success');
                    } catch (err) {
                        console.error('Error deleting document:', err);
                        let errorMessage = 'Failed to delete document';
                        
                        if (err.message) {
                            errorMessage = err.message;
                        } else if (err.name === 'NetworkError' || err.message?.includes('network')) {
                            errorMessage = 'Network error. Please check your connection and try again.';
                        } else if (err.message?.includes('permission') || err.message?.includes('unauthorized')) {
                            errorMessage = 'You do not have permission to delete this document.';
                        }
                        
                        setError(errorMessage);
                    }
                }
            };

            const handleCreate = () => {
                setCreatingDoc(true);
                setSaveError(null);
            };

            const handleSaveCreate = async (newDoc) => {
                if (!newDoc) {
                    setSaveError('No document data provided');
                    return;
                }

                try {
                    setSaveError(null);
                    
                    // Sanitize inputs
                    const sanitizedDoc = {
                        ...newDoc,
                        title: sanitizeSearch(newDoc.title),
                        jobTitle: newDoc.jobTitle ? sanitizeSearch(newDoc.jobTitle) : '',
                        company: newDoc.company ? sanitizeSearch(newDoc.company) : '',
                        content: newDoc.content || ''
                    };

                    // Validate document
                    const validation = validateDocument(sanitizedDoc);
                    if (!validation.isValid) {
                        setSaveError(validation.errors.join('. '));
                        return;
                    }
                    
                    await WorkHistoryStorage.saveDocument(sanitizedDoc);
                    await refreshDocuments();
                    setCreatingDoc(false);
                    showToast('Document created successfully!', 'success');
                } catch (err) {
                    console.error('Error creating document:', err);
                    let errorMessage = 'Failed to create document';
                    
                    if (err.message) {
                        errorMessage = err.message;
                    } else if (err.name === 'NetworkError' || err.message?.includes('network')) {
                        errorMessage = 'Network error. Please check your connection and try again.';
                    } else if (err.message?.includes('permission') || err.message?.includes('unauthorized')) {
                        errorMessage = 'You do not have permission to create documents.';
                    }
                    
                    setSaveError(errorMessage);
                }
            };

            const handleCloseView = () => {
                setViewingDoc(null);
            };

            const handleCloseEdit = () => {
                setEditingDoc(null);
                setSaveError(null);
            };

            const handleCloseCreate = () => {
                setCreatingDoc(false);
                setSaveError(null);
            };

            const getStats = () => {
                const resumes = documents.filter(doc => doc.type === 'resume').length;
                const tailored = documents.filter(doc => doc.type === 'tailored-resume' || doc.type === 'application-tailor').length;
                const coverLetters = documents.filter(doc => doc.type === 'cover-letter').length;
                const drafts = documents.filter(doc => doc.status === 'draft').length;
                
                return { resumes, tailored, coverLetters, drafts };
            };

            const stats = getStats();

            return (
                <div className="space-y-8">

                    {/* Summary Statistics */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                    <div className="w-5 h-5 text-yellow-400 text-xl"></div>
                                </div>
                                <div>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Master Resumes</h3>
                                    <p className="text-3xl font-bold text-yellow-400">{stats.resumes}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 bg-orange-500/20 rounded-lg flex items-center justify-center">
                                    <div className="w-5 h-5 text-orange-400 text-xl"></div>
                                </div>
                                <div>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Tailored Resumes</h3>
                                    <p className="text-3xl font-bold text-orange-400">{stats.tailored}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                    <div className="w-5 h-5 text-blue-400 text-xl"></div>
                                </div>
                                <div>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Cover Letters</h3>
                                    <p className="text-3xl font-bold text-blue-400">{stats.coverLetters}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                    <div className="w-5 h-5 text-yellow-400 text-xl"></div>
                                </div>
                                <div>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Draft Documents</h3>
                                    <p className="text-3xl font-bold text-yellow-400">{stats.drafts}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Filters and Search */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                        {/* Header with Create Button */}
                        <div className="flex items-center justify-between mb-6">
                            <h2 className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>My Documents</h2>
                            <button
                                onClick={handleCreate}
                                className="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors flex items-center gap-2"
                            >
                                <span className="text-lg">+</span>
                                <span>Create New</span>
                            </button>
                        </div>
                        
                        {/* Tab Navigation */}
                        <div className="flex flex-wrap gap-2 mb-6">
                            {[
                                { id: 'all', label: 'All Items' },
                                { id: 'resumes', label: 'Resumes' },
                                { id: 'tailored', label: 'Tailored Resumes' },
                                { id: 'cover-letters', label: 'Cover Letters' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`px-4 py-2 rounded-lg font-medium transition-all duration-300 ${
                                        activeTab === tab.id
                                            ? 'bg-indigo-600 text-white'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                    }`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        {/* Search and Filters */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="relative">
                                <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <div className={`w-5 h-5 ${isLightMode ? 'text-gray-400' : 'text-gray-400'}`}></div>
                                </div>
                                <input
                                    type="text"
                                    placeholder="Search documents... (Press / to focus)"
                                    value={searchQuery}
                                    onChange={(e) => {
                                        const sanitized = sanitizeSearch(e.target.value);
                                        setSearchQuery(sanitized);
                                    }}
                                    maxLength={100}
                                    className={`w-full pl-10 pr-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                />
                            </div>
                            
                            <select
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                                className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                            >
                                <option value="date">Sort by Date</option>
                                <option value="title">Sort by Title</option>
                                <option value="type">Sort by Type</option>
                            </select>
                            
                            <select
                                value={filterStatus}
                                onChange={(e) => setFilterStatus(e.target.value)}
                                className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                            >
                                <option value="all">All Status</option>
                                <option value="completed">Completed</option>
                                <option value="draft">Drafts</option>
                            </select>
                        </div>
                        
                        {/* Search Results Count */}
                        {!isLoading && (
                            <div className={`mt-4 text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                {sortedDocuments.length === 0 ? (
                                    <span>No documents found</span>
                                ) : sortedDocuments.length === 1 ? (
                                    <span>1 document found</span>
                                ) : (
                                    <span>
                                        Showing {startIndex + 1}-{Math.min(endIndex, sortedDocuments.length)} of {sortedDocuments.length} documents
                                    </span>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Toast Notification */}
                    {toast && (
                        <div className={`fixed top-4 right-4 z-50 ${toast.type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-3 animate-fade-in`}>
                            <span className="text-xl">{toast.type === 'success' ? '' : ''}</span>
                            <span>{toast.message}</span>
                            <button
                                onClick={() => setToast(null)}
                                className="ml-2 text-white/80 hover:text-white"
                            >
                                
                            </button>
                        </div>
                    )}

                    {/* Error State */}
                    {error && (
                        <div className={`${isLightMode ? 'bg-red-50 border-red-200' : 'bg-red-900/20 border-red-800/50'} border rounded-2xl p-6`}>
                            <div className="flex items-center gap-3">
                                <div className="text-2xl"></div>
                                <div>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-red-900' : 'text-red-400'} mb-1`}>Error Loading Documents</h3>
                                    <p className={`text-sm ${isLightMode ? 'text-red-700' : 'text-red-300'}`}>{error}</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Loading State */}
                    {isLoading && !error && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {[1, 2, 3].map(i => (
                                <div key={i} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6 animate-pulse`}>
                                    <div className="flex items-start justify-between mb-4">
                                        <div className="flex items-center gap-3">
                                            <div className={`w-10 h-10 rounded-lg ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'}`}></div>
                                            <div className="flex-1">
                                                <div className={`h-4 w-32 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded mb-2`}></div>
                                                <div className={`h-3 w-20 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded`}></div>
                                            </div>
                                        </div>
                                        <div className={`h-6 w-16 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full`}></div>
                                    </div>
                                    <div className="space-y-3">
                                        <div className={`h-3 w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded`}></div>
                                        <div className={`h-3 w-3/4 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded`}></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Documents Grid */}
                    {!isLoading && !error && (
                        <>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {paginatedDocuments.length > 0 ? (
                                paginatedDocuments.map(doc => (
                                <div key={doc.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6 hover:border-indigo-500/50 transition-all duration-300 hover:scale-105`}>
                                    <div className="flex items-start justify-between mb-4">
                                        <div className="flex items-center gap-3">
                                            <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${getTypeColor(doc.type)}`}>
                                                <div className="text-xl">{getTypeIcon(doc.type)}</div>
                                            </div>
                                            <div>
                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} line-clamp-2`}>{doc.title}</h3>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{getTypeLabel(doc.type)}</p>
                                            </div>
                                        </div>
                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(doc.status)}`}>
                                            {doc.status}
                                        </span>
                                    </div>
                                    
                                    <div className="space-y-3 mb-4">
                                        <div className="flex items-center gap-2">
                                            <div className={`w-4 h-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}></div>
                                            <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>{doc.jobTitle}</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <div className={`w-4 h-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}></div>
                                            <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>{doc.company}</span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <div className={`w-4 h-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}></div>
                                            <span className={`text-sm font-medium ${getScoreColor(doc.atsScore)}`}>
                                                ATS Score: {doc.atsScore}%
                                            </span>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <div className={`w-4 h-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}></div>
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                Updated: {formatDateSafe(doc.updatedAt)}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => handleView(doc)}
                                            className="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center gap-1"
                                        >
                                            <div className="w-4 h-4"></div>
                                            View
                                        </button>
                                        <button
                                            onClick={() => handleEdit(doc)}
                                            className="flex-1 bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors duration-200 flex items-center justify-center gap-1"
                                        >
                                            <div className="w-4 h-4"></div>
                                            Edit
                                        </button>
                                        <button
                                            onClick={() => handleDownload(doc)}
                                            className="flex-1 bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-purple-700 transition-colors duration-200 flex items-center justify-center gap-1"
                                        >
                                            <div className="w-4 h-4"></div>
                                            Download
                                        </button>
                                        <button
                                            onClick={() => handleDelete(doc)}
                                            className="bg-red-400 text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-red-500 transition-colors duration-200 flex items-center justify-center"
                                        >
                                            <div className="w-4 h-4"></div>
                                        </button>
                                    </div>
                                </div>
                            ))
                        ) : (
                            <div className="col-span-full text-center py-20">
                                {documents.length === 0 ? (
                                    <>
                                <div className={`w-16 h-16 ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mx-auto mb-4 text-6xl`}></div>
                                        <h3 className={`text-2xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Welcome to Work History Manager!</h3>
                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-6 max-w-md mx-auto`}>
                                            Track and manage all your resumes, cover letters, and tailored applications in one place. Get started by creating your first document.
                                        </p>
                                        <button
                                            onClick={handleCreate}
                                            className="px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-lg"
                                        >
                                            Create Your First Document
                                        </button>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-500'} mt-4 text-sm`}>
                                            Tip: Press <kbd className="px-2 py-1 bg-gray-200 rounded text-xs">/</kbd> to quickly search documents
                                        </p>
                                    </>
                                ) : (
                                    <>
                                        <div className={`w-16 h-16 ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mx-auto mb-4 text-6xl`}></div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>No documents match your search</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-4`}>
                                            Try adjusting your search terms or filters to find what you're looking for.
                                        </p>
                                        <button
                                            onClick={() => {
                                                setSearchQuery('');
                                                setActiveTab('all');
                                                setFilterStatus('all');
                                            }}
                                            className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors"
                                        >
                                            Clear Filters
                                        </button>
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                        
                        {/* Pagination Controls */}
                        {totalPages > 1 && (
                            <div className="flex items-center justify-center gap-2 mt-6">
                                <button
                                    onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                                    disabled={currentPage === 1}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                        currentPage === 1
                                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                            : isLightMode
                                                ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                    }`}
                                >
                                    Previous
                                </button>
                                
                                <div className="flex gap-1">
                                    {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {
                                        let pageNum;
                                        if (totalPages <= 5) {
                                            pageNum = i + 1;
                                        } else if (currentPage <= 3) {
                                            pageNum = i + 1;
                                        } else if (currentPage >= totalPages - 2) {
                                            pageNum = totalPages - 4 + i;
                                        } else {
                                            pageNum = currentPage - 2 + i;
                                        }
                                        
                                        return (
                                            <button
                                                key={pageNum}
                                                onClick={() => setCurrentPage(pageNum)}
                                                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                                    currentPage === pageNum
                                                        ? 'bg-indigo-600 text-white'
                                                        : isLightMode
                                                            ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                }`}
                                            >
                                                {pageNum}
                                            </button>
                                        );
                                    })}
                                </div>
                                
                                <button
                                    onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                                    disabled={currentPage === totalPages}
                                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                                        currentPage === totalPages
                                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                            : isLightMode
                                                ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                    }`}
                                >
                                    Next
                                </button>
                            </div>
                        )}
                        </>
                    )}

                    {/* View Document Modal */}
                    {viewingDoc && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={handleCloseView}>
                            <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto`} onClick={(e) => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{viewingDoc.title}</h2>
                                    <button
                                        onClick={handleCloseView}
                                        className={`p-2 rounded-lg ${isLightMode ? 'hover:bg-gray-100' : 'hover:bg-gray-700'} transition-colors`}
                                    >
                                        <span className="text-2xl"></span>
                                    </button>
                                </div>
                                <div className="space-y-4">
                                    <div className="flex items-center gap-4 text-sm">
                                        <span className={`px-3 py-1 rounded-full ${getStatusColor(viewingDoc.status)}`}>
                                            {viewingDoc.status}
                                        </span>
                                        <span className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>{getTypeLabel(viewingDoc.type)}</span>
                                        {viewingDoc.jobTitle && (
                                            <span className={isLightMode ? 'text-gray-600' : 'text-gray-400'}> {viewingDoc.jobTitle}</span>
                                        )}
                                        {viewingDoc.company && (
                                            <span className={isLightMode ? 'text-gray-600' : 'text-gray-400'}> {viewingDoc.company}</span>
                                        )}
                                    </div>
                                    <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-900'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                        <pre className={`whitespace-pre-wrap ${isLightMode ? 'text-gray-900' : 'text-gray-100'} font-sans`}>
                                            {viewingDoc.content || 'No content available.'}
                                        </pre>
                                    </div>
                                    {viewingDoc.atsScore !== null && viewingDoc.atsScore !== undefined && (
                                        <div className={`text-sm ${getScoreColor(viewingDoc.atsScore)}`}>
                                            ATS Score: {viewingDoc.atsScore}%
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Edit Document Modal */}
                    {editingDoc && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={handleCloseEdit}>
                            <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto`} onClick={(e) => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Edit Document</h2>
                                    <button
                                        onClick={handleCloseEdit}
                                        className={`p-2 rounded-lg ${isLightMode ? 'hover:bg-gray-100' : 'hover:bg-gray-700'} transition-colors`}
                                    >
                                        <span className="text-2xl"></span>
                                    </button>
                                </div>
                                <div className="space-y-4">
                                    {saveError && (
                                        <div className={`p-3 rounded-lg ${isLightMode ? 'bg-red-50 text-red-700' : 'bg-red-900/20 text-red-400'}`}>
                                            {saveError}
                                        </div>
                                    )}
                                    <div>
                                        <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                            Title *
                                        </label>
                                        <input
                                            type="text"
                                            value={editingDoc.title || ''}
                                            onChange={(e) => {
                                                const value = e.target.value;
                                                if (value.length <= 200) {
                                                    setEditingDoc({ ...editingDoc, title: value });
                                                }
                                            }}
                                            maxLength={200}
                                            className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                Job Title
                                            </label>
                                            <input
                                                type="text"
                                                value={editingDoc.jobTitle || ''}
                                                onChange={(e) => {
                                                    const value = e.target.value;
                                                    if (value.length <= 100) {
                                                        setEditingDoc({ ...editingDoc, jobTitle: value });
                                                    }
                                                }}
                                                maxLength={100}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            />
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                Company
                                            </label>
                                            <input
                                                type="text"
                                                value={editingDoc.company || ''}
                                                onChange={(e) => {
                                                    const value = e.target.value;
                                                    if (value.length <= 100) {
                                                        setEditingDoc({ ...editingDoc, company: value });
                                                    }
                                                }}
                                                maxLength={100}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            />
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                Status
                                            </label>
                                            <select
                                                value={editingDoc.status || 'draft'}
                                                onChange={(e) => setEditingDoc({ ...editingDoc, status: e.target.value })}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="draft">Draft</option>
                                                <option value="completed">Completed</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                ATS Score (0-100)
                                            </label>
                                            <input
                                                type="number"
                                                min="0"
                                                max="100"
                                                value={editingDoc.atsScore || ''}
                                                onChange={(e) => setEditingDoc({ ...editingDoc, atsScore: e.target.value ? parseInt(e.target.value) : null })}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                            Content
                                        </label>
                                        <textarea
                                            value={editingDoc.content || ''}
                                            onChange={(e) => {
                                                const value = e.target.value;
                                                if (value.length <= 50000) {
                                                    setEditingDoc({ ...editingDoc, content: value });
                                                }
                                            }}
                                            maxLength={50000}
                                            rows={10}
                                            className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                        />
                                    </div>
                                    <div className="flex gap-3 justify-end">
                                        <button
                                            onClick={handleCloseEdit}
                                            className={`px-4 py-2 rounded-lg ${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} transition-colors`}
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleSaveEdit}
                                            className="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition-colors"
                                        >
                                            Save Changes
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Create Document Modal */}
                    {creatingDoc && (
                        <CreateDocumentModal
                            isLightMode={isLightMode}
                            onClose={handleCloseCreate}
                            onSave={handleSaveCreate}
                            error={saveError}
                        />
                    )}
                </div>
            );
        };

        // Create Document Modal Component
        const CreateDocumentModal = ({ isLightMode, onClose, onSave, error }) => {
            const [newDoc, setNewDoc] = useState({
                title: '',
                type: 'resume',
                content: '',
                jobTitle: '',
                company: '',
                status: 'draft',
                atsScore: null
            });

            const handleSubmit = () => {
                onSave(newDoc);
            };

            return (
                <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={onClose}>
                    <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto`} onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-4">
                            <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Create New Document</h2>
                            <button
                                onClick={onClose}
                                className={`p-2 rounded-lg ${isLightMode ? 'hover:bg-gray-100' : 'hover:bg-gray-700'} transition-colors`}
                            >
                                <span className="text-2xl"></span>
                            </button>
                        </div>
                        <div className="space-y-4">
                            {error && (
                                <div className={`p-3 rounded-lg ${isLightMode ? 'bg-red-50 text-red-700' : 'bg-red-900/20 text-red-400'}`}>
                                    {error}
                                </div>
                            )}
                            <div>
                                <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                    Title *
                                </label>
                                <input
                                    type="text"
                                    value={newDoc.title}
                                    onChange={(e) => {
                                        const value = e.target.value;
                                        if (value.length <= 200) {
                                            setNewDoc({ ...newDoc, title: value });
                                        }
                                    }}
                                    maxLength={200}
                                    className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                    placeholder="Enter document title"
                                />
                            </div>
                            <div>
                                <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                    Document Type *
                                </label>
                                <select
                                    value={newDoc.type}
                                    onChange={(e) => setNewDoc({ ...newDoc, type: e.target.value })}
                                    className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                >
                                    <option value="resume">Resume</option>
                                    <option value="tailored-resume">Tailored Resume</option>
                                    <option value="application-tailor">Application Tailor</option>
                                    <option value="cover-letter">Cover Letter</option>
                                </select>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                        Job Title
                                    </label>
                                    <input
                                        type="text"
                                        value={newDoc.jobTitle}
                                        onChange={(e) => {
                                            const value = e.target.value;
                                            if (value.length <= 100) {
                                                setNewDoc({ ...newDoc, jobTitle: value });
                                            }
                                        }}
                                        maxLength={100}
                                        className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                    />
                                </div>
                                <div>
                                    <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                        Company
                                    </label>
                                    <input
                                        type="text"
                                        value={newDoc.company}
                                        onChange={(e) => {
                                            const value = e.target.value;
                                            if (value.length <= 100) {
                                                setNewDoc({ ...newDoc, company: value });
                                            }
                                        }}
                                        maxLength={100}
                                        className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                    />
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                        Status
                                    </label>
                                    <select
                                        value={newDoc.status}
                                        onChange={(e) => setNewDoc({ ...newDoc, status: e.target.value })}
                                        className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                    >
                                        <option value="draft">Draft</option>
                                        <option value="completed">Completed</option>
                                    </select>
                                </div>
                                <div>
                                    <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                        ATS Score (0-100)
                                    </label>
                                    <input
                                        type="number"
                                        min="0"
                                        max="100"
                                        value={newDoc.atsScore || ''}
                                        onChange={(e) => setNewDoc({ ...newDoc, atsScore: e.target.value ? parseInt(e.target.value) : null })}
                                        className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                    />
                                </div>
                            </div>
                            <div>
                                <label className={`block text-sm font-medium mb-1 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                    Content
                                </label>
                                <textarea
                                    value={newDoc.content}
                                    onChange={(e) => {
                                        const value = e.target.value;
                                        if (value.length <= 50000) {
                                            setNewDoc({ ...newDoc, content: value });
                                        }
                                    }}
                                    maxLength={50000}
                                    rows={10}
                                    className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                    placeholder="Enter document content..."
                                />
                            </div>
                            <div className="flex gap-3 justify-end">
                                <button
                                    onClick={onClose}
                                    className={`px-4 py-2 rounded-lg ${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} transition-colors`}
                                >
                                    Cancel
                                </button>
                                <button
                                    onClick={handleSubmit}
                                    className="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition-colors"
                                >
                                    Create Document
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Global storage for React root to prevent memory leaks
        window.workHistoryRoot = null;
        
        // Cleanup function for Work History Manager
        window.cleanupWorkHistoryManager = function() {
            if (window.workHistoryRoot) {
                try {
                    window.workHistoryRoot.unmount();
                    window.workHistoryRoot = null;
                    console.log('Work History Manager cleaned up successfully');
                } catch (error) {
                    console.error('Error cleaning up Work History Manager:', error);
                    window.workHistoryRoot = null;
                }
            }
        };
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            window.cleanupWorkHistoryManager();
        });

        // Render Work History Manager when work-history-content is shown
        window.renderWorkHistoryManager = function() {
            console.log('renderWorkHistoryManager called');
            const container = document.getElementById('work-history-container');
            console.log('Container found:', container);
            
            if (!container) {
                console.error('work-history-container not found');
                return;
            }
            
            try {
                // Cleanup existing root if any
                if (window.workHistoryRoot) {
                    console.log('Cleaning up existing Work History Manager root...');
                    window.cleanupWorkHistoryManager();
                }
                
                    console.log('Creating React root and rendering Work History Manager...');
                window.workHistoryRoot = ReactDOM.createRoot(container);
                window.workHistoryRoot.render(<WorkHistoryManager />);
                    console.log('Work History Manager rendered successfully');
                } catch (error) {
                    console.error('Error rendering Work History Manager:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Work History Manager</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                window.workHistoryRoot = null;
            }
        };

        // AI-Powered Personal Brand Audit React Component
        const AIBrandAudit = () => {
            const [step, setStep] = useState('input');
            const [resumeFile, setResumeFile] = useState(null);
            const [linkedinUrl, setLinkedinUrl] = useState('');
            const [githubUrl, setGithubUrl] = useState('');
            const [portfolioUrl, setPortfolioUrl] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [processingStep, setProcessingStep] = useState(0);
            const [processingProgress, setProcessingProgress] = useState(0);
            const [brandScore, setBrandScore] = useState(null);
            const [recommendations, setRecommendations] = useState([]);
            const [brandArchetype, setBrandArchetype] = useState(null);
            const [industryBenchmark, setIndustryBenchmark] = useState(null);
            const [uploadError, setUploadError] = useState('');
            const [validationErrors, setValidationErrors] = useState({});
            const [error, setError] = useState('');
            const [selectedRecommendation, setSelectedRecommendation] = useState(null);
            const [currentAuditId, setCurrentAuditId] = useState(null);
            const [auditHistory, setAuditHistory] = useState([]);
            const [supabaseClient, setSupabaseClient] = useState(null);

            // Load audit history
            const loadAuditHistory = React.useCallback(async () => {
                if (!supabaseClient) return;
                try {
                    const { data: { user } } = await supabaseClient.auth.getUser();
                    if (!user) return;

                    const { data, error } = await supabaseClient
                        .from('brand_audits')
                        .select('*')
                        .eq('user_id', user.id)
                        .order('created_at', { ascending: false })
                        .limit(10);

                    if (error) throw error;
                    setAuditHistory(data || []);
                } catch (err) {
                    console.error('Error loading audit history:', err);
                }
            }, [supabaseClient]);

            // Initialize Supabase client
            React.useEffect(() => {
                if (typeof supabase !== 'undefined') {
                    const SUPABASE_URL = 'https://bialelscmftlquykreij.supabase.co';
                    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpYWxlbHNjbWZ0bHF1eWtyZWlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NzgxMTgsImV4cCI6MjA3NTQ1NDExOH0.wUywvxuTxDlgwVi6y8KaT9E64D4iVRKFFoqUx8wAalI';
                    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    setSupabaseClient(client);
                }
            }, []);

            // Load audit history when client is ready
            React.useEffect(() => {
                if (supabaseClient) {
                    loadAuditHistory();
                }
            }, [supabaseClient, loadAuditHistory]);

            const processingSteps = [
                { text: 'Validating inputs...', progress: 10 },
                { text: 'Analyzing your resume content...', progress: 25 },
                { text: 'Extracting LinkedIn profile data...', progress: 40 },
                { text: 'Analyzing GitHub profile...', progress: 55 },
                { text: 'Analyzing portfolio website...', progress: 70 },
                { text: 'Generating personalized recommendations...', progress: 85 },
                { text: 'Finalizing your brand score...', progress: 100 }
            ];

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.size > 10 * 1024 * 1024) {
                        setUploadError('File size must be less than 10MB');
                        return;
                    }
                    if (!['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/msword'].includes(file.type)) {
                        setUploadError('Only PDF, DOCX, and DOC files are allowed');
                        return;
                    }
                    setResumeFile(file);
                    setUploadError('');
                }
            };

            // Validation functions
            const validateInputs = () => {
                const errors = {};
                
                if (!resumeFile && !linkedinUrl.trim()) {
                    errors.general = 'Please upload a resume or provide a LinkedIn URL';
                }
                
                if (linkedinUrl.trim() && !window.BrandAnalysisUtils?.LinkedIn?.validateUrl(linkedinUrl)) {
                    errors.linkedinUrl = 'Invalid LinkedIn URL format. Please use: linkedin.com/in/username';
                }
                
                if (githubUrl.trim() && !window.BrandAnalysisUtils?.GitHub?.validateUrl(githubUrl)) {
                    errors.githubUrl = 'Invalid GitHub URL format. Please use: github.com/username';
                }
                
                if (portfolioUrl.trim() && !window.BrandAnalysisUtils?.Portfolio?.validateUrl(portfolioUrl)) {
                    errors.portfolioUrl = 'Invalid portfolio URL format';
                }
                
                setValidationErrors(errors);
                return Object.keys(errors).length === 0;
            };

            const updateProgress = (stepIndex, progress) => {
                setProcessingStep(stepIndex);
                const stepProgress = processingSteps[stepIndex]?.progress || 0;
                const prevProgress = stepIndex > 0 ? processingSteps[stepIndex - 1]?.progress || 0 : 0;
                const range = stepProgress - prevProgress;
                setProcessingProgress(prevProgress + (range * progress / 100));
            };

            const handleStartAudit = async () => {
                setError('');
                setValidationErrors({});
                
                if (!validateInputs()) {
                    return;
                }

                // Check authentication
                if (!supabaseClient) {
                    setError('Database connection not available. Please refresh the page.');
                    return;
                }

                const { data: { user } } = await supabaseClient.auth.getUser();
                if (!user) {
                    setError('Please log in to perform brand audit.');
                    return;
                }

                // Check rate limiting (5 audits per day)
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const todayAudits = auditHistory.filter(audit => {
                    const auditDate = new Date(audit.created_at);
                    auditDate.setHours(0, 0, 0, 0);
                    return auditDate.getTime() === today.getTime();
                });
                
                if (todayAudits.length >= 5) {
                    setError('You have reached the daily limit of 5 audits. Please try again tomorrow.');
                    return;
                }
                
                setStep('processing');
                setIsProcessing(true);
                setProcessingStep(0);
                setProcessingProgress(0);
                
                try {
                    const utils = window.BrandAnalysisUtils;
                    if (!utils) {
                        throw new Error('Brand analysis utilities not loaded. Please refresh the page.');
                    }

                    let resumeData = null;
                    let linkedInData = null;
                    let githubData = null;
                    let portfolioData = null;

                    // Step 1: Validate inputs
                    updateProgress(0, 100);

                    // Step 2: Parse resume
                    if (resumeFile) {
                        updateProgress(1, 0);
                        try {
                            const resumeText = await utils.ResumeParser.extractTextFromFile(resumeFile);
                            updateProgress(1, 50);
                            resumeData = await utils.ResumeParser.parseResumeWithAI(resumeText);
                            updateProgress(1, 100);
                        } catch (err) {
                            console.error('Resume parsing error:', err);
                            throw new Error(`Failed to parse resume: ${err.message}`);
                        }
                    }

                    // Step 3: Fetch LinkedIn data
                    if (linkedinUrl.trim()) {
                        updateProgress(2, 0);
                        try {
                            linkedInData = await utils.LinkedIn.fetchProfile(linkedinUrl);
                            updateProgress(2, 100);
                        } catch (err) {
                            console.error('LinkedIn fetch error:', err);
                            // Continue with null LinkedIn data
                            linkedInData = null;
                        }
                    }

                    // Step 4: Analyze GitHub
                    if (githubUrl.trim()) {
                        updateProgress(3, 0);
                        try {
                            const username = utils.GitHub.extractUsername(githubUrl);
                            if (username) {
                                githubData = await utils.GitHub.analyzeProfile(username);
                                updateProgress(3, 100);
                            }
                        } catch (err) {
                            console.error('GitHub analysis error:', err);
                            // Continue with null GitHub data
                            githubData = null;
                        }
                    }

                    // Step 5: Analyze portfolio
                    if (portfolioUrl.trim()) {
                        updateProgress(4, 0);
                        try {
                            portfolioData = await utils.Portfolio.analyzePortfolio(portfolioUrl);
                            updateProgress(4, 100);
                        } catch (err) {
                            console.error('Portfolio analysis error:', err);
                            // Continue with null portfolio data
                            portfolioData = null;
                        }
                    }

                    // Step 6: Perform brand analysis
                    updateProgress(5, 0);
                    const resumeAnalysis = await utils.Engine.analyzeResume(resumeData);
                    const linkedinAnalysis = await utils.Engine.analyzeLinkedIn(linkedInData);
                    const githubAnalysis = await utils.Engine.analyzeGitHub(githubData);
                    const portfolioAnalysis = await utils.Engine.analyzePortfolio(portfolioData);
                    
                    updateProgress(5, 50);
                    const brandScore = utils.Engine.generateBrandScore({
                        resume: resumeAnalysis,
                        linkedin: linkedinAnalysis,
                        github: githubAnalysis,
                        portfolio: portfolioAnalysis
                    });

                    const recommendations = await utils.Engine.generateRecommendations(
                        {
                            resume: resumeAnalysis,
                            linkedin: linkedinAnalysis,
                            github: githubAnalysis,
                            portfolio: portfolioAnalysis
                        },
                        {
                            resume: resumeData,
                            linkedin: linkedInData,
                            github: githubData,
                            portfolio: portfolioData
                        }
                    );

                    const brandArchetype = await utils.Engine.determineBrandArchetype(brandScore);
                    const industryBenchmark = utils.Engine.calculateIndustryBenchmark(brandScore.overall);

                    updateProgress(5, 100);

                    // Step 7: Save to database
                    updateProgress(6, 0);
                    const { data: auditData, error: saveError } = await supabaseClient
                        .from('brand_audits')
                        .insert({
                            user_id: user.id,
                            resume_data: resumeData,
                            linkedin_url: linkedinUrl.trim() || null,
                            github_url: githubUrl.trim() || null,
                            portfolio_url: portfolioUrl.trim() || null,
                            brand_score: brandScore,
                            recommendations: recommendations,
                            brand_archetype: brandArchetype,
                            industry_benchmark: industryBenchmark
                        })
                        .select()
                        .single();

                    if (saveError) {
                        console.error('Error saving audit:', saveError);
                        // Continue anyway - user can still see results
                    } else {
                        setCurrentAuditId(auditData.id);
                        await loadAuditHistory();
                    }

                    updateProgress(6, 100);

                    // Set results
                    setBrandScore(brandScore);
                    setRecommendations(recommendations);
                    setBrandArchetype(brandArchetype);
                    setIndustryBenchmark(industryBenchmark);
                        setIsProcessing(false);
                        setStep('results');
                } catch (err) {
                    console.error('Brand audit error:', err);
                    setError(err.message || 'An error occurred during brand analysis. Please try again.');
                    setIsProcessing(false);
                    setStep('input');
                }
            };

            const getScoreColor = (score) => {
                if (score >= 80) return 'text-green-400';
                if (score >= 60) return 'text-yellow-400';
                return 'text-red-400';
            };

            const getPriorityColor = (priority) => {
                switch (priority) {
                    case 'high':
                        return 'text-red-400 bg-red-500/20';
                    case 'medium':
                        return 'text-yellow-400 bg-yellow-500/20';
                    case 'low':
                        return 'text-green-400 bg-green-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getDifficultyIcon = (difficulty) => {
                switch (difficulty) {
                    case 'easy':
                        return '';
                    case 'medium':
                        return '';
                    case 'hard':
                        return '';
                    default:
                        return '';
                }
            };

            const handleRecommendationClick = (recommendation) => {
                setSelectedRecommendation(recommendation);
            };

            const closeModal = () => {
                setSelectedRecommendation(null);
            };

            return (
                <div className="space-y-8">
                    {/* Header */}
                    <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                        <div className="flex items-center gap-4">
                            <div className="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                            </div>
                            <div className="flex-1">
                                <h1 className="text-3xl font-bold text-gray-50">AI-Powered Personal Brand Audit</h1>
                                <p className="text-gray-300">Comprehensive analysis of your digital brand presence</p>
                            </div>
                            <div className="bg-green-500/20 border border-green-500/50 rounded-lg px-3 py-1">
                                <span className="text-sm font-medium text-green-400"> Real Analysis Active</span>
                            </div>
                        </div>
                    </div>

                    {step === 'input' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-8">
                                {/* Resume Upload */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className="text-xl font-semibold text-gray-50">Upload Your Resume</h2>
                                    </div>
                                    
                                    <div className="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-indigo-500 transition-colors duration-300">
                                        <div className="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <div className="w-8 h-8 text-white text-2xl"></div>
                                        </div>
                                        <h3 className="text-lg font-medium text-gray-50 mb-2">Drop your resume here</h3>
                                        <p className="text-gray-400 mb-4">PDF, DOCX, or DOC files only (max 10MB)</p>
                                        <input
                                            type="file"
                                            accept=".pdf,.docx,.doc"
                                            onChange={handleFileUpload}
                                            className="hidden"
                                            id="resume-upload"
                                        />
                                        <label
                                            htmlFor="resume-upload"
                                            className="inline-flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300 cursor-pointer"
                                        >
                                            <div className="w-4 h-4"></div>
                                            {resumeFile ? 'Change File' : 'Choose File'}
                                        </label>
                                        {resumeFile && (
                                            <div className="mt-4 p-3 bg-green-500/20 border border-green-500/50 rounded-lg">
                                                <div className="flex items-center gap-2 text-green-400">
                                                    <div className="w-4 h-4"></div>
                                                    <span className="text-sm font-medium">{resumeFile.name}</span>
                                                </div>
                                            </div>
                                        )}
                                        {uploadError && (
                                            <div className="mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg">
                                                <div className="flex items-center gap-2 text-red-400">
                                                    <div className="w-4 h-4"></div>
                                                    <span className="text-sm font-medium">{uploadError}</span>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* LinkedIn Profile */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className="text-xl font-semibold text-gray-50">LinkedIn Profile</h2>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">LinkedIn URL</label>
                                            <input
                                                type="url"
                                                value={linkedinUrl}
                                                onChange={(e) => setLinkedinUrl(e.target.value)}
                                                placeholder="https://linkedin.com/in/yourname"
                                                className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            />
                                        </div>
                                        <p className="text-sm text-gray-400">We'll analyze your profile, headline, summary, and experience</p>
                                    </div>
                                </div>

                                {/* Optional Integrations */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className="text-xl font-semibold text-gray-50">Optional Integrations</h2>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">GitHub Profile</label>
                                            <input
                                                type="url"
                                                value={githubUrl}
                                                onChange={(e) => setGithubUrl(e.target.value)}
                                                placeholder="https://github.com/yourname"
                                                className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Portfolio/Website</label>
                                            <input
                                                type="url"
                                                value={portfolioUrl}
                                                onChange={(e) => setPortfolioUrl(e.target.value)}
                                                placeholder="https://yourportfolio.com"
                                                className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Start Audit Button */}
                                <div className="text-center">
                                    <button
                                        onClick={handleStartAudit}
                                        disabled={!resumeFile && !linkedinUrl}
                                        className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-4 rounded-lg font-semibold flex items-center gap-2 mx-auto hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 hover:transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                                    >
                                        <div className="w-5 h-5"></div>
                                        Start Brand Audit
                                    </button>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* What We Analyze */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <h3 className="text-lg font-semibold text-gray-50 mb-4">What We Analyze</h3>
                                    <div className="space-y-4">
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <div className="w-4 h-4 text-blue-400 text-lg"></div>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-gray-50">LinkedIn Profile</h4>
                                                <p className="text-sm text-gray-400">Headline, summary, experience, and connections</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <div className="w-4 h-4 text-green-400 text-lg"></div>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-gray-50">Resume Content</h4>
                                                <p className="text-sm text-gray-400">Skills, experience, and formatting</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <div className="w-4 h-4 text-purple-400 text-lg"></div>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-gray-50">GitHub Activity</h4>
                                                <p className="text-sm text-gray-400">Repositories, contributions, and code quality</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 bg-orange-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                                                <div className="w-4 h-4 text-orange-400 text-lg"></div>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-gray-50">Portfolio Site</h4>
                                                <p className="text-sm text-gray-400">Design, content, and user experience</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Sample Insights */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <h3 className="text-lg font-semibold text-gray-50 mb-4">Sample Insights</h3>
                                    <div className="space-y-3">
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-sm text-gray-300">Optimize your LinkedIn headline with specific skills</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-sm text-gray-300">Add quantifiable achievements to your resume</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className="text-sm text-gray-300">Improve your GitHub profile with better documentation</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Privacy & Security */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <h3 className="text-lg font-semibold text-gray-50 mb-4">Privacy & Security</h3>
                                    <div className="space-y-3">
                                        <div className="flex items-start gap-2">
                                            <div className="w-4 h-4 text-green-400 text-lg"></div>
                                            <p className="text-sm text-gray-300">Your data is encrypted and secure</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-4 h-4 text-green-400 text-lg"></div>
                                            <p className="text-sm text-gray-300">GDPR compliant processing</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-4 h-4 text-green-400 text-lg"></div>
                                            <p className="text-sm text-gray-300">Data is not shared with third parties</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {step === 'processing' && (
                        <div className="text-center py-20">
                            <div className="w-24 h-24 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-8 animate-pulse">
                                <div className="w-12 h-12 text-white text-4xl"></div>
                            </div>
                            <h2 className="text-3xl font-bold text-gray-50 mb-4">Analyzing Your Brand</h2>
                            <div className="w-full max-w-md mx-auto bg-gray-800 rounded-full h-2 mb-6">
                                <div 
                                    className="bg-gradient-to-r from-indigo-500 to-purple-600 h-2 rounded-full transition-all duration-300"
                                    style={{ width: `${processingProgress}%` }}
                                ></div>
                            </div>
                            <p className="text-xl text-gray-300 mb-8">{processingSteps[processingStep]?.text}</p>
                            <div className="text-sm text-gray-400">{Math.round(processingProgress)}% Complete</div>
                        </div>
                    )}

                    {step === 'results' && brandScore && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Results */}
                            <div className="lg:col-span-2 space-y-8">
                                {/* Brand Score */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-8">
                                    <h2 className="text-2xl font-bold text-gray-50 mb-8">Your Brand Score</h2>
                                    <div className="text-center mb-8">
                                        <div className={`text-6xl font-bold ${getScoreColor(brandScore.overall)} mb-2`}>
                                            {brandScore.overall}
                                        </div>
                                        <p className="text-xl text-gray-300">Overall Brand Score</p>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandScore.linkedin)}`}>
                                                {brandScore.linkedin}
                                            </div>
                                            <p className="text-sm text-gray-400">LinkedIn</p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandScore.resume)}`}>
                                                {brandScore.resume}
                                            </div>
                                            <p className="text-sm text-gray-400">Resume</p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandScore.portfolio)}`}>
                                                {brandScore.portfolio}
                                            </div>
                                            <p className="text-sm text-gray-400">Portfolio</p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandScore.github)}`}>
                                                {brandScore.github}
                                            </div>
                                            <p className="text-sm text-gray-400">GitHub</p>
                                        </div>
                                    </div>
                                </div>

                                {/* AI Recommendations */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-8">
                                    <h2 className="text-2xl font-bold text-gray-50 mb-8">AI Recommendations</h2>
                                    <div className="space-y-4">
                                        {recommendations.map((rec) => (
                                            <div
                                                key={rec.id}
                                                onClick={() => handleRecommendationClick(rec)}
                                                className="bg-gray-800 border border-gray-700 rounded-lg p-6 hover:border-indigo-500/50 transition-all duration-300 cursor-pointer hover:scale-105"
                                            >
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex items-center gap-3">
                                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${getPriorityColor(rec.priority)}`}>
                                                            {rec.priority.toUpperCase()}
                                                        </span>
                                                        <span className="text-sm text-gray-400">{rec.category}</span>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-sm text-gray-400">{rec.impact}</span>
                                                        <div className="w-4 h-4">{getDifficultyIcon(rec.difficulty)}</div>
                                                    </div>
                                                </div>
                                                <h3 className="text-lg font-semibold text-gray-50 mb-2">{rec.title}</h3>
                                                <p className="text-gray-300 mb-4">{rec.description}</p>
                                                <div className="flex items-center gap-2 text-sm text-indigo-400">
                                                    <span>View Details</span>
                                                    <div className="w-4 h-4"></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Actions */}
                                <div className="flex gap-4">
                                    <button className="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 hover:bg-blue-700 transition-colors duration-200">
                                        <div className="w-4 h-4"></div>
                                        Download Report
                                    </button>
                                    <button 
                                        onClick={() => setStep('input')}
                                        className="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 hover:bg-gray-700 transition-colors duration-200"
                                    >
                                        <div className="w-4 h-4"></div>
                                        Run New Audit
                                    </button>
                                </div>
                            </div>

                            {/* Sidebar Results */}
                            <div className="space-y-6">
                                {/* Quick Wins */}
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <h3 className="text-lg font-semibold text-gray-50 mb-4">Quick Wins</h3>
                                    <div className="space-y-3">
                                        {recommendations.filter(r => r.priority === 'high' && r.difficulty === 'easy').map((rec) => (
                                            <div key={rec.id} className="bg-green-500/20 border border-green-500/50 rounded-lg p-4">
                                                <h4 className="font-medium text-green-400 mb-1">{rec.title}</h4>
                                                <p className="text-sm text-gray-300">{rec.impact}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Brand Archetype */}
                                {brandArchetype && (
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                                                <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                                </svg>
                                        </div>
                                        <h3 className="text-lg font-semibold text-gray-50">Brand Archetype</h3>
                                    </div>
                                    <div className="text-center">
                                            <div className="text-2xl font-bold text-purple-400 mb-2">{brandArchetype.name || 'The Professional'}</div>
                                            <p className="text-sm text-gray-300">{brandArchetype.description || 'A well-rounded professional with a balanced online presence.'}</p>
                                    </div>
                                </div>
                                )}

                                {/* Industry Benchmark */}
                                {industryBenchmark && (
                                <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                    <h3 className="text-lg font-semibold text-gray-50 mb-4">Industry Benchmark</h3>
                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm text-gray-300">Your Score</span>
                                            <span className="text-sm font-medium text-indigo-400">{brandScore.overall}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm text-gray-300">Industry Average</span>
                                                <span className="text-sm font-medium text-gray-400">{industryBenchmark.average || 65}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-sm text-gray-300">Top 10%</span>
                                                <span className="text-sm font-medium text-green-400">{industryBenchmark.top10Percent || 85}</span>
                                        </div>
                                    </div>
                                </div>
                                )}

                                {/* Audit History */}
                                {auditHistory.length > 0 && (
                                    <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-6">
                                        <h3 className="text-lg font-semibold text-gray-50 mb-4">Recent Audits</h3>
                                        <div className="space-y-3">
                                            {auditHistory.slice(0, 5).map((audit) => (
                                                <div 
                                                    key={audit.id} 
                                                    className="bg-gray-800 border border-gray-700 rounded-lg p-4 cursor-pointer hover:border-indigo-500/50 transition-colors"
                                                    onClick={() => {
                                                        setBrandScore(audit.brand_score);
                                                        setRecommendations(audit.recommendations || []);
                                                        setBrandArchetype(audit.brand_archetype);
                                                        setIndustryBenchmark(audit.industry_benchmark);
                                                        setCurrentAuditId(audit.id);
                                                        setStep('results');
                                                    }}
                                                >
                                                    <div className="flex justify-between items-center mb-2">
                                                        <span className="text-sm text-gray-400">
                                                            {new Date(audit.created_at).toLocaleDateString()}
                                                        </span>
                                                        <span className={`text-sm font-medium ${getScoreColor(audit.brand_score?.overall || 0)}`}>
                                                            {audit.brand_score?.overall || 0}
                                                        </span>
                                                    </div>
                                                    <p className="text-xs text-gray-500">Click to view details</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Recommendation Detail Modal */}
                    {selectedRecommendation && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
                            <div className="bg-[#111827] border border-gray-700/50 rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex items-start justify-between mb-6">
                                    <div className="flex items-center gap-3">
                                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${getPriorityColor(selectedRecommendation.priority)}`}>
                                            {selectedRecommendation.priority.toUpperCase()}
                                        </span>
                                        <span className="text-sm text-gray-400">{selectedRecommendation.category}</span>
                                    </div>
                                    <button
                                        onClick={closeModal}
                                        className="text-gray-400 hover:text-white transition-colors duration-200"
                                    >
                                        <div className="w-6 h-6"></div>
                                    </button>
                                </div>
                                
                                <h2 className="text-2xl font-bold text-gray-50 mb-4">{selectedRecommendation.title}</h2>
                                <p className="text-gray-300 mb-6">{selectedRecommendation.description}</p>
                                
                                <div className="bg-gray-800 border border-gray-700 rounded-lg p-4 mb-6">
                                    <h3 className="font-medium text-gray-50 mb-2">Example:</h3>
                                    <p className="text-sm text-gray-300">{selectedRecommendation.example}</p>
                                </div>
                                
                                <div className="flex gap-4">
                                    <button className="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors duration-200">
                                        Mark as Implemented
                                    </button>
                                    <button className="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors duration-200">
                                        Save for Later
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render AI-Powered Personal Brand Audit when ai-brand-audit-content is shown
        window.renderAIBrandAudit = function() {
            console.log('renderAIBrandAudit called - UPDATED VERSION WITH REAL API INTEGRATION');
            const container = document.getElementById('ai-brand-audit-container');
            console.log('Container found:', container);
            
            // Check if utilities are loaded
            if (typeof window.BrandAnalysisUtils === 'undefined') {
                console.warn('BrandAnalysisUtils not loaded! Make sure /js/brand-analysis-utils.js is loaded.');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Utilities Not Loaded</h2>
                            <p class="text-slate-600">Please refresh the page to load brand analysis utilities.</p>
                        </div>
                    `;
                }
                return;
            }
            
            if (container) {
                try {
                    console.log('Brand Analysis Utils loaded:', {
                        GitHub: !!window.BrandAnalysisUtils.GitHub,
                        LinkedIn: !!window.BrandAnalysisUtils.LinkedIn,
                        Portfolio: !!window.BrandAnalysisUtils.Portfolio,
                        ResumeParser: !!window.BrandAnalysisUtils.ResumeParser,
                        Engine: !!window.BrandAnalysisUtils.Engine
                    });
                    console.log('Creating React root and rendering AI-Powered Personal Brand Audit...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<AIBrandAudit />);
                    console.log(' AI-Powered Personal Brand Audit rendered successfully with REAL API integration');
                } catch (error) {
                    console.error('Error rendering AI-Powered Personal Brand Audit:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading AI-Powered Personal Brand Audit</h2>
                            <p class="text-slate-600">${error.message}</p>
                            <p class="text-sm text-gray-500 mt-2">Check console for details</p>
                        </div>
                    `;
                }
            } else {
                console.error('ai-brand-audit-container not found');
            }
        };

        // Brand Audit Goals React Component
        const BrandAuditGoals = () => {
            const [goals, setGoals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [showCreateModal, setShowCreateModal] = useState(false);
            const [editingGoal, setEditingGoal] = useState(null);
            const [supabaseClient, setSupabaseClient] = useState(null);
            const [currentUser, setCurrentUser] = useState(null);
            const [filter, setFilter] = useState('all'); // all, active, completed, paused
            const [sortBy, setSortBy] = useState('created_at'); // created_at, priority, target_date, progress

            const [newGoal, setNewGoal] = useState({
                title: '',
                description: '',
                category: 'general',
                priority: 'medium',
                target_value: '',
                current_value: '0',
                target_date: '',
                status: 'active'
            });

            // Initialize Supabase client
            React.useEffect(() => {
                if (typeof supabase !== 'undefined') {
                    const SUPABASE_URL = 'https://bialelscmftlquykreij.supabase.co';
                    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpYWxlbHNjbWZ0bHF1eWtyZWlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NzgxMTgsImV4cCI6MjA3NTQ1NDExOH0.wUywvxuTxDlgwVi6y8KaT9E64D4iVRKFFoqUx8wAalI';
                    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    setSupabaseClient(client);
                    loadUserAndGoals(client);
                }
            }, []);

            const loadUserAndGoals = async (client) => {
                try {
                    const { data: { user }, error: userError } = await client.auth.getUser();
                    if (userError) throw userError;
                    setCurrentUser(user);
                    
                    if (user) {
                        await loadGoals(client, user.id);
                    }
                } catch (err) {
                    console.error('Error loading user:', err);
                    setError('Failed to load user data. Please refresh the page.');
                    setLoading(false);
                }
            };

            const loadGoals = async (client, userId) => {
                try {
                    setLoading(true);
                    const { data, error } = await client
                        .from('brand_audit_goals')
                        .select('*')
                        .eq('user_id', userId)
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    setGoals(data || []);
                } catch (err) {
                    console.error('Error loading goals:', err);
                    setError('Failed to load goals. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const handleCreateGoal = async () => {
                if (!newGoal.title.trim()) {
                    setError('Please enter a goal title');
                    return;
                }

                if (!supabaseClient || !currentUser) {
                    setError('Not authenticated. Please log in.');
                    return;
                }

                try {
                    setError('');
                    const goalData = {
                        user_id: currentUser.id,
                        title: newGoal.title.trim(),
                        description: newGoal.description.trim() || null,
                        category: newGoal.category,
                        priority: newGoal.priority,
                        target_value: newGoal.target_value ? parseFloat(newGoal.target_value) : null,
                        current_value: parseFloat(newGoal.current_value) || 0,
                        target_date: newGoal.target_date || null,
                        status: newGoal.status
                    };

                    const { data, error } = await supabaseClient
                        .from('brand_audit_goals')
                        .insert([goalData])
                        .select()
                        .single();

                    if (error) throw error;

                    setGoals([data, ...goals]);
                    setShowCreateModal(false);
                    setNewGoal({
                        title: '',
                        description: '',
                        category: 'general',
                        priority: 'medium',
                        target_value: '',
                        current_value: '0',
                        target_date: '',
                        status: 'active'
                    });
                } catch (err) {
                    console.error('Error creating goal:', err);
                    setError('Failed to create goal: ' + (err.message || 'Unknown error'));
                }
            };

            const handleUpdateGoal = async (goalId, updates) => {
                if (!supabaseClient) return;

                try {
                    setError('');
                    const { data, error } = await supabaseClient
                        .from('brand_audit_goals')
                        .update(updates)
                        .eq('id', goalId)
                        .select()
                        .single();

                    if (error) throw error;

                    setGoals(goals.map(g => g.id === goalId ? data : g));
                    setEditingGoal(null);
                } catch (err) {
                    console.error('Error updating goal:', err);
                    setError('Failed to update goal: ' + (err.message || 'Unknown error'));
                }
            };

            const handleDeleteGoal = async (goalId) => {
                if (!supabaseClient) return;
                if (!confirm('Are you sure you want to delete this goal?')) return;

                try {
                    setError('');
                    const { error } = await supabaseClient
                        .from('brand_audit_goals')
                        .delete()
                        .eq('id', goalId);

                    if (error) throw error;

                    setGoals(goals.filter(g => g.id !== goalId));
                } catch (err) {
                    console.error('Error deleting goal:', err);
                    setError('Failed to delete goal: ' + (err.message || 'Unknown error'));
                }
            };

            const handleUpdateProgress = async (goalId, newValue) => {
                const goal = goals.find(g => g.id === goalId);
                if (!goal) return;

                const updates = { current_value: parseFloat(newValue) || 0 };
                
                // Auto-complete if target reached
                if (goal.target_value && parseFloat(newValue) >= goal.target_value && goal.status !== 'completed') {
                    updates.status = 'completed';
                    updates.completed_at = new Date().toISOString();
                }

                await handleUpdateGoal(goalId, updates);
            };

            const getProgressPercentage = (goal) => {
                if (!goal.target_value || goal.target_value === 0) return 0;
                return Math.min(100, Math.round((goal.current_value / goal.target_value) * 100));
            };

            const getPriorityColor = (priority) => {
                switch (priority) {
                    case 'high': return 'text-red-400 bg-red-500/20 border-red-500/50';
                    case 'medium': return 'text-yellow-400 bg-yellow-500/20 border-yellow-500/50';
                    case 'low': return 'text-green-400 bg-green-500/20 border-green-500/50';
                    default: return 'text-gray-400 bg-gray-500/20 border-gray-500/50';
                }
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'completed': return 'text-green-400 bg-green-500/20';
                    case 'active': return 'text-blue-400 bg-blue-500/20';
                    case 'paused': return 'text-yellow-400 bg-yellow-500/20';
                    case 'cancelled': return 'text-gray-400 bg-gray-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const filteredAndSortedGoals = React.useMemo(() => {
                let filtered = [...goals];
                
                // Apply filter
                if (filter !== 'all') {
                    filtered = filtered.filter(g => g.status === filter);
                }
                
                // Apply sorting
                filtered.sort((a, b) => {
                    switch (sortBy) {
                        case 'priority':
                            const priorityOrder = { high: 3, medium: 2, low: 1 };
                            return (priorityOrder[b.priority] || 0) - (priorityOrder[a.priority] || 0);
                        case 'target_date':
                            if (!a.target_date) return 1;
                            if (!b.target_date) return -1;
                            return new Date(a.target_date) - new Date(b.target_date);
                        case 'progress':
                            return getProgressPercentage(b) - getProgressPercentage(a);
                        default:
                            return new Date(b.created_at) - new Date(a.created_at);
                    }
                });
                
                return filtered;
            }, [goals, filter, sortBy]);

            const categories = ['general', 'linkedin', 'resume', 'portfolio', 'github', 'engagement', 'network', 'content', 'visibility'];

            if (loading) {
                return (
                    <div className="flex items-center justify-center py-20">
                        <div className="text-center">
                            <div className="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"></div>
                            <p className="text-gray-400">Loading goals...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-6">
                    {/* Header */}
                    <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-3xl font-bold text-gray-50 mb-2">Goals</h1>
                                <p className="text-gray-300">Set and track your personal brand development goals</p>
                            </div>
                            <button
                                onClick={() => setShowCreateModal(true)}
                                className="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg font-medium hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 flex items-center gap-2"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                New Goal
                            </button>
                        </div>
                    </div>

                    {/* Error Message */}
                    {error && (
                        <div className="bg-red-500/20 border border-red-500/50 rounded-xl p-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-2 text-red-400">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="8" x2="12" y2="12"></line>
                                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                    </svg>
                                    <span>{error}</span>
                                </div>
                                <button onClick={() => setError('')} className="text-red-400 hover:text-red-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Filters and Sort */}
                    <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-4">
                        <div className="flex flex-wrap items-center gap-4">
                            <div className="flex items-center gap-2">
                                <label className="text-gray-300 text-sm font-medium">Filter:</label>
                                <select
                                    value={filter}
                                    onChange={(e) => setFilter(e.target.value)}
                                    className="px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-50 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                >
                                    <option value="all">All Goals</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="paused">Paused</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div className="flex items-center gap-2">
                                <label className="text-gray-300 text-sm font-medium">Sort by:</label>
                                <select
                                    value={sortBy}
                                    onChange={(e) => setSortBy(e.target.value)}
                                    className="px-3 py-2 bg-gray-800 border border-gray-600 rounded-lg text-gray-50 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                >
                                    <option value="created_at">Newest First</option>
                                    <option value="priority">Priority</option>
                                    <option value="target_date">Target Date</option>
                                    <option value="progress">Progress</option>
                                </select>
                            </div>
                            <div className="ml-auto text-gray-400 text-sm">
                                {filteredAndSortedGoals.length} {filteredAndSortedGoals.length === 1 ? 'goal' : 'goals'}
                            </div>
                        </div>
                    </div>

                    {/* Goals List */}
                    {filteredAndSortedGoals.length === 0 ? (
                        <div className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-12 text-center">
                            <div className="text-6xl mb-4"></div>
                            <h3 className="text-xl font-semibold text-gray-50 mb-2">No goals yet</h3>
                            <p className="text-gray-400 mb-6">Create your first goal to start tracking your progress</p>
                            <button
                                onClick={() => setShowCreateModal(true)}
                                className="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg font-medium hover:from-indigo-600 hover:to-purple-700 transition-all duration-300"
                            >
                                Create Your First Goal
                            </button>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {filteredAndSortedGoals.map((goal) => (
                                <div key={goal.id} className="bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl p-6">
                                    <div className="flex items-start justify-between mb-4">
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2 mb-2">
                                                <h3 className="text-xl font-semibold text-gray-50">{goal.title}</h3>
                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getPriorityColor(goal.priority)}`}>
                                                    {goal.priority}
                                                </span>
                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(goal.status)}`}>
                                                    {goal.status}
                                                </span>
                                            </div>
                                            {goal.description && (
                                                <p className="text-gray-400 text-sm mb-2">{goal.description}</p>
                                            )}
                                            <div className="flex items-center gap-4 text-sm text-gray-400">
                                                <span className="capitalize">{goal.category}</span>
                                                {goal.target_date && (
                                                    <span> {new Date(goal.target_date).toLocaleDateString()}</span>
                                                )}
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <button
                                                onClick={() => setEditingGoal(goal)}
                                                className="p-2 text-gray-400 hover:text-indigo-400 transition-colors"
                                                title="Edit goal"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                </svg>
                                            </button>
                                            <button
                                                onClick={() => handleDeleteGoal(goal.id)}
                                                className="p-2 text-gray-400 hover:text-red-400 transition-colors"
                                                title="Delete goal"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                    <polyline points="3 6 5 6 21 6"></polyline>
                                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    {goal.target_value && (
                                        <div className="mb-4">
                                            <div className="flex items-center justify-between text-sm mb-2">
                                                <span className="text-gray-400">Progress</span>
                                                <span className="text-gray-50 font-medium">
                                                    {goal.current_value} / {goal.target_value} ({getProgressPercentage(goal)}%)
                                                </span>
                                            </div>
                                            <div className="w-full bg-gray-700 rounded-full h-3">
                                                <div
                                                    className="bg-gradient-to-r from-indigo-500 to-purple-600 h-3 rounded-full transition-all duration-300"
                                                    style={{ width: `${getProgressPercentage(goal)}%` }}
                                                ></div>
                                            </div>
                                            <div className="mt-2 flex items-center gap-2">
                                                <input
                                                    type="number"
                                                    value={goal.current_value}
                                                    onChange={(e) => handleUpdateProgress(goal.id, e.target.value)}
                                                    className="w-24 px-2 py-1 bg-gray-800 border border-gray-600 rounded text-gray-50 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="Update"
                                                    min="0"
                                                    step={goal.target_value > 100 ? "1" : "0.1"}
                                                />
                                                <span className="text-gray-400 text-xs">Update progress</span>
                                            </div>
                                        </div>
                                    )}

                                    {goal.status === 'active' && (
                                        <div className="flex gap-2 mt-4">
                                            <button
                                                onClick={() => handleUpdateGoal(goal.id, { status: 'completed', completed_at: new Date().toISOString() })}
                                                className="flex-1 px-4 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-colors text-sm font-medium"
                                            >
                                                Mark Complete
                                            </button>
                                            <button
                                                onClick={() => handleUpdateGoal(goal.id, { status: 'paused' })}
                                                className="flex-1 px-4 py-2 bg-yellow-500/20 text-yellow-400 rounded-lg hover:bg-yellow-500/30 transition-colors text-sm font-medium"
                                            >
                                                Pause
                                            </button>
                                        </div>
                                    )}

                                    {goal.status === 'paused' && (
                                        <button
                                            onClick={() => handleUpdateGoal(goal.id, { status: 'active' })}
                                            className="w-full mt-4 px-4 py-2 bg-blue-500/20 text-blue-400 rounded-lg hover:bg-blue-500/30 transition-colors text-sm font-medium"
                                        >
                                            Resume
                                        </button>
                                    )}
                                </div>
                            ))}
                        </div>
                    )}

                    {/* Create/Edit Modal */}
                    {(showCreateModal || editingGoal) && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" onClick={() => { setShowCreateModal(false); setEditingGoal(null); }}>
                            <div className="bg-gray-800 border border-gray-700 rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-50">
                                        {editingGoal ? 'Edit Goal' : 'Create New Goal'}
                                    </h2>
                                    <button
                                        onClick={() => { setShowCreateModal(false); setEditingGoal(null); }}
                                        className="p-2 text-gray-400 hover:text-gray-50 transition-colors"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>
                                </div>

                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Title *</label>
                                        <input
                                            type="text"
                                            value={editingGoal ? editingGoal.title : newGoal.title}
                                            onChange={(e) => editingGoal ? setEditingGoal({...editingGoal, title: e.target.value}) : setNewGoal({...newGoal, title: e.target.value})}
                                            className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            placeholder="e.g., Increase LinkedIn engagement rate"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                        <textarea
                                            value={editingGoal ? editingGoal.description || '' : newGoal.description}
                                            onChange={(e) => editingGoal ? setEditingGoal({...editingGoal, description: e.target.value}) : setNewGoal({...newGoal, description: e.target.value})}
                                            className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            rows="3"
                                            placeholder="Add details about this goal..."
                                        />
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Category</label>
                                            <select
                                                value={editingGoal ? editingGoal.category : newGoal.category}
                                                onChange={(e) => editingGoal ? setEditingGoal({...editingGoal, category: e.target.value}) : setNewGoal({...newGoal, category: e.target.value})}
                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            >
                                                {categories.map(cat => (
                                                    <option key={cat} value={cat}>{cat.charAt(0).toUpperCase() + cat.slice(1)}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Priority</label>
                                            <select
                                                value={editingGoal ? editingGoal.priority : newGoal.priority}
                                                onChange={(e) => editingGoal ? setEditingGoal({...editingGoal, priority: e.target.value}) : setNewGoal({...newGoal, priority: e.target.value})}
                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            >
                                                <option value="low">Low</option>
                                                <option value="medium">Medium</option>
                                                <option value="high">High</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Current Value</label>
                                            <input
                                                type="number"
                                                value={editingGoal ? editingGoal.current_value : newGoal.current_value}
                                                onChange={(e) => editingGoal ? setEditingGoal({...editingGoal, current_value: e.target.value}) : setNewGoal({...newGoal, current_value: e.target.value})}
                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                placeholder="0"
                                                min="0"
                                                step="0.1"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Target Value (optional)</label>
                                            <input
                                                type="number"
                                                value={editingGoal ? (editingGoal.target_value || '') : newGoal.target_value}
                                                onChange={(e) => editingGoal ? setEditingGoal({...editingGoal, target_value: e.target.value}) : setNewGoal({...newGoal, target_value: e.target.value})}
                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                placeholder="e.g., 5000"
                                                min="0"
                                                step="0.1"
                                            />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Target Date (optional)</label>
                                            <input
                                                type="date"
                                                value={editingGoal ? (editingGoal.target_date ? editingGoal.target_date.split('T')[0] : '') : newGoal.target_date}
                                                onChange={(e) => editingGoal ? setEditingGoal({...editingGoal, target_date: e.target.value}) : setNewGoal({...newGoal, target_date: e.target.value})}
                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            />
                                        </div>
                                        {editingGoal && (
                                            <div>
                                                <label className="block text-sm font-medium text-gray-300 mb-2">Status</label>
                                                <select
                                                    value={editingGoal.status}
                                                    onChange={(e) => setEditingGoal({...editingGoal, status: e.target.value})}
                                                    className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                >
                                                    <option value="active">Active</option>
                                                    <option value="completed">Completed</option>
                                                    <option value="paused">Paused</option>
                                                    <option value="cancelled">Cancelled</option>
                                                </select>
                                            </div>
                                        )}
                                    </div>

                                    <div className="flex gap-3 justify-end pt-4">
                                        <button
                                            onClick={() => { setShowCreateModal(false); setEditingGoal(null); }}
                                            className="px-6 py-2 bg-gray-700 text-gray-300 rounded-lg hover:bg-gray-600 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={editingGoal ? () => {
                                                const updates = {
                                                    title: editingGoal.title.trim(),
                                                    description: editingGoal.description?.trim() || null,
                                                    category: editingGoal.category,
                                                    priority: editingGoal.priority,
                                                    target_value: editingGoal.target_value ? parseFloat(editingGoal.target_value) : null,
                                                    current_value: parseFloat(editingGoal.current_value) || 0,
                                                    target_date: editingGoal.target_date || null,
                                                    status: editingGoal.status
                                                };
                                                handleUpdateGoal(editingGoal.id, updates);
                                            } : handleCreateGoal}
                                            className="px-6 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:from-indigo-600 hover:to-purple-700 transition-all duration-300"
                                        >
                                            {editingGoal ? 'Update Goal' : 'Create Goal'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render function for Goals component
        window.renderBrandAuditGoals = function() {
            console.log('renderBrandAuditGoals called');
            const container = document.getElementById('goals-tab-content');
            
            if (container) {
                try {
                    // Cleanup existing root if any
                    if (window.brandAuditGoalsRoot) {
                        window.brandAuditGoalsRoot.unmount();
                    }
                    
                    console.log('Creating React root and rendering Brand Audit Goals...');
                    window.brandAuditGoalsRoot = ReactDOM.createRoot(container);
                    window.brandAuditGoalsRoot.render(<BrandAuditGoals />);
                    console.log('Brand Audit Goals rendered successfully');
                } catch (error) {
                    console.error('Error rendering Brand Audit Goals:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Goals</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('goals-tab-content container not found');
            }
        };

        // Cleanup function for Goals component
        window.cleanupBrandAuditGoals = function() {
            if (window.brandAuditGoalsRoot) {
                try {
                    window.brandAuditGoalsRoot.unmount();
                    window.brandAuditGoalsRoot = null;
                } catch (error) {
                    console.error('Error cleaning up Brand Audit Goals:', error);
                    window.brandAuditGoalsRoot = null;
                }
            }
        };

        // Analytics Tab Component for Content Engine
        const AnalyticsTab = ({ isLightMode }) => {
            const [analyticsData, setAnalyticsData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [timeRange, setTimeRange] = useState(30);

            useEffect(() => {
                loadAnalytics();
            }, [timeRange]);

            const loadAnalytics = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    
                    // Initialize Supabase client
                    if (typeof supabase === 'undefined') {
                        throw new Error('Supabase library not loaded');
                    }
                    if (!window.ContentAnalytics) {
                        throw new Error('ContentAnalytics not available');
                    }
                    
                    const supabaseUrl = 'https://bialelscmftlquykreij.supabase.co';
                    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpYWxlbHNjbWZ0bHF1eWtyZWlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NzgxMTgsImV4cCI6MjA3NTQ1NDExOH0.wUywvxuTxDlgwVi6y8KaT9E64D4iVRKFFoqUx8wAalI';
                    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
                    
                    const analytics = new window.ContentAnalytics(supabaseClient);
                    const data = await analytics.getAnalyticsData(timeRange);
                    setAnalyticsData(data);
                } catch (err) {
                    console.error('Error loading analytics:', err);
                    setError('Failed to load analytics data. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            };

            const formatPercentage = (num) => {
                return num.toFixed(1) + '%';
            };

            // Simple bar chart component
            const BarChart = ({ data, maxValue, color }) => {
                if (!data || Object.keys(data).length === 0) {
                    return (
                        <div className={`text-center py-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                            No data available
                        </div>
                    );
                }

                const entries = Object.entries(data).sort((a, b) => b[1] - a[1]);

                return (
                    <div className="space-y-3">
                        {entries.map(([key, value]) => (
                            <div key={key}>
                                <div className="flex items-center justify-between mb-1">
                                    <span className={`text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                        {key}
                                    </span>
                                    <span className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-100'}`}>
                                        {value}
                                    </span>
                                </div>
                                <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                    <div
                                        className={`h-2 rounded-full ${color}`}
                                        style={{ width: `${maxValue > 0 ? (value / maxValue) * 100 : 0}%` }}
                                    ></div>
                                </div>
                            </div>
                        ))}
                    </div>
                );
            };

            // Line chart component for time series
            const LineChart = ({ data }) => {
                if (!data || data.length === 0) {
                    return (
                        <div className={`text-center py-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                            No time series data available
                        </div>
                    );
                }

                const maxContent = Math.max(...data.map(d => d.contentGenerated), 1);
                const maxViews = Math.max(...data.map(d => d.views), 1);

                return (
                    <div className="relative h-64">
                        <svg viewBox="0 0 800 200" className="w-full h-full">
                            {/* Grid lines */}
                            {[0, 25, 50, 75, 100].map(y => (
                                <line
                                    key={y}
                                    x1="50"
                                    y1={y * 2}
                                    x2="750"
                                    y2={y * 2}
                                    stroke={isLightMode ? '#e5e7eb' : '#374151'}
                                    strokeWidth="1"
                                />
                            ))}
                            
                            {/* Content Generated Line */}
                            <polyline
                                points={data.map((d, i) => {
                                    const x = 50 + (i / (data.length - 1 || 1)) * 700;
                                    const y = 200 - (d.contentGenerated / maxContent) * 150;
                                    return `${x},${y}`;
                                }).join(' ')}
                                fill="none"
                                stroke="#8b5cf6"
                                strokeWidth="2"
                            />
                            
                            {/* Views Line */}
                            <polyline
                                points={data.map((d, i) => {
                                    const x = 50 + (i / (data.length - 1 || 1)) * 700;
                                    const y = 200 - (d.views / maxViews) * 150;
                                    return `${x},${y}`;
                                }).join(' ')}
                                fill="none"
                                stroke="#10b981"
                                strokeWidth="2"
                            />
                        </svg>
                        <div className="absolute bottom-0 left-0 right-0 flex justify-between text-xs text-gray-400 px-2">
                            {data.filter((_, i) => i % Math.ceil(data.length / 5 || 1) === 0).map((d, i) => (
                                <span key={i}>{new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                            ))}
                        </div>
                    </div>
                );
            };

            if (loading) {
                return (
                    <div className="space-y-8">
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                            <div className="flex items-center justify-center py-20">
                                <div className="text-center">
                                    <div className="w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Loading analytics...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="space-y-8">
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                            <div className="text-center py-20">
                                <div className="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span className="text-white text-2xl"></span>
                                </div>
                                <h3 className={`text-xl font-semibold mb-2 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Error Loading Analytics</h3>
                                <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>{error}</p>
                                <button
                                    onClick={loadAnalytics}
                                    className="mt-4 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                                >
                                    Retry
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!analyticsData) {
                return (
                    <div className="space-y-8">
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                            <div className="text-center py-20">
                                <div className="w-16 h-16 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span className="text-white text-3xl"></span>
                                </div>
                                <h3 className={`text-xl font-semibold mb-2 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>No Analytics Data Yet</h3>
                                <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                    Start generating content to see your analytics here.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="space-y-8">
                    {/* Header */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                        <div className="flex items-center justify-between mb-6">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg flex items-center justify-center">
                                    <span className="text-white text-xl"></span>
                                </div>
                                <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    Thought Leadership Analytics
                                </h2>
                            </div>
                            <div className="flex items-center gap-3">
                                <button
                                    onClick={loadAnalytics}
                                    disabled={loading}
                                    className={`px-4 py-2 rounded-lg border font-medium transition-all ${
                                        loading
                                            ? 'opacity-50 cursor-not-allowed'
                                            : isLightMode
                                                ? 'bg-white border-gray-300 text-gray-900 hover:bg-gray-50'
                                                : 'bg-gray-800 border-gray-600 text-gray-100 hover:bg-gray-700'
                                    } focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                    title="Refresh analytics data"
                                >
                                    {loading ? '' : ''} Refresh
                                </button>
                                <select
                                    value={timeRange}
                                    onChange={(e) => setTimeRange(Number(e.target.value))}
                                    className={`px-4 py-2 rounded-lg border ${
                                        isLightMode 
                                            ? 'bg-white border-gray-300 text-gray-900' 
                                            : 'bg-gray-800 border-gray-600 text-gray-100'
                                    } focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                >
                                    <option value={7}>Last 7 days</option>
                                    <option value={30}>Last 30 days</option>
                                    <option value={90}>Last 90 days</option>
                                    <option value={365}>Last year</option>
                                </select>
                            </div>
                        </div>

                        {/* Key Metrics */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-xl p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Total Content</div>
                                <div className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.totalContent}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-xl p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Total Views</div>
                                <div className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {formatNumber(analyticsData.totalViews)}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-xl p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Engagement Rate</div>
                                <div className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {formatPercentage(analyticsData.averageEngagementRate)}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-xl p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Total Engagement</div>
                                <div className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {formatNumber(analyticsData.totalLikes + analyticsData.totalComments + analyticsData.totalShares)}
                                </div>
                            </div>
                        </div>

                        {/* Detailed Metrics */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-xl p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Likes</div>
                                <div className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {formatNumber(analyticsData.totalLikes)}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-xl p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Comments</div>
                                <div className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {formatNumber(analyticsData.totalComments)}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-xl p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Shares</div>
                                <div className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {formatNumber(analyticsData.totalShares)}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Charts Row */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* Content by Platform */}
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                            <h3 className={`text-xl font-bold mb-6 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                Content by Platform
                            </h3>
                            <BarChart
                                data={analyticsData.contentByPlatform}
                                maxValue={Math.max(...Object.values(analyticsData.contentByPlatform || {}), 1)}
                                color="bg-gradient-to-r from-purple-500 to-indigo-600"
                            />
                        </div>

                        {/* Content by Type */}
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                            <h3 className={`text-xl font-bold mb-6 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                Content by Type
                            </h3>
                            <BarChart
                                data={analyticsData.contentByType}
                                maxValue={Math.max(...Object.values(analyticsData.contentByType || {}), 1)}
                                color="bg-gradient-to-r from-green-500 to-emerald-600"
                            />
                        </div>
                    </div>

                    {/* Time Series Chart */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                        <h3 className={`text-xl font-bold mb-6 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                            Content Performance Over Time
                        </h3>
                        <LineChart data={analyticsData.timeSeriesData} />
                        <div className="flex items-center gap-4 mt-4">
                            <div className="flex items-center gap-2">
                                <div className="w-4 h-0.5 bg-purple-500"></div>
                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Content Generated</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-4 h-0.5 bg-green-500"></div>
                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Views</span>
                            </div>
                        </div>
                    </div>

                    {/* Generation Stats */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                        <h3 className={`text-xl font-bold mb-6 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                            Generation Statistics
                        </h3>
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Total Generated</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.generationStats.totalGenerated}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Posts</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.generationStats.postsGenerated}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Articles</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.generationStats.articlesGenerated}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Threads</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.generationStats.threadsGenerated}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Avg Words</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {Math.round(analyticsData.generationStats.averageWordsPerContent)}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Top Performing Content */}
                    {analyticsData.topPerformingContent && analyticsData.topPerformingContent.length > 0 && (
                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                            <h3 className={`text-xl font-bold mb-6 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                Top Performing Content
                            </h3>
                            <div className="space-y-4">
                                {analyticsData.topPerformingContent.slice(0, 5).map((content, index) => (
                                    <div
                                        key={content.id}
                                        className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'} flex items-center justify-between`}
                                    >
                                        <div className="flex items-center gap-4">
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${
                                                index === 0 ? 'bg-yellow-500 text-white' :
                                                index === 1 ? 'bg-gray-400 text-white' :
                                                index === 2 ? 'bg-orange-500 text-white' :
                                                'bg-gray-600 text-white'
                                            }`}>
                                                {index + 1}
                                            </div>
                                            <div>
                                                <div className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                    {content.title}
                                                </div>
                                                <div className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                    {content.platform}
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-6">
                                            <div className="text-right">
                                                <div className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                    {formatNumber(content.views)} views
                                                </div>
                                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                    {formatPercentage(content.engagement_rate)} engagement
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Scheduled Content Stats */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                        <h3 className={`text-xl font-bold mb-6 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                            Scheduled Content Status
                        </h3>
                        <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Total</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.scheduledStats.total}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Drafts</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.scheduledStats.drafts}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Scheduled</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.scheduledStats.scheduled}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Published</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.scheduledStats.published}
                                </div>
                            </div>
                            <div className={`${isLightMode ? 'bg-white/30' : 'bg-gray-800'} rounded-lg p-4 border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                <div className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-1`}>Failed</div>
                                <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {analyticsData.scheduledStats.failed}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Content Engine for Thought Leadership React Component
        const ContentEngine = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [activeGenerator, setActiveGenerator] = useState(null);
            const [selectedTopic, setSelectedTopic] = useState(null);
            const [generatedContent, setGeneratedContent] = useState(null);
            const [contentType, setContentType] = useState('post');
            const [tone, setTone] = useState('professional');
            const [selectedPlatforms, setSelectedPlatforms] = useState([]);
            const [contentHistory, setContentHistory] = useState([]);
            const [error, setError] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [formData, setFormData] = useState({});
            
            // Calendar & Post Queue state
            const [scheduledPosts, setScheduledPosts] = useState([]);
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [calendarView, setCalendarView] = useState('month'); // 'month', 'week', 'day'
            const [selectedPost, setSelectedPost] = useState(null);
            const [timezone, setTimezone] = useState(Intl.DateTimeFormat().resolvedOptions().timeZone);
            const [showScheduleModal, setShowScheduleModal] = useState(false);
            const [scheduleModalContent, setScheduleModalContent] = useState(null);
            const [queueFilters, setQueueFilters] = useState({ status: 'all', platform: 'all', search: '' });
            
            // Expertise modal state
            const [showExpertiseModal, setShowExpertiseModal] = useState(false);
            const [editingExpertise, setEditingExpertise] = useState(null);
            const [expertiseError, setExpertiseError] = useState(null);
            
            // Dynamic content state
            const [growthOpportunities, setGrowthOpportunities] = useState([]);
            const [contentStrategy, setContentStrategy] = useState([]);
            const [authorityInsights, setAuthorityInsights] = useState({});
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            const trendingTopics = [
                {
                    id: 1,
                    title: 'AI Ethics in Software Development',
                    relevanceScore: 92,
                    engagementPotential: 85,
                    competitionLevel: 'Medium',
                    timeframe: 'This Week',
                    category: 'Technology',
                    keywords: ['AI', 'Ethics', 'Development', 'Responsibility']
                },
                {
                    id: 2,
                    title: 'Remote Work Culture Evolution',
                    relevanceScore: 88,
                    engagementPotential: 78,
                    competitionLevel: 'High',
                    timeframe: 'This Month',
                    category: 'Workplace',
                    keywords: ['Remote Work', 'Culture', 'Productivity', 'Team Building']
                },
                {
                    id: 3,
                    title: 'Sustainable Tech Practices',
                    relevanceScore: 85,
                    engagementPotential: 72,
                    competitionLevel: 'Low',
                    timeframe: 'Next Week',
                    category: 'Sustainability',
                    keywords: ['Green Tech', 'Sustainability', 'Environment', 'Innovation']
                }
            ];

            const contentSuggestions = [
                {
                    id: 1,
                    topic: 'The Future of AI in Healthcare',
                    angle: 'Personal experience with AI diagnostics',
                    contentType: 'LinkedIn Post',
                    estimatedEngagement: 450,
                    difficulty: 'Medium',
                    timeToCreate: '15 min',
                    platforms: ['LinkedIn', 'Twitter']
                },
                {
                    id: 2,
                    topic: 'Building Inclusive Tech Teams',
                    angle: 'Data-driven approach to diversity',
                    contentType: 'Article',
                    estimatedEngagement: 320,
                    difficulty: 'Easy',
                    timeToCreate: '25 min',
                    platforms: ['LinkedIn', 'Medium']
                },
                {
                    id: 3,
                    topic: 'Cybersecurity Best Practices',
                    angle: 'Lessons from recent breaches',
                    contentType: 'Thread',
                    estimatedEngagement: 280,
                    difficulty: 'Hard',
                    timeToCreate: '20 min',
                    platforms: ['Twitter', 'LinkedIn']
                }
            ];

            // Expertise areas state management
            const EXPERTISE_STORAGE_KEY = 'content_engine_expertise_areas';
            
            const defaultExpertiseAreas = [
                {
                    id: 1,
                    name: 'Software Architecture',
                    level: 'Expert',
                    authorityScore: 85,
                    contentCount: 24,
                    lastUpdated: Date.now() - (2 * 24 * 60 * 60 * 1000), // 2 days ago
                    createdAt: Date.now() - (30 * 24 * 60 * 60 * 1000) // 30 days ago
                },
                {
                    id: 2,
                    name: 'AI & Machine Learning',
                    level: 'Advanced',
                    authorityScore: 72,
                    contentCount: 18,
                    lastUpdated: Date.now() - (7 * 24 * 60 * 60 * 1000), // 1 week ago
                    createdAt: Date.now() - (25 * 24 * 60 * 60 * 1000) // 25 days ago
                },
                {
                    id: 3,
                    name: 'DevOps & Infrastructure',
                    level: 'Intermediate',
                    authorityScore: 58,
                    contentCount: 12,
                    lastUpdated: Date.now() - (14 * 24 * 60 * 60 * 1000), // 2 weeks ago
                    createdAt: Date.now() - (20 * 24 * 60 * 60 * 1000) // 20 days ago
                }
            ];

            const loadExpertiseAreasFromStorage = () => {
                try {
                    const stored = localStorage.getItem(EXPERTISE_STORAGE_KEY);
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        // Migrate old data format if needed
                        return parsed.map(area => ({
                            ...area,
                            lastUpdated: area.lastUpdated || (typeof area.lastUpdated === 'string' ? Date.now() - (7 * 24 * 60 * 60 * 1000) : area.lastUpdated),
                            createdAt: area.createdAt || area.lastUpdated || Date.now()
                        }));
                    }
                    return defaultExpertiseAreas;
                } catch (error) {
                    console.error('Error loading expertise areas:', error);
                    return defaultExpertiseAreas;
                }
            };

            const saveExpertiseAreasToStorage = (areas) => {
                try {
                    localStorage.setItem(EXPERTISE_STORAGE_KEY, JSON.stringify(areas));
                } catch (error) {
                    console.error('Error saving expertise areas:', error);
                    if (error.name === 'QuotaExceededError') {
                        throw new Error('Storage quota exceeded. Please delete some expertise areas.');
                    }
                    throw error;
                }
            };

            const [expertiseAreas, setExpertiseAreas] = useState(() => loadExpertiseAreasFromStorage());

            // Helper functions for expertise areas
            const generateExpertiseId = () => Date.now();
            
            const formatLastUpdated = (timestamp) => {
                if (!timestamp) return 'Never';
                const now = Date.now();
                const diff = now - timestamp;
                const seconds = Math.floor(diff / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                const weeks = Math.floor(days / 7);
                
                if (weeks > 0) return `${weeks} week${weeks > 1 ? 's' : ''} ago`;
                if (days > 0) return `${days} day${days > 1 ? 's' : ''} ago`;
                if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
                if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
                return 'Just now';
            };

            const validateExpertiseArea = (area, existingAreas = []) => {
                const errors = [];
                
                if (!area.name || area.name.trim().length < 3) {
                    errors.push('Name must be at least 3 characters');
                }
                if (area.name && area.name.trim().length > 50) {
                    errors.push('Name must be less than 50 characters');
                }
                
                // Check for duplicates (excluding current area if editing)
                const duplicateName = existingAreas.find(
                    a => a.id !== area.id && a.name.toLowerCase().trim() === area.name.toLowerCase().trim()
                );
                if (duplicateName) {
                    errors.push('An expertise area with this name already exists');
                }
                
                if (typeof area.authorityScore !== 'number' || area.authorityScore < 0 || area.authorityScore > 100) {
                    errors.push('Authority score must be a number between 0 and 100');
                }
                
                const validLevels = ['Beginner', 'Intermediate', 'Advanced', 'Expert'];
                if (!validLevels.includes(area.level)) {
                    errors.push('Level must be one of: Beginner, Intermediate, Advanced, Expert');
                }
                
                return errors;
            };

            const getExpertiseLevelFromScore = (score) => {
                if (score >= 80) return 'Expert';
                if (score >= 60) return 'Advanced';
                if (score >= 40) return 'Intermediate';
                return 'Beginner';
            };

            // CRUD operations for expertise areas
            const addExpertiseArea = (newArea) => {
                try {
                    const validationErrors = validateExpertiseArea(newArea, expertiseAreas);
                    if (validationErrors.length > 0) {
                        throw new Error(validationErrors.join(', '));
                    }
                    
                    const area = {
                        id: generateExpertiseId(),
                        name: newArea.name.trim(),
                        level: newArea.level,
                        authorityScore: newArea.authorityScore,
                        contentCount: 0,
                        lastUpdated: Date.now(),
                        createdAt: Date.now()
                    };
                    
                    const updated = [...expertiseAreas, area];
                    setExpertiseAreas(updated);
                    saveExpertiseAreasToStorage(updated);
                    return area;
                } catch (error) {
                    console.error('Error adding expertise area:', error);
                    throw error;
                }
            };

            const updateExpertiseArea = (id, updates) => {
                try {
                    const index = expertiseAreas.findIndex(area => area.id === id);
                    if (index === -1) {
                        throw new Error('Expertise area not found');
                    }
                    
                    const updatedArea = {
                        ...expertiseAreas[index],
                        ...updates,
                        lastUpdated: Date.now()
                    };
                    
                    // Validate updated area
                    const validationErrors = validateExpertiseArea(updatedArea, expertiseAreas);
                    if (validationErrors.length > 0) {
                        throw new Error(validationErrors.join(', '));
                    }
                    
                    // Update name trimming
                    if (updates.name) {
                        updatedArea.name = updates.name.trim();
                    }
                    
                    const updated = [...expertiseAreas];
                    updated[index] = updatedArea;
                    setExpertiseAreas(updated);
                    saveExpertiseAreasToStorage(updated);
                    return updatedArea;
                } catch (error) {
                    console.error('Error updating expertise area:', error);
                    throw error;
                }
            };

            const deleteExpertiseArea = (id) => {
                try {
                    const filtered = expertiseAreas.filter(area => area.id !== id);
                    setExpertiseAreas(filtered);
                    saveExpertiseAreasToStorage(filtered);
                } catch (error) {
                    console.error('Error deleting expertise area:', error);
                    throw error;
                }
            };

            // Note: We don't need a useEffect to sync expertiseAreas to localStorage
            // because all CRUD operations (add, update, delete) already save to localStorage
            // This prevents infinite loops and unnecessary saves

            const getRelevanceColor = (score) => {
                if (score >= 90) return 'text-green-400 bg-green-500/20';
                if (score >= 80) return 'text-blue-400 bg-blue-500/20';
                if (score >= 70) return 'text-yellow-400 bg-yellow-500/20';
                return 'text-red-400 bg-red-500/20';
            };

            const getCompetitionColor = (level) => {
                switch (level) {
                    case 'Low':
                        return 'text-green-400 bg-green-500/20';
                    case 'Medium':
                        return 'text-yellow-400 bg-yellow-500/20';
                    case 'High':
                        return 'text-red-400 bg-red-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getDifficultyColor = (difficulty) => {
                switch (difficulty) {
                    case 'Easy':
                        return 'text-green-400';
                    case 'Medium':
                        return 'text-yellow-400';
                    case 'Hard':
                        return 'text-red-400';
                    default:
                        return 'text-gray-400';
                }
            };

            const getAuthorityColor = (score) => {
                if (score >= 80) return 'text-green-400';
                if (score >= 60) return 'text-yellow-400';
                return 'text-red-400';
            };

            // OpenAI API helper function for content generation
            const callOpenAIForContent = async (prompt, options = {}) => {
                try {
                    const apiKey = window.getOpenAIKey ? window.getOpenAIKey() : null;
                    if (!apiKey) {
                        throw new Error('OpenAI API key not found. Please set it in Settings > Integrations.');
                    }

                    const {
                        model = 'gpt-4o-mini',
                        temperature = 0.7,
                        maxTokens = 2000,
                        contentType = 'post'
                    } = options;

                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${apiKey}`
                        },
                        body: JSON.stringify({
                            model,
                            messages: [
                                {
                                    role: 'user',
                                    content: prompt
                                }
                            ],
                            temperature,
                            max_tokens: maxTokens
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ error: { message: 'Unknown error' } }));
                        throw new Error(errorData.error?.message || `API error: ${response.status}`);
                    }

                    const data = await response.json();
                    const content = data.choices[0]?.message?.content;
                    
                    if (!content) {
                        throw new Error('No response from OpenAI');
                    }

                    return content.trim();
                } catch (error) {
                    console.error('Error calling OpenAI API:', error);
                    throw error;
                }
            };

            // Record content to analytics database
            const recordContentToAnalytics = async (contentData) => {
                console.log(' Recording content to analytics:', contentData.type, contentData.title);
                try {
                    // Initialize Supabase client
                    if (typeof supabase === 'undefined') {
                        console.warn(' Supabase not available, skipping analytics recording');
                        return;
                    }
                    
                    const supabaseUrl = 'https://bialelscmftlquykreij.supabase.co';
                    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpYWxlbHNjbWZ0bHF1eWtyZWlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk4NzgxMTgsImV4cCI6MjA3NTQ1NDExOH0.wUywvxuTxDlgwVi6y8KaT9E64D4iVRKFFoqUx8wAalI';
                    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
                    
                    // Get current user
                    const { data: { user }, error: userError } = await supabaseClient.auth.getUser();
                    if (userError) {
                        console.error(' Error getting user:', userError);
                        return;
                    }
                    if (!user) {
                        console.warn(' User not authenticated, skipping analytics recording');
                        return;
                    }
                    console.log(' User authenticated:', user.id);
                    
                    // Determine content type
                    const contentTypeMap = {
                        'post-generator': 'post',
                        'comment-helper': 'post',
                        'carousel-maker': 'post',
                        'repurpose-content': 'post'
                    };
                    
                    const contentType = contentTypeMap[contentData.type] || 'post';
                    const platform = contentData.metadata?.platforms?.[0] || contentData.metadata?.platform || null;
                    
                    // Record to content_analytics table
                    const { data, error } = await supabaseClient
                        .from('content_analytics')
                        .insert({
                            user_id: user.id,
                            content_id: `content_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                            content_type: contentType,
                            platform: platform,
                            title: contentData.title || 'Untitled',
                            content_preview: contentData.content?.substring(0, 200) || '',
                            metadata: {
                                ...contentData.metadata,
                                type: contentData.type
                            }
                        })
                        .select()
                        .single();
                    
                    if (error) {
                        console.error(' Error recording content to analytics:', error);
                        console.error('Error details:', JSON.stringify(error, null, 2));
                        return;
                    }
                    
                    console.log(' Content recorded to analytics successfully! ID:', data.id);
                    
                    // Update generation stats
                    const today = new Date().toISOString().split('T')[0];
                    const wordCount = contentData.content?.split(/\s+/).filter(word => word.length > 0).length || 0;
                    
                    // Get existing stats for today
                    const { data: existingStats } = await supabaseClient
                        .from('content_generation_stats')
                        .select('*')
                        .eq('user_id', user.id)
                        .eq('date', today)
                        .maybeSingle();
                    
                    if (existingStats) {
                        // Update existing stats
                        const updates = {
                            total_generated: existingStats.total_generated + 1,
                            total_words: (existingStats.total_words || 0) + wordCount
                        };
                        
                        if (contentType === 'post') {
                            updates.posts_generated = (existingStats.posts_generated || 0) + 1;
                        }
                        
                        await supabaseClient
                            .from('content_generation_stats')
                            .update(updates)
                            .eq('id', existingStats.id);
                    } else {
                        // Create new stats for today
                        const newStats = {
                            user_id: user.id,
                            date: today,
                            total_generated: 1,
                            total_words: wordCount,
                            posts_generated: contentType === 'post' ? 1 : 0,
                            articles_generated: 0,
                            threads_generated: 0
                        };
                        
                        await supabaseClient
                            .from('content_generation_stats')
                            .insert(newStats);
                    }
                    
                } catch (error) {
                    console.error(' Error recording content to analytics:', error);
                    console.error('Error stack:', error.stack);
                    console.error('Content data that failed:', {
                        type: contentData?.type,
                        title: contentData?.title,
                        hasContent: !!contentData?.content
                    });
                    // Don't throw - analytics recording failure shouldn't break content generation
                }
            };

            // Content storage utilities
            const CONTENT_STORAGE_KEY = 'content_engine_generated_content';

            const saveContentToHistory = (contentData) => {
                try {
                    const history = loadContentHistory();
                    const newContent = {
                        id: Date.now(),
                        type: contentData.type,
                        title: contentData.title || 'Untitled Content',
                        content: contentData.content,
                        metadata: {
                            topic: contentData.metadata?.topic || '',
                            platforms: contentData.metadata?.platforms || [],
                            tone: contentData.metadata?.tone || 'professional',
                            timestamp: Date.now()
                        }
                    };
                    history.unshift(newContent);
                    // Keep only last 100 items
                    const limitedHistory = history.slice(0, 100);
                    localStorage.setItem(CONTENT_STORAGE_KEY, JSON.stringify(limitedHistory));
                    setContentHistory(limitedHistory);
                    return newContent;
                } catch (error) {
                    console.error('Error saving content:', error);
                    if (error.name === 'QuotaExceededError') {
                        throw new Error('Storage quota exceeded. Please delete some old content.');
                    }
                    throw error;
                }
            };

            const loadContentHistory = () => {
                try {
                    const stored = localStorage.getItem(CONTENT_STORAGE_KEY);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error loading content history:', error);
                    return [];
                }
            };

            const deleteContentFromHistory = (id) => {
                try {
                    const history = loadContentHistory();
                    const filtered = history.filter(item => item.id !== id);
                    localStorage.setItem(CONTENT_STORAGE_KEY, JSON.stringify(filtered));
                    setContentHistory(filtered);
                } catch (error) {
                    console.error('Error deleting content:', error);
                    throw error;
                }
            };

            // Load content history on mount
            React.useEffect(() => {
                const history = loadContentHistory();
                setContentHistory(history);
            }, []);

            // Scheduling storage utilities
            const SCHEDULED_POSTS_STORAGE_KEY = 'content_engine_scheduled_posts';

            const saveScheduledPost = (postData) => {
                try {
                    const posts = loadScheduledPosts();
                    const newPost = {
                        id: postData.id || Date.now(),
                        content: postData.content,
                        title: postData.title || postData.content.substring(0, 50) + '...',
                        platform: postData.platform,
                        scheduledDate: postData.scheduledDate,
                        status: postData.status || 'draft',
                        contentType: postData.contentType || 'post',
                        metadata: {
                            originalContentId: postData.metadata?.originalContentId || null,
                            tone: postData.metadata?.tone || 'professional',
                            visibility: postData.metadata?.visibility || 'PUBLIC',
                            retryCount: postData.metadata?.retryCount || 0,
                            errorMessage: postData.metadata?.errorMessage || null,
                            publishedAt: postData.metadata?.publishedAt || null,
                            createdAt: postData.metadata?.createdAt || new Date().toISOString()
                        }
                    };
                    posts.push(newPost);
                    // Sort by scheduled date
                    posts.sort((a, b) => new Date(a.scheduledDate) - new Date(b.scheduledDate));
                    localStorage.setItem(SCHEDULED_POSTS_STORAGE_KEY, JSON.stringify(posts));
                    setScheduledPosts(posts);
                    return newPost;
                } catch (error) {
                    console.error('Error saving scheduled post:', error);
                    if (error.name === 'QuotaExceededError') {
                        throw new Error('Storage quota exceeded. Please delete some old posts.');
                    }
                    throw error;
                }
            };

            const loadScheduledPosts = () => {
                try {
                    const stored = localStorage.getItem(SCHEDULED_POSTS_STORAGE_KEY);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error loading scheduled posts:', error);
                    return [];
                }
            };

            const deleteScheduledPost = (id) => {
                try {
                    const posts = loadScheduledPosts();
                    const filtered = posts.filter(post => post.id !== id);
                    localStorage.setItem(SCHEDULED_POSTS_STORAGE_KEY, JSON.stringify(filtered));
                    setScheduledPosts(filtered);
                } catch (error) {
                    console.error('Error deleting scheduled post:', error);
                    throw error;
                }
            };

            const updateScheduledPost = (id, updates) => {
                try {
                    const posts = loadScheduledPosts();
                    const index = posts.findIndex(post => post.id === id);
                    if (index === -1) {
                        throw new Error('Post not found');
                    }
                    posts[index] = { ...posts[index], ...updates };
                    if (updates.metadata) {
                        posts[index].metadata = { ...posts[index].metadata, ...updates.metadata };
                    }
                    // Re-sort by scheduled date
                    posts.sort((a, b) => new Date(a.scheduledDate) - new Date(b.scheduledDate));
                    localStorage.setItem(SCHEDULED_POSTS_STORAGE_KEY, JSON.stringify(posts));
                    setScheduledPosts(posts);
                    return posts[index];
                } catch (error) {
                    console.error('Error updating scheduled post:', error);
                    throw error;
                }
            };

            // Load scheduled posts on mount
            React.useEffect(() => {
                const posts = loadScheduledPosts();
                setScheduledPosts(posts);
            }, []);

            const handleGenerateContent = (suggestion) => {
                // Navigate to generator tab and pre-fill form
                setActiveTab('generator');
                setActiveGenerator('post-generator'); // Default to post generator
                setSelectedTopic(suggestion);
                setFormData({
                    topic: suggestion.topic,
                    angle: suggestion.angle,
                    platforms: suggestion.platforms,
                    contentType: suggestion.contentType,
                    tone: 'professional'
                });
                setSelectedPlatforms(suggestion.platforms);
                setContentType(suggestion.contentType.toLowerCase().includes('post') ? 'post' : 'article');
            };

            const handleGeneratorSelect = (generator) => {
                setActiveGenerator(generator);
                setGeneratedContent(null);
                setError(null);
                setFormData({});
            };

            // Content generation functions for each generator type
            const generatePost = async (formData) => {
                const { topic, targetAudience = 'professionals', tone, platforms = [], contentLength = 'medium' } = formData;
                
                if (!topic || topic.trim() === '') {
                    throw new Error('Topic is required');
                }

                const lengthGuide = {
                    short: '200-300 words',
                    medium: '400-600 words',
                    long: '800-1000 words'
                };

                const platformConstraints = platforms.length > 0 
                    ? `Optimized for: ${platforms.join(', ')}. ` 
                    : '';

                const prompt = `Create a professional ${tone} social media post about "${topic}".

${platformConstraints}Target audience: ${targetAudience}.

Length: ${lengthGuide[contentLength] || lengthGuide.medium}.

Requirements:
- Engaging and thought-provoking
- Professional ${tone} tone
- Include a clear value proposition
- Use appropriate formatting (hashtags, line breaks)
- Make it shareable and actionable

Generate only the post content, no additional commentary:`;

                return await callOpenAIForContent(prompt, {
                    temperature: 0.7,
                    maxTokens: contentLength === 'long' ? 3000 : contentLength === 'short' ? 1000 : 2000
                });
            };

            const generateComment = async (formData) => {
                const { originalPost, context = '', tone } = formData;
                
                if (!originalPost || originalPost.trim() === '') {
                    throw new Error('Original post text is required');
                }

                const prompt = `Generate a thoughtful, professional ${tone} comment responding to this social media post:

"${originalPost}"

${context ? `Context: ${context}` : ''}

Requirements:
- Be respectful and professional
- Add value to the conversation
- ${tone === 'conversational' ? 'Engage naturally' : 'Maintain professional tone'}
- Keep it concise (50-150 words)
- Show thoughtfulness and expertise

Generate 3 different comment variations, numbered 1, 2, and 3. Each should have a slightly different angle or perspective:`;

                return await callOpenAIForContent(prompt, {
                    temperature: 0.8,
                    maxTokens: 800
                });
            };

            const generateCarousel = async (formData) => {
                const { topic, numberOfSlides = 5, platform = 'LinkedIn' } = formData;
                
                if (!topic || topic.trim() === '') {
                    throw new Error('Topic is required');
                }

                if (numberOfSlides < 3 || numberOfSlides > 10) {
                    throw new Error('Number of slides must be between 3 and 10');
                }

                const prompt = `Create a ${numberOfSlides}-slide carousel content series about "${topic}" for ${platform}.

Format each slide as:
Slide 1: [Title/Headline]
Slide 2: [Content]
...
Slide ${numberOfSlides}: [Conclusion/Call to Action]

Requirements:
- Each slide should be concise (1-2 sentences or bullet points)
- Progressive narrative that builds on each slide
- Engaging and informative
- Include a strong hook in slide 1
- End with a clear call to action
- Make it visually structured (suitable for carousel format)

Generate the carousel content with clear slide numbering:`;

                return await callOpenAIForContent(prompt, {
                    temperature: 0.7,
                    maxTokens: 2500
                });
            };

            const generateRepurposedContent = async (formData) => {
                const { originalContent, targetFormat, targetPlatform = 'LinkedIn' } = formData;
                
                if (!originalContent || originalContent.trim() === '') {
                    throw new Error('Original content is required');
                }

                const formatGuidelines = {
                    post: 'a concise social media post (200-400 words)',
                    carousel: 'a 5-slide carousel format',
                    thread: 'a Twitter/X thread format with numbered tweets',
                    article: 'an article format (500-800 words)'
                };

                const prompt = `Repurpose this content into ${formatGuidelines[targetFormat] || 'a new format'} for ${targetPlatform}:

Original Content:
"${originalContent}"

Requirements:
- Maintain the core message and value
- Adapt to ${targetFormat} format
- Optimize for ${targetPlatform} audience
- Make it fresh and engaging
- Preserve key insights and information
- Use appropriate formatting for the platform

Generate the repurposed content:`;

                return await callOpenAIForContent(prompt, {
                    temperature: 0.7,
                    maxTokens: targetFormat === 'article' ? 3000 : 2000
                });
            };

            // Utility functions for content actions
            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    return true;
                } catch (error) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        return true;
                    } catch (err) {
                        document.body.removeChild(textArea);
                        throw new Error('Failed to copy to clipboard');
                    }
                }
            };

            const exportAsTextFile = (content, filename) => {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename || 'content.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const getWordCount = (text) => {
                return text.trim().split(/\s+/).filter(word => word.length > 0).length;
            };

            const getCharacterCount = (text) => {
                return text.length;
            };

            // Calendar utility functions
            const getDaysInMonth = (date) => {
                return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            };

            const getFirstDayOfMonth = (date) => {
                return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
            };

            const formatDate = (date, format = 'short') => {
                const d = new Date(date);
                if (format === 'short') {
                    return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                }
                return d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            };

            const formatDateTime = (date) => {
                const d = new Date(date);
                return d.toLocaleString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            };

            const getPostsForDate = (date) => {
                const dateStr = date.toISOString().split('T')[0];
                return scheduledPosts.filter(post => {
                    const postDate = new Date(post.scheduledDate).toISOString().split('T')[0];
                    return postDate === dateStr;
                });
            };

            const getPlatformColor = (platform) => {
                const colors = {
                    'LinkedIn': 'blue',
                    'Twitter': 'cyan',
                    'Facebook': 'indigo',
                    'Instagram': 'pink',
                    'Medium': 'green'
                };
                return colors[platform] || 'gray';
            };

            const getStatusColor = (status) => {
                const colors = {
                    'draft': 'gray',
                    'scheduled': 'yellow',
                    'published': 'green',
                    'failed': 'red',
                    'publishing': 'blue'
                };
                return colors[status] || 'gray';
            };

            // LinkedIn publishing function
            const publishLinkedInPost = async (post) => {
                if (!window.LinkedInService) {
                    throw new Error('LinkedIn service not available');
                }
                
                const profile = window.LinkedInService.getCachedProfile();
                if (!profile || !profile.id) {
                    throw new Error('LinkedIn not connected. Please connect your LinkedIn account first.');
                }
                
                try {
                    await window.LinkedInService.sharePost(post.content, {
                        visibility: post.metadata.visibility || 'PUBLIC'
                    });
                    return { success: true };
                } catch (error) {
                    console.error('Error publishing LinkedIn post:', error);
                    throw error;
                }
            };

            // Automation system - check for posts to publish
            React.useEffect(() => {
                const checkAndPublishPosts = async () => {
                    const posts = loadScheduledPosts();
                    const now = new Date();
                    const postsToPublish = posts.filter(post => 
                        post.status === 'scheduled' && 
                        new Date(post.scheduledDate) <= now &&
                        post.platform === 'LinkedIn' // Only LinkedIn for now
                    );
                    
                    for (const post of postsToPublish) {
                        try {
                            // Update status to publishing
                            updateScheduledPost(post.id, { 
                                status: 'publishing'
                            });
                            
                            await publishLinkedInPost(post);
                            
                            // Update status to published
                            updateScheduledPost(post.id, {
                                status: 'published',
                                metadata: {
                                    ...post.metadata,
                                    publishedAt: new Date().toISOString()
                                }
                            });
                            
                            // Show notification
                            console.log('Post published successfully:', post.title);
                        } catch (error) {
                            // Update status to failed
                            updateScheduledPost(post.id, {
                                status: 'failed',
                                metadata: {
                                    ...post.metadata,
                                    retryCount: (post.metadata.retryCount || 0) + 1,
                                    errorMessage: error.message || 'Failed to publish post'
                                }
                            });
                            
                            // Show notification
                            console.error('Failed to publish post:', error.message);
                        }
                    }
                };
                
                // Check every minute
                const interval = setInterval(checkAndPublishPosts, 60000);
                
                // Also check immediately
                checkAndPublishPosts();
                
                return () => clearInterval(interval);
            }, []);

            // Handler to open schedule modal with content
            const handleScheduleContent = (content) => {
                setScheduleModalContent(content);
                setShowScheduleModal(true);
            };

            // Generator Component: Post Generator
            const PostGeneratorComponent = ({
                isLightMode, formData, setFormData, generatedContent, setGeneratedContent,
                isLoading, setIsLoading, error, setError, generatePost,
                tone, setTone, selectedPlatforms, setSelectedPlatforms, contentType, setContentType,
                copyToClipboard, exportAsTextFile, getWordCount, getCharacterCount, saveContentToHistory,
                handleScheduleContent, expertiseAreas
            }) => {
                const [localFormData, setLocalFormData] = React.useState({
                    topic: formData.topic || '',
                    targetAudience: formData.targetAudience || 'professionals',
                    contentLength: formData.contentLength || 'medium',
                    expertiseArea: formData.expertiseArea || ''
                });
                const [suggestedExpertise, setSuggestedExpertise] = React.useState([]);
                const [showExpertiseSuggestions, setShowExpertiseSuggestions] = React.useState(false);

                React.useEffect(() => {
                    if (formData.topic) {
                        setLocalFormData(prev => ({ ...prev, topic: formData.topic }));
                    }
                    if (formData.expertiseArea) {
                        setLocalFormData(prev => ({ ...prev, expertiseArea: formData.expertiseArea }));
                    }
                }, [formData.topic, formData.expertiseArea]);

                // Auto-suggest expertise areas based on topic
                React.useEffect(() => {
                    if (localFormData.topic && expertiseAreas && expertiseAreas.length > 0) {
                        const topicLower = localFormData.topic.toLowerCase();
                        const suggestions = expertiseAreas
                            .filter(area => {
                                const areaNameLower = area.name.toLowerCase();
                                // Check if topic contains expertise area name or vice versa
                                return topicLower.includes(areaNameLower.split(' ')[0]) ||
                                       areaNameLower.includes(topicLower.split(' ')[0]) ||
                                       topicLower.split(' ').some(word => areaNameLower.includes(word));
                            })
                            .slice(0, 3)
                            .map(area => area.name);
                        
                        setSuggestedExpertise(suggestions);
                        setShowExpertiseSuggestions(suggestions.length > 0 && !localFormData.expertiseArea);
                    } else {
                        setSuggestedExpertise([]);
                        setShowExpertiseSuggestions(false);
                    }
                }, [localFormData.topic, expertiseAreas, localFormData.expertiseArea]);

                const platforms = ['LinkedIn', 'Twitter', 'Facebook', 'Instagram', 'Medium'];
                const tones = ['professional', 'conversational', 'friendly', 'authoritative', 'inspiring'];
                const contentLengths = ['short', 'medium', 'long'];

                const handleGenerate = async () => {
                    setError(null);
                    if (!localFormData.topic || localFormData.topic.trim() === '') {
                        setError('Topic is required');
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const fullFormData = {
                            ...localFormData,
                            tone,
                            platforms: selectedPlatforms
                        };
                        const content = await generatePost(fullFormData);
                        const contentObj = {
                            title: localFormData.topic,
                            content: content,
                            type: 'post-generator',
                            metadata: {
                                topic: localFormData.topic,
                                platforms: selectedPlatforms,
                                tone: tone,
                                timestamp: Date.now(),
                                expertiseArea: localFormData.expertiseArea || null,
                                expertise_area: localFormData.expertiseArea || null
                            }
                        };
                        setGeneratedContent(contentObj);
                        setFormData(fullFormData);
                        
                        // Record to analytics (non-blocking)
                        recordContentToAnalytics(contentObj).catch(err => {
                            console.warn('Failed to record analytics, but content generation succeeded:', err);
                        });
                    } catch (err) {
                        setError(err.message || 'Failed to generate content. Please try again.');
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleSave = () => {
                    if (!generatedContent) return;
                    try {
                        saveContentToHistory(generatedContent);
                        alert('Content saved to history!');
                    } catch (err) {
                        setError(err.message);
                    }
                };

                const handleCopy = async () => {
                    if (!generatedContent?.content) return;
                    try {
                        await copyToClipboard(generatedContent.content);
                        alert('Content copied to clipboard!');
                    } catch (err) {
                        setError('Failed to copy to clipboard');
                    }
                };

                const handleExport = () => {
                    if (!generatedContent?.content) return;
                    const filename = `post-${localFormData.topic.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.txt`;
                    exportAsTextFile(generatedContent.content, filename);
                };

                return (
                    <div className="space-y-6">
                        {/* Form */}
                        <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Create Your Post</h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Topic *
                                    </label>
                                    <input
                                        type="text"
                                        value={localFormData.topic}
                                        onChange={(e) => setLocalFormData({ ...localFormData, topic: e.target.value })}
                                        placeholder="What do you want to write about?"
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    />
                                    {/* Auto-suggested Expertise Areas */}
                                    {showExpertiseSuggestions && suggestedExpertise.length > 0 && (
                                        <div className={`mt-2 p-3 rounded-lg border ${isLightMode ? 'bg-blue-50 border-blue-200' : 'bg-blue-500/20 border-blue-500/50'}`}>
                                            <div className={`text-xs font-medium mb-2 ${isLightMode ? 'text-blue-800' : 'text-blue-300'}`}>
                                                 Suggested Expertise Areas:
                                            </div>
                                            <div className="flex flex-wrap gap-2">
                                                {suggestedExpertise.map((expertise, idx) => (
                                                    <button
                                                        key={idx}
                                                        type="button"
                                                        onClick={() => {
                                                            setLocalFormData({ ...localFormData, expertiseArea: expertise });
                                                            setShowExpertiseSuggestions(false);
                                                        }}
                                                        className={`px-3 py-1 rounded-full text-xs font-medium transition-all ${
                                                            isLightMode
                                                                ? 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                                                                : 'bg-blue-500/30 text-blue-300 hover:bg-blue-500/40'
                                                        }`}
                                                    >
                                                        {expertise} 
                                                    </button>
                                                ))}
                                                <button
                                                    type="button"
                                                    onClick={() => setShowExpertiseSuggestions(false)}
                                                    className={`px-2 py-1 text-xs ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}
                                                >
                                                    Dismiss
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Expertise Area Selector */}
                                {expertiseAreas && expertiseAreas.length > 0 && (
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                            Expertise Area (Optional)
                                        </label>
                                        <select
                                            value={localFormData.expertiseArea || ''}
                                            onChange={(e) => setLocalFormData({ ...localFormData, expertiseArea: e.target.value })}
                                            className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                            disabled={isLoading}
                                        >
                                            <option value="">Select an expertise area (optional)</option>
                                            {expertiseAreas.map(area => (
                                                <option key={area.id} value={area.name}>
                                                    {area.name} ({area.level})
                                                </option>
                                            ))}
                                        </select>
                                        <p className={`text-xs mt-1 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                            Link this content to an expertise area for better analytics
                                        </p>
                                    </div>
                                )}

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Target Audience
                                    </label>
                                    <input
                                        type="text"
                                        value={localFormData.targetAudience}
                                        onChange={(e) => setLocalFormData({ ...localFormData, targetAudience: e.target.value })}
                                        placeholder="e.g., professionals, developers, entrepreneurs"
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Tone
                                    </label>
                                    <select
                                        value={tone}
                                        onChange={(e) => setTone(e.target.value)}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    >
                                        {tones.map(t => (
                                            <option key={t} value={t}>{t.charAt(0).toUpperCase() + t.slice(1)}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Platforms
                                    </label>
                                    <div className="flex flex-wrap gap-2">
                                        {platforms.map(platform => (
                                            <button
                                                key={platform}
                                                type="button"
                                                onClick={() => {
                                                    if (selectedPlatforms.includes(platform)) {
                                                        setSelectedPlatforms(selectedPlatforms.filter(p => p !== platform));
                                                    } else {
                                                        setSelectedPlatforms([...selectedPlatforms, platform]);
                                                    }
                                                }}
                                                disabled={isLoading}
                                                className={`px-3 py-1 rounded-full text-sm transition-all ${
                                                    selectedPlatforms.includes(platform)
                                                        ? 'bg-purple-500 text-white'
                                                        : isLightMode
                                                            ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                }`}
                                            >
                                                {platform}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Content Length
                                    </label>
                                    <select
                                        value={localFormData.contentLength}
                                        onChange={(e) => setLocalFormData({ ...localFormData, contentLength: e.target.value })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    >
                                        {contentLengths.map(len => (
                                            <option key={len} value={len}>{len.charAt(0).toUpperCase() + len.slice(1)}</option>
                                        ))}
                                    </select>
                                </div>

                                <button
                                    onClick={handleGenerate}
                                    disabled={isLoading || !localFormData.topic}
                                    className="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center gap-2">
                                            <span className="animate-spin"></span>
                                            Generating...
                                        </span>
                                    ) : (
                                        'Generate Post'
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Generated Content */}
                        {generatedContent && (
                            <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Generated Content</h3>
                                    <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                        {getWordCount(generatedContent.content)} words  {getCharacterCount(generatedContent.content)} characters
                                    </div>
                                </div>

                                <div className={`mb-4 p-4 rounded-lg ${isLightMode ? 'bg-gray-50' : 'bg-gray-900'} border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                    <pre className={`whitespace-pre-wrap ${isLightMode ? 'text-gray-900' : 'text-gray-50'} font-sans text-sm`}>
                                        {generatedContent.content}
                                    </pre>
                                </div>

                                {/* Action Buttons */}
                                <div className="flex flex-wrap gap-3">
                                    <button
                                        onClick={handleCopy}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                : 'bg-blue-600 text-white hover:bg-blue-700'
                                        }`}
                                    >
                                         Copy
                                    </button>
                                    <button
                                        onClick={handleSave}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-green-500 text-white hover:bg-green-600'
                                                : 'bg-green-600 text-white hover:bg-green-700'
                                        }`}
                                    >
                                         Save
                                    </button>
                                    <button
                                        onClick={() => handleScheduleContent && handleScheduleContent(generatedContent)}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-orange-500 text-white hover:bg-orange-600'
                                                : 'bg-orange-600 text-white hover:bg-orange-700'
                                        }`}
                                    >
                                         Schedule
                                    </button>
                                    <button
                                        onClick={handleExport}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-purple-500 text-white hover:bg-purple-600'
                                                : 'bg-purple-600 text-white hover:bg-purple-700'
                                        }`}
                                    >
                                         Export
                                    </button>
                                    <button
                                        onClick={handleGenerate}
                                        disabled={isLoading}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                        } disabled:opacity-50`}
                                    >
                                         Regenerate
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Generator Component: Comment Helper
            const CommentHelperComponent = ({
                isLightMode, formData, setFormData, generatedContent, setGeneratedContent,
                isLoading, setIsLoading, error, setError, generateComment,
                tone, setTone, copyToClipboard, exportAsTextFile, getWordCount, getCharacterCount, saveContentToHistory,
                handleScheduleContent
            }) => {
                const [localFormData, setLocalFormData] = React.useState({
                    originalPost: formData.originalPost || '',
                    context: formData.context || ''
                });

                const tones = ['professional', 'conversational', 'friendly', 'supportive', 'thoughtful'];

                const handleGenerate = async () => {
                    setError(null);
                    if (!localFormData.originalPost || localFormData.originalPost.trim() === '') {
                        setError('Original post text is required');
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const fullFormData = {
                            ...localFormData,
                            tone
                        };
                        const content = await generateComment(fullFormData);
                        const contentObj = {
                            title: 'Comment Response',
                            content: content,
                            type: 'comment-helper',
                            metadata: {
                                topic: 'Comment Response',
                                platforms: [],
                                tone: tone,
                                timestamp: Date.now()
                            }
                        };
                        setGeneratedContent(contentObj);
                        setFormData(fullFormData);
                        
                        // Record to analytics (non-blocking)
                        recordContentToAnalytics(contentObj).catch(err => {
                            console.warn('Failed to record analytics, but content generation succeeded:', err);
                        });
                    } catch (err) {
                        setError(err.message || 'Failed to generate comment. Please try again.');
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleCopy = async (text) => {
                    try {
                        await copyToClipboard(text);
                        alert('Comment copied to clipboard!');
                    } catch (err) {
                        setError('Failed to copy to clipboard');
                    }
                };

                const handleSave = () => {
                    if (!generatedContent) return;
                    try {
                        saveContentToHistory(generatedContent);
                        alert('Content saved to history!');
                    } catch (err) {
                        setError(err.message);
                    }
                };

                // Parse multiple comments from generated content
                const parseComments = (content) => {
                    if (!content) return [];
                    const lines = content.split('\n');
                    const comments = [];
                    let currentComment = '';
                    let currentNum = null;

                    lines.forEach(line => {
                        const numMatch = line.match(/^(\d+)\.?\s*(.*)/);
                        if (numMatch) {
                            if (currentNum !== null && currentComment.trim()) {
                                comments.push({ number: currentNum, text: currentComment.trim() });
                            }
                            currentNum = parseInt(numMatch[1]);
                            currentComment = numMatch[2];
                        } else if (line.trim() && currentNum !== null) {
                            currentComment += ' ' + line.trim();
                        }
                    });

                    if (currentNum !== null && currentComment.trim()) {
                        comments.push({ number: currentNum, text: currentComment.trim() });
                    }

                    return comments.length > 0 ? comments : [{ number: 1, text: content }];
                };

                const comments = generatedContent ? parseComments(generatedContent.content) : [];

                return (
                    <div className="space-y-6">
                        {/* Form */}
                        <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Generate Comment Response</h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Original Post Text *
                                    </label>
                                    <textarea
                                        value={localFormData.originalPost}
                                        onChange={(e) => setLocalFormData({ ...localFormData, originalPost: e.target.value })}
                                        placeholder="Paste the post you want to respond to..."
                                        rows="4"
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Additional Context (Optional)
                                    </label>
                                    <textarea
                                        value={localFormData.context}
                                        onChange={(e) => setLocalFormData({ ...localFormData, context: e.target.value })}
                                        placeholder="Any additional context or angle you want to emphasize..."
                                        rows="2"
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Tone
                                    </label>
                                    <select
                                        value={tone}
                                        onChange={(e) => setTone(e.target.value)}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    >
                                        {tones.map(t => (
                                            <option key={t} value={t}>{t.charAt(0).toUpperCase() + t.slice(1)}</option>
                                        ))}
                                    </select>
                                </div>

                                <button
                                    onClick={handleGenerate}
                                    disabled={isLoading || !localFormData.originalPost}
                                    className="w-full bg-gradient-to-r from-blue-500 to-cyan-600 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-600 hover:to-cyan-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center gap-2">
                                            <span className="animate-spin"></span>
                                            Generating...
                                        </span>
                                    ) : (
                                        'Generate Comments'
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Generated Comments */}
                        {generatedContent && comments.length > 0 && (
                            <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Generated Comment Options</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => handleScheduleContent && handleScheduleContent(generatedContent)}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                isLightMode
                                                    ? 'bg-orange-500 text-white hover:bg-orange-600'
                                                    : 'bg-orange-600 text-white hover:bg-orange-700'
                                            }`}
                                        >
                                             Schedule
                                        </button>
                                        <button
                                            onClick={handleSave}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                isLightMode
                                                    ? 'bg-green-500 text-white hover:bg-green-600'
                                                    : 'bg-green-600 text-white hover:bg-green-700'
                                            }`}
                                        >
                                             Save All
                                        </button>
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    {comments.map((comment, index) => (
                                        <div key={index} className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-900'} border ${isLightMode ? 'border-gray-200' : 'border-gray-700'} rounded-lg p-4`}>
                                            <div className="flex items-start justify-between mb-2">
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>
                                                    Option {comment.number}
                                                </span>
                                                <button
                                                    onClick={() => handleCopy(comment.text)}
                                                    className={`px-3 py-1 rounded-lg text-sm font-medium transition-all ${
                                                        isLightMode
                                                            ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                            : 'bg-blue-600 text-white hover:bg-blue-700'
                                                    }`}
                                                >
                                                     Copy
                                                </button>
                                            </div>
                                            <p className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'} text-sm whitespace-pre-wrap`}>
                                                {comment.text}
                                            </p>
                                            <div className={`mt-2 text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                {getWordCount(comment.text)} words  {getCharacterCount(comment.text)} characters
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Generator Component: Carousel Maker
            const CarouselMakerComponent = ({
                isLightMode, formData, setFormData, generatedContent, setGeneratedContent,
                isLoading, setIsLoading, error, setError, generateCarousel,
                copyToClipboard, exportAsTextFile, getWordCount, getCharacterCount, saveContentToHistory,
                handleScheduleContent
            }) => {
                const [localFormData, setLocalFormData] = React.useState({
                    topic: formData.topic || '',
                    numberOfSlides: formData.numberOfSlides || 5,
                    platform: formData.platform || 'LinkedIn'
                });

                React.useEffect(() => {
                    if (formData.topic) {
                        setLocalFormData(prev => ({ ...prev, topic: formData.topic }));
                    }
                }, [formData.topic]);

                const platforms = ['LinkedIn', 'Instagram', 'Twitter', 'Facebook'];

                const handleGenerate = async () => {
                    setError(null);
                    if (!localFormData.topic || localFormData.topic.trim() === '') {
                        setError('Topic is required');
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const content = await generateCarousel(localFormData);
                        const contentObj = {
                            title: localFormData.topic,
                            content: content,
                            type: 'carousel-maker',
                            metadata: {
                                topic: localFormData.topic,
                                platforms: [localFormData.platform],
                                tone: 'professional',
                                timestamp: Date.now()
                            }
                        };
                        setGeneratedContent(contentObj);
                        setFormData(localFormData);
                        
                        // Record to analytics (non-blocking)
                        recordContentToAnalytics(contentObj).catch(err => {
                            console.warn('Failed to record analytics, but content generation succeeded:', err);
                        });
                    } catch (err) {
                        setError(err.message || 'Failed to generate carousel. Please try again.');
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleSave = () => {
                    if (!generatedContent) return;
                    try {
                        saveContentToHistory(generatedContent);
                        alert('Content saved to history!');
                    } catch (err) {
                        setError(err.message);
                    }
                };

                const handleCopy = async () => {
                    if (!generatedContent?.content) return;
                    try {
                        await copyToClipboard(generatedContent.content);
                        alert('Carousel content copied to clipboard!');
                    } catch (err) {
                        setError('Failed to copy to clipboard');
                    }
                };

                const handleExport = () => {
                    if (!generatedContent?.content) return;
                    const filename = `carousel-${localFormData.topic.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.txt`;
                    exportAsTextFile(generatedContent.content, filename);
                };

                // Parse slides from content
                const parseSlides = (content) => {
                    if (!content) return [];
                    const slideRegex = /Slide\s+(\d+):?\s*(.*?)(?=Slide\s+\d+:|$)/gis;
                    const matches = [...content.matchAll(slideRegex)];
                    return matches.map(match => ({
                        number: parseInt(match[1]),
                        content: match[2].trim()
                    }));
                };

                const slides = generatedContent ? parseSlides(generatedContent.content) : [];

                return (
                    <div className="space-y-6">
                        {/* Form */}
                        <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Create Carousel</h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Topic *
                                    </label>
                                    <input
                                        type="text"
                                        value={localFormData.topic}
                                        onChange={(e) => setLocalFormData({ ...localFormData, topic: e.target.value })}
                                        placeholder="What topic should the carousel cover?"
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Number of Slides (3-10)
                                    </label>
                                    <input
                                        type="number"
                                        min="3"
                                        max="10"
                                        value={localFormData.numberOfSlides}
                                        onChange={(e) => setLocalFormData({ ...localFormData, numberOfSlides: parseInt(e.target.value) || 5 })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Platform
                                    </label>
                                    <select
                                        value={localFormData.platform}
                                        onChange={(e) => setLocalFormData({ ...localFormData, platform: e.target.value })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    >
                                        {platforms.map(p => (
                                            <option key={p} value={p}>{p}</option>
                                        ))}
                                    </select>
                                </div>

                                <button
                                    onClick={handleGenerate}
                                    disabled={isLoading || !localFormData.topic}
                                    className="w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white px-6 py-3 rounded-lg font-medium hover:from-purple-600 hover:to-pink-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center gap-2">
                                            <span className="animate-spin"></span>
                                            Generating...
                                        </span>
                                    ) : (
                                        'Generate Carousel'
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Generated Carousel */}
                        {generatedContent && (
                            <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Carousel Content</h3>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={handleCopy}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                isLightMode
                                                    ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                    : 'bg-blue-600 text-white hover:bg-blue-700'
                                            }`}
                                        >
                                             Copy
                                        </button>
                                        <button
                                            onClick={() => handleScheduleContent && handleScheduleContent(generatedContent)}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                isLightMode
                                                    ? 'bg-orange-500 text-white hover:bg-orange-600'
                                                    : 'bg-orange-600 text-white hover:bg-orange-700'
                                            }`}
                                        >
                                             Schedule
                                        </button>
                                        <button
                                            onClick={handleSave}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                isLightMode
                                                    ? 'bg-green-500 text-white hover:bg-green-600'
                                                    : 'bg-green-600 text-white hover:bg-green-700'
                                            }`}
                                        >
                                             Save
                                        </button>
                                        <button
                                            onClick={handleExport}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                isLightMode
                                                    ? 'bg-purple-500 text-white hover:bg-purple-600'
                                                    : 'bg-purple-600 text-white hover:bg-purple-700'
                                            }`}
                                        >
                                             Export
                                        </button>
                                    </div>
                                </div>

                                {slides.length > 0 ? (
                                    <div className="space-y-3">
                                        {slides.map((slide, index) => (
                                            <div key={index} className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-900'} border ${isLightMode ? 'border-gray-200' : 'border-gray-700'} rounded-lg p-4`}>
                                                <div className="flex items-center gap-2 mb-2">
                                                    <span className={`text-sm font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>
                                                        Slide {slide.number}
                                                    </span>
                                                </div>
                                                <p className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'} text-sm whitespace-pre-wrap`}>
                                                    {slide.content}
                                                </p>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className={`p-4 rounded-lg ${isLightMode ? 'bg-gray-50' : 'bg-gray-900'} border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                        <pre className={`whitespace-pre-wrap ${isLightMode ? 'text-gray-900' : 'text-gray-50'} font-sans text-sm`}>
                                            {generatedContent.content}
                                        </pre>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                );
            };

            // Generator Component: Repurpose Content
            const RepurposeContentComponent = ({
                isLightMode, formData, setFormData, generatedContent, setGeneratedContent,
                isLoading, setIsLoading, error, setError, generateRepurposedContent,
                copyToClipboard, exportAsTextFile, getWordCount, getCharacterCount, saveContentToHistory,
                handleScheduleContent
            }) => {
                const [localFormData, setLocalFormData] = React.useState({
                    originalContent: formData.originalContent || '',
                    targetFormat: formData.targetFormat || 'post',
                    targetPlatform: formData.targetPlatform || 'LinkedIn'
                });

                const formats = [
                    { value: 'post', label: 'Social Media Post' },
                    { value: 'carousel', label: 'Carousel' },
                    { value: 'thread', label: 'Twitter/X Thread' },
                    { value: 'article', label: 'Article' }
                ];

                const platforms = ['LinkedIn', 'Twitter', 'Facebook', 'Instagram', 'Medium'];

                const handleGenerate = async () => {
                    setError(null);
                    if (!localFormData.originalContent || localFormData.originalContent.trim() === '') {
                        setError('Original content is required');
                        return;
                    }

                    setIsLoading(true);
                    try {
                        const content = await generateRepurposedContent(localFormData);
                        const contentObj = {
                            title: `Repurposed ${localFormData.targetFormat}`,
                            content: content,
                            type: 'repurpose-content',
                            metadata: {
                                topic: localFormData.targetFormat,
                                platforms: [localFormData.targetPlatform],
                                tone: 'professional',
                                timestamp: Date.now()
                            }
                        };
                        setGeneratedContent(contentObj);
                        setFormData(localFormData);
                        
                        // Record to analytics (non-blocking)
                        recordContentToAnalytics(contentObj).catch(err => {
                            console.warn('Failed to record analytics, but content generation succeeded:', err);
                        });
                    } catch (err) {
                        setError(err.message || 'Failed to repurpose content. Please try again.');
                    } finally {
                        setIsLoading(false);
                    }
                };

                const handleSave = () => {
                    if (!generatedContent) return;
                    try {
                        saveContentToHistory(generatedContent);
                        alert('Content saved to history!');
                    } catch (err) {
                        setError(err.message);
                    }
                };

                const handleCopy = async () => {
                    if (!generatedContent?.content) return;
                    try {
                        await copyToClipboard(generatedContent.content);
                        alert('Content copied to clipboard!');
                    } catch (err) {
                        setError('Failed to copy to clipboard');
                    }
                };

                const handleExport = () => {
                    if (!generatedContent?.content) return;
                    const filename = `repurposed-${localFormData.targetFormat}-${Date.now()}.txt`;
                    exportAsTextFile(generatedContent.content, filename);
                };

                return (
                    <div className="space-y-6">
                        {/* Form */}
                        <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Repurpose Content</h3>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Original Content *
                                    </label>
                                    <textarea
                                        value={localFormData.originalContent}
                                        onChange={(e) => setLocalFormData({ ...localFormData, originalContent: e.target.value })}
                                        placeholder="Paste your existing content here..."
                                        rows="6"
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Target Format
                                    </label>
                                    <select
                                        value={localFormData.targetFormat}
                                        onChange={(e) => setLocalFormData({ ...localFormData, targetFormat: e.target.value })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    >
                                        {formats.map(f => (
                                            <option key={f.value} value={f.value}>{f.label}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Target Platform
                                    </label>
                                    <select
                                        value={localFormData.targetPlatform}
                                        onChange={(e) => setLocalFormData({ ...localFormData, targetPlatform: e.target.value })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        disabled={isLoading}
                                    >
                                        {platforms.map(p => (
                                            <option key={p} value={p}>{p}</option>
                                        ))}
                                    </select>
                                </div>

                                <button
                                    onClick={handleGenerate}
                                    disabled={isLoading || !localFormData.originalContent}
                                    className="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-lg font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center gap-2">
                                            <span className="animate-spin"></span>
                                            Repurposing...
                                        </span>
                                    ) : (
                                        'Repurpose Content'
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Generated Content */}
                        {generatedContent && (
                            <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Repurposed Content</h3>
                                    <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                        {getWordCount(generatedContent.content)} words  {getCharacterCount(generatedContent.content)} characters
                                    </div>
                                </div>

                                <div className={`mb-4 p-4 rounded-lg ${isLightMode ? 'bg-gray-50' : 'bg-gray-900'} border ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                    <pre className={`whitespace-pre-wrap ${isLightMode ? 'text-gray-900' : 'text-gray-50'} font-sans text-sm`}>
                                        {generatedContent.content}
                                    </pre>
                                </div>

                                {/* Action Buttons */}
                                <div className="flex flex-wrap gap-3">
                                    <button
                                        onClick={handleCopy}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                : 'bg-blue-600 text-white hover:bg-blue-700'
                                        }`}
                                    >
                                         Copy
                                    </button>
                                    <button
                                        onClick={() => handleScheduleContent && handleScheduleContent(generatedContent)}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-orange-500 text-white hover:bg-orange-600'
                                                : 'bg-orange-600 text-white hover:bg-orange-700'
                                        }`}
                                    >
                                         Schedule
                                    </button>
                                    <button
                                        onClick={handleSave}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-green-500 text-white hover:bg-green-600'
                                                : 'bg-green-600 text-white hover:bg-green-700'
                                        }`}
                                    >
                                         Save
                                    </button>
                                    <button
                                        onClick={handleExport}
                                        className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-purple-500 text-white hover:bg-purple-600'
                                                : 'bg-purple-600 text-white hover:bg-purple-700'
                                        }`}
                                    >
                                         Export
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            // Expertise Modal Component
            const ExpertiseModal = ({ isOpen, onClose, isLightMode, editingExpertise, onSave, onError, expertiseAreas }) => {
                const [formData, setFormData] = React.useState({
                    name: '',
                    level: 'Intermediate',
                    authorityScore: 50
                });
                const [validationError, setValidationError] = React.useState(null);
                const [isSaving, setIsSaving] = React.useState(false);

                React.useEffect(() => {
                    if (editingExpertise) {
                        setFormData({
                            name: editingExpertise.name || '',
                            level: editingExpertise.level || 'Intermediate',
                            authorityScore: editingExpertise.authorityScore || 50
                        });
                    } else {
                        setFormData({
                            name: '',
                            level: 'Intermediate',
                            authorityScore: 50
                        });
                    }
                    setValidationError(null);
                }, [editingExpertise, isOpen]);

                if (!isOpen) return null;

                const handleSubmit = async (e) => {
                    e.preventDefault();
                    setValidationError(null);

                    // Validation
                    const errors = validateExpertiseArea(formData, expertiseAreas.filter(a => a.id !== editingExpertise?.id));
                    if (errors.length > 0) {
                        setValidationError(errors.join(', '));
                        return;
                    }

                    try {
                        setIsSaving(true);
                        if (editingExpertise) {
                            await onSave(editingExpertise.id, formData);
                        } else {
                            await onSave(null, formData);
                        }
                        onClose();
                    } catch (error) {
                        setValidationError(error.message || 'Failed to save expertise area');
                        if (onError) onError(error);
                    } finally {
                        setIsSaving(false);
                    }
                };

                const handleKeyDown = (e) => {
                    if (e.key === 'Escape') {
                        onClose();
                    }
                };

                const levels = ['Beginner', 'Intermediate', 'Advanced', 'Expert'];

                return (
                    <div 
                        className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm" 
                        onClick={onClose}
                        onKeyDown={handleKeyDown}
                    >
                        <div 
                            className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto`} 
                            onClick={(e) => e.stopPropagation()}
                        >
                            <div className="flex items-center justify-between mb-6">
                                <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {editingExpertise ? 'Edit Expertise Area' : 'Add New Expertise Area'}
                                </h2>
                                <button
                                    onClick={onClose}
                                    className={`${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'} transition-colors`}
                                    aria-label="Close modal"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>

                            {validationError && (
                                <div className={`mb-4 p-3 rounded-lg ${isLightMode ? 'bg-red-50 border-red-200' : 'bg-red-500/20 border-red-500/50'} border`}>
                                    <p className={`text-sm ${isLightMode ? 'text-red-800' : 'text-red-300'}`}>{validationError}</p>
                                </div>
                            )}

                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Name *
                                    </label>
                                    <input
                                        type="text"
                                        value={formData.name}
                                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                        placeholder="e.g., Software Architecture"
                                        maxLength={50}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        required
                                        disabled={isSaving}
                                        aria-label="Expertise area name"
                                    />
                                    <p className={`mt-1 text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                        {formData.name.length}/50 characters
                                    </p>
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Level *
                                    </label>
                                    <select
                                        value={formData.level}
                                        onChange={(e) => setFormData({ ...formData, level: e.target.value })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        required
                                        disabled={isSaving}
                                        aria-label="Expertise level"
                                    >
                                        {levels.map(level => (
                                            <option key={level} value={level}>{level}</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Authority Score *
                                    </label>
                                    <input
                                        type="number"
                                        min="0"
                                        max="100"
                                        value={formData.authorityScore}
                                        onChange={(e) => {
                                            const value = parseInt(e.target.value) || 0;
                                            const clampedValue = Math.min(100, Math.max(0, value));
                                            setFormData({ ...formData, authorityScore: clampedValue });
                                        }}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        required
                                        disabled={isSaving}
                                        aria-label="Authority score (0-100)"
                                    />
                                    <div className="mt-2">
                                        <input
                                            type="range"
                                            min="0"
                                            max="100"
                                            value={formData.authorityScore}
                                            onChange={(e) => setFormData({ ...formData, authorityScore: parseInt(e.target.value) })}
                                            className="w-full"
                                            disabled={isSaving}
                                            aria-label="Authority score slider"
                                        />
                                        <div className={`flex justify-between text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mt-1`}>
                                            <span>0</span>
                                            <span className="font-medium">{formData.authorityScore}</span>
                                            <span>100</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                        }`}
                                        disabled={isSaving}
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        disabled={isSaving}
                                        className="flex-1 px-4 py-2 rounded-lg font-medium bg-gradient-to-r from-purple-500 to-indigo-600 text-white hover:from-purple-600 hover:to-indigo-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        {isSaving ? (
                                            <span className="flex items-center justify-center gap-2">
                                                <span className="animate-spin"></span>
                                                Saving...
                                            </span>
                                        ) : (
                                            editingExpertise ? 'Update Expertise' : 'Add Expertise'
                                        )}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Schedule Modal Component
            const ScheduleModal = ({ isOpen, onClose, content, isLightMode, editingPost }) => {
                const [scheduleForm, setScheduleForm] = React.useState({
                    content: content?.content || '',
                    title: content?.title || '',
                    platform: 'LinkedIn',
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toTimeString().slice(0, 5),
                    status: 'draft',
                    visibility: 'PUBLIC',
                    contentType: content?.type || 'post-generator'
                });
                const [validationError, setValidationError] = React.useState(null);

                React.useEffect(() => {
                    if (content) {
                        if (editingPost) {
                            // Editing existing post
                            const scheduledDate = new Date(editingPost.scheduledDate);
                            setScheduleForm({
                                content: editingPost.content || '',
                                title: editingPost.title || '',
                                platform: editingPost.platform || 'LinkedIn',
                                date: scheduledDate.toISOString().split('T')[0],
                                time: scheduledDate.toTimeString().slice(0, 5),
                                status: editingPost.status || 'draft',
                                visibility: editingPost.metadata?.visibility || 'PUBLIC',
                                contentType: editingPost.contentType || 'post-generator'
                            });
                        } else {
                            // New post from generated content
                            setScheduleForm({
                                content: content.content || '',
                                title: content.title || '',
                                platform: selectedPlatforms[0] || 'LinkedIn',
                                date: new Date().toISOString().split('T')[0],
                                time: new Date().toTimeString().slice(0, 5),
                                status: 'draft',
                                visibility: 'PUBLIC',
                                contentType: content.type || 'post-generator'
                            });
                        }
                    }
                }, [content, editingPost]);

                if (!isOpen) return null;

                const handleSubmit = (e) => {
                    e.preventDefault();
                    setValidationError(null);

                    // Validation
                    if (!scheduleForm.content || scheduleForm.content.trim() === '') {
                        setValidationError('Content is required');
                        return;
                    }
                    if (!scheduleForm.platform) {
                        setValidationError('Platform is required');
                        return;
                    }

                    const scheduledDateTime = new Date(`${scheduleForm.date}T${scheduleForm.time}`);
                    const now = new Date();
                    
                    if (scheduleForm.status === 'scheduled' && scheduledDateTime <= now) {
                        setValidationError('Scheduled date must be in the future');
                        return;
                    }

                    try {
                        if (editingPost) {
                            // Update existing post
                            updateScheduledPost(editingPost.id, {
                                content: scheduleForm.content,
                                title: scheduleForm.title || scheduleForm.content.substring(0, 50) + '...',
                                platform: scheduleForm.platform,
                                scheduledDate: scheduledDateTime.toISOString(),
                                status: scheduleForm.status,
                                metadata: {
                                    ...editingPost.metadata,
                                    visibility: scheduleForm.platform === 'LinkedIn' ? scheduleForm.visibility : 'PUBLIC'
                                }
                            });
                            alert('Post updated successfully!');
                        } else {
                            // Create new post
                            const postData = {
                                content: scheduleForm.content,
                                title: scheduleForm.title || scheduleForm.content.substring(0, 50) + '...',
                                platform: scheduleForm.platform,
                                scheduledDate: scheduledDateTime.toISOString(),
                                status: scheduleForm.status,
                                contentType: scheduleForm.contentType,
                                metadata: {
                                    originalContentId: content?.id || null,
                                    tone: tone || 'professional',
                                    visibility: scheduleForm.platform === 'LinkedIn' ? scheduleForm.visibility : 'PUBLIC',
                                    retryCount: 0,
                                    errorMessage: null,
                                    createdAt: new Date().toISOString()
                                }
                            };
                            saveScheduledPost(postData);
                            alert('Post scheduled successfully!');
                        }
                        onClose();
                    } catch (error) {
                        setValidationError(error.message || 'Failed to schedule post');
                    }
                };

                const platforms = ['LinkedIn', 'Twitter', 'Facebook', 'Instagram', 'Medium'];

                return (
                    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm" onClick={onClose}>
                        <div className={`${isLightMode ? 'bg-white' : 'bg-gray-800'} rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto`} onClick={(e) => e.stopPropagation()}>
                            <div className="flex items-center justify-between mb-6">
                                <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                    {editingPost ? 'Edit Scheduled Post' : 'Schedule Post'}
                                </h2>
                                <button
                                    onClick={onClose}
                                    className={`${isLightMode ? 'text-gray-500 hover:text-gray-700' : 'text-gray-400 hover:text-gray-200'}`}
                                    aria-label="Close"
                                >
                                    
                                </button>
                            </div>

                            {validationError && (
                                <div className={`mb-4 p-3 rounded-lg ${isLightMode ? 'bg-red-50 border-red-200' : 'bg-red-500/20 border-red-500/50'} border`}>
                                    <p className={`text-sm ${isLightMode ? 'text-red-800' : 'text-red-300'}`}>{validationError}</p>
                                </div>
                            )}

                            {/* LinkedIn Connection Warning */}
                            {scheduleForm.platform === 'LinkedIn' && scheduleForm.status === 'scheduled' && (
                                <div className={`mb-4 p-3 rounded-lg ${isLightMode ? 'bg-yellow-50 border-yellow-200' : 'bg-yellow-500/20 border-yellow-500/50'} border`}>
                                    {(() => {
                                        const linkedInProfile = window.LinkedInService?.getCachedProfile();
                                        const isConnected = linkedInProfile && linkedInProfile.id;
                                        return (
                                            <p className={`text-sm ${isLightMode ? 'text-yellow-800' : 'text-yellow-300'}`}>
                                                {isConnected 
                                                    ? ' LinkedIn is connected. Posts will auto-publish at the scheduled time.'
                                                    : ' LinkedIn is not connected. Please connect your LinkedIn account to enable auto-publishing.'}
                                            </p>
                                        );
                                    })()}
                                </div>
                            )}

                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Content *
                                    </label>
                                    <textarea
                                        value={scheduleForm.content}
                                        onChange={(e) => setScheduleForm({ ...scheduleForm, content: e.target.value })}
                                        rows="6"
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        required
                                    />
                                </div>

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Platform *
                                    </label>
                                    <select
                                        value={scheduleForm.platform}
                                        onChange={(e) => setScheduleForm({ ...scheduleForm, platform: e.target.value })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        required
                                    >
                                        {platforms.map(p => (
                                            <option key={p} value={p}>{p}</option>
                                        ))}
                                    </select>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                            Date *
                                        </label>
                                        <input
                                            type="date"
                                            value={scheduleForm.date}
                                            onChange={(e) => setScheduleForm({ ...scheduleForm, date: e.target.value })}
                                            min={new Date().toISOString().split('T')[0]}
                                            className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                            Time *
                                        </label>
                                        <input
                                            type="time"
                                            value={scheduleForm.time}
                                            onChange={(e) => setScheduleForm({ ...scheduleForm, time: e.target.value })}
                                            className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                            required
                                        />
                                    </div>
                                </div>

                                {scheduleForm.platform === 'LinkedIn' && (
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                            Visibility
                                        </label>
                                        <select
                                            value={scheduleForm.visibility}
                                            onChange={(e) => setScheduleForm({ ...scheduleForm, visibility: e.target.value })}
                                            className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                        >
                                            <option value="PUBLIC">Public</option>
                                            <option value="CONNECTIONS">Connections Only</option>
                                        </select>
                                    </div>
                                )}

                                <div>
                                    <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                        Status
                                    </label>
                                    <select
                                        value={scheduleForm.status}
                                        onChange={(e) => setScheduleForm({ ...scheduleForm, status: e.target.value })}
                                        className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                    >
                                        <option value="draft">Draft</option>
                                        <option value="scheduled">Scheduled</option>
                                    </select>
                                </div>

                                <div className="flex gap-3 pt-4">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className={`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${
                                            isLightMode
                                                ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                        }`}
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        className="flex-1 px-4 py-2 rounded-lg font-medium bg-gradient-to-r from-orange-500 to-red-600 text-white hover:from-orange-600 hover:to-red-700 transition-all"
                                    >
                                        {editingPost ? 'Update Post' : 'Schedule Post'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Calendar Month View Component
            const MonthView = ({ selectedDate, setSelectedDate, scheduledPosts, onDateClick, isLightMode }) => {
                const daysInMonth = getDaysInMonth(selectedDate);
                const firstDay = getFirstDayOfMonth(selectedDate);
                const monthName = selectedDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                const navigateMonth = (direction) => {
                    const newDate = new Date(selectedDate);
                    newDate.setMonth(selectedDate.getMonth() + direction);
                    setSelectedDate(newDate);
                };

                const goToToday = () => {
                    setSelectedDate(new Date());
                };

                const days = [];
                for (let i = 0; i < firstDay; i++) {
                    days.push(null);
                }
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(day);
                }

                const today = new Date();
                const isToday = (day) => {
                    return day === today.getDate() &&
                           selectedDate.getMonth() === today.getMonth() &&
                           selectedDate.getFullYear() === today.getFullYear();
                };

                const getPostsForDay = (day) => {
                    if (!day) return [];
                    const date = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), day);
                    return getPostsForDate(date);
                };

                return (
                    <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                        <div className="flex items-center justify-between mb-6">
                            <h3 className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{monthName}</h3>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => navigateMonth(-1)}
                                    className={`px-3 py-1 rounded-lg ${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} transition-colors`}
                                >
                                    
                                </button>
                                <button
                                    onClick={goToToday}
                                    className={`px-3 py-1 rounded-lg ${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} transition-colors text-sm`}
                                >
                                    Today
                                </button>
                                <button
                                    onClick={() => navigateMonth(1)}
                                    className={`px-3 py-1 rounded-lg ${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} transition-colors`}
                                >
                                    
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-7 gap-2">
                            {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                <div key={day} className={`text-center font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-400'} py-2`}>
                                    {day}
                                </div>
                            ))}
                            {days.map((day, index) => {
                                const dayPosts = getPostsForDay(day);
                                return (
                                    <div
                                        key={index}
                                        onClick={() => day && onDateClick && onDateClick(new Date(selectedDate.getFullYear(), selectedDate.getMonth(), day))}
                                        className={`min-h-[80px] p-2 rounded-lg border cursor-pointer transition-all ${
                                            !day
                                                ? 'border-transparent'
                                                : isToday(day)
                                                    ? isLightMode
                                                        ? 'bg-blue-50 border-blue-300'
                                                        : 'bg-blue-500/20 border-blue-500/50'
                                                    : isLightMode
                                                        ? 'bg-gray-50 border-gray-200 hover:border-purple-300'
                                                        : 'bg-gray-700/50 border-gray-600 hover:border-purple-500/50'
                                        }`}
                                    >
                                        {day && (
                                            <>
                                                <div className={`text-sm font-medium mb-1 ${isToday(day) ? 'text-blue-600' : isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                    {day}
                                                </div>
                                                {dayPosts.length > 0 && (
                                                    <div className="flex flex-wrap gap-1">
                                                        {dayPosts.slice(0, 3).map((post, idx) => {
                                                            const platformColorClasses = {
                                                                'LinkedIn': 'bg-blue-500',
                                                                'Twitter': 'bg-cyan-500',
                                                                'Facebook': 'bg-indigo-500',
                                                                'Instagram': 'bg-pink-500',
                                                                'Medium': 'bg-green-500'
                                                            };
                                                            return (
                                                                <div
                                                                    key={idx}
                                                                    className={`w-2 h-2 rounded-full ${platformColorClasses[post.platform] || 'bg-gray-500'}`}
                                                                    title={`${post.platform}: ${post.title}`}
                                                                />
                                                            );
                                                        })}
                                                        {dayPosts.length > 3 && (
                                                            <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                +{dayPosts.length - 3}
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            // Day View Component
            const DayView = ({ date, scheduledPosts, onPostClick, isLightMode }) => {
                const dayPosts = getPostsForDate(date);
                const dateStr = formatDate(date, 'long');

                return (
                    <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                        <h3 className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>
                            {dateStr}
                        </h3>
                        {dayPosts.length === 0 ? (
                            <div className={`text-center py-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                No posts scheduled for this day
                            </div>
                        ) : (
                            <div className="space-y-3">
                                {dayPosts.map((post) => (
                                    <div
                                        key={post.id}
                                        onClick={() => onPostClick && onPostClick(post)}
                                        className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-900 border-gray-700'} border rounded-lg p-4 hover:border-purple-500/50 transition-all cursor-pointer`}
                                    >
                                        <div className="flex items-center justify-between mb-2">
                                            <div className="flex items-center gap-2">
                                                {(() => {
                                                    const platformColorClasses = {
                                                        'LinkedIn': 'bg-blue-500/20 text-blue-400',
                                                        'Twitter': 'bg-cyan-500/20 text-cyan-400',
                                                        'Facebook': 'bg-indigo-500/20 text-indigo-400',
                                                        'Instagram': 'bg-pink-500/20 text-pink-400',
                                                        'Medium': 'bg-green-500/20 text-green-400'
                                                    };
                                                    const statusColorClasses = {
                                                        'draft': 'bg-gray-500/20 text-gray-400',
                                                        'scheduled': 'bg-yellow-500/20 text-yellow-400',
                                                        'published': 'bg-green-500/20 text-green-400',
                                                        'failed': 'bg-red-500/20 text-red-400',
                                                        'publishing': 'bg-blue-500/20 text-blue-400'
                                                    };
                                                    return (
                                                        <>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${platformColorClasses[post.platform] || 'bg-gray-500/20 text-gray-400'}`}>
                                                                {post.platform}
                                                            </span>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusColorClasses[post.status] || 'bg-gray-500/20 text-gray-400'}`}>
                                                                {post.status}
                                                            </span>
                                                        </>
                                                    );
                                                })()}
                                            </div>
                                            <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                {new Date(post.scheduledDate).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}
                                            </div>
                                        </div>
                                        <h4 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>{post.title}</h4>
                                        <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'} line-clamp-2`}>
                                            {post.content.substring(0, 150)}...
                                        </p>
                                        {post.status === 'failed' && post.metadata?.errorMessage && (
                                            <div className={`mt-2 p-2 rounded text-xs ${isLightMode ? 'bg-red-50 text-red-800' : 'bg-red-500/20 text-red-300'}`}>
                                                Error: {post.metadata.errorMessage}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            };

            // Post Queue Component
            const PostQueueComponent = ({ scheduledPosts, filters, setFilters, onPostClick, onDelete, onEdit, isLightMode, publishLinkedInPost, updateScheduledPost }) => {
                const filteredPosts = scheduledPosts.filter(post => {
                    if (filters.status !== 'all' && post.status !== filters.status) return false;
                    if (filters.platform !== 'all' && post.platform !== filters.platform) return false;
                    if (filters.search && !post.content.toLowerCase().includes(filters.search.toLowerCase()) && !post.title.toLowerCase().includes(filters.search.toLowerCase())) return false;
                    return true;
                });

                const platforms = ['all', 'LinkedIn', 'Twitter', 'Facebook', 'Instagram', 'Medium'];
                const statuses = ['all', 'draft', 'scheduled', 'published', 'failed'];

                return (
                    <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6`}>
                        <div className="flex items-center justify-between mb-6">
                            <h3 className={`text-xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Post Queue</h3>
                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                {filteredPosts.length} {filteredPosts.length === 1 ? 'post' : 'posts'}
                            </div>
                        </div>

                        {/* Filters */}
                        <div className="mb-6 space-y-4">
                            <div>
                                <input
                                    type="text"
                                    placeholder="Search posts..."
                                    value={filters.search}
                                    onChange={(e) => setFilters({ ...filters, search: e.target.value })}
                                    className={`w-full px-4 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                />
                            </div>
                            <div className="flex flex-wrap gap-3">
                                <select
                                    value={filters.status}
                                    onChange={(e) => setFilters({ ...filters, status: e.target.value })}
                                    className={`px-3 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                >
                                    {statuses.map(s => (
                                        <option key={s} value={s}>{s.charAt(0).toUpperCase() + s.slice(1)}</option>
                                    ))}
                                </select>
                                <select
                                    value={filters.platform}
                                    onChange={(e) => setFilters({ ...filters, platform: e.target.value })}
                                    className={`px-3 py-2 rounded-lg border ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                >
                                    {platforms.map(p => (
                                        <option key={p} value={p}>{p.charAt(0).toUpperCase() + p.slice(1)}</option>
                                    ))}
                                </select>
                                <button
                                    onClick={() => setFilters({ status: 'all', platform: 'all', search: '' })}
                                    className={`px-3 py-2 rounded-lg ${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} transition-colors text-sm`}
                                >
                                    Clear Filters
                                </button>
                            </div>
                        </div>

                        {/* Posts List */}
                        <div className="space-y-3 max-h-96 overflow-y-auto">
                            {filteredPosts.length === 0 ? (
                                <div className={`text-center py-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                    No posts found
                                </div>
                            ) : (
                                filteredPosts.map((post) => (
                                    <div
                                        key={post.id}
                                        className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-900 border-gray-700'} border rounded-lg p-4 hover:border-purple-500/50 transition-all cursor-pointer`}
                                        onClick={() => onPostClick && onPostClick(post)}
                                    >
                                        <div className="flex items-start justify-between mb-2">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    {(() => {
                                                        const platformColorClasses = {
                                                            'LinkedIn': 'bg-blue-500/20 text-blue-400',
                                                            'Twitter': 'bg-cyan-500/20 text-cyan-400',
                                                            'Facebook': 'bg-indigo-500/20 text-indigo-400',
                                                            'Instagram': 'bg-pink-500/20 text-pink-400',
                                                            'Medium': 'bg-green-500/20 text-green-400'
                                                        };
                                                        const statusColorClasses = {
                                                            'draft': 'bg-gray-500/20 text-gray-400',
                                                            'scheduled': 'bg-yellow-500/20 text-yellow-400',
                                                            'published': 'bg-green-500/20 text-green-400',
                                                            'failed': 'bg-red-500/20 text-red-400',
                                                            'publishing': 'bg-blue-500/20 text-blue-400'
                                                        };
                                                        return (
                                                            <>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${platformColorClasses[post.platform] || 'bg-gray-500/20 text-gray-400'}`}>
                                                                    {post.platform}
                                                                </span>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${statusColorClasses[post.status] || 'bg-gray-500/20 text-gray-400'}`}>
                                                                    {post.status}
                                                                </span>
                                                            </>
                                                        );
                                                    })()}
                                                </div>
                                                <h4 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>{post.title}</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'} line-clamp-2`}>
                                                    {post.content.substring(0, 100)}...
                                                </p>
                                                <div className={`text-xs mt-2 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                    {formatDateTime(post.scheduledDate)}
                                                </div>
                                                {post.status === 'failed' && post.metadata?.errorMessage && (
                                                    <div className={`mt-2 p-2 rounded text-xs ${isLightMode ? 'bg-red-50 text-red-800' : 'bg-red-500/20 text-red-300'}`}>
                                                        Error: {post.metadata.errorMessage}
                                                    </div>
                                                )}
                                            </div>
                                            <div className="flex gap-2 ml-4">
                                                {post.status === 'scheduled' && post.platform === 'LinkedIn' && (
                                                    <button
                                                        onClick={async (e) => {
                                                            e.stopPropagation();
                                                            if (confirm('Publish this post now?')) {
                                                                try {
                                                                    await publishLinkedInPost(post);
                                                                    updateScheduledPost(post.id, {
                                                                        status: 'published',
                                                                        metadata: {
                                                                            ...post.metadata,
                                                                            publishedAt: new Date().toISOString()
                                                                        }
                                                                    });
                                                                    alert('Post published successfully!');
                                                                } catch (error) {
                                                                    alert(`Failed to publish: ${error.message}`);
                                                                }
                                                            }
                                                        }}
                                                        className={`px-2 py-1 rounded text-xs ${isLightMode ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-green-600 text-white hover:bg-green-700'}`}
                                                    >
                                                        Publish Now
                                                    </button>
                                                )}
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        onEdit && onEdit(post);
                                                    }}
                                                    className={`px-2 py-1 rounded text-xs ${isLightMode ? 'bg-blue-500 text-white hover:bg-blue-600' : 'bg-blue-600 text-white hover:bg-blue-700'}`}
                                                >
                                                    Edit
                                                </button>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        if (confirm('Delete this post?')) {
                                                            onDelete && onDelete(post.id);
                                                        }
                                                    }}
                                                    className={`px-2 py-1 rounded text-xs ${isLightMode ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-red-600 text-white hover:bg-red-700'}`}
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                );
            };

            // Dynamic content calculation functions
            const calculateGrowthOpportunities = (areas, trendingTopics) => {
                const opportunities = [];
                
                // Find skill gaps (low authority scores)
                const skillGaps = areas.filter(area => area.authorityScore < 60);
                skillGaps.forEach(area => {
                    opportunities.push({
                        type: 'Skill Gap',
                        title: area.name,
                        description: `Consider creating content to build authority in this area. Current score: ${area.authorityScore}`,
                        priority: area.authorityScore < 40 ? 'high' : 'medium'
                    });
                });
                
                // Find emerging topics that align with expertise
                trendingTopics.forEach(topic => {
                    const relevantArea = areas.find(area => 
                        topic.title.toLowerCase().includes(area.name.toLowerCase().split(' ')[0]) ||
                        area.name.toLowerCase().includes(topic.keywords[0]?.toLowerCase() || '')
                    );
                    if (relevantArea && topic.relevanceScore > 85) {
                        opportunities.push({
                            type: 'Emerging Topic',
                            title: topic.title,
                            description: `This topic is gaining traction and aligns with your ${relevantArea.name} expertise`,
                            priority: 'high'
                        });
                    }
                });
                
                return opportunities.slice(0, 5); // Limit to 5 opportunities
            };

            const generateContentStrategy = (areas) => {
                const strategies = [];
                
                areas.forEach(area => {
                    if (area.authorityScore >= 80) {
                        strategies.push(`Focus on ${area.name} content to maintain your expert status`);
                    } else if (area.authorityScore >= 60) {
                        strategies.push(`Create more ${area.name} content to reach advanced level`);
                    } else {
                        strategies.push(`Develop ${area.name} content to fill knowledge gaps`);
                    }
                });
                
                return strategies;
            };

            const calculateAuthorityInsights = (areas, contentHistory) => {
                if (areas.length === 0) {
                    return {
                        overallAuthority: 0,
                        contentConsistency: 0,
                        trendAlignment: 0,
                        engagementQuality: 68 // Placeholder
                    };
                }
                
                // Calculate overall authority as average
                const overallAuthority = areas.length > 0 
                    ? Math.round(areas.reduce((sum, area) => sum + area.authorityScore, 0) / areas.length)
                    : 0;
                
                // Calculate content consistency (based on content count distribution)
                const totalContent = areas.reduce((sum, area) => sum + area.contentCount, 0);
                const avgContentPerArea = areas.length > 0 ? totalContent / areas.length : 0;
                let contentConsistency = 100; // Default to 100% if no content
                if (avgContentPerArea > 0) {
                const consistencyScore = areas.reduce((score, area) => {
                    const deviation = Math.abs(area.contentCount - avgContentPerArea);
                    return score + Math.max(0, 100 - (deviation / avgContentPerArea * 100));
                }, 0) / areas.length;
                    contentConsistency = Math.round(consistencyScore);
                }
                
                // Calculate trend alignment (placeholder - would need trending topics data)
                const highAuthorityAreas = areas.filter(a => a.authorityScore >= 70).length;
                const trendAlignment = areas.length > 0 ? Math.round((highAuthorityAreas / areas.length) * 100) : 0;
                
                // Engagement quality (placeholder for now)
                const engagementQuality = 68;
                
                return {
                    overallAuthority,
                    contentConsistency: Math.min(100, contentConsistency),
                    trendAlignment: Math.min(100, trendAlignment),
                    engagementQuality
                };
            };

            // Calculate dashboard metrics from real data
            const calculateDashboardMetrics = React.useMemo(() => {
                const now = new Date();
                const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                const thisMonthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                const lastMonthEnd = new Date(now.getFullYear(), now.getMonth(), 0);
                
                const thisMonthContent = contentHistory.filter(item => {
                    const itemDate = new Date(item.metadata?.timestamp || item.createdAt || 0);
                    return itemDate >= thisMonth && itemDate <= thisMonthEnd;
                });
                
                const lastMonthContent = contentHistory.filter(item => {
                    const itemDate = new Date(item.metadata?.timestamp || item.createdAt || 0);
                    return itemDate >= lastMonth && itemDate <= lastMonthEnd;
                });
                
                const thisWeek = new Date(now);
                thisWeek.setDate(now.getDate() - 7);
                const thisWeekContent = contentHistory.filter(item => {
                    const itemDate = new Date(item.metadata?.timestamp || item.createdAt || 0);
                    return itemDate >= thisWeek;
                });
                
                const totalEngagement = thisMonthContent.reduce((sum, item) => {
                    const engagement = item.metadata?.engagement || item.metadata?.estimatedEngagement || 0;
                    return sum + (typeof engagement === 'number' ? engagement : 0);
                }, 0);
                
                const avgEngagement = thisMonthContent.length > 0 
                    ? Math.round(totalEngagement / thisMonthContent.length) 
                    : 0;
                
                const lastMonthEngagement = lastMonthContent.reduce((sum, item) => {
                    const engagement = item.metadata?.engagement || item.metadata?.estimatedEngagement || 0;
                    return sum + (typeof engagement === 'number' ? engagement : 0);
                }, 0);
                
                const engagementGrowth = lastMonthEngagement > 0 
                    ? Math.round(((totalEngagement - lastMonthEngagement) / lastMonthEngagement) * 100)
                    : 0;
                
                const publishedThisWeek = thisWeekContent.filter(item => 
                    item.metadata?.status === 'published' || item.metadata?.published
                ).length;
                
                const authorityChange = authorityInsights.overallAuthority 
                    ? (authorityInsights.overallAuthority - (authorityInsights.previousAuthority || authorityInsights.overallAuthority - 5))
                    : 0;
                
                return {
                    postsThisMonth: thisMonthContent.length,
                    postsLastMonth: lastMonthContent.length,
                    postsChange: thisMonthContent.length - lastMonthContent.length,
                    totalEngagement,
                    avgEngagement,
                    engagementGrowth,
                    contentGeneratedThisWeek: thisWeekContent.length,
                    publishedThisWeek,
                    authorityChange
                };
            }, [contentHistory, authorityInsights]);

            // Generate personalized content suggestions
            const generatePersonalizedSuggestions = React.useMemo(() => {
                if (expertiseAreas.length === 0) return contentSuggestions;
                
                const suggestions = [];
                const recentTopics = contentHistory.slice(0, 10).map(item => 
                    item.metadata?.topic?.toLowerCase() || ''
                );
                
                expertiseAreas.forEach((area, index) => {
                    if (index >= 3) return; // Limit to 3 suggestions
                    
                    const areaName = area.name.toLowerCase();
                    const matchingTopic = trendingTopics.find(topic => 
                        topic.title.toLowerCase().includes(areaName.split(' ')[0]) ||
                        areaName.includes(topic.keywords[0]?.toLowerCase() || '')
                    );
                    
                    if (matchingTopic) {
                        const contentType = area.authorityScore >= 70 ? 'Article' : 'LinkedIn Post';
                        const estimatedEngagement = Math.round(
                            (matchingTopic.engagementPotential || 75) * (area.authorityScore / 100) * 10
                        );
                        
                        suggestions.push({
                            id: `suggestion-${area.id}`,
                            topic: `${area.name}: ${matchingTopic.title}`,
                            angle: `Leverage your ${area.level.toLowerCase()} expertise in ${area.name}`,
                            contentType,
                            estimatedEngagement,
                            difficulty: area.authorityScore >= 70 ? 'Easy' : 'Medium',
                            timeToCreate: contentType === 'Article' ? '25 min' : '15 min',
                            platforms: ['LinkedIn', 'Twitter'],
                            expertiseArea: area.name
                        });
                    }
                });
                
                // Fill remaining slots with default suggestions if needed
                while (suggestions.length < 3 && suggestions.length < contentSuggestions.length) {
                    const defaultSuggestion = contentSuggestions[suggestions.length];
                    if (defaultSuggestion) {
                        suggestions.push(defaultSuggestion);
                    }
                }
                
                return suggestions.slice(0, 3);
            }, [expertiseAreas, trendingTopics, contentHistory]);

            // Generate smart insights
            const generateSmartInsights = React.useMemo(() => {
                const insights = [];
                
                // Authority building insight
                if (expertiseAreas.length > 0) {
                    const topArea = expertiseAreas.reduce((top, area) => 
                        area.contentCount > (top?.contentCount || 0) ? area : top
                    );
                    if (topArea && topArea.contentCount > 0) {
                        insights.push({
                            type: 'authority',
                            title: 'Authority Building',
                            message: `Your ${topArea.name} content has ${topArea.contentCount} pieces. Keep building authority in this area!`,
                            color: 'green'
                        });
                    }
                }
                
                // Engagement insight
                if (calculateDashboardMetrics.avgEngagement > 0) {
                    const engagementLevel = calculateDashboardMetrics.avgEngagement > 500 ? 'excellent' :
                                          calculateDashboardMetrics.avgEngagement > 300 ? 'good' : 'growing';
                    if (engagementLevel !== 'excellent') {
                        insights.push({
                            type: 'engagement',
                            title: 'Engagement Opportunity',
                            message: `Your average engagement is ${calculateDashboardMetrics.avgEngagement}. Consider more visual content to boost engagement.`,
                            color: 'blue'
                        });
                    }
                }
                
                // Content frequency insight
                if (calculateDashboardMetrics.postsThisMonth < 10) {
                    insights.push({
                        type: 'frequency',
                        title: 'Content Frequency',
                        message: `You've posted ${calculateDashboardMetrics.postsThisMonth} times this month. Aim for 12-15 posts for optimal growth.`,
                        color: 'purple'
                    });
                }
                
                // Trending opportunity
                if (trendingTopics.length > 0) {
                    const topTrend = trendingTopics[0];
                    insights.push({
                        type: 'trending',
                        title: 'Trending Opportunity',
                        message: `${topTrend.title} is trending with ${topTrend.relevanceScore}% relevance. Consider creating content on this topic.`,
                        color: 'blue'
                    });
                }
                
                return insights.slice(0, 3);
            }, [expertiseAreas, calculateDashboardMetrics, trendingTopics]);

            // Get recent activity
            const recentActivity = React.useMemo(() => {
                return contentHistory
                    .slice(0, 5)
                    .map(item => ({
                        id: item.id,
                        title: item.title,
                        type: item.type || item.metadata?.contentType || 'post',
                        timestamp: new Date(item.metadata?.timestamp || item.createdAt || Date.now()),
                        platform: item.metadata?.platforms?.[0] || 'LinkedIn',
                        status: item.metadata?.status || 'generated'
                    }))
                    .sort((a, b) => b.timestamp - a.timestamp);
            }, [contentHistory]);

            // Calculate per-expertise analytics
            const getExpertiseAreaAnalytics = React.useCallback((areaName) => {
                const areaNameLower = areaName.toLowerCase();
                
                // Find all content related to this expertise area
                const relatedContent = contentHistory.filter(item => {
                    const topic = item.metadata?.topic?.toLowerCase() || '';
                    const expertise = item.metadata?.expertiseArea?.toLowerCase() || item.metadata?.expertise_area?.toLowerCase() || '';
                    const title = item.title?.toLowerCase() || '';
                    
                    return topic.includes(areaNameLower.split(' ')[0]) || 
                           areaNameLower.includes(topic.split(' ')[0]) ||
                           expertise.includes(areaNameLower) ||
                           title.includes(areaNameLower.split(' ')[0]);
                });
                
                // Calculate engagement metrics
                const totalEngagement = relatedContent.reduce((sum, item) => {
                    const engagement = item.metadata?.engagement || item.metadata?.estimatedEngagement || 0;
                    return sum + (typeof engagement === 'number' ? engagement : 0);
                }, 0);
                
                const totalViews = relatedContent.reduce((sum, item) => {
                    const views = item.metadata?.views || item.metadata?.estimatedViews || 0;
                    return sum + (typeof views === 'number' ? views : 0);
                }, 0);
                
                const totalLikes = relatedContent.reduce((sum, item) => {
                    const likes = item.metadata?.likes || 0;
                    return sum + (typeof likes === 'number' ? likes : 0);
                }, 0);
                
                const totalComments = relatedContent.reduce((sum, item) => {
                    const comments = item.metadata?.comments || 0;
                    return sum + (typeof comments === 'number' ? comments : 0);
                }, 0);
                
                const totalShares = relatedContent.reduce((sum, item) => {
                    const shares = item.metadata?.shares || 0;
                    return sum + (typeof shares === 'number' ? shares : 0);
                }, 0);
                
                const avgEngagement = relatedContent.length > 0 ? Math.round(totalEngagement / relatedContent.length) : 0;
                const engagementRate = totalViews > 0 ? ((totalLikes + totalComments + totalShares) / totalViews * 100).toFixed(1) : 0;
                
                // Content type distribution
                const contentTypes = relatedContent.reduce((acc, item) => {
                    const type = item.type || item.metadata?.contentType || 'post';
                    acc[type] = (acc[type] || 0) + 1;
                    return acc;
                }, {});
                
                // Best performing content (sorted by engagement)
                const bestPerforming = relatedContent
                    .map(item => ({
                        id: item.id,
                        title: item.title,
                        engagement: item.metadata?.engagement || item.metadata?.estimatedEngagement || 0,
                        views: item.metadata?.views || item.metadata?.estimatedViews || 0,
                        platform: item.metadata?.platforms?.[0] || 'LinkedIn',
                        type: item.type || item.metadata?.contentType || 'post',
                        date: new Date(item.metadata?.timestamp || item.createdAt || Date.now())
                    }))
                    .sort((a, b) => b.engagement - a.engagement)
                    .slice(0, 5);
                
                // Performance trend (last 30 days)
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const recentContent = relatedContent.filter(item => {
                    const itemDate = new Date(item.metadata?.timestamp || item.createdAt || 0);
                    return itemDate >= thirtyDaysAgo;
                });
                
                const previousContent = relatedContent.filter(item => {
                    const itemDate = new Date(item.metadata?.timestamp || item.createdAt || 0);
                    const sixtyDaysAgo = new Date();
                    sixtyDaysAgo.setDate(sixtyDaysAgo.getDate() - 60);
                    return itemDate >= sixtyDaysAgo && itemDate < thirtyDaysAgo;
                });
                
                const recentEngagement = recentContent.reduce((sum, item) => 
                    sum + (item.metadata?.engagement || item.metadata?.estimatedEngagement || 0), 0
                );
                const previousEngagement = previousContent.reduce((sum, item) => 
                    sum + (item.metadata?.engagement || item.metadata?.estimatedEngagement || 0), 0
                );
                
                const engagementTrend = previousEngagement > 0 
                    ? ((recentEngagement - previousEngagement) / previousEngagement * 100).toFixed(1)
                    : 0;
                
                // Generate time-series data for charts (last 30 days)
                const timeSeriesData = [];
                const now = new Date();
                for (let i = 29; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const dayContent = relatedContent.filter(item => {
                        const itemDate = new Date(item.metadata?.timestamp || item.createdAt || 0);
                        return itemDate.toISOString().split('T')[0] === dateStr;
                    });
                    
                    const dayEngagement = dayContent.reduce((sum, item) => 
                        sum + (item.metadata?.engagement || item.metadata?.estimatedEngagement || 0), 0
                    );
                    
                    timeSeriesData.push({
                        date: dateStr,
                        contentCount: dayContent.length,
                        engagement: dayEngagement,
                        views: dayContent.reduce((sum, item) => 
                            sum + (item.metadata?.views || item.metadata?.estimatedViews || 0), 0
                        )
                    });
                }
                
                // Authority score history (simulated based on content creation - in real app, this would be stored)
                // For now, we'll create a trend based on content count over time
                const authorityHistory = [];
                const monthsBack = 6;
                for (let i = monthsBack - 1; i >= 0; i--) {
                    const monthDate = new Date(now);
                    monthDate.setMonth(monthDate.getMonth() - i);
                    const monthStart = new Date(monthDate.getFullYear(), monthDate.getMonth(), 1);
                    const monthEnd = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
                    
                    const monthContent = relatedContent.filter(item => {
                        const itemDate = new Date(item.metadata?.timestamp || item.createdAt || 0);
                        return itemDate >= monthStart && itemDate <= monthEnd;
                    });
                    
                    // Estimate authority score based on content count (simplified)
                    const estimatedScore = Math.min(100, Math.max(0, 
                        (monthContent.length * 5) + (i === monthsBack - 1 ? 50 : 0)
                    ));
                    
                    authorityHistory.push({
                        month: monthDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),
                        score: estimatedScore,
                        contentCount: monthContent.length
                    });
                }
                
                return {
                    contentCount: relatedContent.length,
                    totalEngagement,
                    avgEngagement,
                    totalViews,
                    totalLikes,
                    totalComments,
                    totalShares,
                    engagementRate: parseFloat(engagementRate),
                    contentTypes,
                    bestPerforming,
                    engagementTrend: parseFloat(engagementTrend),
                    recentContentCount: recentContent.length,
                    timeSeriesData,
                    authorityHistory
                };
            }, [contentHistory]);

            // State for expanded analytics
            const [expandedAnalytics, setExpandedAnalytics] = useState(new Set());
            
            const toggleAnalytics = (areaId) => {
                const newExpanded = new Set(expandedAnalytics);
                if (newExpanded.has(areaId)) {
                    newExpanded.delete(areaId);
                } else {
                    newExpanded.add(areaId);
                }
                setExpandedAnalytics(newExpanded);
            };

            // State for expanded card details
            const [expandedCards, setExpandedCards] = useState(new Set());
            
            const toggleCardExpansion = (areaId) => {
                const newExpanded = new Set(expandedCards);
                if (newExpanded.has(areaId)) {
                    newExpanded.delete(areaId);
                } else {
                    newExpanded.add(areaId);
                }
                setExpandedCards(newExpanded);
            };

            // Get quick stats for an expertise area
            const getQuickStats = React.useCallback((areaName) => {
                const analytics = getExpertiseAreaAnalytics(areaName);
                return {
                    totalEngagement: analytics.totalEngagement,
                    avgEngagement: analytics.avgEngagement,
                    totalViews: analytics.totalViews,
                    engagementRate: analytics.engagementRate
                };
            }, [getExpertiseAreaAnalytics]);

            // Get recent content for an expertise area
            const getRecentContent = React.useCallback((areaName) => {
                const areaNameLower = areaName.toLowerCase();
                const relatedContent = contentHistory.filter(item => {
                    const topic = item.metadata?.topic?.toLowerCase() || '';
                    const expertise = item.metadata?.expertiseArea?.toLowerCase() || item.metadata?.expertise_area?.toLowerCase() || '';
                    const title = item.title?.toLowerCase() || '';
                    return topic.includes(areaNameLower.split(' ')[0]) || 
                           areaNameLower.includes(topic.split(' ')[0]) ||
                           expertise.includes(areaNameLower) ||
                           title.includes(areaNameLower.split(' ')[0]);
                })
                .sort((a, b) => {
                    const dateA = new Date(a.metadata?.timestamp || a.createdAt || 0);
                    const dateB = new Date(b.metadata?.timestamp || b.createdAt || 0);
                    return dateB - dateA;
                })
                .slice(0, 3);
                
                return relatedContent;
            }, [contentHistory]);

            // Generate smart recommendations for an expertise area
            const getSmartRecommendations = React.useCallback((areaName, area, analytics) => {
                const recommendations = [];
                const areaNameLower = areaName.toLowerCase();
                
                // 1. Content Frequency Recommendations
                const daysSinceLastContent = analytics.contentCount > 0 ? (() => {
                    const relatedContent = contentHistory.filter(item => {
                        const topic = item.metadata?.topic?.toLowerCase() || '';
                        const expertise = item.metadata?.expertiseArea?.toLowerCase() || item.metadata?.expertise_area?.toLowerCase() || '';
                        return topic.includes(areaNameLower.split(' ')[0]) || expertise.includes(areaNameLower);
                    });
                    if (relatedContent.length === 0) return 999;
                    const lastContent = relatedContent.sort((a, b) => {
                        const dateA = new Date(a.metadata?.timestamp || a.createdAt || 0);
                        const dateB = new Date(b.metadata?.timestamp || b.createdAt || 0);
                        return dateB - dateA;
                    })[0];
                    const lastDate = new Date(lastContent.metadata?.timestamp || lastContent.createdAt || 0);
                    return Math.floor((Date.now() - lastDate.getTime()) / (1000 * 60 * 60 * 24));
                })() : 999;
                
                if (daysSinceLastContent > 14) {
                    recommendations.push({
                        type: 'frequency',
                        priority: 'high',
                        icon: '',
                        title: 'Increase Content Frequency',
                        description: `It's been ${daysSinceLastContent} days since your last content. Aim for at least 2-3 pieces per week to maintain authority.`,
                        action: 'Generate Content',
                        actionType: 'generate'
                    });
                } else if (daysSinceLastContent > 7) {
                    recommendations.push({
                        type: 'frequency',
                        priority: 'medium',
                        icon: '',
                        title: 'Maintain Content Momentum',
                        description: `Keep up the good work! Consider posting more frequently (every 3-4 days) to accelerate growth.`,
                        action: 'Generate Content',
                        actionType: 'generate'
                    });
                }
                
                // 2. Authority Score Recommendations
                if (area.authorityScore < 50) {
                    recommendations.push({
                        type: 'authority',
                        priority: 'high',
                        icon: '',
                        title: 'Boost Authority Score',
                        description: `Your authority score is ${area.authorityScore}. Focus on creating high-quality, engaging content consistently to reach 50+.`,
                        action: 'View Strategy',
                        actionType: 'strategy'
                    });
                } else if (area.authorityScore < 70) {
                    recommendations.push({
                        type: 'authority',
                        priority: 'medium',
                        icon: '',
                        title: 'Reach Expert Level',
                        description: `You're at ${area.authorityScore}. Create more in-depth content and engage with your audience to reach 70+.`,
                        action: 'View Strategy',
                        actionType: 'strategy'
                    });
                }
                
                // 3. Content Type Diversification
                const contentTypes = analytics.contentTypes || {};
                const typeCount = Object.keys(contentTypes).length;
                if (typeCount < 2 && analytics.contentCount > 0) {
                    recommendations.push({
                        type: 'diversification',
                        priority: 'medium',
                        icon: '',
                        title: 'Diversify Content Types',
                        description: `You're primarily creating ${Object.keys(contentTypes)[0] || 'one type'} content. Try articles, threads, or videos to reach different audiences.`,
                        action: 'Explore Types',
                        actionType: 'diversify'
                    });
                }
                
                // 4. Engagement Optimization
                if (analytics.avgEngagement > 0 && analytics.engagementRate < 3) {
                    recommendations.push({
                        type: 'engagement',
                        priority: 'high',
                        icon: '',
                        title: 'Improve Engagement Rate',
                        description: `Your engagement rate is ${analytics.engagementRate.toFixed(1)}%. Try asking questions, using visuals, or posting at optimal times.`,
                        action: 'View Tips',
                        actionType: 'engagement'
                    });
                } else if (analytics.engagementRate >= 5) {
                    recommendations.push({
                        type: 'engagement',
                        priority: 'low',
                        icon: '',
                        title: 'Excellent Engagement!',
                        description: `Your ${analytics.engagementRate.toFixed(1)}% engagement rate is great! Keep creating similar content to maintain this.`,
                        action: 'View Top Content',
                        actionType: 'view'
                    });
                }
                
                // 5. Trending Topics
                const relevantTrends = trendingTopics.filter(topic => {
                    return topic.title.toLowerCase().includes(areaNameLower.split(' ')[0]) ||
                           areaNameLower.includes(topic.keywords?.[0]?.toLowerCase() || '') ||
                           topic.keywords?.some(kw => areaNameLower.includes(kw.toLowerCase()));
                });
                
                if (relevantTrends.length > 0) {
                    const topTrend = relevantTrends[0];
                    recommendations.push({
                        type: 'trending',
                        priority: 'high',
                        icon: '',
                        title: 'Trending Topic Opportunity',
                        description: `"${topTrend.title}" is trending with ${topTrend.relevanceScore}% relevance. Create content on this to boost visibility.`,
                        action: 'Create Content',
                        actionType: 'generate',
                        topic: topTrend.title
                    });
                }
                
                // 6. Content Gap Analysis
                if (analytics.contentCount === 0) {
                    recommendations.push({
                        type: 'gap',
                        priority: 'high',
                        icon: '',
                        title: 'Start Building Authority',
                        description: `You haven't created any content for ${areaName} yet. Start with an introductory post or article to establish your expertise.`,
                        action: 'Generate First Content',
                        actionType: 'generate'
                    });
                } else if (analytics.contentCount < 5) {
                    recommendations.push({
                        type: 'gap',
                        priority: 'medium',
                        icon: '',
                        title: 'Build Content Foundation',
                        description: `You have ${analytics.contentCount} pieces. Aim for at least 10-15 pieces to establish strong authority in this area.`,
                        action: 'Generate More',
                        actionType: 'generate'
                    });
                }
                
                // 7. Authority Score Trend
                if (analytics.authorityHistory && analytics.authorityHistory.length >= 3) {
                    const recentScores = analytics.authorityHistory.slice(-3).map(h => h.score);
                    const isDeclining = recentScores[recentScores.length - 1] < recentScores[0] - 5;
                    if (isDeclining) {
                        recommendations.push({
                            type: 'trend',
                            priority: 'high',
                            icon: '',
                            title: 'Authority Score Declining',
                            description: `Your authority score has dropped ${recentScores[0] - recentScores[recentScores.length - 1]} points recently. Increase content frequency and engagement.`,
                            action: 'View History',
                            actionType: 'view'
                        });
                    }
                }
                
                // 8. Best Performing Content Analysis
                if (analytics.bestPerforming && analytics.contentCount > 3) {
                    recommendations.push({
                        type: 'optimization',
                        priority: 'medium',
                        icon: '',
                        title: 'Leverage Top Content',
                        description: `Your best performing content got ${analytics.bestPerforming.engagement} engagement. Create similar content to replicate success.`,
                        action: 'View Top Content',
                        actionType: 'view'
                    });
                }
                
                // Sort by priority (high > medium > low)
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                recommendations.sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority]);
                
                return recommendations.slice(0, 5); // Return top 5 recommendations
            }, [contentHistory, trendingTopics]);

            // Sorting and filtering state
            const [sortBy, setSortBy] = useState('authority'); // 'authority', 'content', 'name', 'updated'
            const [filterLevel, setFilterLevel] = useState('all'); // 'all', 'Beginner', 'Intermediate', 'Advanced', 'Expert'
            const [filterScoreMin, setFilterScoreMin] = useState(0);
            const [filterScoreMax, setFilterScoreMax] = useState(100);
            const [searchQuery, setSearchQuery] = useState('');
            
            // Comparison view state
            const [selectedForComparison, setSelectedForComparison] = useState(new Set());
            const [showComparisonView, setShowComparisonView] = useState(false);
            
            const toggleComparisonSelection = (areaId) => {
                const newSelected = new Set(selectedForComparison);
                if (newSelected.has(areaId)) {
                    newSelected.delete(areaId);
                } else {
                    if (newSelected.size < 5) { // Limit to 5 for comparison
                        newSelected.add(areaId);
                    } else {
                        alert('You can compare up to 5 expertise areas at once.');
                        return;
                    }
                }
                setSelectedForComparison(newSelected);
            };
            
            const clearComparison = () => {
                setSelectedForComparison(new Set());
                setShowComparisonView(false);
            };

            // Bulk operations state
            const [bulkSelectionMode, setBulkSelectionMode] = useState(false);
            const [selectedForBulk, setSelectedForBulk] = useState(new Set());
            const [showLevelDropdown, setShowLevelDropdown] = useState(false);
            
            const toggleBulkSelection = (areaId) => {
                const newSelected = new Set(selectedForBulk);
                if (newSelected.has(areaId)) {
                    newSelected.delete(areaId);
                } else {
                    newSelected.add(areaId);
                }
                setSelectedForBulk(newSelected);
            };
            
            const selectAllForBulk = () => {
                setSelectedForBulk(new Set(sortedAndFilteredAreas.map(area => area.id)));
            };
            
            const deselectAllForBulk = () => {
                setSelectedForBulk(new Set());
            };
            
            const handleBulkDelete = () => {
                const selectedAreas = expertiseAreas.filter(area => selectedForBulk.has(area.id));
                if (selectedAreas.length === 0) {
                    alert('Please select at least one expertise area to delete.');
                    return;
                }
                
                const areaNames = selectedAreas.map(a => a.name).join(', ');
                if (window.confirm(`Are you sure you want to delete ${selectedAreas.length} expertise area(s)?\n\n${areaNames}\n\nThis action cannot be undone.`)) {
                    try {
                        selectedAreas.forEach(area => {
                            deleteExpertiseArea(area.id);
                        });
                        setSelectedForBulk(new Set());
                        setBulkSelectionMode(false);
                        alert(`Successfully deleted ${selectedAreas.length} expertise area(s)!`);
                    } catch (error) {
                        alert(`Error deleting expertise areas: ${error.message}`);
                    }
                }
            };
            
            const handleBulkUpdateLevel = (newLevel) => {
                const selectedAreas = expertiseAreas.filter(area => selectedForBulk.has(area.id));
                if (selectedAreas.length === 0) {
                    alert('Please select at least one expertise area to update.');
                    return;
                }
                
                if (window.confirm(`Update ${selectedAreas.length} expertise area(s) to "${newLevel}" level?`)) {
                    try {
                        selectedAreas.forEach(area => {
                            updateExpertiseArea(area.id, {
                                ...area,
                                level: newLevel,
                                lastUpdated: Date.now()
                            });
                        });
                        setSelectedForBulk(new Set());
                        setBulkSelectionMode(false);
                        alert(`Successfully updated ${selectedAreas.length} expertise area(s) to ${newLevel} level!`);
                    } catch (error) {
                        alert(`Error updating expertise areas: ${error.message}`);
                    }
                }
            };
            
            const exitBulkMode = () => {
                setBulkSelectionMode(false);
                setSelectedForBulk(new Set());
                setShowLevelDropdown(false);
            };

            // Analytics integration state
            const [analyticsFilter, setAnalyticsFilter] = useState(null); // { type: 'expertise', value: areaName }
            
            const navigateToAnalyticsWithFilter = (expertiseAreaName) => {
                setAnalyticsFilter({ type: 'expertise', value: expertiseAreaName });
                setActiveTab('analytics');
                // Scroll to top after tab switch
                setTimeout(() => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 100);
            };

            // Get expertise-specific analytics summary
            const getExpertiseAnalyticsSummary = React.useCallback((areaName) => {
                const areaNameLower = areaName.toLowerCase();
                const relatedContent = contentHistory.filter(item => {
                    const topic = item.metadata?.topic?.toLowerCase() || '';
                    const expertise = item.metadata?.expertiseArea?.toLowerCase() || item.metadata?.expertise_area?.toLowerCase() || '';
                    const title = item.title?.toLowerCase() || '';
                    return topic.includes(areaNameLower.split(' ')[0]) || 
                           areaNameLower.includes(topic.split(' ')[0]) ||
                           expertise.includes(areaNameLower) ||
                           title.includes(areaNameLower.split(' ')[0]);
                });
                
                const totalEngagement = relatedContent.reduce((sum, item) => 
                    sum + (item.metadata?.engagement || item.metadata?.estimatedEngagement || 0), 0
                );
                const totalViews = relatedContent.reduce((sum, item) => 
                    sum + (item.metadata?.views || item.metadata?.estimatedViews || 0), 0
                );
                const avgEngagement = relatedContent.length > 0 ? totalEngagement / relatedContent.length : 0;
                const engagementRate = totalViews > 0 ? (totalEngagement / totalViews) * 100 : 0;
                
                // Get content by platform
                const contentByPlatform = {};
                relatedContent.forEach(item => {
                    const platform = item.platform || item.metadata?.platform || 'Unknown';
                    contentByPlatform[platform] = (contentByPlatform[platform] || 0) + 1;
                });
                
                // Get top performing content
                const topPerforming = relatedContent
                    .sort((a, b) => {
                        const engagementA = a.metadata?.engagement || a.metadata?.estimatedEngagement || 0;
                        const engagementB = b.metadata?.engagement || b.metadata?.estimatedEngagement || 0;
                        return engagementB - engagementA;
                    })
                    .slice(0, 3);
                
                return {
                    totalContent: relatedContent.length,
                    totalEngagement,
                    totalViews,
                    avgEngagement,
                    engagementRate,
                    contentByPlatform,
                    topPerforming
                };
            }, [contentHistory]);

            // Sort and filter expertise areas
            const sortedAndFilteredAreas = React.useMemo(() => {
                let filtered = expertiseAreas.filter(area => {
                    // Filter by level
                    if (filterLevel !== 'all' && area.level !== filterLevel) {
                        return false;
                    }
                    
                    // Filter by authority score range
                    if (area.authorityScore < filterScoreMin || area.authorityScore > filterScoreMax) {
                        return false;
                    }
                    
                    // Filter by search query
                    if (searchQuery && !area.name.toLowerCase().includes(searchQuery.toLowerCase())) {
                        return false;
                    }
                    
                    return true;
                });
                
                // Sort the filtered results
                filtered.sort((a, b) => {
                    switch(sortBy) {
                        case 'authority':
                            return b.authorityScore - a.authorityScore;
                        case 'content':
                            return b.contentCount - a.contentCount;
                        case 'name':
                            return a.name.localeCompare(b.name);
                        case 'updated':
                            return (b.lastUpdated || 0) - (a.lastUpdated || 0);
                        default:
                            return 0;
                    }
                });
                
                return filtered;
            }, [expertiseAreas, sortBy, filterLevel, filterScoreMin, filterScoreMax, searchQuery]);

            // Mini Line Chart Component for expertise analytics
            const MiniLineChart = ({ data, color, height = 80 }) => {
                if (!data || data.length === 0) {
                    return (
                        <div className={`text-center py-4 text-xs ${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}>
                            No data
                        </div>
                    );
                }

                const values = data.map(d => typeof d === 'object' ? (d.value || d.score || d.engagement || d.contentCount || 0) : d);
                const maxValue = Math.max(...values, 1);
                const minValue = Math.min(...values, 0);
                const range = maxValue - minValue || 1;

                return (
                    <div className="relative" style={{ height: `${height}px` }}>
                        <svg viewBox={`0 0 200 ${height}`} className="w-full h-full">
                            {/* Grid line */}
                            <line
                                x1="20"
                                y1={height / 2}
                                x2="180"
                                y2={height / 2}
                                stroke={isLightMode ? '#e5e7eb' : '#374151'}
                                strokeWidth="1"
                            />
                            
                            {/* Data line */}
                            <polyline
                                points={values.map((val, i) => {
                                    const x = 20 + (i / (values.length - 1 || 1)) * 160;
                                    const y = height - 10 - ((val - minValue) / range) * (height - 20);
                                    return `${x},${y}`;
                                }).join(' ')}
                                fill="none"
                                stroke={color || '#8b5cf6'}
                                strokeWidth="2"
                            />
                            
                            {/* Data points */}
                            {values.map((val, i) => {
                                const x = 20 + (i / (values.length - 1 || 1)) * 160;
                                const y = height - 10 - ((val - minValue) / range) * (height - 20);
                                return (
                                    <circle
                                        key={i}
                                        cx={x}
                                        cy={y}
                                        r="3"
                                        fill={color || '#8b5cf6'}
                                    />
                                );
                            })}
                        </svg>
                    </div>
                );
            };

            // Mini Bar Chart Component
            const MiniBarChart = ({ data, color, height = 80 }) => {
                if (!data || data.length === 0) {
                    return (
                        <div className={`text-center py-4 text-xs ${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}>
                            No data
                        </div>
                    );
                }

                const values = data.map(d => typeof d === 'object' ? (d.value || d.count || d.contentCount || 0) : d);
                const maxValue = Math.max(...values, 1);

                return (
                    <div className="relative" style={{ height: `${height}px` }}>
                        <svg viewBox={`0 0 200 ${height}`} className="w-full h-full">
                            {values.map((val, i) => {
                                const barWidth = 160 / values.length;
                                const barHeight = (val / maxValue) * (height - 20);
                                const x = 20 + (i * barWidth);
                                const y = height - 10 - barHeight;
                                
                                return (
                                    <rect
                                        key={i}
                                        x={x}
                                        y={y}
                                        width={barWidth - 2}
                                        height={barHeight}
                                        fill={color || '#8b5cf6'}
                                        rx="2"
                                    />
                                );
                            })}
                        </svg>
                    </div>
                );
            };

            // Comparison Chart Component for all expertise areas
            const ExpertiseComparisonChart = () => {
                if (expertiseAreas.length === 0) {
                    return (
                        <div className={`text-center py-4 text-sm ${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}>
                            No expertise areas to compare
                        </div>
                    );
                }

                const maxScore = Math.max(...expertiseAreas.map(a => a.authorityScore), 1);
                const maxContent = Math.max(...expertiseAreas.map(a => a.contentCount), 1);

                return (
                    <div className="space-y-4">
                        {/* Authority Score Comparison */}
                        <div>
                            <h5 className={`text-xs font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                Authority Scores
                            </h5>
                            <div className="space-y-2">
                                {expertiseAreas.map((area) => (
                                    <div key={area.id}>
                                        <div className="flex items-center justify-between mb-1">
                                            <span className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                {area.name}
                                            </span>
                                            <span className={`text-xs font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                {area.authorityScore}
                                            </span>
                                        </div>
                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                            <div
                                                className={`h-2 rounded-full ${
                                                    area.authorityScore >= 80 ? 'bg-green-500' : 
                                                    area.authorityScore >= 60 ? 'bg-yellow-500' : 'bg-red-500'
                                                }`}
                                                style={{ width: `${(area.authorityScore / maxScore) * 100}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Content Count Comparison */}
                        <div>
                            <h5 className={`text-xs font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>
                                Content Count
                            </h5>
                            <div className="space-y-2">
                                {expertiseAreas.map((area) => (
                                    <div key={area.id}>
                                        <div className="flex items-center justify-between mb-1">
                                            <span className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                {area.name}
                                            </span>
                                            <span className={`text-xs font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                {area.contentCount}
                                            </span>
                                        </div>
                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                            <div
                                                className="h-2 rounded-full bg-purple-500"
                                                style={{ width: `${maxContent > 0 ? (area.contentCount / maxContent) * 100 : 0}%` }}
                                            ></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            // Update dynamic content when expertise areas or content history changes
            React.useEffect(() => {
                const opportunities = calculateGrowthOpportunities(expertiseAreas, trendingTopics);
                setGrowthOpportunities(opportunities);
                
                const strategies = generateContentStrategy(expertiseAreas);
                setContentStrategy(strategies);
                
                const insights = calculateAuthorityInsights(expertiseAreas, contentHistory);
                setAuthorityInsights(insights);
            }, [expertiseAreas, contentHistory]);

            // Update content counts based on content history
            React.useEffect(() => {
                if (contentHistory.length > 0) {
                    const updatedAreas = expertiseAreas.map(area => {
                        // Count content items that match this expertise area
                        const matchingContent = contentHistory.filter(item => {
                            const topic = item.metadata?.topic?.toLowerCase() || '';
                            const areaName = area.name.toLowerCase();
                            return topic.includes(areaName.split(' ')[0]) || areaName.includes(topic.split(' ')[0]);
                        }).length;
                        
                        return {
                            ...area,
                            contentCount: matchingContent
                        };
                    });
                    
                    // Only update if counts changed
                    const countsChanged = updatedAreas.some((area, index) => 
                        area.contentCount !== expertiseAreas[index].contentCount
                    );
                    if (countsChanged) {
                        setExpertiseAreas(updatedAreas);
                    }
                }
            }, [contentHistory]);

            // Expertise handlers
            const handleEditExpertise = (area) => {
                setEditingExpertise(area);
                setShowExpertiseModal(true);
                setExpertiseError(null);
            };

            const handleDeleteExpertise = (id) => {
                const area = expertiseAreas.find(a => a.id === id);
                if (area && window.confirm(`Are you sure you want to delete "${area.name}"? This action cannot be undone.`)) {
                    try {
                        deleteExpertiseArea(id);
                        alert('Expertise area deleted successfully!');
                    } catch (error) {
                        alert(`Error deleting expertise area: ${error.message}`);
                    }
                }
            };

            const tabs = [
                { id: 'dashboard', label: 'Dashboard', icon: '' },
                { id: 'generator', label: 'Content Generator', icon: '' },
                { id: 'calendar', label: 'Calendar & Post Queue', icon: '' },
                { id: 'analytics', label: 'Analytics', icon: '' },
                { id: 'expertise', label: 'Expertise', icon: '' }
            ];

            return (
                <div className="space-y-8">
                    {/* Schedule Modal */}
                    <ScheduleModal
                        isOpen={showScheduleModal}
                        onClose={() => {
                            setShowScheduleModal(false);
                            setScheduleModalContent(null);
                            setSelectedPost(null);
                        }}
                        content={scheduleModalContent}
                        editingPost={selectedPost}
                        isLightMode={isLightMode}
                    />

                    {/* Expertise Modal */}
                    <ExpertiseModal
                        isOpen={showExpertiseModal}
                        onClose={() => {
                            setShowExpertiseModal(false);
                            setEditingExpertise(null);
                            setExpertiseError(null);
                        }}
                        isLightMode={isLightMode}
                        editingExpertise={editingExpertise}
                        expertiseAreas={expertiseAreas}
                        onSave={async (id, formData) => {
                            try {
                                if (id) {
                                    updateExpertiseArea(id, formData);
                                    alert('Expertise area updated successfully!');
                                } else {
                                    addExpertiseArea(formData);
                                    alert('Expertise area added successfully!');
                                }
                                setShowExpertiseModal(false);
                                setEditingExpertise(null);
                            } catch (error) {
                                setExpertiseError(error.message);
                                throw error;
                            }
                        }}
                        onError={(error) => {
                            setExpertiseError(error.message);
                        }}
                    />

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex space-x-1 overflow-x-auto">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                        activeTab === tab.id
                                            ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-gray-400 hover:text-gray-50 hover:bg-gray-800'
                                    }`}
                                >
                                    <div className="w-4 h-4">{tab.icon}</div>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'dashboard' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-8">
                                {/* Today's Content Suggestions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Today's Content Suggestions</h2>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {generatePersonalizedSuggestions.map((suggestion) => (
                                            <div key={suggestion.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:border-purple-500/50 transition-all duration-300`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div>
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{suggestion.topic}</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{suggestion.angle}</p>
                                                        <div className="flex items-center gap-4 text-sm">
                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>{suggestion.contentType}</span>
                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}></span>
                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>{suggestion.timeToCreate}</span>
                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}></span>
                                                            <span className={`font-medium ${getDifficultyColor(suggestion.difficulty)}`}>
                                                                {suggestion.difficulty}
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className={`text-2xl font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'} mb-1`}>{suggestion.estimatedEngagement}</div>
                                                        <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Est. Engagement</div>
                                                    </div>
                                                </div>
                                                
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center gap-2">
                                                        {suggestion.platforms.map((platform, index) => (
                                                            <span key={index} className={`px-2 py-1 ${isLightMode ? 'bg-purple-100 text-purple-700' : 'bg-purple-500/20 text-purple-400'} text-xs rounded-full`}>
                                                                {platform}
                                                            </span>
                                                        ))}
                                                    </div>
                                                    <button
                                                        onClick={() => handleGenerateContent(suggestion)}
                                                        disabled={isLoading}
                                                        className="bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-6 py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                                    >
                                                        {isLoading ? (
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-4 h-4 animate-spin"></div>
                                                                Generating...
                                                            </div>
                                                        ) : (
                                                            'Generate'
                                                        )}
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Authority Score Overview */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-yellow-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Authority Score Overview</h2>
                                    </div>
                                    
                                    <div className="grid grid-cols-3 gap-6">
                                        <div className="text-center">
                                            <div className={`text-4xl font-bold mb-2 ${
                                                (authorityInsights.overallAuthority || 0) >= 80 ? (isLightMode ? 'text-green-600' : 'text-green-400') :
                                                (authorityInsights.overallAuthority || 0) >= 60 ? (isLightMode ? 'text-yellow-600' : 'text-yellow-400') :
                                                (isLightMode ? 'text-red-600' : 'text-red-400')
                                            }`}>
                                                {authorityInsights.overallAuthority || 0}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-1`}>Overall Authority</div>
                                            <div className={`text-xs ${
                                                calculateDashboardMetrics.authorityChange >= 0 
                                                    ? (isLightMode ? 'text-green-600' : 'text-green-400')
                                                    : (isLightMode ? 'text-red-600' : 'text-red-400')
                                            }`}>
                                                {calculateDashboardMetrics.authorityChange >= 0 ? '+' : ''}{calculateDashboardMetrics.authorityChange} this month
                                            </div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-4xl font-bold ${isLightMode ? 'text-blue-600' : 'text-blue-400'} mb-2`}>
                                                {calculateDashboardMetrics.postsThisMonth}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-1`}>Posts This Month</div>
                                            <div className={`text-xs ${
                                                calculateDashboardMetrics.postsChange >= 0 
                                                    ? (isLightMode ? 'text-blue-600' : 'text-blue-400')
                                                    : (isLightMode ? 'text-red-600' : 'text-red-400')
                                            }`}>
                                                {calculateDashboardMetrics.postsChange >= 0 ? '+' : ''}{calculateDashboardMetrics.postsChange} from last month
                                            </div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-4xl font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'} mb-2`}>
                                                {calculateDashboardMetrics.totalEngagement > 1000 
                                                    ? (calculateDashboardMetrics.totalEngagement / 1000).toFixed(1) + 'K'
                                                    : calculateDashboardMetrics.totalEngagement}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-1`}>Total Engagement</div>
                                            <div className={`text-xs ${
                                                calculateDashboardMetrics.engagementGrowth >= 0 
                                                    ? (isLightMode ? 'text-purple-600' : 'text-purple-400')
                                                    : (isLightMode ? 'text-red-600' : 'text-red-400')
                                            }`}>
                                                {calculateDashboardMetrics.engagementGrowth >= 0 ? '+' : ''}{calculateDashboardMetrics.engagementGrowth}% growth
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Trending Topics */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center">
                                            <div className="w-4 h-4 text-white text-lg"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Trending Topics</h3>
                                    </div>
                                    
                                    <div className="space-y-3">
                                        {trendingTopics.map((topic) => (
                                            <div key={topic.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{topic.title}</h4>
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getRelevanceColor(topic.relevanceScore)}`}>
                                                        {topic.relevanceScore}% Relevant
                                                    </span>
                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getCompetitionColor(topic.competitionLevel)}`}>
                                                        {topic.competitionLevel} Competition
                                                    </span>
                                                </div>
                                                <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                    {topic.timeframe}  {topic.category}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Quick Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Stats</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Content Generated</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                {calculateDashboardMetrics.contentGeneratedThisWeek} this week
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Published</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                {calculateDashboardMetrics.publishedThisWeek} this week
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Avg. Engagement</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                {calculateDashboardMetrics.avgEngagement || 0}
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Authority Growth</span>
                                            <span className={`text-sm font-medium ${
                                                calculateDashboardMetrics.authorityChange >= 0 
                                                    ? (isLightMode ? 'text-green-600' : 'text-green-400')
                                                    : (isLightMode ? 'text-red-600' : 'text-red-400')
                                            }`}>
                                                {calculateDashboardMetrics.authorityChange >= 0 ? '+' : ''}{calculateDashboardMetrics.authorityChange}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                {/* AI Insights */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>AI Insights</h3>
                                    <div className="space-y-4">
                                        {generateSmartInsights.length > 0 ? (
                                            generateSmartInsights.map((insight, index) => (
                                                <div key={index} className={`${
                                                    insight.color === 'blue' ? 'bg-blue-500/20 border-blue-500/50' :
                                                    insight.color === 'green' ? 'bg-green-500/20 border-green-500/50' :
                                                    'bg-purple-500/20 border-purple-500/50'
                                                } border rounded-lg p-4`}>
                                                    <h4 className={`font-medium mb-1 ${
                                                        insight.color === 'blue' ? (isLightMode ? 'text-blue-600' : 'text-blue-400') :
                                                        insight.color === 'green' ? (isLightMode ? 'text-green-600' : 'text-green-400') :
                                                        (isLightMode ? 'text-purple-600' : 'text-purple-400')
                                                    }`}>
                                                        {insight.title}
                                                    </h4>
                                                    <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                                                        {insight.message}
                                                    </p>
                                        </div>
                                            ))
                                        ) : (
                                            <div className={`text-center py-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                <p className="text-sm">Generate some content to see personalized insights!</p>
                                        </div>
                                        )}
                                        </div>
                                    </div>

                                {/* Recent Activity */}
                                {recentActivity.length > 0 && (
                                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Recent Activity</h3>
                                        <div className="space-y-3">
                                            {recentActivity.map((activity) => (
                                                <div key={activity.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                                    <div className="flex items-start justify-between">
                                                        <div className="flex-1">
                                                            <div className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>
                                                                {activity.title}
                                                            </div>
                                                            <div className="flex items-center gap-2 text-xs">
                                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                    {activity.type}
                                                                </span>
                                                                <span className={`${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}></span>
                                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                    {activity.platform}
                                                                </span>
                                                                <span className={`${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}></span>
                                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                    {activity.timestamp.toLocaleDateString()}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                            activity.status === 'published' 
                                                                ? (isLightMode ? 'bg-green-100 text-green-700' : 'bg-green-500/20 text-green-400')
                                                                : activity.status === 'scheduled'
                                                                ? (isLightMode ? 'bg-blue-100 text-blue-700' : 'bg-blue-500/20 text-blue-400')
                                                                : (isLightMode ? 'bg-gray-100 text-gray-700' : 'bg-gray-500/20 text-gray-400')
                                                        }`}>
                                                            {activity.status}
                                                        </span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Quick Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Actions</h3>
                                    <div className="space-y-2">
                                        <button
                                            onClick={() => setActiveTab('generator')}
                                            className="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-200 text-sm"
                                        >
                                            Generate Content Now
                                        </button>
                                        <button
                                            onClick={() => setActiveTab('calendar')}
                                            className="w-full bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-cyan-700 transition-all duration-200 text-sm"
                                        >
                                            Schedule Post
                                        </button>
                                        <button
                                            onClick={() => setActiveTab('analytics')}
                                            className="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-2 rounded-lg font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 text-sm"
                                        >
                                            View Analytics
                                        </button>
                                        <button
                                            onClick={() => {
                                                setEditingExpertise(null);
                                                setShowExpertiseModal(true);
                                                setExpertiseError(null);
                                            }}
                                            className="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-2 rounded-lg font-medium hover:from-orange-600 hover:to-red-700 transition-all duration-200 text-sm"
                                        >
                                            Add Expertise Area
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'generator' && (
                        <div className="space-y-8">
                            {/* Content History Section */}
                            {contentHistory.length > 0 && !activeGenerator && (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Content History</h2>
                                        <button
                                            onClick={() => {
                                                if (confirm('Clear all content history?')) {
                                                    localStorage.removeItem(CONTENT_STORAGE_KEY);
                                                    setContentHistory([]);
                                                }
                                            }}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                                isLightMode
                                                    ? 'bg-red-500 text-white hover:bg-red-600'
                                                    : 'bg-red-600 text-white hover:bg-red-700'
                                            }`}
                                        >
                                            Clear All
                                        </button>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                                        {contentHistory.slice(0, 9).map((item) => (
                                            <div key={item.id} className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4 hover:border-purple-500/50 transition-all`}>
                                                <div className="flex items-start justify-between mb-2">
                                                    <h3 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} truncate`}>{item.title}</h3>
                                                    <button
                                                        onClick={() => {
                                                            if (confirm('Delete this content?')) {
                                                                deleteContentFromHistory(item.id);
                                                            }
                                                        }}
                                                        className={`text-xs ${isLightMode ? 'text-red-600 hover:text-red-700' : 'text-red-400 hover:text-red-300'}`}
                                                    >
                                                        
                                                    </button>
                                                </div>
                                                <p className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2 line-clamp-2`}>
                                                    {item.content.substring(0, 100)}...
                                                </p>
                                                <div className="flex items-center justify-between text-xs">
                                                    <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                        {new Date(item.metadata.timestamp).toLocaleDateString()}
                                                    </span>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => {
                                                                setGeneratedContent(item);
                                                                setActiveGenerator(item.type);
                                                                setFormData({
                                                                    topic: item.metadata.topic,
                                                                    platforms: item.metadata.platforms,
                                                                    tone: item.metadata.tone
                                                                });
                                                            }}
                                                            className={`px-2 py-1 rounded text-xs font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-purple-500 text-white hover:bg-purple-600'
                                                                    : 'bg-purple-600 text-white hover:bg-purple-700'
                                                            }`}
                                                        >
                                                            View
                                                        </button>
                                                        <button
                                                            onClick={() => handleScheduleContent(item)}
                                                            className={`px-2 py-1 rounded text-xs font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-orange-500 text-white hover:bg-orange-600'
                                                                    : 'bg-orange-600 text-white hover:bg-orange-700'
                                                            }`}
                                                        >
                                                            
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {!activeGenerator ? (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-8`}>Choose Your Content Generator</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                        {[
                                            {
                                                id: 'post-generator',
                                                title: 'Post Generator',
                                                description: 'Create engaging social media posts',
                                                icon: '',
                                                gradient: 'from-blue-500 to-indigo-600'
                                            },
                                            {
                                                id: 'comment-helper',
                                                title: 'Comment Helper',
                                                description: 'Generate thoughtful responses',
                                                icon: '',
                                                gradient: 'from-blue-500 to-cyan-500'
                                            },
                                            {
                                                id: 'carousel-maker',
                                                title: 'Carousel Maker',
                                                description: 'Create visual content series',
                                                icon: '',
                                                gradient: 'from-purple-500 to-pink-500'
                                            },
                                            {
                                                id: 'repurpose-content',
                                                title: 'Repurpose Content',
                                                description: 'Transform existing content',
                                                icon: '',
                                                gradient: 'from-green-500 to-emerald-500'
                                            }
                                        ].map((generator) => (
                                            <div
                                                key={generator.id}
                                                onClick={() => handleGeneratorSelect(generator.id)}
                                                className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-2xl p-6 hover:border-purple-500/50 transition-all duration-300 cursor-pointer hover:scale-105`}
                                            >
                                                <div className={`w-16 h-16 bg-gradient-to-r ${generator.gradient} rounded-2xl flex items-center justify-center mx-auto mb-4`}>
                                                    <div className="w-8 h-8 text-white text-2xl">{generator.icon}</div>
                                                </div>
                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2 text-center`}>{generator.title}</h3>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} text-center`}>{generator.description}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ) : (
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center gap-4 mb-6">
                                        <button
                                            onClick={() => {
                                                setActiveGenerator(null);
                                                setGeneratedContent(null);
                                                setError(null);
                                            }}
                                            className={`${isLightMode ? 'text-gray-600 hover:text-gray-900' : 'text-gray-400 hover:text-white'} transition-colors duration-200`}
                                            aria-label="Back to generators"
                                        >
                                            <div className="w-6 h-6"></div>
                                        </button>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                            {activeGenerator === 'post-generator' && 'Post Generator'}
                                            {activeGenerator === 'comment-helper' && 'Comment Helper'}
                                            {activeGenerator === 'carousel-maker' && 'Carousel Maker'}
                                            {activeGenerator === 'repurpose-content' && 'Repurpose Content'}
                                        </h2>
                                    </div>

                                    {/* Error Display */}
                                    {error && (
                                        <div className={`mb-6 p-4 rounded-lg border ${isLightMode ? 'bg-red-50 border-red-200' : 'bg-red-500/20 border-red-500/50'}`}>
                                            <div className="flex items-center gap-2">
                                                <span className="text-red-500"></span>
                                                <p className={`text-sm ${isLightMode ? 'text-red-800' : 'text-red-300'}`}>{error}</p>
                                            </div>
                                        </div>
                                    )}

                                    {/* Post Generator */}
                                    {activeGenerator === 'post-generator' && (
                                        <PostGeneratorComponent
                                            isLightMode={isLightMode}
                                            formData={formData}
                                            setFormData={setFormData}
                                            generatedContent={generatedContent}
                                            setGeneratedContent={setGeneratedContent}
                                            isLoading={isLoading}
                                            setIsLoading={setIsLoading}
                                            error={error}
                                            setError={setError}
                                            generatePost={generatePost}
                                            tone={tone}
                                            setTone={setTone}
                                            selectedPlatforms={selectedPlatforms}
                                            setSelectedPlatforms={setSelectedPlatforms}
                                            contentType={contentType}
                                            setContentType={setContentType}
                                            copyToClipboard={copyToClipboard}
                                            exportAsTextFile={exportAsTextFile}
                                            getWordCount={getWordCount}
                                            getCharacterCount={getCharacterCount}
                                            saveContentToHistory={saveContentToHistory}
                                            handleScheduleContent={handleScheduleContent}
                                            expertiseAreas={expertiseAreas}
                                        />
                                    )}

                                    {/* Comment Helper */}
                                    {activeGenerator === 'comment-helper' && (
                                        <CommentHelperComponent
                                            isLightMode={isLightMode}
                                            formData={formData}
                                            setFormData={setFormData}
                                            generatedContent={generatedContent}
                                            setGeneratedContent={setGeneratedContent}
                                            isLoading={isLoading}
                                            setIsLoading={setIsLoading}
                                            error={error}
                                            setError={setError}
                                            generateComment={generateComment}
                                            tone={tone}
                                            setTone={setTone}
                                            copyToClipboard={copyToClipboard}
                                            exportAsTextFile={exportAsTextFile}
                                            getWordCount={getWordCount}
                                            getCharacterCount={getCharacterCount}
                                            saveContentToHistory={saveContentToHistory}
                                            handleScheduleContent={handleScheduleContent}
                                        />
                                    )}

                                    {/* Carousel Maker */}
                                    {activeGenerator === 'carousel-maker' && (
                                        <CarouselMakerComponent
                                            isLightMode={isLightMode}
                                            formData={formData}
                                            setFormData={setFormData}
                                            generatedContent={generatedContent}
                                            setGeneratedContent={setGeneratedContent}
                                            isLoading={isLoading}
                                            setIsLoading={setIsLoading}
                                            error={error}
                                            setError={setError}
                                            generateCarousel={generateCarousel}
                                            copyToClipboard={copyToClipboard}
                                            exportAsTextFile={exportAsTextFile}
                                            getWordCount={getWordCount}
                                            getCharacterCount={getCharacterCount}
                                            saveContentToHistory={saveContentToHistory}
                                            handleScheduleContent={handleScheduleContent}
                                        />
                                    )}

                                    {/* Repurpose Content */}
                                    {activeGenerator === 'repurpose-content' && (
                                        <RepurposeContentComponent
                                            isLightMode={isLightMode}
                                            formData={formData}
                                            setFormData={setFormData}
                                            generatedContent={generatedContent}
                                            setGeneratedContent={setGeneratedContent}
                                            isLoading={isLoading}
                                            setIsLoading={setIsLoading}
                                            error={error}
                                            setError={setError}
                                            generateRepurposedContent={generateRepurposedContent}
                                            copyToClipboard={copyToClipboard}
                                            exportAsTextFile={exportAsTextFile}
                                            getWordCount={getWordCount}
                                            getCharacterCount={getCharacterCount}
                                            saveContentToHistory={saveContentToHistory}
                                            handleScheduleContent={handleScheduleContent}
                                        />
                                    )}
                                </div>
                            )}
                        </div>
                    )}

                    {activeTab === 'expertise' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-8">
                                {/* Expertise Areas */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Your Expertise Areas</h2>
                                            {bulkSelectionMode && (
                                                <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                                                    isLightMode ? 'bg-orange-100 text-orange-700' : 'bg-orange-500/20 text-orange-400'
                                                }`}>
                                                    Bulk Mode ({selectedForBulk.size} selected)
                                                </span>
                                            )}
                                        </div>
                                        <div className="flex items-center gap-2">
                                            {/* Bulk Operations */}
                                            {!bulkSelectionMode ? (
                                                <>
                                                    {expertiseAreas.length > 0 && (
                                                        <button
                                                            onClick={() => setBulkSelectionMode(true)}
                                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-orange-500 text-white hover:bg-orange-600'
                                                                    : 'bg-orange-600 text-white hover:bg-orange-700'
                                                            }`}
                                                        >
                                                             Bulk Actions
                                                        </button>
                                                    )}
                                                    {selectedForComparison.size > 0 && (
                                                        <>
                                                            <button
                                                                onClick={() => setShowComparisonView(true)}
                                                                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                    isLightMode
                                                                        ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                                        : 'bg-blue-600 text-white hover:bg-blue-700'
                                                                }`}
                                                            >
                                                                 Compare ({selectedForComparison.size})
                                                            </button>
                                                            <button
                                                                onClick={clearComparison}
                                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                    isLightMode
                                                                        ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                                        : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                                }`}
                                                            >
                                                                Clear
                                                            </button>
                                                        </>
                                                    )}
                                                    {/* Content Distribution Chart Toggle */}
                                                    {expertiseAreas.length > 0 && (
                                                        <button
                                                            onClick={() => {
                                                                const chartSection = document.getElementById('content-distribution-chart');
                                                                if (chartSection) {
                                                                    chartSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                                                }
                                                            }}
                                                            className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-indigo-100 text-indigo-700 hover:bg-indigo-200'
                                                                    : 'bg-indigo-500/20 text-indigo-400 hover:bg-indigo-500/30'
                                                            }`}
                                                        >
                                                             View Distribution
                                                        </button>
                                                    )}
                                                </>
                                            ) : (
                                                <>
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={selectAllForBulk}
                                                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-green-500 text-white hover:bg-green-600'
                                                                    : 'bg-green-600 text-white hover:bg-green-700'
                                                            }`}
                                                        >
                                                            Select All
                                                        </button>
                                                        <button
                                                            onClick={deselectAllForBulk}
                                                            className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                            }`}
                                                        >
                                                            Deselect All
                                                        </button>
                                                    </div>
                                                    {selectedForBulk.size > 0 && (
                                                        <div className="flex items-center gap-2 border-l pl-2 ml-2">
                                                            <div className="relative">
                                                                <button
                                                                    onClick={() => setShowLevelDropdown(!showLevelDropdown)}
                                                                    className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                        isLightMode
                                                                            ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                                            : 'bg-blue-600 text-white hover:bg-blue-700'
                                                                    }`}
                                                                >
                                                                    Update Level 
                                                                </button>
                                                                {showLevelDropdown && (
                                                                    <div className={`absolute right-0 mt-1 w-48 ${isLightMode ? 'bg-white' : 'bg-gray-800'} border ${isLightMode ? 'border-gray-200' : 'border-gray-700'} rounded-lg shadow-lg z-10`}>
                                                                        <div className="py-1">
                                                                            {['Beginner', 'Intermediate', 'Advanced', 'Expert'].map(level => (
                                                                                <button
                                                                                    key={level}
                                                                                    onClick={() => {
                                                                                        handleBulkUpdateLevel(level);
                                                                                        setShowLevelDropdown(false);
                                                                                    }}
                                                                                    className={`w-full text-left px-4 py-2 text-sm ${isLightMode ? 'hover:bg-gray-100 text-gray-700' : 'hover:bg-gray-700 text-gray-300'} transition-colors`}
                                                                                >
                                                                                    Set to {level}
                                                                                </button>
                                                                            ))}
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            <button
                                                                onClick={handleBulkDelete}
                                                                className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                    isLightMode
                                                                        ? 'bg-red-500 text-white hover:bg-red-600'
                                                                        : 'bg-red-600 text-white hover:bg-red-700'
                                                                }`}
                                                            >
                                                                 Delete ({selectedForBulk.size})
                                                            </button>
                                                        </div>
                                                    )}
                                                    <button
                                                        onClick={exitBulkMode}
                                                        className={`px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                                                            isLightMode
                                                                ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                                : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                        }`}
                                                    >
                                                        Cancel
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* Content Distribution Chart */}
                                    {expertiseAreas.length > 0 && (() => {
                                        const distributionData = expertiseAreas.map(area => {
                                            const relatedContent = contentHistory.filter(item => {
                                                const topic = item.metadata?.topic?.toLowerCase() || '';
                                                const expertise = item.metadata?.expertiseArea?.toLowerCase() || item.metadata?.expertise_area?.toLowerCase() || '';
                                                const title = item.title?.toLowerCase() || '';
                                                const areaNameLower = area.name.toLowerCase();
                                                return topic.includes(areaNameLower.split(' ')[0]) || 
                                                       areaNameLower.includes(topic.split(' ')[0]) ||
                                                       expertise.includes(areaNameLower) ||
                                                       title.includes(areaNameLower.split(' ')[0]);
                                            });
                                            return {
                                                name: area.name,
                                                count: relatedContent.length,
                                                color: area.authorityScore >= 80 ? '#10b981' : area.authorityScore >= 60 ? '#eab308' : '#ef4444'
                                            };
                                        });
                                        const maxCount = Math.max(...distributionData.map(d => d.count), 1);
                                        
                                        return (
                                            <div id="content-distribution-chart" className={`mb-6 ${isLightMode ? 'bg-gray-50' : 'bg-gray-800/50'} rounded-lg p-4`}>
                                                <h3 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-3`}>
                                                    Content Distribution Across Expertise Areas
                                                </h3>
                                                <div className="space-y-2">
                                                    {distributionData.map((item, idx) => (
                                                        <div key={idx}>
                                                            <div className="flex items-center justify-between mb-1">
                                                                <span className={`text-xs font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                                    {item.name}
                                                                </span>
                                                                <span className={`text-xs font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                    {item.count} {item.count === 1 ? 'piece' : 'pieces'}
                                                                </span>
                                                            </div>
                                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                                <div
                                                                    className="h-2 rounded-full transition-all duration-300"
                                                                    style={{ 
                                                                        width: `${maxCount > 0 ? (item.count / maxCount) * 100 : 0}%`,
                                                                        backgroundColor: item.color
                                                                    }}
                                                                ></div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        );
                                    })()}
                                    
                                    {/* Sorting and Filtering Controls */}
                                    {expertiseAreas.length > 0 && (
                                        <div className={`mb-6 ${isLightMode ? 'bg-gray-50' : 'bg-gray-800/50'} rounded-lg p-4 space-y-4`}>
                                            <div className="flex items-center justify-between flex-wrap gap-4">
                                                <h3 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                    Filter & Sort
                                                </h3>
                                                <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                    Showing {sortedAndFilteredAreas.length} of {expertiseAreas.length} areas
                                                </div>
                                            </div>
                                            
                                            {/* Search */}
                                            <div>
                                                <input
                                                    type="text"
                                                    value={searchQuery}
                                                    onChange={(e) => setSearchQuery(e.target.value)}
                                                    placeholder="Search expertise areas..."
                                                    className={`w-full px-4 py-2 rounded-lg border text-sm ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                                />
                                            </div>
                                            
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                                                {/* Sort By */}
                                                <div>
                                                    <label className={`block text-xs font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-1`}>
                                                        Sort By
                                                    </label>
                                                    <select
                                                        value={sortBy}
                                                        onChange={(e) => setSortBy(e.target.value)}
                                                        className={`w-full px-3 py-2 rounded-lg border text-sm ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                                    >
                                                        <option value="authority">Authority Score</option>
                                                        <option value="content">Content Count</option>
                                                        <option value="name">Name (A-Z)</option>
                                                        <option value="updated">Last Updated</option>
                                                    </select>
                                                </div>
                                                
                                                {/* Filter by Level */}
                                                <div>
                                                    <label className={`block text-xs font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-1`}>
                                                        Level
                                                    </label>
                                                    <select
                                                        value={filterLevel}
                                                        onChange={(e) => setFilterLevel(e.target.value)}
                                                        className={`w-full px-3 py-2 rounded-lg border text-sm ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                                    >
                                                        <option value="all">All Levels</option>
                                                        <option value="Beginner">Beginner</option>
                                                        <option value="Intermediate">Intermediate</option>
                                                        <option value="Advanced">Advanced</option>
                                                        <option value="Expert">Expert</option>
                                                    </select>
                                                </div>
                                                
                                                {/* Authority Score Range - Min */}
                                                <div>
                                                    <label className={`block text-xs font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-1`}>
                                                        Min Score
                                                    </label>
                                                    <input
                                                        type="number"
                                                        min="0"
                                                        max="100"
                                                        value={filterScoreMin}
                                                        onChange={(e) => setFilterScoreMin(Math.max(0, Math.min(100, parseInt(e.target.value) || 0)))}
                                                        className={`w-full px-3 py-2 rounded-lg border text-sm ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                                    />
                                                </div>
                                                
                                                {/* Authority Score Range - Max */}
                                                <div>
                                                    <label className={`block text-xs font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-1`}>
                                                        Max Score
                                                    </label>
                                                    <input
                                                        type="number"
                                                        min="0"
                                                        max="100"
                                                        value={filterScoreMax}
                                                        onChange={(e) => setFilterScoreMax(Math.max(0, Math.min(100, parseInt(e.target.value) || 100)))}
                                                        className={`w-full px-3 py-2 rounded-lg border text-sm ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-700 border-gray-600 text-gray-50'} focus:outline-none focus:ring-2 focus:ring-purple-500`}
                                                    />
                                                </div>
                                            </div>
                                            
                                            {/* Clear Filters Button */}
                                            {(filterLevel !== 'all' || filterScoreMin !== 0 || filterScoreMax !== 100 || searchQuery) && (
                                                <button
                                                    onClick={() => {
                                                        setFilterLevel('all');
                                                        setFilterScoreMin(0);
                                                        setFilterScoreMax(100);
                                                        setSearchQuery('');
                                                    }}
                                                    className={`w-full py-2 rounded-lg text-sm font-medium transition-all ${
                                                        isLightMode
                                                            ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                    }`}
                                                >
                                                    Clear All Filters
                                                </button>
                                            )}
                                        </div>
                                    )}
                                    
                                    <div className="space-y-4">
                                        {expertiseAreas.length === 0 ? (
                                            <div className={`${isLightMode ? 'bg-gradient-to-br from-purple-50 to-indigo-50' : 'bg-gradient-to-br from-purple-900/20 to-indigo-900/20'} border-2 ${isLightMode ? 'border-purple-200' : 'border-purple-500/30'} rounded-2xl p-12 text-center`}>
                                                <div className="max-w-md mx-auto">
                                                    <div className="w-24 h-24 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                                                        <span className="text-5xl"></span>
                                                    </div>
                                                    <h3 className={`text-2xl font-bold mb-3 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                        Start Building Your Expertise Profile
                                                    </h3>
                                                    <p className={`text-base mb-6 ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                                                        Define your areas of expertise to track your authority, generate targeted content, and grow your professional presence.
                                                    </p>
                                                    
                                                    {/* Benefits List */}
                                                    <div className={`${isLightMode ? 'bg-white/60' : 'bg-gray-800/40'} rounded-lg p-4 mb-6 text-left`}>
                                                        <h4 className={`text-sm font-semibold mb-3 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                             What you'll get:
                                                        </h4>
                                                        <ul className={`space-y-2 text-sm ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                            <li className="flex items-start gap-2">
                                                                <span className="text-green-500 mt-0.5"></span>
                                                                <span>Track authority scores for each expertise area</span>
                                                            </li>
                                                            <li className="flex items-start gap-2">
                                                                <span className="text-green-500 mt-0.5"></span>
                                                                <span>Get personalized content recommendations</span>
                                                            </li>
                                                            <li className="flex items-start gap-2">
                                                                <span className="text-green-500 mt-0.5"></span>
                                                                <span>Analyze performance and engagement metrics</span>
                                                            </li>
                                                            <li className="flex items-start gap-2">
                                                                <span className="text-green-500 mt-0.5"></span>
                                                                <span>Receive smart growth recommendations</span>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    
                                                    {/* Quick Start Guide */}
                                                    <div className={`${isLightMode ? 'bg-blue-50' : 'bg-blue-900/20'} rounded-lg p-4 mb-6 text-left border-l-4 ${isLightMode ? 'border-blue-500' : 'border-blue-400'}`}>
                                                        <h4 className={`text-sm font-semibold mb-2 ${isLightMode ? 'text-blue-900' : 'text-blue-300'}`}>
                                                             Quick Start Guide:
                                                        </h4>
                                                        <ol className={`space-y-1.5 text-sm ${isLightMode ? 'text-blue-800' : 'text-blue-200'} list-decimal list-inside`}>
                                                            <li>Click " Add New" button above</li>
                                                            <li>Enter your expertise area name (e.g., "React Development")</li>
                                                            <li>Select your current skill level</li>
                                                            <li>Start generating content to build authority!</li>
                                                        </ol>
                                                    </div>
                                                    
                                                    {/* CTA Button */}
                                                    <button
                                                        onClick={() => {
                                                            setEditingExpertise(null);
                                                            setShowExpertiseModal(true);
                                                            setExpertiseError(null);
                                                        }}
                                                        className={`w-full py-4 rounded-xl text-base font-semibold transition-all duration-200 transform hover:scale-105 ${
                                                            isLightMode
                                                                ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white hover:from-purple-600 hover:to-indigo-700 shadow-lg'
                                                                : 'bg-gradient-to-r from-purple-600 to-indigo-700 text-white hover:from-purple-700 hover:to-indigo-800 shadow-lg shadow-purple-500/20'
                                                        }`}
                                                    >
                                                         Add Your First Expertise Area
                                                    </button>
                                                    
                                                    <p className={`text-xs mt-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                         Tip: Add 3-5 expertise areas to get the most value from the platform
                                                    </p>
                                                </div>
                                            </div>
                                        ) : sortedAndFilteredAreas.length === 0 ? (
                                            <div className={`${isLightMode ? 'bg-yellow-50' : 'bg-yellow-900/20'} border-2 ${isLightMode ? 'border-yellow-200' : 'border-yellow-500/30'} rounded-2xl p-10 text-center`}>
                                                <div className="max-w-md mx-auto">
                                                    <div className="w-20 h-20 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                                        <span className="text-4xl"></span>
                                                    </div>
                                                    <h3 className={`text-xl font-bold mb-2 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                        No Results Found
                                                    </h3>
                                                    <p className={`text-sm mb-6 ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                                                        No expertise areas match your current filters. Try adjusting your search or filter criteria.
                                                    </p>
                                                    
                                                    {/* Current Filters Display */}
                                                    {(searchQuery || filterLevel !== 'all' || filterScoreMin > 0 || filterScoreMax < 100) && (
                                                        <div className={`${isLightMode ? 'bg-white/60' : 'bg-gray-800/40'} rounded-lg p-4 mb-4 text-left`}>
                                                            <h4 className={`text-xs font-semibold mb-2 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                                Current Filters:
                                                            </h4>
                                                            <div className="flex flex-wrap gap-2">
                                                                {searchQuery && (
                                                                    <span className={`px-2 py-1 rounded text-xs ${isLightMode ? 'bg-gray-200 text-gray-700' : 'bg-gray-700 text-gray-300'}`}>
                                                                        Search: "{searchQuery}"
                                                                    </span>
                                                                )}
                                                                {filterLevel !== 'all' && (
                                                                    <span className={`px-2 py-1 rounded text-xs ${isLightMode ? 'bg-gray-200 text-gray-700' : 'bg-gray-700 text-gray-300'}`}>
                                                                        Level: {filterLevel}
                                                                    </span>
                                                                )}
                                                                {(filterScoreMin > 0 || filterScoreMax < 100) && (
                                                                    <span className={`px-2 py-1 rounded text-xs ${isLightMode ? 'bg-gray-200 text-gray-700' : 'bg-gray-700 text-gray-300'}`}>
                                                                        Score: {filterScoreMin}-{filterScoreMax}
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    )}
                                                    
                                                    {/* Action Buttons */}
                                                    <div className="flex flex-col sm:flex-row gap-3 justify-center">
                                                        <button
                                                            onClick={() => {
                                                                setSearchQuery('');
                                                                setFilterLevel('all');
                                                                setFilterScoreMin(0);
                                                                setFilterScoreMax(100);
                                                            }}
                                                            className={`px-6 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-yellow-500 text-white hover:bg-yellow-600'
                                                                    : 'bg-yellow-600 text-white hover:bg-yellow-700'
                                                            }`}
                                                        >
                                                             Clear All Filters
                                                        </button>
                                                        <button
                                                            onClick={() => {
                                                                setEditingExpertise(null);
                                                                setShowExpertiseModal(true);
                                                                setExpertiseError(null);
                                                            }}
                                                            className={`px-6 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                isLightMode
                                                                    ? 'bg-purple-500 text-white hover:bg-purple-600'
                                                                    : 'bg-purple-600 text-white hover:bg-purple-700'
                                                            }`}
                                                        >
                                                             Add New Expertise Area
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            sortedAndFilteredAreas.map((area) => {
                                                const quickStats = getQuickStats(area.name);
                                                const recentContent = getRecentContent(area.name);
                                                
                                                return (
                                                <div key={area.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} ${selectedForComparison.has(area.id) ? 'border-purple-500 border-2' : selectedForBulk.has(area.id) ? 'border-orange-500 border-2' : 'border'} rounded-lg p-6 hover:border-purple-500/50 transition-all duration-200`}>
                                                    {/* Selection Checkboxes */}
                                                    <div className="flex items-center justify-between mb-2">
                                                        {bulkSelectionMode ? (
                                                            <label className="flex items-center gap-2 cursor-pointer">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={selectedForBulk.has(area.id)}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        toggleBulkSelection(area.id);
                                                                    }}
                                                                    className="w-5 h-5 text-orange-600 rounded focus:ring-orange-500"
                                                                />
                                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                                    Select for bulk action
                                                                </span>
                                                            </label>
                                                        ) : (
                                                            <div></div>
                                                        )}
                                                        {!bulkSelectionMode && (
                                                            <label className="flex items-center gap-2 cursor-pointer">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={selectedForComparison.has(area.id)}
                                                                    onChange={(e) => {
                                                                        e.stopPropagation();
                                                                        toggleComparisonSelection(area.id);
                                                                    }}
                                                                    className="w-4 h-4 text-purple-600 rounded focus:ring-purple-500"
                                                                />
                                                                <span className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                                    Compare
                                                                </span>
                                                            </label>
                                                        )}
                                                    </div>
                                                    
                                                    {/* Card Header - Clickable to expand */}
                                                    <div 
                                                        className="cursor-pointer"
                                                        onClick={() => toggleCardExpansion(area.id)}
                                                    >
                                                <div className="flex items-start justify-between mb-4">
                                                        <div className="flex-1">
                                                            <div className="flex items-center justify-between mb-2">
                                                                    <div className="flex items-center gap-2">
                                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{area.name}</h3>
                                                                        <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${
                                                                            area.level === 'Expert' ? (isLightMode ? 'bg-purple-100 text-purple-700' : 'bg-purple-500/30 text-purple-300') :
                                                                            area.level === 'Advanced' ? (isLightMode ? 'bg-blue-100 text-blue-700' : 'bg-blue-500/30 text-blue-300') :
                                                                            area.level === 'Intermediate' ? (isLightMode ? 'bg-yellow-100 text-yellow-700' : 'bg-yellow-500/30 text-yellow-300') :
                                                                            (isLightMode ? 'bg-gray-100 text-gray-700' : 'bg-gray-500/30 text-gray-300')
                                                                        }`}>
                                                                            {area.level}
                                                                        </span>
                                                                    </div>
                                                                <div className="flex items-center gap-2">
                                                                    <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                handleEditExpertise(area);
                                                                            }}
                                                                        className={`p-2 rounded-lg transition-colors ${
                                                                            isLightMode 
                                                                                ? 'text-blue-600 hover:bg-blue-50' 
                                                                                : 'text-blue-400 hover:bg-blue-500/20'
                                                                        }`}
                                                                        aria-label={`Edit ${area.name}`}
                                                                        title="Edit expertise area"
                                                                    >
                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                                                        </svg>
                                                                    </button>
                                                                    <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                handleDeleteExpertise(area.id);
                                                                            }}
                                                                        className={`p-2 rounded-lg transition-colors ${
                                                                            isLightMode 
                                                                                ? 'text-red-600 hover:bg-red-50' 
                                                                                : 'text-red-400 hover:bg-red-500/20'
                                                                        }`}
                                                                        aria-label={`Delete ${area.name}`}
                                                                        title="Delete expertise area"
                                                                    >
                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                                            <polyline points="3 6 5 6 21 6"></polyline>
                                                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                                                        </svg>
                                                                    </button>
                                                                        <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                toggleCardExpansion(area.id);
                                                                            }}
                                                                            className={`p-1 rounded-lg transition-colors ${
                                                                                isLightMode 
                                                                                    ? 'text-gray-600 hover:bg-gray-100' 
                                                                                    : 'text-gray-400 hover:bg-gray-700'
                                                                            }`}
                                                                            aria-label={expandedCards.has(area.id) ? 'Collapse' : 'Expand'}
                                                                        >
                                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{ transform: expandedCards.has(area.id) ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.2s' }}>
                                                                                <polyline points="6 9 12 15 18 9"></polyline>
                                                                        </svg>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                    </div>
                                                        <div className="text-right ml-4">
                                                        <div className={`text-2xl font-bold ${getAuthorityColor(area.authorityScore)}`}>
                                                            {area.authorityScore}
                                                        </div>
                                                        <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Authority Score</div>
                                                    </div>
                                                </div>
                                                
                                                <div className="mb-4">
                                                    <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                        <span>Authority Progress</span>
                                                        <span>{area.authorityScore}/100</span>
                                                    </div>
                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                        <div 
                                                            className={`h-2 rounded-full ${
                                                                area.authorityScore >= 80 ? 'bg-green-500' : 
                                                                area.authorityScore >= 60 ? 'bg-yellow-500' : 'bg-red-500'
                                                            }`}
                                                            style={{ width: `${area.authorityScore}%` }}
                                                        ></div>
                                                    </div>
                                                </div>
                                                        
                                                        {/* Quick Stats Preview */}
                                                        {area.contentCount > 0 && (
                                                            <div className="grid grid-cols-3 gap-3 mb-4">
                                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-2 text-center`}>
                                                                    <div className={`text-sm font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        {quickStats.avgEngagement || 0}
                                                                    </div>
                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Avg Engagement</div>
                                                                </div>
                                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-2 text-center`}>
                                                                    <div className={`text-sm font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        {quickStats.totalViews > 1000 
                                                                            ? (quickStats.totalViews / 1000).toFixed(1) + 'K'
                                                                            : quickStats.totalViews}
                                                                    </div>
                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Views</div>
                                                                </div>
                                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-2 text-center`}>
                                                                    <div className={`text-sm font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        {quickStats.engagementRate.toFixed(1)}%
                                                                    </div>
                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Engagement Rate</div>
                                                                </div>
                                                            </div>
                                                        )}
                                                
                                                <div className={`flex items-center justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                    <span>{area.contentCount} pieces of content</span>
                                                        <span>Updated {formatLastUpdated(area.lastUpdated)}</span>
                                                </div>
                                            </div>
                                                    
                                                    {/* Expanded Card Details */}
                                                    {expandedCards.has(area.id) && (
                                                        <div className={`mt-4 pt-4 border-t ${isLightMode ? 'border-gray-200' : 'border-gray-700'} space-y-4`}>
                                                            {/* Recent Content Preview */}
                                                            {recentContent.length > 0 && (
                                                                <div>
                                                                    <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>
                                                                        Recent Content
                                                                    </h4>
                                                                    <div className="space-y-2">
                                                                        {recentContent.map((item) => (
                                                                            <div 
                                                                                key={item.id}
                                                                                className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-2 flex items-center justify-between cursor-pointer hover:${isLightMode ? 'bg-gray-100' : 'bg-gray-700'} transition-colors`}
                                                                                onClick={(e) => {
                                                                                    e.stopPropagation();
                                                                                    setGeneratedContent(item);
                                                                                    setActiveTab('generator');
                                                                                    setActiveGenerator(item.type || 'post-generator');
                                                                                }}
                                                                            >
                                                                                <div className="flex-1 min-w-0">
                                                                                    <div className={`text-xs font-medium truncate ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                                        {item.title}
                                                                                    </div>
                                                                                    <div className="flex items-center gap-2 text-xs mt-0.5">
                                                                                        <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>
                                                                                            {item.type || item.metadata?.contentType || 'post'}
                                                                                        </span>
                                                                                        <span className={isLightMode ? 'text-gray-400' : 'text-gray-500'}></span>
                                                                                        <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>
                                                                                            {new Date(item.metadata?.timestamp || item.createdAt || Date.now()).toLocaleDateString()}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                                <button
                                                                                    onClick={(e) => {
                                                                                        e.stopPropagation();
                                                                                        setGeneratedContent(item);
                                                                                        setActiveTab('generator');
                                                                                        setActiveGenerator(item.type || 'post-generator');
                                                                                    }}
                                                                                    className={`ml-2 px-2 py-1 rounded text-xs font-medium transition-all ${
                                                                                        isLightMode
                                                                                            ? 'bg-purple-500 text-white hover:bg-purple-600'
                                                                                            : 'bg-purple-600 text-white hover:bg-purple-700'
                                                                                    }`}
                                                                                >
                                                                                    View
                                                                                </button>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}
                                                            
                                                            {/* Quick Actions */}
                                                            <div className="grid grid-cols-2 gap-2">
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        setActiveTab('generator');
                                                                        setFormData({
                                                                            ...formData,
                                                                            topic: area.name,
                                                                            expertiseArea: area.name
                                                                        });
                                                                        setTimeout(() => {
                                                                            setActiveGenerator('post-generator');
                                                                        }, 100);
                                                                    }}
                                                                    className={`py-2 rounded-lg text-xs font-medium transition-all duration-200 ${
                                                                        isLightMode
                                                                            ? 'bg-green-100 text-green-700 hover:bg-green-200'
                                                                            : 'bg-green-500/20 text-green-400 hover:bg-green-500/30'
                                                                    }`}
                                                                >
                                                                     Generate
                                                                </button>
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        toggleAnalytics(area.id);
                                                                    }}
                                                                    className={`py-2 rounded-lg text-xs font-medium transition-all duration-200 ${
                                                                        isLightMode
                                                                            ? 'bg-purple-100 text-purple-700 hover:bg-purple-200'
                                                                            : 'bg-purple-500/20 text-purple-400 hover:bg-purple-500/30'
                                                                    }`}
                                                                >
                                                                     Analytics
                                                                </button>
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        navigateToAnalyticsWithFilter(area.name);
                                                                    }}
                                                                    className={`py-2 rounded-lg text-xs font-medium transition-all duration-200 ${
                                                                        isLightMode
                                                                            ? 'bg-blue-100 text-blue-700 hover:bg-blue-200'
                                                                            : 'bg-blue-500/20 text-blue-400 hover:bg-blue-500/30'
                                                                    }`}
                                                                >
                                                                     View Analytics
                                                                </button>
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        handleEditExpertise(area);
                                                                    }}
                                                                    className={`py-2 rounded-lg text-xs font-medium transition-all duration-200 ${
                                                                        isLightMode
                                                                            ? 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                                            : 'bg-gray-500/20 text-gray-400 hover:bg-gray-500/30'
                                                                    }`}
                                                                >
                                                                     Edit
                                                                </button>
                                    </div>
                                                        </div>
                                                    )}
                                                
                                                {/* Action Buttons - Always Visible */}
                                                <div className="flex gap-2 mt-4" onClick={(e) => e.stopPropagation()}>
                                                    <button
                                                        onClick={() => {
                                                            setActiveTab('generator');
                                                            setFormData({
                                                                ...formData,
                                                                topic: area.name,
                                                                expertiseArea: area.name
                                                            });
                                                            setTimeout(() => {
                                                                setActiveGenerator('post-generator');
                                                            }, 100);
                                                        }}
                                                        className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${
                                                            isLightMode
                                                                ? 'bg-green-100 text-green-700 hover:bg-green-200'
                                                                : 'bg-green-500/20 text-green-400 hover:bg-green-500/30'
                                                        }`}
                                                    >
                                                         Generate Content
                                                    </button>
                                                    <button
                                                        onClick={() => toggleAnalytics(area.id)}
                                                        className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${
                                                            isLightMode
                                                                ? 'bg-purple-100 text-purple-700 hover:bg-purple-200'
                                                                : 'bg-purple-500/20 text-purple-400 hover:bg-purple-500/30'
                                                        }`}
                                                    >
                                                        {expandedAnalytics.has(area.id) ? ' Hide' : ' Analytics'}
                                                    </button>
                                                                </div>
                                                
                                                {/* Expanded Analytics Section */}
                                                {expandedAnalytics.has(area.id) && (() => {
                                                    const analytics = getExpertiseAreaAnalytics(area.name);
                                                    return (
                                                        <div className={`mt-4 pt-4 border-t ${isLightMode ? 'border-gray-200' : 'border-gray-700'} space-y-4`} onClick={(e) => e.stopPropagation()}>
                                                            {/* Key Metrics */}
                                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-3`}>
                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-1`}>Total Engagement</div>
                                                                    <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        {analytics.totalEngagement > 1000 
                                                                            ? (analytics.totalEngagement / 1000).toFixed(1) + 'K'
                                                                            : analytics.totalEngagement}
                                                                    </div>
                                                                </div>
                                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-3`}>
                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-1`}>Avg Engagement</div>
                                                                    <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        {analytics.avgEngagement}
                                                                    </div>
                                                                </div>
                                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-3`}>
                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-1`}>Engagement Rate</div>
                                                                    <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        {analytics.engagementRate}%
                                                                    </div>
                                                                </div>
                                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-3`}>
                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-1`}>Total Views</div>
                                                                    <div className={`text-lg font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        {analytics.totalViews > 1000 
                                                                            ? (analytics.totalViews / 1000).toFixed(1) + 'K'
                                                                            : analytics.totalViews}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            {/* Engagement Breakdown */}
                                                            <div>
                                                                <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Engagement Breakdown</h4>
                                                                <div className="grid grid-cols-3 gap-2">
                                                                    <div className={`${isLightMode ? 'bg-blue-50' : 'bg-blue-500/20'} rounded-lg p-2 text-center`}>
                                                                        <div className={`text-sm font-bold ${isLightMode ? 'text-blue-700' : 'text-blue-400'}`}>
                                                                            {analytics.totalLikes}
                                                                        </div>
                                                                        <div className={`text-xs ${isLightMode ? 'text-blue-600' : 'text-blue-300'}`}>Likes</div>
                                                                    </div>
                                                                    <div className={`${isLightMode ? 'bg-green-50' : 'bg-green-500/20'} rounded-lg p-2 text-center`}>
                                                                        <div className={`text-sm font-bold ${isLightMode ? 'text-green-700' : 'text-green-400'}`}>
                                                                            {analytics.totalComments}
                                                                        </div>
                                                                        <div className={`text-xs ${isLightMode ? 'text-green-600' : 'text-green-300'}`}>Comments</div>
                                                                    </div>
                                                                    <div className={`${isLightMode ? 'bg-purple-50' : 'bg-purple-500/20'} rounded-lg p-2 text-center`}>
                                                                        <div className={`text-sm font-bold ${isLightMode ? 'text-purple-700' : 'text-purple-400'}`}>
                                                                            {analytics.totalShares}
                                                                        </div>
                                                                        <div className={`text-xs ${isLightMode ? 'text-purple-600' : 'text-purple-300'}`}>Shares</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            {/* Content Type Distribution */}
                                                            {Object.keys(analytics.contentTypes).length > 0 && (
                                                                <div>
                                                                    <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Content Type Distribution</h4>
                                                                    <div className="space-y-2">
                                                                        {Object.entries(analytics.contentTypes).map(([type, count]) => (
                                                                            <div key={type} className="flex items-center justify-between">
                                                                                <span className={`text-sm capitalize ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                                                    {type}
                                                                                </span>
                                                                                <div className="flex items-center gap-2 flex-1 mx-3">
                                                                                    <div className={`flex-1 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                                                        <div 
                                                                                            className="bg-purple-500 h-2 rounded-full"
                                                                                            style={{ width: `${(count / analytics.contentCount) * 100}%` }}
                                                                                        ></div>
                                                                                    </div>
                                                                                    <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} w-8 text-right`}>
                                                                                        {count}
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}
                                                            
                                                            {/* Engagement Trend */}
                                                            {analytics.engagementTrend !== 0 && (
                                                                <div>
                                                                    <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Engagement Trend (Last 30 Days)</h4>
                                                                    <div className={`flex items-center gap-2 ${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-3`}>
                                                                        <span className={`text-lg ${analytics.engagementTrend >= 0 ? 'text-green-500' : 'text-red-500'}`}>
                                                                            {analytics.engagementTrend >= 0 ? '' : ''}
                                                                        </span>
                                                                        <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                            {Math.abs(analytics.engagementTrend)}% {analytics.engagementTrend >= 0 ? 'increase' : 'decrease'} compared to previous 30 days
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            
                                                            {/* Authority Score History - Detailed Timeline */}
                                                            {analytics.authorityHistory && analytics.authorityHistory.length > 0 && (
                                                                <div className={`pt-4 border-t ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                                                    <div className="flex items-center justify-between mb-4">
                                                                        <h4 className={`text-base font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                             Authority Score History
                                                                        </h4>
                                                                        <div className="flex items-center gap-4 text-xs">
                                                                            {(() => {
                                                                                const firstScore = analytics.authorityHistory[0]?.score || 0;
                                                                                const lastScore = analytics.authorityHistory[analytics.authorityHistory.length - 1]?.score || 0;
                                                                                const change = lastScore - firstScore;
                                                                                const changePercent = firstScore > 0 ? ((change / firstScore) * 100).toFixed(1) : 0;
                                                                                return (
                                                                                    <>
                                                                                        <div className={`flex items-center gap-1 ${change >= 0 ? 'text-green-500' : 'text-red-500'}`}>
                                                                                            <span>{change >= 0 ? '' : ''}</span>
                                                                                            <span className="font-medium">{Math.abs(change)} points</span>
                                                                                        </div>
                                                                                        <div className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>
                                                                                            {changePercent}% change
                                                                                        </div>
                                                                                    </>
                                                                                );
                                                                            })()}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {/* Detailed Timeline Chart */}
                                                                    <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/30'} rounded-lg p-4 mb-4`}>
                                                                        <div className="relative" style={{ height: '180px' }}>
                                                                            <svg viewBox="0 0 600 180" className="w-full h-full">
                                                                                {(() => {
                                                                                    const values = analytics.authorityHistory.map(h => h.score);
                                                                                    const maxValue = Math.max(...values, 100);
                                                                                    const minValue = Math.min(...values, 0);
                                                                                    const range = maxValue - minValue || 100;
                                                                                    const padding = 40;
                                                                                    const chartWidth = 560;
                                                                                    const chartHeight = 140;
                                                                                    const stepX = chartWidth / (values.length - 1 || 1);
                                                                                    
                                                                                    // Draw grid lines
                                                                                    for (let i = 0; i <= 4; i++) {
                                                                                        const y = padding + (chartHeight / 4) * i;
                                                                                        const value = maxValue - (range / 4) * i;
                                                                                        return (
                                                                                            <g key={`grid-${i}`}>
                                                                                                <line
                                                                                                    x1={padding}
                                                                                                    y1={y}
                                                                                                    x2={padding + chartWidth}
                                                                                                    y2={y}
                                                                                                    stroke={isLightMode ? '#e5e7eb' : '#374151'}
                                                                                                    strokeWidth="1"
                                                                                                    strokeDasharray="2,2"
                                                                                                />
                                                                                                <text
                                                                                                    x={padding - 10}
                                                                                                    y={y + 4}
                                                                                                    textAnchor="end"
                                                                                                    className={`text-xs ${isLightMode ? 'fill-gray-500' : 'fill-gray-400'}`}
                                                                                                    fontSize="10"
                                                                                                >
                                                                                                    {Math.round(value)}
                                                                                                </text>
                                                                                            </g>
                                                                                        );
                                                                                    }
                                                                                    
                                                                                    // Draw line
                                                                                    const points = values.map((val, i) => {
                                                                                        const x = padding + (i * stepX);
                                                                                        const y = padding + chartHeight - ((val - minValue) / range) * chartHeight;
                                                                                        return `${x},${y}`;
                                                                                    }).join(' ');
                                                                                    
                                                                                    // Draw area under line
                                                                                    const areaPoints = `${padding},${padding + chartHeight} ${points} ${padding + chartWidth},${padding + chartHeight}`;
                                                                                    
                                                                                    return (
                                                                                        <>
                                                                                            <polygon
                                                                                                points={areaPoints}
                                                                                                fill={isLightMode ? 'rgba(16, 185, 129, 0.1)' : 'rgba(16, 185, 129, 0.2)'}
                                                                                            />
                                                                                            <polyline
                                                                                                points={points}
                                                                                                fill="none"
                                                                                                stroke="#10b981"
                                                                                                strokeWidth="3"
                                                                                                strokeLinecap="round"
                                                                                                strokeLinejoin="round"
                                                                                            />
                                                                                            {values.map((val, i) => {
                                                                                                const x = padding + (i * stepX);
                                                                                                const y = padding + chartHeight - ((val - minValue) / range) * chartHeight;
                                                                                                return (
                                                                                                    <g key={`point-${i}`}>
                                                                                                        <circle
                                                                                                            cx={x}
                                                                                                            cy={y}
                                                                                                            r="5"
                                                                                                            fill="#10b981"
                                                                                                            stroke={isLightMode ? '#fff' : '#1f2937'}
                                                                                                            strokeWidth="2"
                                                                                                        />
                                                                                                        <text
                                                                                                            x={x}
                                                                                                            y={y - 12}
                                                                                                            textAnchor="middle"
                                                                                                            className={`text-xs font-medium ${isLightMode ? 'fill-gray-900' : 'fill-gray-50'}`}
                                                                                                            fontSize="11"
                                                                                                        >
                                                                                                            {Math.round(val)}
                                                                                                        </text>
                                                                                                    </g>
                                                                                                );
                                                                                            })}
                                                                                        </>
                                                                                    );
                                                                                })()}
                                                                            </svg>
                                                                        </div>
                                                                        
                                                                        {/* Timeline Labels */}
                                                                        <div className="flex justify-between mt-2 px-2">
                                                                            {analytics.authorityHistory.map((h, i) => (
                                                                                <div key={i} className="flex flex-col items-center">
                                                                                    <span className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                        {h.month.split(' ')[0]}
                                                                                    </span>
                                                                                    <span className={`text-xs font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                                                                                        {h.month.split(' ')[1]}
                                                                                    </span>
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {/* Score Milestones and Insights */}
                                                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                                                        {(() => {
                                                                            const scores = analytics.authorityHistory.map(h => h.score);
                                                                            const maxScore = Math.max(...scores);
                                                                            const minScore = Math.min(...scores);
                                                                            const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
                                                                            const currentScore = scores[scores.length - 1];
                                                                            const firstScore = scores[0];
                                                                            
                                                                            return (
                                                                                <>
                                                                                    <div className={`${isLightMode ? 'bg-blue-50' : 'bg-blue-500/20'} rounded-lg p-3`}>
                                                                                        <div className={`text-xs ${isLightMode ? 'text-blue-600' : 'text-blue-400'} mb-1`}>Peak Score</div>
                                                                                        <div className={`text-lg font-bold ${isLightMode ? 'text-blue-900' : 'text-blue-300'}`}>
                                                                                            {Math.round(maxScore)}
                                                                                        </div>
                                                                                        <div className={`text-xs mt-1 ${isLightMode ? 'text-blue-500' : 'text-blue-400'}`}>
                                                                                            {analytics.authorityHistory.find(h => h.score === maxScore)?.month}
                                                                                        </div>
                                                                                    </div>
                                                                                    <div className={`${isLightMode ? 'bg-purple-50' : 'bg-purple-500/20'} rounded-lg p-3`}>
                                                                                        <div className={`text-xs ${isLightMode ? 'text-purple-600' : 'text-purple-400'} mb-1`}>Average Score</div>
                                                                                        <div className={`text-lg font-bold ${isLightMode ? 'text-purple-900' : 'text-purple-300'}`}>
                                                                                            {Math.round(avgScore)}
                                                                                        </div>
                                                                                        <div className={`text-xs mt-1 ${isLightMode ? 'text-purple-500' : 'text-purple-400'}`}>
                                                                                            Over 6 months
                                                                                        </div>
                                                                                    </div>
                                                                                    <div className={`${isLightMode ? 'bg-green-50' : 'bg-green-500/20'} rounded-lg p-3`}>
                                                                                        <div className={`text-xs ${isLightMode ? 'text-green-600' : 'text-green-400'} mb-1`}>Current Score</div>
                                                                                        <div className={`text-lg font-bold ${isLightMode ? 'text-green-900' : 'text-green-300'}`}>
                                                                                            {Math.round(currentScore)}
                                                                                        </div>
                                                                                        <div className={`text-xs mt-1 ${currentScore >= firstScore ? 'text-green-500' : 'text-red-500'}`}>
                                                                                            {currentScore >= firstScore ? ' Growing' : ' Declining'}
                                                                                        </div>
                                                                                    </div>
                                                                                </>
                                                                            );
                                                                        })()}
                                                                    </div>
                                                                    
                                                                    {/* Trend Analysis */}
                                                                    {(() => {
                                                                        const scores = analytics.authorityHistory.map(h => h.score);
                                                                        const recentTrend = scores.slice(-3);
                                                                        const isRising = recentTrend[recentTrend.length - 1] > recentTrend[0];
                                                                        const isStable = Math.abs(recentTrend[recentTrend.length - 1] - recentTrend[0]) < 5;
                                                                        
                                                                        return (
                                                                            <div className={`mt-3 ${isLightMode ? 'bg-gray-50' : 'bg-gray-700/30'} rounded-lg p-3`}>
                                                                                <div className="flex items-center gap-2 mb-2">
                                                                                    <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                                        Recent Trend Analysis
                                                                                    </span>
                                                                                    <span className={`text-lg ${isRising ? 'text-green-500' : isStable ? 'text-yellow-500' : 'text-red-500'}`}>
                                                                                        {isRising ? '' : isStable ? '' : ''}
                                                                                    </span>
                                                                                </div>
                                                                                <p className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                                                    {isRising 
                                                                                        ? `Your authority score is trending upward! Keep creating quality content to maintain this growth.`
                                                                                        : isStable
                                                                                        ? `Your authority score has remained relatively stable. Consider increasing content frequency to boost growth.`
                                                                                        : `Your authority score has declined recently. Focus on creating more engaging content to reverse this trend.`
                                                                                    }
                                                                                </p>
                                                                            </div>
                                                                        );
                                                                    })()}
                                                                </div>
                                                            )}
                                                            
                                                            {/* Smart Recommendations */}
                                                            {(() => {
                                                                const recommendations = getSmartRecommendations(area.name, area, analytics);
                                                                return recommendations.length > 0 ? (
                                                                    <div className={`pt-4 border-t ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                                                        <div className="flex items-center justify-between mb-4">
                                                                            <h4 className={`text-base font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                                 Smart Recommendations
                                                                            </h4>
                                                                            <span className={`text-xs px-2 py-1 rounded-full ${isLightMode ? 'bg-purple-100 text-purple-700' : 'bg-purple-500/20 text-purple-300'}`}>
                                                                                {recommendations.length} suggestions
                                                                            </span>
                                                                        </div>
                                                                        
                                                                        <div className="space-y-3">
                                                                            {recommendations.map((rec, idx) => (
                                                                                <div 
                                                                                    key={idx}
                                                                                    className={`rounded-lg p-4 border-l-4 ${
                                                                                        rec.priority === 'high' 
                                                                                            ? (isLightMode ? 'bg-red-50 border-red-500' : 'bg-red-500/10 border-red-500')
                                                                                            : rec.priority === 'medium'
                                                                                            ? (isLightMode ? 'bg-yellow-50 border-yellow-500' : 'bg-yellow-500/10 border-yellow-500')
                                                                                            : (isLightMode ? 'bg-green-50 border-green-500' : 'bg-green-500/10 border-green-500')
                                                                                    }`}
                                                                                >
                                                                                    <div className="flex items-start justify-between gap-3">
                                                                                        <div className="flex items-start gap-3 flex-1">
                                                                                            <span className="text-2xl">{rec.icon}</span>
                                                                                            <div className="flex-1">
                                                                                                <div className="flex items-center gap-2 mb-1">
                                                                                                    <h5 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                                                        {rec.title}
                                                                                                    </h5>
                                                                                                    <span className={`text-xs px-1.5 py-0.5 rounded ${
                                                                                                        rec.priority === 'high' 
                                                                                                            ? (isLightMode ? 'bg-red-100 text-red-700' : 'bg-red-500/30 text-red-300')
                                                                                                            : rec.priority === 'medium'
                                                                                                            ? (isLightMode ? 'bg-yellow-100 text-yellow-700' : 'bg-yellow-500/30 text-yellow-300')
                                                                                                            : (isLightMode ? 'bg-green-100 text-green-700' : 'bg-green-500/30 text-green-300')
                                                                                                    }`}>
                                                                                                        {rec.priority}
                                                                                                    </span>
                                                                                                </div>
                                                                                                <p className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>
                                                                                                    {rec.description}
                                                                                                </p>
                                                                                            </div>
                                                                                        </div>
                                                                                        <button
                                                                                            onClick={(e) => {
                                                                                                e.stopPropagation();
                                                                                                if (rec.actionType === 'generate') {
                                                                                                    setActiveTab('generator');
                                                                                                    setFormData({
                                                                                                        ...formData,
                                                                                                        topic: rec.topic || area.name,
                                                                                                        expertiseArea: area.name
                                                                                                    });
                                                                                                    setTimeout(() => {
                                                                                                        setActiveGenerator('post-generator');
                                                                                                    }, 100);
                                                                                                } else if (rec.actionType === 'view') {
                                                                                                    // Scroll to top of analytics or show more details
                                                                                                    window.scrollTo({ top: 0, behavior: 'smooth' });
                                                                                                }
                                                                                            }}
                                                                                            className={`px-3 py-1.5 rounded-lg text-xs font-medium transition-all whitespace-nowrap ${
                                                                                                rec.priority === 'high'
                                                                                                    ? (isLightMode ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-red-500 text-white hover:bg-red-600')
                                                                                                    : rec.priority === 'medium'
                                                                                                    ? (isLightMode ? 'bg-yellow-500 text-white hover:bg-yellow-600' : 'bg-yellow-500 text-white hover:bg-yellow-600')
                                                                                                    : (isLightMode ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-green-500 text-white hover:bg-green-600')
                                                                                            }`}
                                                                                        >
                                                                                            {rec.action}
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                        
                                                                        {recommendations.length === 0 && (
                                                                            <div className={`text-center py-6 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                <p className="text-sm">No specific recommendations at this time.</p>
                                                                                <p className="text-xs mt-1">Keep creating quality content to maintain your authority!</p>
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                ) : null;
                                                            })()}
                                                            
                                                            {/* Visual Performance Charts */}
                                                            <div className={`grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                                                
                                                                {/* Content Creation Frequency */}
                                                                {analytics.timeSeriesData && analytics.timeSeriesData.length > 0 && (
                                                                    <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/30'} rounded-lg p-4`}>
                                                                        <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-3`}>
                                                                            Content Creation (Last 30 Days)
                                                                        </h4>
                                                                        <MiniBarChart 
                                                                            data={analytics.timeSeriesData.map(d => ({ value: d.contentCount }))}
                                                                            color="#8b5cf6"
                                                                            height={100}
                                                                        />
                                                                        <div className="flex justify-between text-xs mt-2">
                                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>30d ago</span>
                                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>Today</span>
                                                                        </div>
                                                                    </div>
                                                                )}
                                                                
                                                                {/* Engagement Trend Chart */}
                                                                {analytics.timeSeriesData && analytics.timeSeriesData.length > 0 && (
                                                                    <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/30'} rounded-lg p-4`}>
                                                                        <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-3`}>
                                                                            Engagement Trend (Last 30 Days)
                                                                        </h4>
                                                                        <MiniLineChart 
                                                                            data={analytics.timeSeriesData.map(d => ({ value: d.engagement }))}
                                                                            color="#3b82f6"
                                                                            height={100}
                                                                        />
                                                                        <div className="flex justify-between text-xs mt-2">
                                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>30d ago</span>
                                                                            <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>Today</span>
                                                                        </div>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            
                                                            {/* Related Content List */}
                                                            {(() => {
                                                                const relatedContent = contentHistory.filter(item => {
                                                                    const topic = item.metadata?.topic?.toLowerCase() || '';
                                                                    const expertise = item.metadata?.expertiseArea?.toLowerCase() || item.metadata?.expertise_area?.toLowerCase() || '';
                                                                    const title = item.title?.toLowerCase() || '';
                                                                    const areaNameLower = area.name.toLowerCase();
                                                                    return topic.includes(areaNameLower.split(' ')[0]) || 
                                                                           areaNameLower.includes(topic.split(' ')[0]) ||
                                                                           expertise.includes(areaNameLower) ||
                                                                           title.includes(areaNameLower.split(' ')[0]);
                                                                }).slice(0, 10);
                                                                
                                                                return relatedContent.length > 0 ? (
                                                                    <div>
                                                                        <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>
                                                                            Related Content ({relatedContent.length})
                                                                        </h4>
                                                                        <div className="space-y-2 max-h-64 overflow-y-auto">
                                                                            {relatedContent.map((item) => (
                                                                                <div 
                                                                                    key={item.id} 
                                                                                    className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-3 hover:${isLightMode ? 'bg-gray-100' : 'bg-gray-700'} transition-colors cursor-pointer`}
                                                                                    onClick={() => {
                                                                                        setGeneratedContent(item);
                                                                                        setActiveTab('generator');
                                                                                        setActiveGenerator(item.type || 'post-generator');
                                                                                    }}
                                                                                >
                                                                                    <div className="flex items-start justify-between">
                                                                                        <div className="flex-1">
                                                                                            <div className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1 truncate`}>
                                                                                                {item.title}
                                                                                            </div>
                                                                                            <div className="flex items-center gap-2 text-xs">
                                                                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                                    {item.type || item.metadata?.contentType || 'post'}
                                                                                                </span>
                                                                                                <span className={`${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}></span>
                                                                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                                    {item.metadata?.platforms?.[0] || 'LinkedIn'}
                                                                                                </span>
                                                                                                <span className={`${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}></span>
                                                                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                                    {new Date(item.metadata?.timestamp || item.createdAt || Date.now()).toLocaleDateString()}
                                                                                                </span>
                                                                                            </div>
                                                                                        </div>
                                                                                        <button
                                                                                            onClick={(e) => {
                                                                                                e.stopPropagation();
                                                                                                setGeneratedContent(item);
                                                                                                setActiveTab('generator');
                                                                                                setActiveGenerator(item.type || 'post-generator');
                                                                                            }}
                                                                                            className={`ml-2 px-2 py-1 rounded text-xs font-medium transition-all ${
                                                                                                isLightMode
                                                                                                    ? 'bg-purple-500 text-white hover:bg-purple-600'
                                                                                                    : 'bg-purple-600 text-white hover:bg-purple-700'
                                                                                            }`}
                                                                                        >
                                                                                            View
                                                                                        </button>
                                                                                    </div>
                                                                                </div>
                                                                            ))}
                                                                        </div>
                                                                    </div>
                                                                ) : null;
                                                            })()}
                                                            
                                                            {/* Best Performing Content */}
                                                            {analytics.bestPerforming.length > 0 && (
                                                                <div>
                                                                    <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Top Performing Content</h4>
                                                                    <div className="space-y-2">
                                                                        {analytics.bestPerforming.map((content, idx) => (
                                                                            <div 
                                                                                key={content.id} 
                                                                                className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-700/50'} rounded-lg p-3 flex items-start justify-between cursor-pointer hover:${isLightMode ? 'bg-gray-100' : 'bg-gray-700'} transition-colors`}
                                                                                onClick={() => {
                                                                                    const fullContent = contentHistory.find(c => c.id === content.id);
                                                                                    if (fullContent) {
                                                                                        setGeneratedContent(fullContent);
                                                                                        setActiveTab('generator');
                                                                                        setActiveGenerator(fullContent.type || 'post-generator');
                                                                                    }
                                                                                }}
                                                                            >
                                                                                <div className="flex-1">
                                                                                    <div className="flex items-center gap-2 mb-1">
                                                                                        <span className={`text-xs font-bold ${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                                                                            #{idx + 1}
                                                                                        </span>
                                                                                        <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} truncate`}>
                                                                                            {content.title}
                                                                                        </span>
                                                                                    </div>
                                                                                    <div className="flex items-center gap-2 text-xs">
                                                                                        <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                            {content.type}
                                                                                        </span>
                                                                                        <span className={`${isLightMode ? 'text-gray-400' : 'text-gray-500'}`}></span>
                                                                                        <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                            {content.platform}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                                <div className="text-right ml-3">
                                                                                    <div className={`text-sm font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>
                                                                                        {content.engagement}
                                                                                    </div>
                                                                                    <div className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                                        engagement
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}
                                                            
                                                            {/* Empty State */}
                                                            {analytics.contentCount === 0 && (
                                                                <div className={`${isLightMode ? 'bg-gradient-to-br from-blue-50 to-indigo-50' : 'bg-gradient-to-br from-blue-900/20 to-indigo-900/20'} border-2 ${isLightMode ? 'border-blue-200' : 'border-blue-500/30'} rounded-xl p-8 text-center`}>
                                                                    <div className="w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                                                        <span className="text-3xl"></span>
                                                                    </div>
                                                                    <h4 className={`text-lg font-semibold mb-2 ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                        No Analytics Data Yet
                                                                    </h4>
                                                                    <p className={`text-sm mb-4 ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                                                                        Start creating content related to <span className="font-semibold">{area.name}</span> to see detailed analytics, engagement metrics, and performance insights.
                                                                    </p>
                                                                    
                                                                    {/* Quick Actions */}
                                                                    <div className="flex flex-col sm:flex-row gap-2 justify-center mt-4">
                                                                        <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                setActiveTab('generator');
                                                                                setFormData({
                                                                                    ...formData,
                                                                                    topic: area.name,
                                                                                    expertiseArea: area.name
                                                                                });
                                                                                setTimeout(() => {
                                                                                    setActiveGenerator('post-generator');
                                                                                }, 100);
                                                                            }}
                                                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                                isLightMode
                                                                                    ? 'bg-blue-500 text-white hover:bg-blue-600'
                                                                                    : 'bg-blue-600 text-white hover:bg-blue-700'
                                                                            }`}
                                                                        >
                                                                             Generate First Content
                                                                        </button>
                                                                        <button
                                                                            onClick={(e) => {
                                                                                e.stopPropagation();
                                                                                setActiveTab('generator');
                                                                                setTimeout(() => {
                                                                                    setActiveGenerator('post-generator');
                                                                                }, 100);
                                                                            }}
                                                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                                                                isLightMode
                                                                                    ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                                                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                                            }`}
                                                                        >
                                                                            Explore Generator
                                                                        </button>
                                                                    </div>
                                                                    
                                                                    {/* What You'll See */}
                                                                    <div className={`mt-6 ${isLightMode ? 'bg-white/60' : 'bg-gray-800/40'} rounded-lg p-4 text-left`}>
                                                                        <h5 className={`text-xs font-semibold mb-2 ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                                             Once you create content, you'll see:
                                                                        </h5>
                                                                        <ul className={`space-y-1 text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                                            <li className="flex items-center gap-2">
                                                                                <span></span>
                                                                                <span>Engagement metrics (likes, comments, shares)</span>
                                                                            </li>
                                                                            <li className="flex items-center gap-2">
                                                                                <span></span>
                                                                                <span>View counts and reach</span>
                                                                            </li>
                                                                            <li className="flex items-center gap-2">
                                                                                <span></span>
                                                                                <span>Content performance trends</span>
                                                                            </li>
                                                                            <li className="flex items-center gap-2">
                                                                                <span></span>
                                                                                <span>Authority score progression</span>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            )}
                                                            
                                                            {/* View Full Analytics Button */}
                                                            {analytics.contentCount > 0 && (
                                                                <div className={`pt-4 border-t ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            navigateToAnalyticsWithFilter(area.name);
                                                                        }}
                                                                        className={`w-full py-3 rounded-lg text-sm font-medium transition-all duration-200 ${
                                                                            isLightMode
                                                                                ? 'bg-gradient-to-r from-blue-500 to-indigo-600 text-white hover:from-blue-600 hover:to-indigo-700'
                                                                                : 'bg-gradient-to-r from-blue-600 to-indigo-700 text-white hover:from-blue-700 hover:to-indigo-800'
                                                                        }`}
                                                                    >
                                                                         View Full Analytics for {area.name}
                                                                    </button>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })()}
                                                </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    
                                    <button 
                                        onClick={() => {
                                            setEditingExpertise(null);
                                            setShowExpertiseModal(true);
                                            setExpertiseError(null);
                                        }}
                                        className="w-full mt-6 bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-3 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300"
                                        aria-label="Add new expertise area"
                                    >
                                        <div className="flex items-center justify-center gap-2">
                                            <div className="w-4 h-4"></div>
                                            Add New Expertise Area
                                        </div>
                                    </button>
                                </div>

                                {/* Growth Opportunities */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Growth Opportunities</h2>
                                    
                                    <div className="space-y-4">
                                        {growthOpportunities.length === 0 ? (
                                            <div className={`text-center py-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                No growth opportunities identified. Add more expertise areas to get personalized recommendations.
                                        </div>
                                        ) : (
                                            growthOpportunities.map((opportunity, index) => (
                                                <div 
                                                    key={index}
                                                    className={`${
                                                        opportunity.type === 'Emerging Topic' 
                                                            ? 'bg-purple-500/20 border-purple-500/50' 
                                                            : 'bg-blue-500/20 border-blue-500/50'
                                                    } border rounded-lg p-6`}
                                                >
                                                    <h3 className={`font-semibold ${
                                                        opportunity.type === 'Emerging Topic' 
                                                            ? 'text-purple-400' 
                                                            : 'text-blue-400'
                                                    } mb-2`}>{opportunity.type}</h3>
                                                    <p className={`${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2 font-medium`}>{opportunity.title}</p>
                                                    <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{opportunity.description}</p>
                                        </div>
                                            ))
                                        )}
                                    </div>
                                </div>

                                {/* Content Strategy */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Content Strategy</h2>
                                    
                                    <div className="space-y-3">
                                        {contentStrategy.length === 0 ? (
                                            <div className={`text-center py-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                Add expertise areas to get personalized content strategy recommendations.
                                        </div>
                                        ) : (
                                            contentStrategy.map((strategy, index) => (
                                                <div key={index} className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-purple-500 rounded-full mt-2 flex-shrink-0"></div>
                                                    <p className={`${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>{strategy}</p>
                                        </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Quick Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Actions</h3>
                                    <div className="space-y-3">
                                        <button 
                                            onClick={() => {
                                                if (expertiseAreas.length === 0) {
                                                    alert('No expertise areas to update. Please add an expertise area first.');
                                                    return;
                                                }
                                                // If only one area, edit it directly. If multiple, edit the first one (could be enhanced to show selection)
                                                if (expertiseAreas.length === 1) {
                                                    handleEditExpertise(expertiseAreas[0]);
                                                } else {
                                                    // For multiple areas, edit the first one (can be enhanced later with selection)
                                                    handleEditExpertise(expertiseAreas[0]);
                                                }
                                            }}
                                            disabled={expertiseAreas.length === 0}
                                            className={`w-full py-2 rounded-lg font-medium transition-colors duration-200 ${
                                                expertiseAreas.length === 0
                                                    ? 'bg-gray-400 text-gray-200 cursor-not-allowed'
                                                    : 'bg-blue-600 text-white hover:bg-blue-700'
                                            }`}
                                        >
                                            Update Expertise Level
                                        </button>
                                        <button 
                                            onClick={() => {
                                                setEditingExpertise(null);
                                                setShowExpertiseModal(true);
                                                setExpertiseError(null);
                                            }}
                                            className="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200"
                                        >
                                            Add New Skill
                                        </button>
                                        <button 
                                            onClick={() => {
                                                setActiveTab('generator');
                                                // Scroll to content history section if it exists
                                                setTimeout(() => {
                                                    const contentHistorySection = document.querySelector('[data-content-history]');
                                                    if (contentHistorySection) {
                                                        contentHistorySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                                    }
                                                }, 100);
                                            }}
                                            className="w-full bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200"
                                        >
                                            View Content History
                                        </button>
                                    </div>
                                </div>

                                {/* Comparison View */}
                                {showComparisonView && selectedForComparison.size > 0 && (() => {
                                    const comparedAreas = expertiseAreas.filter(area => selectedForComparison.has(area.id));
                                    const comparisonData = comparedAreas.map(area => {
                                        const analytics = getExpertiseAreaAnalytics(area.name);
                                        return {
                                            area,
                                            analytics,
                                            quickStats: getQuickStats(area.name)
                                        };
                                    });
                                    
                                    return (
                                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                            <div className="flex items-center justify-between mb-6">
                                                <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                     Comparison View
                                                </h2>
                                                <button
                                                    onClick={() => setShowComparisonView(false)}
                                                    className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${
                                                        isLightMode
                                                            ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                                    }`}
                                                >
                                                    Close
                                                </button>
                                            </div>
                                            
                                            {/* Comparison Table */}
                                            <div className="overflow-x-auto mb-6">
                                                <table className="w-full">
                                                    <thead>
                                                        <tr className={`border-b ${isLightMode ? 'border-gray-200' : 'border-gray-700'}`}>
                                                            <th className={`text-left py-3 px-4 text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>Expertise Area</th>
                                                            <th className={`text-center py-3 px-4 text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>Authority Score</th>
                                                            <th className={`text-center py-3 px-4 text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>Content Count</th>
                                                            <th className={`text-center py-3 px-4 text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>Avg Engagement</th>
                                                            <th className={`text-center py-3 px-4 text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>Engagement Rate</th>
                                                            <th className={`text-center py-3 px-4 text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>Total Views</th>
                                                            <th className={`text-center py-3 px-4 text-sm font-semibold ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>Level</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {comparisonData.map(({ area, analytics, quickStats }, idx) => {
                                                            const maxScore = Math.max(...comparisonData.map(d => d.area.authorityScore));
                                                            const maxContent = Math.max(...comparisonData.map(d => d.analytics.contentCount));
                                                            const maxEngagement = Math.max(...comparisonData.map(d => d.quickStats.avgEngagement || 0));
                                                            
                                                            return (
                                                                <tr key={area.id} className={`border-b ${isLightMode ? 'border-gray-100' : 'border-gray-800'} hover:${isLightMode ? 'bg-gray-50' : 'bg-gray-800/50'}`}>
                                                                    <td className="py-3 px-4">
                                                                        <div className="flex items-center gap-2">
                                                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                                {area.name}
                                                                            </span>
                                                                        </div>
                                                                    </td>
                                                                    <td className="py-3 px-4 text-center">
                                                                        <div className="flex flex-col items-center">
                                                                            <span className={`text-sm font-bold ${getAuthorityColor(area.authorityScore)}`}>
                                                                                {area.authorityScore}
                                                                            </span>
                                                                            <div className={`w-20 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5 mt-1`}>
                                                                                <div 
                                                                                    className={`h-1.5 rounded-full ${
                                                                                        area.authorityScore >= 80 ? 'bg-green-500' : 
                                                                                        area.authorityScore >= 60 ? 'bg-yellow-500' : 'bg-red-500'
                                                                                    }`}
                                                                                    style={{ width: `${(area.authorityScore / maxScore) * 100}%` }}
                                                                                ></div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td className="py-3 px-4 text-center">
                                                                        <div className="flex flex-col items-center">
                                                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                                {analytics.contentCount}
                                                                            </span>
                                                                            <div className={`w-20 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5 mt-1`}>
                                                                                <div 
                                                                                    className="h-1.5 rounded-full bg-purple-500"
                                                                                    style={{ width: `${maxContent > 0 ? (analytics.contentCount / maxContent) * 100 : 0}%` }}
                                                                                ></div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td className="py-3 px-4 text-center">
                                                                        <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                            {quickStats.avgEngagement || 0}
                                                                        </span>
                                                                    </td>
                                                                    <td className="py-3 px-4 text-center">
                                                                        <span className={`text-sm font-medium ${
                                                                            analytics.engagementRate >= 5 ? 'text-green-500' :
                                                                            analytics.engagementRate >= 3 ? 'text-yellow-500' : 'text-red-500'
                                                                        }`}>
                                                                            {analytics.engagementRate.toFixed(1)}%
                                                                        </span>
                                                                    </td>
                                                                    <td className="py-3 px-4 text-center">
                                                                        <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                            {quickStats.totalViews > 1000 
                                                                                ? (quickStats.totalViews / 1000).toFixed(1) + 'K'
                                                                                : quickStats.totalViews}
                                                                        </span>
                                                                    </td>
                                                                    <td className="py-3 px-4 text-center">
                                                                        <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${
                                                                            area.level === 'Expert' ? (isLightMode ? 'bg-purple-100 text-purple-700' : 'bg-purple-500/30 text-purple-300') :
                                                                            area.level === 'Advanced' ? (isLightMode ? 'bg-blue-100 text-blue-700' : 'bg-blue-500/30 text-blue-300') :
                                                                            area.level === 'Intermediate' ? (isLightMode ? 'bg-yellow-100 text-yellow-700' : 'bg-yellow-500/30 text-yellow-300') :
                                                                            (isLightMode ? 'bg-gray-100 text-gray-700' : 'bg-gray-500/30 text-gray-300')
                                                                        }`}>
                                                                            {area.level}
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })}
                                                    </tbody>
                                                </table>
                                            </div>
                                            
                                            {/* Comparison Charts */}
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                                {/* Authority Score Comparison Bar Chart */}
                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-800/50'} rounded-lg p-4`}>
                                                    <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-3`}>
                                                        Authority Score Comparison
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {comparisonData.map(({ area }) => {
                                                            const maxScore = Math.max(...comparisonData.map(d => d.area.authorityScore));
                                                            return (
                                                                <div key={area.id}>
                                                                    <div className="flex items-center justify-between mb-1">
                                                                        <span className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                                            {area.name}
                                                                        </span>
                                                                        <span className={`text-xs font-medium ${getAuthorityColor(area.authorityScore)}`}>
                                                                            {area.authorityScore}
                                                                        </span>
                                                                    </div>
                                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-3`}>
                                                                        <div 
                                                                            className={`h-3 rounded-full ${
                                                                                area.authorityScore >= 80 ? 'bg-green-500' : 
                                                                                area.authorityScore >= 60 ? 'bg-yellow-500' : 'bg-red-500'
                                                                            }`}
                                                                            style={{ width: `${(area.authorityScore / maxScore) * 100}%` }}
                                                                        ></div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                                
                                                {/* Content Count Comparison */}
                                                <div className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-800/50'} rounded-lg p-4`}>
                                                    <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-3`}>
                                                        Content Count Comparison
                                                    </h4>
                                                    <div className="space-y-2">
                                                        {comparisonData.map(({ area, analytics }) => {
                                                            const maxContent = Math.max(...comparisonData.map(d => d.analytics.contentCount));
                                                            return (
                                                                <div key={area.id}>
                                                                    <div className="flex items-center justify-between mb-1">
                                                                        <span className={`text-xs ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                                            {area.name}
                                                                        </span>
                                                                        <span className={`text-xs font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                            {analytics.contentCount}
                                                                        </span>
                                                                    </div>
                                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-3`}>
                                                                        <div 
                                                                            className="h-3 rounded-full bg-purple-500"
                                                                            style={{ width: `${maxContent > 0 ? (analytics.contentCount / maxContent) * 100 : 0}%` }}
                                                                        ></div>
                                                                    </div>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {/* Key Insights */}
                                            <div className={`${isLightMode ? 'bg-blue-50' : 'bg-blue-500/10'} rounded-lg p-4 border-l-4 border-blue-500`}>
                                                <h4 className={`text-sm font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>
                                                     Comparison Insights
                                                </h4>
                                                <ul className={`space-y-1 text-xs ${isLightMode ? 'text-gray-700' : 'text-gray-300'}`}>
                                                    {(() => {
                                                        const insights = [];
                                                        const topAuthority = comparisonData.reduce((max, d) => 
                                                            d.area.authorityScore > max.area.authorityScore ? d : max
                                                        );
                                                        const topContent = comparisonData.reduce((max, d) => 
                                                            d.analytics.contentCount > max.analytics.contentCount ? d : max
                                                        );
                                                        const topEngagement = comparisonData.reduce((max, d) => 
                                                            (d.quickStats.avgEngagement || 0) > (max.quickStats.avgEngagement || 0) ? d : max
                                                        );
                                                        
                                                        insights.push(` ${topAuthority.area.name} has the highest authority score (${topAuthority.area.authorityScore})`);
                                                        insights.push(` ${topContent.area.name} has the most content (${topContent.analytics.contentCount} pieces)`);
                                                        if (topEngagement.quickStats.avgEngagement > 0) {
                                                            insights.push(` ${topEngagement.area.name} has the best engagement (${topEngagement.quickStats.avgEngagement} avg)`);
                                                        }
                                                        
                                                        return insights;
                                                    })().map((insight, idx) => (
                                                        <li key={idx} className="flex items-start gap-2">
                                                            <span></span>
                                                            <span>{insight}</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Expertise Performance Ranking */}
                                {expertiseAreas.length > 0 && (() => {
                                    const performanceRanking = expertiseAreas.map(area => {
                                        const summary = getExpertiseAnalyticsSummary(area.name);
                                        return {
                                            area,
                                            summary,
                                            score: area.authorityScore * 0.4 + (summary.engagementRate || 0) * 0.3 + (summary.totalContent || 0) * 0.3
                                        };
                                    }).sort((a, b) => b.score - a.score).slice(0, 5);
                                    
                                    return (
                                        <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                            <div className="flex items-center justify-between mb-4">
                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                     Top Performing Expertise
                                                </h3>
                                                <button
                                                    onClick={() => navigateToAnalyticsWithFilter(null)}
                                                    className={`text-xs px-2 py-1 rounded ${isLightMode ? 'text-blue-600 hover:bg-blue-50' : 'text-blue-400 hover:bg-blue-500/20'}`}
                                                >
                                                    View All 
                                                </button>
                                            </div>
                                            <div className="space-y-3">
                                                {performanceRanking.map((item, idx) => (
                                                    <div 
                                                        key={item.area.id}
                                                        className={`${isLightMode ? 'bg-gray-50' : 'bg-gray-800/50'} rounded-lg p-3 cursor-pointer hover:${isLightMode ? 'bg-gray-100' : 'bg-gray-800'} transition-colors`}
                                                        onClick={() => navigateToAnalyticsWithFilter(item.area.name)}
                                                    >
                                                        <div className="flex items-center justify-between mb-2">
                                                            <div className="flex items-center gap-2">
                                                                <span className={`text-lg font-bold ${idx === 0 ? 'text-yellow-500' : idx === 1 ? 'text-gray-400' : idx === 2 ? 'text-orange-600' : 'text-gray-500'}`}>
                                                                    #{idx + 1}
                                                                </span>
                                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                    {item.area.name}
                                                                </span>
                                                            </div>
                                                            <span className={`text-xs font-bold ${getAuthorityColor(item.area.authorityScore)}`}>
                                                                {item.area.authorityScore}
                                                            </span>
                                                        </div>
                                                        <div className="grid grid-cols-3 gap-2 text-xs">
                                                            <div>
                                                                <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>Content: </span>
                                                                <span className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                    {item.summary.totalContent}
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>Engagement: </span>
                                                                <span className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                    {item.summary.engagementRate.toFixed(1)}%
                                                                </span>
                                                            </div>
                                                            <div>
                                                                <span className={isLightMode ? 'text-gray-500' : 'text-gray-400'}>Views: </span>
                                                                <span className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                                    {item.summary.totalViews > 1000 
                                                                        ? (item.summary.totalViews / 1000).toFixed(1) + 'K'
                                                                        : item.summary.totalViews}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })()}

                                {/* Authority Insights */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Authority Insights</h3>
                                    <div className="space-y-4">
                                        <div className="text-center">
                                            <div className={`text-3xl font-bold mb-2 ${
                                                (authorityInsights.overallAuthority || 0) >= 80 ? 'text-green-400' : 
                                                (authorityInsights.overallAuthority || 0) >= 60 ? 'text-yellow-400' : 'text-red-400'
                                            }`}>
                                                {authorityInsights.overallAuthority || 0}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Overall Authority</div>
                                        </div>
                                        <div className="space-y-2">
                                            <div className="flex justify-between text-sm">
                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Content Consistency</span>
                                                <span className={`${
                                                    (authorityInsights.contentConsistency || 0) >= 80 ? 'text-green-400' : 
                                                    (authorityInsights.contentConsistency || 0) >= 60 ? 'text-yellow-400' : 'text-red-400'
                                                }`}>
                                                    {authorityInsights.contentConsistency || 0}%
                                                </span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Trend Alignment</span>
                                                <span className={`${
                                                    (authorityInsights.trendAlignment || 0) >= 80 ? 'text-green-400' : 
                                                    (authorityInsights.trendAlignment || 0) >= 60 ? 'text-blue-400' : 'text-yellow-400'
                                                }`}>
                                                    {authorityInsights.trendAlignment || 0}%
                                                </span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Engagement Quality</span>
                                                <span className={`${
                                                    (authorityInsights.engagementQuality || 0) >= 80 ? 'text-green-400' : 
                                                    (authorityInsights.engagementQuality || 0) >= 60 ? 'text-purple-400' : 'text-yellow-400'
                                                }`}>
                                                    {authorityInsights.engagementQuality || 0}%
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Expertise Comparison Chart */}
                                {expertiseAreas.length > 1 && (
                                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Area Comparison</h3>
                                        <ExpertiseComparisonChart />
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {activeTab === 'calendar' && (
                        <div className="space-y-8">
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                <div className="flex items-center justify-between mb-6">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Calendar & Post Queue</h2>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        {/* LinkedIn Connection Status */}
                                        {(() => {
                                            const linkedInProfile = window.LinkedInService?.getCachedProfile();
                                            const isConnected = linkedInProfile && linkedInProfile.id;
                                            return (
                                                <div className={`flex items-center gap-2 px-3 py-1 rounded-lg text-sm ${
                                                    isConnected
                                                        ? isLightMode ? 'bg-green-100 text-green-700' : 'bg-green-500/20 text-green-400'
                                                        : isLightMode ? 'bg-yellow-100 text-yellow-700' : 'bg-yellow-500/20 text-yellow-400'
                                                }`}>
                                                    <span>{isConnected ? '' : ''}</span>
                                                    <span>{isConnected ? 'LinkedIn Connected' : 'LinkedIn Not Connected'}</span>
                                                </div>
                                            );
                                        })()}
                                        <button
                                            onClick={() => setCalendarView('month')}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                calendarView === 'month'
                                                    ? 'bg-gradient-to-r from-orange-500 to-red-600 text-white'
                                                    : isLightMode
                                                        ? 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                                        : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                            }`}
                                        >
                                            Month
                                        </button>
                                        <button
                                            onClick={() => setShowScheduleModal(true)}
                                            className="px-4 py-2 rounded-lg font-medium bg-gradient-to-r from-orange-500 to-red-600 text-white hover:from-orange-600 hover:to-red-700 transition-all"
                                        >
                                            + Schedule Post
                                        </button>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Calendar View */}
                                    <div>
                                        {calendarView === 'month' && (
                                            <MonthView
                                                selectedDate={selectedDate}
                                                setSelectedDate={setSelectedDate}
                                                scheduledPosts={scheduledPosts}
                                                onDateClick={(date) => {
                                                    setSelectedDate(date);
                                                    setCalendarView('day');
                                                }}
                                                isLightMode={isLightMode}
                                            />
                                        )}
                                        {calendarView === 'day' && (
                                            <div className="space-y-4">
                                                <button
                                                    onClick={() => setCalendarView('month')}
                                                    className={`px-4 py-2 rounded-lg font-medium ${isLightMode ? 'bg-gray-200 hover:bg-gray-300' : 'bg-gray-700 hover:bg-gray-600'} transition-colors mb-4`}
                                                >
                                                     Back to Month
                                                </button>
                                                <DayView
                                                    date={selectedDate}
                                                    scheduledPosts={scheduledPosts}
                                                    onPostClick={(post) => {
                                                        setSelectedPost(post);
                                                        setShowScheduleModal(true);
                                                        setScheduleModalContent({
                                                            content: post.content,
                                                            title: post.title,
                                                            type: post.contentType,
                                                            id: post.id
                                                        });
                                                    }}
                                                    isLightMode={isLightMode}
                                                />
                                            </div>
                                        )}
                                    </div>

                                    {/* Post Queue */}
                                    <div>
                                        <PostQueueComponent
                                            scheduledPosts={scheduledPosts}
                                            filters={queueFilters}
                                            setFilters={setQueueFilters}
                                            onPostClick={(post) => {
                                                setSelectedPost(post);
                                                setShowScheduleModal(true);
                                                setScheduleModalContent({
                                                    content: post.content,
                                                    title: post.title,
                                                    type: post.contentType,
                                                    id: post.id
                                                });
                                            }}
                                            onDelete={(id) => {
                                                deleteScheduledPost(id);
                                            }}
                                            onEdit={(post) => {
                                                setSelectedPost(post);
                                                setScheduleModalContent({
                                                    content: post.content,
                                                    title: post.title,
                                                    type: post.contentType,
                                                    id: post.id
                                                });
                                                setShowScheduleModal(true);
                                            }}
                                            publishLinkedInPost={publishLinkedInPost}
                                            updateScheduledPost={updateScheduledPost}
                                            isLightMode={isLightMode}
                                        />
                                    </div>
                                </div>

                                {/* Statistics */}
                                <div className={`${isLightMode ? 'bg-white/30 border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-xl p-6 mt-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Statistics</h3>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-blue-600' : 'text-blue-400'} mb-1`}>
                                                {scheduledPosts.filter(p => p.status === 'draft').length}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Drafts</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-yellow-600' : 'text-yellow-400'} mb-1`}>
                                                {scheduledPosts.filter(p => p.status === 'scheduled').length}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Scheduled</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-green-600' : 'text-green-400'} mb-1`}>
                                                {scheduledPosts.filter(p => p.status === 'published').length}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Published</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-red-600' : 'text-red-400'} mb-1`}>
                                                {scheduledPosts.filter(p => p.status === 'failed').length}
                                            </div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Failed</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'analytics' && (
                        <AnalyticsTab isLightMode={isLightMode} />
                    )}
                </div>
            );
        };

        // Render Content Engine when content-engine-content is shown
        window.renderContentEngine = function() {
            console.log('renderContentEngine called');
            const container = document.getElementById('content-engine-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    // Reuse existing root if it exists to avoid React warnings
                    if (window.contentEngineRoot) {
                        console.log('Reusing existing React root and rendering Content Engine for Thought Leadership...');
                        window.contentEngineRoot.render(<ContentEngine />);
                        console.log('Content Engine for Thought Leadership rendered successfully');
                    } else {
                        console.log('Creating React root and rendering Content Engine for Thought Leadership...');
                        window.contentEngineRoot = ReactDOM.createRoot(container);
                        window.contentEngineRoot.render(<ContentEngine />);
                        console.log('Content Engine for Thought Leadership rendered successfully');
                    }
                } catch (error) {
                    console.error('Error rendering Content Engine for Thought Leadership:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Content Engine for Thought Leadership</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('content-engine-container not found');
            }
        };

        // AI-Generated Career Portfolio/Microsite React Component
        const AIPortfolio = () => {
            const [step, setStep] = useState('onboarding');
            const [selectedTemplate, setSelectedTemplate] = useState(null);
            const [portfolioBlocks, setPortfolioBlocks] = useState([]);
            const [activeBlock, setActiveBlock] = useState(null);
            const [previewDevice, setPreviewDevice] = useState('desktop');
            const [isGenerating, setIsGenerating] = useState(false);
            const [uploadedFile, setUploadedFile] = useState(null);
            const [importStatus, setImportStatus] = useState('');
            const [portfolioUrl, setPortfolioUrl] = useState('');
            const [customDomain, setCustomDomain] = useState('');
            const [seoSettings, setSeoSettings] = useState({
                title: '',
                description: '',
                keywords: ''
            });
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');
            const [projects, setProjects] = useState([]);
            const [showAddProject, setShowAddProject] = useState(false);
            const [newProject, setNewProject] = useState({
                title: '',
                description: '',
                technologies: [],
                imageUrl: '',
                liveUrl: '',
                githubUrl: '',
                featured: false
            });

            const templates = [
                {
                    id: 1,
                    name: 'Executive Professional',
                    category: 'Corporate',
                    preview: 'Professional blue theme with clean layout',
                    description: 'Perfect for executives and senior professionals',
                    blocks: ['Header', 'About', 'Experience', 'Skills', 'Contact'],
                    gradient: 'from-blue-500 to-indigo-600'
                },
                {
                    id: 2,
                    name: 'Developer Portfolio',
                    category: 'Tech',
                    preview: 'Dark theme with code focus',
                    description: 'Ideal for software developers and engineers',
                    blocks: ['Header', 'About', 'Projects', 'Skills', 'Experience', 'Contact'],
                    gradient: 'from-gray-600 to-gray-800'
                },
                {
                    id: 3,
                    name: 'Creative Showcase',
                    category: 'Creative',
                    preview: 'Purple-pink theme for visual professionals',
                    description: 'Great for designers and creative professionals',
                    blocks: ['Header', 'About', 'Portfolio', 'Skills', 'Testimonials', 'Contact'],
                    gradient: 'from-purple-500 to-pink-500'
                },
                {
                    id: 4,
                    name: 'Clean Minimal',
                    category: 'Minimalist',
                    preview: 'Clean gray theme',
                    description: 'Simple and clean for any professional',
                    blocks: ['Header', 'About', 'Experience', 'Contact'],
                    gradient: 'from-gray-400 to-gray-600'
                }
            ];

            const blockLibrary = [
                {
                    id: 'header',
                    type: 'Header',
                    icon: '',
                    description: 'Name, title, and hero image'
                },
                {
                    id: 'about',
                    type: 'About',
                    icon: '',
                    description: 'Professional summary and bio'
                },
                {
                    id: 'projects',
                    type: 'Projects',
                    icon: '',
                    description: 'Portfolio showcase'
                },
                {
                    id: 'skills',
                    type: 'Skills',
                    icon: '',
                    description: 'Technical and soft skills'
                },
                {
                    id: 'experience',
                    type: 'Experience',
                    icon: '',
                    description: 'Work history and achievements'
                },
                {
                    id: 'testimonials',
                    type: 'Testimonials',
                    icon: '',
                    description: 'Client recommendations'
                },
                {
                    id: 'contact',
                    type: 'Contact',
                    icon: '',
                    description: 'Contact information'
                }
            ];

            const mockProjects = [
                {
                    id: 1,
                    title: 'E-Commerce Platform',
                    description: 'Full-stack e-commerce solution with React and Node.js',
                    technologies: ['React', 'Node.js', 'MongoDB', 'Stripe'],
                    imageUrl: '/api/placeholder/400/300',
                    liveUrl: 'https://example.com',
                    githubUrl: 'https://github.com/example',
                    featured: true
                },
                {
                    id: 2,
                    title: 'Task Management App',
                    description: 'Collaborative task management with real-time updates',
                    technologies: ['Vue.js', 'Firebase', 'Tailwind CSS'],
                    imageUrl: '/api/placeholder/400/300',
                    liveUrl: 'https://example.com',
                    githubUrl: 'https://github.com/example',
                    featured: false
                }
            ];

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        alert('File size must be less than 5MB');
                        return;
                    }
                    if (!['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/msword'].includes(file.type)) {
                        alert('Only PDF, DOCX, and DOC files are allowed');
                        return;
                    }
                    setUploadedFile(file);
                    setImportStatus('uploading');
                    
                    // Simulate processing
                    setTimeout(() => {
                        setImportStatus('processing');
                        setTimeout(() => {
                            setImportStatus('success');
                        }, 2000);
                    }, 1000);
                }
            };

            const handleTemplateSelect = (template) => {
                setSelectedTemplate(template);
            };

            const handleGeneratePortfolio = () => {
                setIsGenerating(true);
                
                // Simulate AI generation
                setTimeout(() => {
                    setPortfolioBlocks(blockLibrary);
                    setPortfolioUrl('https://portfolio.example.com');
                    setIsGenerating(false);
                    setStep('editor');
                }, 3000);
            };

            const handleAddBlock = (block) => {
                const newBlock = {
                    id: Date.now(),
                    type: block.type,
                    title: block.type,
                    content: `Sample ${block.type} content`,
                    position: portfolioBlocks.length,
                    visible: true
                };
                setPortfolioBlocks([...portfolioBlocks, newBlock]);
            };

            const handlePreviewDevice = (device) => {
                setPreviewDevice(device);
            };

            const handlePublish = () => {
                setStep('publish');
            };

            const getDeviceSize = () => {
                switch (previewDevice) {
                    case 'mobile':
                        return 'w-80';
                    case 'tablet':
                        return 'w-96';
                    case 'desktop':
                        return 'w-full max-w-4xl';
                    default:
                        return 'w-full max-w-4xl';
                }
            };

            return (
                <div className="space-y-8">

                    {/* Progress Indicator */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                        <div className="flex items-center justify-between mb-4">
                            <h2 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Portfolio Creation Progress</h2>
                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                {step === 'onboarding' && 'Step 1 of 6'}
                                {step === 'import' && 'Step 2 of 6'}
                                {step === 'template' && 'Step 3 of 6'}
                                {step === 'editor' && 'Step 4 of 6'}
                                {step === 'preview' && 'Step 5 of 6'}
                                {step === 'publish' && 'Step 6 of 6'}
                            </span>
                        </div>
                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                            <div 
                                className="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-500"
                                style={{ 
                                    width: step === 'onboarding' ? '16.67%' :
                                           step === 'import' ? '33.33%' :
                                           step === 'template' ? '50%' :
                                           step === 'editor' ? '66.67%' :
                                           step === 'preview' ? '83.33%' : '100%'
                                }}
                            ></div>
                        </div>
                    </div>

                    {/* Step Content */}
                    {step === 'onboarding' && (
                        <div className="text-center py-20">
                            <div className="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-8">
                                <div className="w-10 h-10 text-white text-4xl"></div>
                            </div>
                            <h2 className={`text-4xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Build Your Professional Portfolio in Minutes</h2>
                            <p className={`text-xl ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-12 max-w-3xl mx-auto`}>
                                Our AI analyzes your resume and professional data to create a stunning, personalized portfolio website that showcases your expertise and achievements.
                            </p>
                            
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="w-16 h-16 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <div className="w-8 h-8 text-white text-2xl"></div>
                                    </div>
                                    <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Import Your Data</h3>
                                    <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>Upload your resume or connect your LinkedIn profile to get started</p>
                                </div>
                                
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="w-16 h-16 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <div className="w-8 h-8 text-white text-2xl"></div>
                                    </div>
                                    <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Choose Your Style</h3>
                                    <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>Select from professional templates designed for your industry</p>
                                </div>
                                
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <div className="w-8 h-8 text-white text-2xl"></div>
                                    </div>
                                    <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>AI Generates</h3>
                                    <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>Get a complete portfolio ready to publish in minutes</p>
                                </div>
                            </div>
                            
                            <button
                                onClick={() => setStep('import')}
                                className="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-4 rounded-lg font-semibold text-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 hover:transform hover:scale-105"
                            >
                                Start Building My Portfolio
                            </button>
                        </div>
                    )}

                    {step === 'import' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Resume Upload */}
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                                        <div className="w-5 h-5 text-white text-xl"></div>
                                    </div>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Upload Your Resume</h2>
                                </div>
                                
                                <div className={`border-2 border-dashed ${isLightMode ? 'border-gray-300' : 'border-gray-600'} rounded-lg p-8 text-center hover:border-blue-500 transition-colors duration-300`}>
                                    <div className="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <div className="w-8 h-8 text-white text-2xl"></div>
                                    </div>
                                    <h3 className={`text-lg font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Drop your resume here</h3>
                                    <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-4`}>PDF, DOCX, or DOC files only (max 5MB)</p>
                                    <input
                                        type="file"
                                        accept=".pdf,.docx,.doc"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                        id="resume-upload"
                                    />
                                    <label
                                        htmlFor="resume-upload"
                                        className="inline-flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300 cursor-pointer"
                                    >
                                        <div className="w-4 h-4"></div>
                                        Choose File
                                    </label>
                                    
                                    {uploadedFile && (
                                        <div className="mt-4">
                                            {importStatus === 'uploading' && (
                                                <div className={`p-3 ${isLightMode ? 'bg-yellow-100 border-yellow-300' : 'bg-yellow-500/20 border-yellow-500/50'} border rounded-lg`}>
                                                    <div className={`flex items-center gap-2 ${isLightMode ? 'text-yellow-700' : 'text-yellow-400'}`}>
                                                        <div className="w-4 h-4 animate-spin"></div>
                                                        <span className="text-sm font-medium">Uploading...</span>
                                                    </div>
                                                </div>
                                            )}
                                            {importStatus === 'processing' && (
                                                <div className={`p-3 ${isLightMode ? 'bg-blue-100 border-blue-300' : 'bg-blue-500/20 border-blue-500/50'} border rounded-lg`}>
                                                    <div className={`flex items-center gap-2 ${isLightMode ? 'text-blue-700' : 'text-blue-400'}`}>
                                                        <div className="w-4 h-4 animate-spin"></div>
                                                        <span className="text-sm font-medium">Processing resume...</span>
                                                    </div>
                                                </div>
                                            )}
                                            {importStatus === 'success' && (
                                                <div className={`p-3 ${isLightMode ? 'bg-green-100 border-green-300' : 'bg-green-500/20 border-green-500/50'} border rounded-lg`}>
                                                    <div className={`flex items-center gap-2 ${isLightMode ? 'text-green-700' : 'text-green-400'}`}>
                                                        <div className="w-4 h-4"></div>
                                                        <span className="text-sm font-medium">{uploadedFile.name} processed successfully</span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Social Integration */}
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                        <div className="w-5 h-5 text-white text-xl"></div>
                                    </div>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Social Integration</h2>
                                </div>
                                
                                <div className="space-y-4">
                                    <button className="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center gap-2">
                                        <div className="w-4 h-4"></div>
                                        Connect LinkedIn
                                    </button>
                                    
                                    <button className="w-full bg-gray-600 text-white py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors duration-200 flex items-center justify-center gap-2">
                                        <div className="w-4 h-4"></div>
                                        Connect GitHub
                                    </button>
                                    
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Portfolio URL</label>
                                        <input
                                            type="url"
                                            placeholder="https://yourportfolio.com"
                                            className={`w-full px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            <div className="lg:col-span-2 text-center">
                                <button
                                    onClick={() => setStep('template')}
                                    disabled={!uploadedFile && importStatus !== 'success'}
                                    className="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-4 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    Continue to Templates
                                </button>
                            </div>
                        </div>
                    )}

                    {step === 'template' && (
                        <div className="space-y-8">
                            <div className="text-center">
                                <h2 className={`text-3xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Choose Your Template</h2>
                                <p className={`text-xl ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Select a professional template that matches your industry and style</p>
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {templates.map((template) => (
                                    <div
                                        key={template.id}
                                        onClick={() => handleTemplateSelect(template)}
                                        className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6 cursor-pointer transition-all duration-300 hover:scale-105 ${
                                            selectedTemplate?.id === template.id 
                                                ? 'border-blue-500 ring-2 ring-blue-500/50' 
                                                : 'hover:border-blue-500/50'
                                        }`}
                                    >
                                        <div className={`w-full h-32 bg-gradient-to-r ${template.gradient} rounded-lg mb-4 flex items-center justify-center`}>
                                            <div className="text-white text-2xl"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{template.name}</h3>
                                        <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-3`}>{template.description}</p>
                                        <div className="flex flex-wrap gap-1">
                                            {template.blocks.map((block, index) => (
                                                <span key={index} className={`px-2 py-1 ${isLightMode ? 'bg-gray-200 text-gray-700' : 'bg-gray-700 text-gray-300'} text-xs rounded`}>
                                                    {block}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            {selectedTemplate && (
                                <div className="text-center">
                                    <button
                                        onClick={handleGeneratePortfolio}
                                        disabled={isGenerating}
                                        className="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-8 py-4 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        {isGenerating ? (
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4 animate-spin"></div>
                                                Generating Portfolio...
                                            </div>
                                        ) : (
                                            <div className="flex items-center gap-2">
                                                <div className="w-4 h-4"></div>
                                                Generate My Portfolio
                                            </div>
                                        )}
                                    </button>
                                </div>
                            )}
                        </div>
                    )}

                    {step === 'editor' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Left Sidebar - Block Library */}
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                <div className="flex items-center gap-3 mb-6">
                                    <div className="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                        <div className="w-4 h-4 text-white text-lg"></div>
                                    </div>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Block Library</h3>
                                </div>
                                
                                <div className="space-y-3">
                                    {blockLibrary.map((block) => (
                                        <div
                                            key={block.id}
                                            onClick={() => handleAddBlock(block)}
                                            className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4 cursor-pointer hover:border-blue-500/50 transition-all duration-300`}
                                        >
                                            <div className="flex items-center gap-3">
                                                <div className="text-2xl">{block.icon}</div>
                                                <div>
                                                    <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{block.type}</h4>
                                                    <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>{block.description}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className={`mt-6 p-4 ${isLightMode ? 'bg-purple-100 border-purple-300' : 'bg-purple-500/20 border-purple-500/50'} border rounded-lg`}>
                                    <h4 className={`font-medium ${isLightMode ? 'text-purple-700' : 'text-purple-400'} mb-2`}>AI Assistant</h4>
                                    <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>Enhance your content with AI suggestions</p>
                                    <button className="w-full bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                        Get AI Suggestions
                                    </button>
                                </div>
                            </div>

                            {/* Center - Portfolio Preview */}
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                <div className="flex items-center justify-between mb-6">
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Portfolio Preview</h3>
                                    <div className="flex items-center gap-2">
                                        <button
                                            onClick={() => handlePreviewDevice('mobile')}
                                            className={`p-2 rounded-lg transition-colors duration-200 ${
                                                previewDevice === 'mobile' ? 'bg-blue-600 text-white' : isLightMode ? 'bg-gray-200 text-gray-600 hover:bg-gray-300' : 'bg-gray-700 text-gray-400 hover:bg-gray-600'
                                            }`}
                                        >
                                            <div className="w-4 h-4"></div>
                                        </button>
                                        <button
                                            onClick={() => handlePreviewDevice('tablet')}
                                            className={`p-2 rounded-lg transition-colors duration-200 ${
                                                previewDevice === 'tablet' ? 'bg-blue-600 text-white' : isLightMode ? 'bg-gray-200 text-gray-600 hover:bg-gray-300' : 'bg-gray-700 text-gray-400 hover:bg-gray-600'
                                            }`}
                                        >
                                            <div className="w-4 h-4"></div>
                                        </button>
                                        <button
                                            onClick={() => handlePreviewDevice('desktop')}
                                            className={`p-2 rounded-lg transition-colors duration-200 ${
                                                previewDevice === 'desktop' ? 'bg-blue-600 text-white' : isLightMode ? 'bg-gray-200 text-gray-600 hover:bg-gray-300' : 'bg-gray-700 text-gray-400 hover:bg-gray-600'
                                            }`}
                                        >
                                            <div className="w-4 h-4"></div>
                                        </button>
                                    </div>
                                </div>
                                
                                <div className="bg-white rounded-lg p-6 overflow-auto" style={{ maxHeight: '600px' }}>
                                    <div className={`mx-auto ${getDeviceSize()}`}>
                                        <div className="text-center mb-8">
                                            <div className="w-24 h-24 bg-gray-300 rounded-full mx-auto mb-4"></div>
                                            <h1 className="text-3xl font-bold text-gray-900 mb-2">John Doe</h1>
                                            <p className="text-xl text-gray-600">Senior Software Engineer</p>
                                        </div>
                                        
                                        <div className="space-y-8">
                                            <section>
                                                <h2 className="text-2xl font-bold text-gray-900 mb-4">About</h2>
                                                <p className="text-gray-700">Experienced software engineer with 5+ years of experience in full-stack development...</p>
                                            </section>
                                            
                                            <section>
                                                <h2 className="text-2xl font-bold text-gray-900 mb-4">Skills</h2>
                                                <div className="flex flex-wrap gap-2">
                                                    {['React', 'Node.js', 'Python', 'AWS', 'Docker'].map((skill) => (
                                                        <span key={skill} className="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                                                            {skill}
                                                        </span>
                                                    ))}
                                                </div>
                                            </section>
                                            
                                            <section>
                                                <h2 className="text-2xl font-bold text-gray-900 mb-4">Projects</h2>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    {mockProjects.map((project) => (
                                                        <div key={project.id} className="border border-gray-200 rounded-lg p-4">
                                                            <h3 className="font-semibold text-gray-900 mb-2">{project.title}</h3>
                                                            <p className="text-gray-600 text-sm mb-2">{project.description}</p>
                                                            <div className="flex flex-wrap gap-1">
                                                                {project.technologies.map((tech) => (
                                                                    <span key={tech} className="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                                                                        {tech}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Right Sidebar - Customization */}
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Customization</h3>
                                
                                <div className="space-y-6">
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Portfolio URL</label>
                                        <input
                                            type="text"
                                            value={portfolioUrl}
                                            onChange={(e) => setPortfolioUrl(e.target.value)}
                                            className={`w-full px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Theme</label>
                                        <select className={`w-full px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`}>
                                            <option>Professional Blue</option>
                                            <option>Dark Theme</option>
                                            <option>Minimal Gray</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Custom Domain (Premium)</label>
                                        <input
                                            type="text"
                                            value={customDomain}
                                            onChange={(e) => setCustomDomain(e.target.value)}
                                            placeholder="yourname.com"
                                            className={`w-full px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>SEO Title</label>
                                        <input
                                            type="text"
                                            value={seoSettings.title}
                                            onChange={(e) => setSeoSettings({...seoSettings, title: e.target.value})}
                                            placeholder="John Doe - Software Engineer"
                                            className={`w-full px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>SEO Description</label>
                                        <textarea
                                            value={seoSettings.description}
                                            onChange={(e) => setSeoSettings({...seoSettings, description: e.target.value})}
                                            placeholder="Professional portfolio of John Doe, Senior Software Engineer..."
                                            rows={3}
                                            className={`w-full px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                        />
                                    </div>
                                    
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setStep('preview')}
                                            className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200"
                                        >
                                            Preview
                                        </button>
                                        <button
                                            onClick={handlePublish}
                                            className="flex-1 bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200"
                                        >
                                            Publish
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {step === 'preview' && (
                        <div className="space-y-8">
                            <div className="flex items-center justify-between">
                                <h2 className="text-3xl font-bold text-gray-50">Portfolio Preview</h2>
                                <div className="flex gap-4">
                                    <button
                                        onClick={() => setStep('editor')}
                                        className="bg-gray-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors duration-200"
                                    >
                                        Edit Portfolio
                                    </button>
                                    <button
                                        onClick={handlePublish}
                                        className="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200"
                                    >
                                        Publish Portfolio
                                    </button>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-2xl p-8">
                                <div className="max-w-4xl mx-auto">
                                    <div className="text-center mb-12">
                                        <div className="w-32 h-32 bg-gray-300 rounded-full mx-auto mb-6"></div>
                                        <h1 className="text-4xl font-bold text-gray-900 mb-4">John Doe</h1>
                                        <p className="text-2xl text-gray-600 mb-6">Senior Software Engineer</p>
                                        <div className="flex justify-center gap-4">
                                            <button className="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">
                                                Download Resume
                                            </button>
                                            <button className="bg-gray-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors duration-200">
                                                Contact Me
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-12">
                                        <section>
                                            <h2 className="text-3xl font-bold text-gray-900 mb-6">About Me</h2>
                                            <p className="text-lg text-gray-700 leading-relaxed">
                                                Experienced software engineer with 5+ years of experience in full-stack development. 
                                                Passionate about creating scalable web applications and leading development teams. 
                                                Expertise in React, Node.js, Python, and cloud technologies.
                                            </p>
                                        </section>
                                        
                                        <section>
                                            <h2 className="text-3xl font-bold text-gray-900 mb-6">Skills</h2>
                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                                {['React', 'Node.js', 'Python', 'AWS', 'Docker', 'MongoDB', 'TypeScript', 'GraphQL'].map((skill) => (
                                                    <div key={skill} className="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                                                        <span className="font-medium text-blue-900">{skill}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </section>
                                        
                                        <section>
                                            <h2 className="text-3xl font-bold text-gray-900 mb-6">Featured Projects</h2>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                                {mockProjects.map((project) => (
                                                    <div key={project.id} className="border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow duration-300">
                                                        <h3 className="text-xl font-semibold text-gray-900 mb-3">{project.title}</h3>
                                                        <p className="text-gray-600 mb-4">{project.description}</p>
                                                        <div className="flex flex-wrap gap-2 mb-4">
                                                            {project.technologies.map((tech) => (
                                                                <span key={tech} className="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full">
                                                                    {tech}
                                                                </span>
                                                            ))}
                                                        </div>
                                                        <div className="flex gap-4">
                                                            <button className="text-blue-600 hover:text-blue-700 font-medium">
                                                                View Live
                                                            </button>
                                                            <button className="text-gray-600 hover:text-gray-700 font-medium">
                                                                GitHub
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </section>
                                        
                                        <section>
                                            <h2 className="text-3xl font-bold text-gray-900 mb-6">Contact</h2>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                <div>
                                                    <h3 className="font-semibold text-gray-900 mb-2">Email</h3>
                                                    <p className="text-gray-600">john.doe@example.com</p>
                                                </div>
                                                <div>
                                                    <h3 className="font-semibold text-gray-900 mb-2">Phone</h3>
                                                    <p className="text-gray-600">+1 (555) 123-4567</p>
                                                </div>
                                                <div>
                                                    <h3 className="font-semibold text-gray-900 mb-2">Location</h3>
                                                    <p className="text-gray-600">San Francisco, CA</p>
                                                </div>
                                                <div>
                                                    <h3 className="font-semibold text-gray-900 mb-2">Social</h3>
                                                    <div className="flex gap-4">
                                                        <button className="text-blue-600 hover:text-blue-700">LinkedIn</button>
                                                        <button className="text-gray-600 hover:text-gray-700">GitHub</button>
                                                        <button className="text-blue-400 hover:text-blue-500">Twitter</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {step === 'publish' && (
                        <div className="text-center py-20">
                            <div className="w-20 h-20 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-8">
                                <div className="w-10 h-10 text-white text-4xl"></div>
                            </div>
                            <h2 className={`text-4xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Portfolio Published Successfully!</h2>
                            <p className={`text-xl ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-8`}>Your professional portfolio is now live and ready to share</p>
                            
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8 max-w-2xl mx-auto mb-8`}>
                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Your Portfolio URL</h3>
                                <div className="flex items-center gap-4">
                                    <input
                                        type="text"
                                        value={portfolioUrl}
                                        readOnly
                                        className={`flex-1 px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg`}
                                    />
                                    <button className="bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">
                                        Copy
                                    </button>
                                    <button className={`${isLightMode ? 'bg-gray-500 hover:bg-gray-600' : 'bg-gray-600 hover:bg-gray-700'} text-white px-4 py-3 rounded-lg font-medium transition-colors duration-200`}>
                                        <div className="w-4 h-4"></div>
                                    </button>
                                </div>
                            </div>
                            
                            <div className="flex gap-4 justify-center">
                                <button
                                    onClick={() => setStep('editor')}
                                    className="bg-blue-600 text-white px-8 py-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200"
                                >
                                    Continue Editing
                                </button>
                                <button className="bg-green-600 text-white px-8 py-4 rounded-lg font-semibold hover:bg-green-700 transition-colors duration-200">
                                    Share Portfolio
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render AI-Generated Career Portfolio when career-portfolio-content is shown
        window.renderAIPortfolio = function() {
            console.log('renderAIPortfolio called');
            const container = document.getElementById('career-portfolio-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering AI-Generated Career Portfolio/Microsite...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<AIPortfolio />);
                    console.log('AI-Generated Career Portfolio/Microsite rendered successfully');
                } catch (error) {
                    console.error('Error rendering AI-Generated Career Portfolio/Microsite:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading AI-Generated Career Portfolio/Microsite</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('career-portfolio-container not found');
            }
        };

        // Career Event Scout React Component
        const CareerEventScout = () => {
            const [activeTab, setActiveTab] = useState('events');
            const [searchQuery, setSearchQuery] = useState('');
            const [filterType, setFilterType] = useState('all');
            const [filterLocation, setFilterLocation] = useState('all');
            const [filterDate, setFilterDate] = useState('all');
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            const careerEvents = [
                {
                    id: 1,
                    title: 'React Conf 2024',
                    type: 'Conference',
                    date: '2024-03-15',
                    location: 'San Francisco, CA',
                    isVirtual: false,
                    description: 'The premier React conference featuring the latest in React development',
                    attendees: 2500,
                    speakers: ['Dan Abramov', 'Sophie Alpert', 'Andrew Clark'],
                    relevanceScore: 95,
                    industry: 'Technology',
                    skills: ['React', 'JavaScript', 'Frontend'],
                    url: 'https://reactconf.com',
                    price: '$299',
                    isBookmarked: false
                },
                {
                    id: 2,
                    title: 'AI in Healthcare Workshop',
                    type: 'Workshop',
                    date: '2024-03-20',
                    location: 'Virtual',
                    isVirtual: true,
                    description: 'Hands-on workshop on implementing AI solutions in healthcare',
                    attendees: 150,
                    speakers: ['Dr. Sarah Chen', 'Prof. Michael Rodriguez'],
                    relevanceScore: 88,
                    industry: 'Healthcare',
                    skills: ['AI', 'Machine Learning', 'Healthcare'],
                    url: 'https://ai-healthcare-workshop.com',
                    price: 'Free',
                    isBookmarked: true
                },
                {
                    id: 3,
                    title: 'Tech Networking Mixer',
                    type: 'Networking',
                    date: '2024-03-25',
                    location: 'New York, NY',
                    isVirtual: false,
                    description: 'Connect with fellow tech professionals and industry leaders',
                    attendees: 300,
                    speakers: ['John Smith', 'Jane Doe'],
                    relevanceScore: 82,
                    industry: 'Technology',
                    skills: ['Networking', 'Career Development'],
                    url: 'https://tech-mixer.com',
                    price: '$50',
                    isBookmarked: false
                }
            ];

            const roleModels = [
                {
                    id: 1,
                    name: 'Sarah Johnson',
                    title: 'Senior Software Engineer',
                    company: 'Google',
                    industry: 'Technology',
                    followersCount: 12500,
                    engagementRate: 8.5,
                    contentThemes: ['React', 'Career Growth', 'Diversity'],
                    recentPosts: ['Just shipped a new feature at Google!', 'Tips for junior developers'],
                    linkedinUrl: 'https://linkedin.com/in/sarahjohnson',
                    twitterUrl: 'https://twitter.com/sarahjohnson',
                    isFollowing: true,
                    influenceScore: 92,
                    avatar: '/api/placeholder/60/60'
                },
                {
                    id: 2,
                    name: 'Michael Chen',
                    title: 'VP of Engineering',
                    company: 'Stripe',
                    industry: 'Fintech',
                    followersCount: 8500,
                    engagementRate: 7.2,
                    contentThemes: ['Leadership', 'Engineering', 'Startups'],
                    recentPosts: ['Building great engineering teams', 'Scaling payment infrastructure'],
                    linkedinUrl: 'https://linkedin.com/in/michaelchen',
                    twitterUrl: 'https://twitter.com/michaelchen',
                    isFollowing: false,
                    influenceScore: 88,
                    avatar: '/api/placeholder/60/60'
                }
            ];

            const networkingOpportunities = [
                {
                    id: 1,
                    type: 'Event Attendee',
                    name: 'Alex Rodriguez',
                    title: 'Product Manager',
                    company: 'Microsoft',
                    mutualConnections: 3,
                    relevanceScore: 85,
                    contactInfo: 'alex.rodriguez@microsoft.com',
                    suggestedApproach: 'Mention your shared interest in React and ask about their experience at Microsoft',
                    eventContext: 'React Conf 2024'
                },
                {
                    id: 2,
                    type: 'Speaker',
                    name: 'Dr. Lisa Wang',
                    title: 'AI Research Director',
                    company: 'OpenAI',
                    mutualConnections: 1,
                    relevanceScore: 92,
                    contactInfo: 'lisa.wang@openai.com',
                    suggestedApproach: 'Reference their recent research paper and ask about future AI trends',
                    eventContext: 'AI in Healthcare Workshop'
                }
            ];

            const getRelevanceColor = (score) => {
                if (score >= 90) return 'text-green-400 bg-green-500/20';
                if (score >= 80) return 'text-blue-400 bg-blue-500/20';
                if (score >= 70) return 'text-yellow-400 bg-yellow-500/20';
                return 'text-red-400 bg-red-500/20';
            };

            const getEventTypeIcon = (type) => {
                switch (type) {
                    case 'Conference':
                        return '';
                    case 'Workshop':
                        return '';
                    case 'Networking':
                        return '';
                    case 'Webinar':
                        return '';
                    case 'Meetup':
                        return '';
                    default:
                        return '';
                }
            };

            const getEventTypeColor = (type) => {
                switch (type) {
                    case 'Conference':
                        return 'text-purple-400 bg-purple-500/20';
                    case 'Workshop':
                        return 'text-blue-400 bg-blue-500/20';
                    case 'Networking':
                        return 'text-green-400 bg-green-500/20';
                    case 'Webinar':
                        return 'text-orange-400 bg-orange-500/20';
                    case 'Meetup':
                        return 'text-pink-400 bg-pink-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const handleBookmarkToggle = (eventId) => {
                // Toggle bookmark functionality would be implemented here
                console.log('Toggle bookmark for event:', eventId);
            };

            const handleFollowToggle = (roleModelId) => {
                // Toggle follow functionality would be implemented here
                console.log('Toggle follow for role model:', roleModelId);
            };

            const tabs = [
                { id: 'events', label: 'Career Events', icon: '' },
                { id: 'role-models', label: 'Role Models', icon: '' },
                { id: 'networking', label: 'Networking', icon: '' },
                { id: 'insights', label: 'AI Insights', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex space-x-1 overflow-x-auto">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                        activeTab === tab.id
                                            ? 'bg-indigo-600 text-white shadow-lg'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                    }`}
                                >
                                    <div className="w-4 h-4">{tab.icon}</div>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'events' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Search and Filters */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex flex-col md:flex-row gap-4">
                                        <div className="flex-1">
                                            <div className="relative">
                                                <div className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none`}>
                                                    <div className={`w-4 h-4 ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}></div>
                                                </div>
                                                <input
                                                    type="text"
                                                    value={searchQuery}
                                                    onChange={(e) => setSearchQuery(e.target.value)}
                                                    placeholder="Search events..."
                                                    className={`w-full pl-10 pr-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                                />
                                            </div>
                                        </div>
                                        <div className="flex gap-3">
                                            <select
                                                value={filterType}
                                                onChange={(e) => setFilterType(e.target.value)}
                                                className={`px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Types</option>
                                                <option value="conference">Conferences</option>
                                                <option value="workshop">Workshops</option>
                                                <option value="networking">Networking</option>
                                                <option value="webinar">Webinars</option>
                                                <option value="meetup">Meetups</option>
                                            </select>
                                            <select
                                                value={filterLocation}
                                                onChange={(e) => setFilterLocation(e.target.value)}
                                                className={`px-4 py-3 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Locations</option>
                                                <option value="virtual">Virtual Only</option>
                                                <option value="in-person">In-Person Only</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                {/* Events List */}
                                <div className="space-y-4">
                                    {careerEvents.map((event) => (
                                        <div key={event.id} className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6 hover:border-indigo-500/50 transition-all duration-300`}>
                                            <div className="flex items-start justify-between mb-4">
                                                <div className="flex items-start gap-4">
                                                    <div className="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                                        <div className="w-6 h-6 text-white text-xl">{getEventTypeIcon(event.type)}</div>
                                                    </div>
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{event.title}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getEventTypeColor(event.type)}`}>
                                                                {event.type}
                                                            </span>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getRelevanceColor(event.relevanceScore)}`}>
                                                                {event.relevanceScore}% Match
                                                            </span>
                                                        </div>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <div className="flex items-center gap-1">
                                                                <div className="w-4 h-4"></div>
                                                                {event.date}
                                                            </div>
                                                            <div className="flex items-center gap-1">
                                                                <div className="w-4 h-4"></div>
                                                                {event.location}
                                                            </div>
                                                            <div className="flex items-center gap-1">
                                                                <div className="w-4 h-4"></div>
                                                                {event.attendees} attendees
                                                            </div>
                                                            <div className="flex items-center gap-1">
                                                                <div className="w-4 h-4"></div>
                                                                {event.price}
                                                            </div>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>{event.description}</p>
                                                        <div className="flex flex-wrap gap-2 mb-4">
                                                            {event.skills.map((skill) => (
                                                                <span key={skill} className="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded-full">
                                                                    {skill}
                                                                </span>
                                                            ))}
                                                        </div>
                                                        <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            <strong>Speakers:</strong> {event.speakers.join(', ')}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <button
                                                        onClick={() => handleBookmarkToggle(event.id)}
                                                        className={`p-2 rounded-lg transition-colors duration-200 ${
                                                            event.isBookmarked 
                                                                ? 'bg-yellow-500 text-white' 
                                                                : isLightMode 
                                                                    ? 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                                                    : 'bg-gray-700 text-gray-400 hover:bg-gray-600'
                                                        }`}
                                                    >
                                                        <div className="w-4 h-4"></div>
                                                    </button>
                                                    <button className="p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                                                        <div className="w-4 h-4"></div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Event Filters */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Event Filters</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Event Type</label>
                                            <select className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}>
                                                <option>All Types</option>
                                                <option>Conferences</option>
                                                <option>Workshops</option>
                                                <option>Networking</option>
                                                <option>Webinars</option>
                                                <option>Meetups</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Location</label>
                                            <select className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}>
                                                <option>All Locations</option>
                                                <option>Virtual Only</option>
                                                <option>In-Person Only</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Date Range</label>
                                            <select className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}>
                                                <option>All Dates</option>
                                                <option>This Month</option>
                                                <option>Next Month</option>
                                                <option>Next Quarter</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                {/* Bookmarked Events */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Bookmarked Events</h3>
                                    <div className="space-y-3">
                                        {careerEvents.filter(event => event.isBookmarked).map((event) => (
                                            <div key={event.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>{event.title}</h4>
                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                    {event.date}  {event.location}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'role-models' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className="space-y-4">
                                    {roleModels.map((model) => (
                                        <div key={model.id} className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                            <div className="flex items-start gap-4">
                                                <div className="w-16 h-16 bg-gray-300 rounded-full flex-shrink-0"></div>
                                                <div className="flex-1">
                                                    <div className="flex items-start justify-between mb-3">
                                                        <div>
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{model.name}</h3>
                                                            <p className={isLightMode ? 'text-gray-600' : 'text-gray-400'}>{model.title} at {model.company}</p>
                                                            <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mt-1`}>
                                                                <span>{model.followersCount.toLocaleString()} followers</span>
                                                                <span>{model.engagementRate}% engagement</span>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getRelevanceColor(model.influenceScore)}`}>
                                                                    {model.influenceScore} Influence
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => handleFollowToggle(model.id)}
                                                            className={`px-4 py-2 rounded-lg font-medium transition-colors duration-200 ${
                                                                model.isFollowing 
                                                                    ? 'bg-gray-600 text-white' 
                                                                    : 'bg-indigo-600 text-white hover:bg-indigo-700'
                                                            }`}
                                                        >
                                                            {model.isFollowing ? 'Following' : 'Follow'}
                                                        </button>
                                                    </div>
                                                    <div className="mb-4">
                                                        <div className="flex flex-wrap gap-2">
                                                            {model.contentThemes.map((theme) => (
                                                                <span key={theme} className="px-2 py-1 bg-purple-500/20 text-purple-400 text-xs rounded-full">
                                                                    {theme}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    <div className="mb-4">
                                                        <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Recent Posts</h4>
                                                        <div className="space-y-1">
                                                            {model.recentPosts.map((post, index) => (
                                                                <p key={index} className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}> {post}</p>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-3">
                                                        <button className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">
                                                            <div className="w-4 h-4"></div>
                                                            LinkedIn
                                                        </button>
                                                        <button className="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200">
                                                            <div className="w-4 h-4"></div>
                                                            Twitter
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Following */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Following</h3>
                                    <div className="space-y-3">
                                        {roleModels.filter(model => model.isFollowing).map((model) => (
                                            <div key={model.id} className="flex items-center gap-3">
                                                <div className="w-10 h-10 bg-gray-300 rounded-full flex-shrink-0"></div>
                                                <div>
                                                    <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{model.name}</h4>
                                                    <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{model.title}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* AI Recommendations */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>AI Recommendations</h3>
                                    <div className="space-y-4">
                                        <div className={`${isLightMode ? 'bg-blue-100 border-blue-300' : 'bg-blue-500/20 border-blue-500/50'} border rounded-lg p-4`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-blue-700' : 'text-blue-400'} mb-1`}>Trending Topic</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>React Server Components are gaining traction in the community</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-green-100 border-green-300' : 'bg-green-500/20 border-green-500/50'} border rounded-lg p-4`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-green-700' : 'text-green-400'} mb-1`}>Networking Tip</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Engage with content from industry leaders to build meaningful connections</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'networking' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className="space-y-4">
                                    {networkingOpportunities.map((opportunity) => (
                                        <div key={opportunity.id} className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                            <div className="flex items-start justify-between mb-4">
                                                <div className="flex items-start gap-4">
                                                    <div className="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                                                        <div className="w-6 h-6 text-white text-xl"></div>
                                                    </div>
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{opportunity.name}</h3>
                                                            <span className={`px-2 py-1 ${isLightMode ? 'bg-gray-200 text-gray-700' : 'bg-gray-700 text-gray-300'} text-xs rounded-full`}>
                                                                {opportunity.type}
                                                            </span>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getRelevanceColor(opportunity.relevanceScore)}`}>
                                                                {opportunity.relevanceScore}% Match
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-400'} mb-3`}>{opportunity.title} at {opportunity.company}</p>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-4`}>
                                                            <span>{opportunity.mutualConnections} mutual connections</span>
                                                            <span></span>
                                                            <span>Context: {opportunity.eventContext}</span>
                                                        </div>
                                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4 mb-4`}>
                                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>AI Suggested Approach</h4>
                                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>{opportunity.suggestedApproach}</p>
                                                        </div>
                                                        <div className="flex gap-3">
                                                            <button className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">
                                                                <div className="w-4 h-4"></div>
                                                                Connect
                                                            </button>
                                                            <button className="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200">
                                                                <div className="w-4 h-4"></div>
                                                                Email
                                                            </button>
                                                            <button className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200">
                                                                <div className="w-4 h-4"></div>
                                                                Save Contact
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Networking Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Networking Stats</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Opportunities Found</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>12 this month</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Connections Made</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>8 this month</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Events Attended</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>3 this quarter</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Networking Tips */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Networking Tips</h3>
                                    <div className="space-y-3">
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Research attendees before events to identify key connections</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Follow up within 24 hours of meeting someone new</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-2 h-2 bg-indigo-500 rounded-full mt-2 flex-shrink-0"></div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Share valuable content to stay top-of-mind with your network</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'insights' && (
                        <div className="space-y-8">
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Event Recommendation</h3>
                                    </div>
                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>Based on your interests, we recommend attending React Conf 2024 for networking opportunities.</p>
                                    <div className={`text-sm ${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>High relevance for your career goals</div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Networking Strategy</h3>
                                    </div>
                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>Focus on connecting with senior engineers at your target companies.</p>
                                    <div className={`text-sm ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>Strategic networking approach</div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Content Opportunity</h3>
                                    </div>
                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>Share your experience at tech events to build your professional brand.</p>
                                    <div className={`text-sm ${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>Content creation opportunity</div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Career Growth</h3>
                                    </div>
                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>Attending leadership workshops can accelerate your career progression.</p>
                                    <div className={`text-sm ${isLightMode ? 'text-orange-600' : 'text-orange-400'}`}>Growth opportunity identified</div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 bg-pink-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Industry Trends</h3>
                                    </div>
                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>AI and machine learning events are trending in your industry.</p>
                                    <div className={`text-sm ${isLightMode ? 'text-pink-600' : 'text-pink-400'}`}>Industry trend analysis</div>
                                </div>

                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 bg-cyan-500 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Skill Development</h3>
                                    </div>
                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>Consider attending workshops on cloud architecture to expand your skills.</p>
                                    <div className={`text-sm ${isLightMode ? 'text-cyan-600' : 'text-cyan-400'}`}>Skill development path</div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Career Event Scout when career-event-scout-content is shown
        window.renderCareerEventScout = function() {
            console.log('renderCareerEventScout called');
            const container = document.getElementById('career-event-scout-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Career Event Scout...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<CareerEventScout />);
                    console.log('Career Event Scout rendered successfully');
                } catch (error) {
                    console.error('Error rendering Career Event Scout:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Career Event Scout</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('career-event-scout-container not found');
            }
        };

        // AI Brand Intelligence React Component
        const AIBrandIntelligence = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [isScanning, setIsScanning] = useState(false);
            const [lastScanDate, setLastScanDate] = useState('2024-03-15');
            const [selectedInsight, setSelectedInsight] = useState(null);
            const [filterPriority, setFilterPriority] = useState('all');
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            const brandHealthScore = {
                overall: 78,
                visibility: 82,
                engagement: 74,
                reputation: 85,
                authority: 71,
                trend: 'up'
            };

            const mentorInsights = [
                {
                    id: 1,
                    type: 'weekly',
                    title: 'Search Visibility Boost Opportunity',
                    content: 'Your LinkedIn profile appears on page 2 for "software engineer" searches. Optimizing your headline and adding more relevant keywords could move you to page 1.',
                    priority: 'high',
                    actionItems: [
                        { id: 1, title: 'Update LinkedIn headline with target keywords', description: 'Add "Senior Software Engineer | React & Node.js" to headline', category: 'SEO', difficulty: 'easy', estimatedTime: '5 min', completed: false },
                        { id: 2, title: 'Add 3 more relevant skills to LinkedIn', description: 'Include trending technologies in your skills section', category: 'SEO', difficulty: 'easy', estimatedTime: '10 min', completed: false }
                    ],
                    estimatedImpact: 'High',
                    createdAt: '2024-03-15',
                    isRead: false
                },
                {
                    id: 2,
                    type: 'monthly',
                    title: 'LinkedIn Engagement Trending Up',
                    content: 'Your recent posts about React development are getting 40% more engagement than your average. Consider creating more technical content.',
                    priority: 'medium',
                    actionItems: [
                        { id: 3, title: 'Create weekly technical posts', description: 'Share insights about React best practices and development tips', category: 'Content', difficulty: 'medium', estimatedTime: '30 min', completed: false }
                    ],
                    estimatedImpact: 'Medium',
                    createdAt: '2024-03-10',
                    isRead: true
                },
                {
                    id: 3,
                    type: 'achievement',
                    title: 'Consistency Achievement Unlocked',
                    content: 'You\'ve posted consistently for 2 weeks! This is building your professional brand authority.',
                    priority: 'low',
                    actionItems: [
                        { id: 4, title: 'Maintain posting schedule', description: 'Continue posting 2-3 times per week', category: 'Content', difficulty: 'easy', estimatedTime: '15 min', completed: true }
                    ],
                    estimatedImpact: 'Low',
                    createdAt: '2024-03-12',
                    isRead: true
                }
            ];

            const reputationAlerts = [
                {
                    id: 1,
                    type: 'opportunity',
                    title: 'New Job Opportunity Mention',
                    description: 'A recruiter mentioned you in a post about React developers. This could lead to new opportunities.',
                    severity: 'info',
                    isRead: false,
                    actionRequired: false,
                    createdAt: '2024-03-14'
                },
                {
                    id: 2,
                    type: 'visibility',
                    title: 'Search Ranking Drop',
                    description: 'Your GitHub profile dropped from page 1 to page 2 for "full-stack developer" searches.',
                    severity: 'warning',
                    isRead: true,
                    actionRequired: true,
                    createdAt: '2024-03-13'
                }
            ];

            const brandMentions = [
                {
                    id: 1,
                    platform: 'LinkedIn',
                    title: 'Senior Software Engineer at TechCorp',
                    url: 'https://linkedin.com/in/johndoe',
                    snippet: 'Experienced React developer with 5+ years building scalable web applications...',
                    sentiment: 'positive',
                    ranking: 1,
                    date: '2024-03-15',
                    isOwned: true
                },
                {
                    id: 2,
                    platform: 'GitHub',
                    title: 'React Portfolio Project',
                    url: 'https://github.com/johndoe/portfolio',
                    snippet: 'Modern portfolio built with React, TypeScript, and Tailwind CSS...',
                    sentiment: 'neutral',
                    ranking: 3,
                    date: '2024-03-10',
                    isOwned: true
                },
                {
                    id: 3,
                    platform: 'Portfolio',
                    title: 'John Doe - Full Stack Developer',
                    url: 'https://johndoe.dev',
                    snippet: 'Passionate about creating user-friendly applications with modern technologies...',
                    sentiment: 'positive',
                    ranking: 2,
                    date: '2024-03-08',
                    isOwned: true
                }
            ];

            const getScoreColor = (score) => {
                if (score >= 80) return 'text-green-400';
                if (score >= 60) return 'text-yellow-400';
                return 'text-red-400';
            };

            const getScoreBgColor = (score) => {
                if (score >= 80) return 'bg-green-500/20';
                if (score >= 60) return 'bg-yellow-500/20';
                return 'bg-red-500/20';
            };

            const getPriorityColor = (priority) => {
                switch (priority) {
                    case 'high':
                        return 'text-red-400 bg-red-500/20';
                    case 'medium':
                        return 'text-yellow-400 bg-yellow-500/20';
                    case 'low':
                        return 'text-green-400 bg-green-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getSeverityColor = (severity) => {
                switch (severity) {
                    case 'critical':
                        return 'text-red-400 bg-red-500/20';
                    case 'warning':
                        return 'text-yellow-400 bg-yellow-500/20';
                    case 'info':
                        return 'text-blue-400 bg-blue-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getSentimentColor = (sentiment) => {
                switch (sentiment) {
                    case 'positive':
                        return 'text-green-400 bg-green-500/20';
                    case 'negative':
                        return 'text-red-400 bg-red-500/20';
                    case 'neutral':
                        return 'text-gray-400 bg-gray-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getPlatformColor = (platform) => {
                switch (platform) {
                    case 'LinkedIn':
                        return 'text-blue-400 bg-blue-500/20';
                    case 'GitHub':
                        return 'text-gray-400 bg-gray-500/20';
                    case 'Portfolio':
                        return 'text-purple-400 bg-purple-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const handleBrandScan = () => {
                setIsScanning(true);
                // Simulate brand scan
                setTimeout(() => {
                    setIsScanning(false);
                    setLastScanDate(new Date().toISOString().split('T')[0]);
                }, 3000);
            };

            const handleInsightClick = (insight) => {
                setSelectedInsight(insight);
            };

            const handleActionToggle = (insightId, actionId) => {
                // Toggle action completion
                console.log('Toggle action:', insightId, actionId);
            };

            const tabs = [
                { id: 'overview', label: 'Brand Overview', icon: '' },
                { id: 'insights', label: 'AI Insights & Actions', icon: '' },
                { id: 'reputation', label: 'Reputation Monitor', icon: '' },
                { id: 'analytics', label: 'Analytics & Trends', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex items-center justify-between">
                            <div className="flex space-x-1 overflow-x-auto">
                                {tabs.map((tab) => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                            activeTab === tab.id
                                                ? 'bg-indigo-600 text-white shadow-lg'
                                                : isLightMode 
                                                    ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                    : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                    >
                                        <div className="w-4 h-4">{tab.icon}</div>
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                            <button
                                onClick={handleBrandScan}
                                disabled={isScanning}
                                className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all duration-300 disabled:opacity-50 ml-4"
                            >
                                {isScanning ? (
                                    <>
                                        <div className="w-4 h-4 animate-spin"></div>
                                        Scanning...
                                    </>
                                ) : (
                                    <>
                                        <div className="w-4 h-4"></div>
                                        Run Brand Scan
                                    </>
                                )}
                            </button>
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'overview' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-8">
                                {/* Brand Health Dashboard */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Brand Health Dashboard</h2>
                                    </div>
                                    
                                    <div className="text-center mb-8">
                                        <div className={`text-6xl font-bold ${getScoreColor(brandHealthScore.overall)} mb-2`}>
                                            {brandHealthScore.overall}
                                        </div>
                                        <p className={`text-xl ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>Overall Brand Score</p>
                                        <div className={`flex items-center justify-center gap-2 ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>
                                            <div className="w-4 h-4"></div>
                                            <span>+5% from last month</span>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandHealthScore.visibility)}`}>
                                                {brandHealthScore.visibility}
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Visibility</p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandHealthScore.engagement)}`}>
                                                {brandHealthScore.engagement}
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Engagement</p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandHealthScore.reputation)}`}>
                                                {brandHealthScore.reputation}
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Reputation</p>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${getScoreColor(brandHealthScore.authority)}`}>
                                                {brandHealthScore.authority}
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Authority</p>
                                        </div>
                                    </div>
                                    
                                    <div className={`mt-6 p-4 ${isLightMode ? 'bg-indigo-100 border-indigo-300' : 'bg-gradient-to-r from-indigo-500/20 to-purple-600/20 border-indigo-500/30'} border rounded-lg`}>
                                        <h3 className={`font-semibold ${isLightMode ? 'text-indigo-700' : 'text-indigo-400'} mb-2`}>AI Recommendation</h3>
                                        <p className={isLightMode ? 'text-gray-600' : 'text-gray-300'}>Focus on improving your engagement score by posting more consistently on LinkedIn and sharing valuable technical content.</p>
                                    </div>
                                </div>

                                {/* Quick Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Quick Actions</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <button className="bg-blue-600 text-white p-6 rounded-xl hover:bg-blue-700 transition-colors duration-200">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-8 h-8"></div>
                                                <h3 className="font-semibold">View AI Insights</h3>
                                            </div>
                                            <p className="text-blue-100 text-sm">Get personalized recommendations</p>
                                        </button>
                                        <button className="bg-yellow-600 text-white p-6 rounded-xl hover:bg-yellow-700 transition-colors duration-200">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-8 h-8"></div>
                                                <h3 className="font-semibold">Check Reputation</h3>
                                            </div>
                                            <p className="text-yellow-100 text-sm">Monitor your online presence</p>
                                        </button>
                                        <button className="bg-purple-600 text-white p-6 rounded-xl hover:bg-purple-700 transition-colors duration-200">
                                            <div className="flex items-center gap-3 mb-2">
                                                <div className="w-8 h-8"></div>
                                                <h3 className="font-semibold">View Analytics</h3>
                                            </div>
                                            <p className="text-purple-100 text-sm">Track your brand growth</p>
                                        </button>
                                    </div>
                                </div>

                                {/* Recent Activity & Alerts */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Recent Activity & Alerts</h2>
                                    <div className="space-y-4">
                                        {reputationAlerts.map((alert) => (
                                            <div key={alert.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                <div className="flex items-start justify-between">
                                                    <div className="flex items-start gap-3">
                                                        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${getSeverityColor(alert.severity)}`}>
                                                            <div className="w-4 h-4"></div>
                                                        </div>
                                                        <div>
                                                            <h3 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{alert.title}</h3>
                                                            <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} text-sm`}>{alert.description}</p>
                                                            <div className="flex items-center gap-2 mt-2">
                                                                <span className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{alert.createdAt}</span>
                                                                {alert.actionRequired && (
                                                                    <span className="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded-full">
                                                                        Action Required
                                                                    </span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {!alert.isRead && (
                                                        <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Top Priority Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Top Priority Actions</h3>
                                    <div className="space-y-3">
                                        {mentorInsights.filter(insight => insight.priority === 'high').map((insight) => (
                                            <div key={insight.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>{insight.title}</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>{insight.content.substring(0, 80)}...</p>
                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getPriorityColor(insight.priority)}`}>
                                                    {insight.priority.toUpperCase()}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Online Presence */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Online Presence</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Mentions</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>12</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Positive Sentiment</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>85%</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Avg. Ranking</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>2.1</span>
                                        </div>
                                    </div>
                                </div>

                                {/* This Week's Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>This Week's Progress</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Actions Completed</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>3/5</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Score Change</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-green-600' : 'text-green-400'}`}>+5 points</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>New Mentions</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>2</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'insights' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>AI-Generated Insights</h2>
                                        <select
                                            value={filterPriority}
                                            onChange={(e) => setFilterPriority(e.target.value)}
                                            className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                        >
                                            <option value="all">All Priorities</option>
                                            <option value="high">High Priority</option>
                                            <option value="medium">Medium Priority</option>
                                            <option value="low">Low Priority</option>
                                        </select>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {mentorInsights
                                            .filter(insight => filterPriority === 'all' || insight.priority === filterPriority)
                                            .map((insight) => (
                                            <div key={insight.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex items-start gap-3">
                                                        <div className="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                                            <div className="w-5 h-5 text-white text-xl"></div>
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-2">
                                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{insight.title}</h3>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getPriorityColor(insight.priority)}`}>
                                                                    {insight.priority.toUpperCase()}
                                                                </span>
                                                                <span className={`px-2 py-1 ${isLightMode ? 'bg-blue-100 text-blue-600' : 'bg-blue-500/20 text-blue-400'} text-xs rounded-full`}>
                                                                    {insight.estimatedImpact} Impact
                                                                </span>
                                                            </div>
                                                            <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>{insight.content}</p>
                                                        </div>
                                                    </div>
                                                    {!insight.isRead && (
                                                        <div className="w-2 h-2 bg-blue-500 rounded-full"></div>
                                                    )}
                                                </div>
                                                
                                                <div className="space-y-3">
                                                    <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Action Items</h4>
                                                    {insight.actionItems.map((action) => (
                                                        <div key={action.id} className={`flex items-start gap-3 ${isLightMode ? 'bg-white/20 backdrop-blur-xl border-white/10' : 'bg-gray-700'} border rounded-lg p-3`}>
                                                            <input
                                                                type="checkbox"
                                                                checked={action.completed}
                                                                onChange={() => handleActionToggle(insight.id, action.id)}
                                                                className={`mt-1 w-4 h-4 text-indigo-600 ${isLightMode ? 'bg-white border-gray-300' : 'bg-gray-800 border-gray-600'} rounded focus:ring-indigo-500`}
                                                            />
                                                            <div className="flex-1">
                                                                <h5 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{action.title}</h5>
                                                                <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>{action.description}</p>
                                                                <div className="flex items-center gap-2 mt-2">
                                                                    <span className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{action.category}</span>
                                                                    <span className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}></span>
                                                                    <span className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{action.difficulty}</span>
                                                                    <span className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}></span>
                                                                    <span className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{action.estimatedTime}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Action Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Action Progress</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                <span>Overall Progress</span>
                                                <span>60%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-indigo-500 h-2 rounded-full" style={{ width: '60%' }}></div>
                                            </div>
                                        </div>
                                        <div className="space-y-2">
                                            <div className="flex justify-between text-sm">
                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Completed</span>
                                                <span className="text-green-400">3</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>In Progress</span>
                                                <span className="text-yellow-400">2</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Pending</span>
                                                <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>1</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Quick Wins */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Wins</h3>
                                    <div className="space-y-3">
                                        {mentorInsights
                                            .filter(insight => insight.priority === 'high' && insight.actionItems.some(action => action.difficulty === 'easy'))
                                            .map((insight) => (
                                            <div key={insight.id} className="bg-green-500/20 border border-green-500/50 rounded-lg p-3">
                                                <h4 className="font-medium text-green-400 mb-1">{insight.title}</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Easy actions available</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'reputation' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Brand Mentions & Search Results</h2>
                                    
                                    <div className="space-y-4">
                                        {brandMentions.map((mention) => (
                                            <div key={mention.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex items-start gap-4">
                                                        <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${getPlatformColor(mention.platform)}`}>
                                                            <div className="w-5 h-5 text-xl">
                                                                {mention.platform === 'LinkedIn' ? '' : 
                                                                 mention.platform === 'GitHub' ? '' : ''}
                                                            </div>
                                                        </div>
                                                        <div className="flex-1">
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>{mention.title}</h3>
                                                            <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{mention.snippet}</p>
                                                            <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                <span>Ranking: #{mention.ranking}</span>
                                                                <span></span>
                                                                <span>{mention.date}</span>
                                                                <span></span>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getSentimentColor(mention.sentiment)}`}>
                                                                    {mention.sentiment}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <button className="p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                                                        <div className="w-4 h-4"></div>
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Reputation Health */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Reputation Health</h3>
                                    <div className="text-center mb-4">
                                        <div className={`text-4xl font-bold ${isLightMode ? 'text-green-600' : 'text-green-400'} mb-2`}>85</div>
                                        <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Overall Score</div>
                                    </div>
                                    <div className="space-y-3">
                                        <div className="flex justify-between text-sm">
                                            <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Positive Mentions</span>
                                            <span className={`${isLightMode ? 'text-green-600' : 'text-green-400'}`}>85%</span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Search Visibility</span>
                                            <span className={`${isLightMode ? 'text-blue-600' : 'text-blue-400'}`}>Good</span>
                                        </div>
                                        <div className="flex justify-between text-sm">
                                            <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Authority Score</span>
                                            <span className={`${isLightMode ? 'text-purple-600' : 'text-purple-400'}`}>71</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Monitoring Settings */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Monitoring Settings</h3>
                                    <div className="space-y-3">
                                        <div className="flex items-center justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>LinkedIn</span>
                                            <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                        </div>
                                        <div className="flex items-center justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>GitHub</span>
                                            <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                        </div>
                                        <div className="flex items-center justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Portfolio</span>
                                            <div className="w-2 h-2 bg-green-500 rounded-full"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'analytics' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Brand Performance Analytics</h2>
                                    </div>
                                    
                                    <div className="text-center py-20">
                                        <div className="w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                            <div className="w-8 h-8 text-white text-3xl"></div>
                                        </div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Interactive Analytics Coming Soon</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-8`}>Advanced charts and trend analysis will be available in the next update</p>
                                        <button className="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:from-indigo-600 hover:to-purple-700 transition-all duration-300">
                                            Get Notified
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Key Metrics */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Key Metrics</h3>
                                    <div className="space-y-4">
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-green-600' : 'text-green-400'} mb-1`}>+12%</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Brand Growth</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-blue-600' : 'text-blue-400'} mb-1`}>+8</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>New Mentions</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'} mb-1`}>+15%</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Engagement</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Export Options */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Export Options</h3>
                                    <div className="space-y-3">
                                        <button className="w-full bg-blue-600 text-white py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">
                                            Brand Report
                                        </button>
                                        <button className="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                            Reputation Analysis
                                        </button>
                                        <button className="w-full bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                            Action Plan
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render AI Brand Intelligence when brand-intelligence-content is shown
        window.renderAIBrandIntelligence = function() {
            console.log('renderAIBrandIntelligence called');
            const container = document.getElementById('brand-intelligence-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering AI Brand Intelligence...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<AIBrandIntelligence />);
                    console.log('AI Brand Intelligence rendered successfully');
                } catch (error) {
                    console.error('Error rendering AI Brand Intelligence:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading AI Brand Intelligence</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('brand-intelligence-container not found');
            }
        };

        // Upskilling Dashboard React Component
        const UpskillingDashboard = () => {
            const [activeTab, setActiveTab] = useState('overview');
            
            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            const skills = [
                {
                    id: 1,
                    name: 'React',
                    currentLevel: 85,
                    targetLevel: 90,
                    marketDemand: 'high',
                    trendDirection: 'up',
                    lastUpdated: '2024-03-15'
                },
                {
                    id: 2,
                    name: 'TypeScript',
                    currentLevel: 75,
                    targetLevel: 85,
                    marketDemand: 'high',
                    trendDirection: 'up',
                    lastUpdated: '2024-03-14'
                },
                {
                    id: 3,
                    name: 'Node.js',
                    currentLevel: 70,
                    targetLevel: 80,
                    marketDemand: 'medium',
                    trendDirection: 'stable',
                    lastUpdated: '2024-03-12'
                },
                {
                    id: 4,
                    name: 'Python',
                    currentLevel: 60,
                    targetLevel: 75,
                    marketDemand: 'high',
                    trendDirection: 'up',
                    lastUpdated: '2024-03-10'
                }
            ];

            const learningPaths = [
                {
                    id: 1,
                    title: 'Full Stack Development',
                    description: 'Master modern web development with React, Node.js, and databases',
                    progress: 65,
                    estimatedTime: '6 months',
                    difficulty: 'intermediate',
                    skills: ['React', 'Node.js', 'MongoDB', 'TypeScript'],
                    nextMilestone: 'Build a complete e-commerce application'
                },
                {
                    id: 2,
                    title: 'AI/ML Engineering',
                    description: 'Learn machine learning fundamentals and AI development',
                    progress: 25,
                    estimatedTime: '8 months',
                    difficulty: 'advanced',
                    skills: ['Python', 'TensorFlow', 'Data Science', 'MLOps'],
                    nextMilestone: 'Complete your first ML project'
                },
                {
                    id: 3,
                    title: 'DevOps & Cloud',
                    description: 'Master cloud infrastructure and deployment strategies',
                    progress: 40,
                    estimatedTime: '4 months',
                    difficulty: 'intermediate',
                    skills: ['AWS', 'Docker', 'Kubernetes', 'CI/CD'],
                    nextMilestone: 'Deploy a scalable microservices architecture'
                }
            ];

            const sprints = [
                {
                    id: 1,
                    title: 'React Performance Optimization',
                    description: 'Learn advanced React patterns and optimization techniques',
                    duration: '2 weeks',
                    status: 'active',
                    progress: 60,
                    deliverable: 'Optimized React application',
                    startDate: '2024-03-10',
                    endDate: '2024-03-24'
                },
                {
                    id: 2,
                    title: 'TypeScript Advanced Patterns',
                    description: 'Master advanced TypeScript features and design patterns',
                    duration: '3 weeks',
                    status: 'upcoming',
                    progress: 0,
                    deliverable: 'TypeScript utility library',
                    startDate: '2024-03-25',
                    endDate: '2024-04-15'
                },
                {
                    id: 3,
                    title: 'Node.js Microservices',
                    description: 'Build scalable microservices with Node.js',
                    duration: '4 weeks',
                    status: 'completed',
                    progress: 100,
                    deliverable: 'Microservices architecture',
                    startDate: '2024-02-15',
                    endDate: '2024-03-10'
                }
            ];

            const achievements = [
                {
                    id: 1,
                    title: 'Sprint Completed',
                    description: 'React Performance Optimization',
                    color: 'bg-green-500',
                    date: '2024-03-15'
                },
                {
                    id: 2,
                    title: 'Skill Milestone',
                    description: 'React Level 85%',
                    color: 'bg-blue-500',
                    date: '2024-03-14'
                },
                {
                    id: 3,
                    title: 'Market Alignment',
                    description: 'High demand skills improved',
                    color: 'bg-purple-500',
                    date: '2024-03-12'
                }
            ];

            const getSkillLevelColor = (level) => {
                if (level >= 80) return 'text-green-400';
                if (level >= 60) return 'text-blue-400';
                if (level >= 40) return 'text-yellow-400';
                return 'text-red-400';
            };

            const getMarketDemandColor = (demand) => {
                switch (demand) {
                    case 'high':
                        return 'text-green-400 bg-green-500/20';
                    case 'medium':
                        return 'text-yellow-400 bg-yellow-500/20';
                    case 'low':
                        return 'text-red-400 bg-red-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getTrendIcon = (trend) => {
                switch (trend) {
                    case 'up':
                        return '';
                    case 'down':
                        return '';
                    case 'stable':
                        return '';
                    default:
                        return '';
                }
            };

            const getDifficultyColor = (difficulty) => {
                switch (difficulty) {
                    case 'beginner':
                        return 'text-green-400 bg-green-500/20';
                    case 'intermediate':
                        return 'text-yellow-400 bg-yellow-500/20';
                    case 'advanced':
                        return 'text-red-400 bg-red-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'active':
                        return 'text-green-400 bg-green-500/20';
                    case 'completed':
                        return 'text-blue-400 bg-blue-500/20';
                    case 'upcoming':
                        return 'text-orange-400 bg-orange-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const tabs = [
                { id: 'overview', label: 'Overview', icon: '' },
                { id: 'skills', label: 'Skills Radar', icon: '' },
                { id: 'paths', label: 'Learning Paths', icon: '' },
                { id: 'sprints', label: 'Learning Sprints', icon: '' },
                { id: 'certifications', label: 'Certifications', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex space-x-1 overflow-x-auto">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                        activeTab === tab.id
                                            ? 'bg-indigo-600 text-white shadow-lg'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                    }`}
                                >
                                    <div className="w-4 h-4">{tab.icon}</div>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'overview' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-8">
                                {/* Learning Progress Overview */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                            <div className="w-5 h-5 text-white text-xl"></div>
                                        </div>
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Learning Progress Overview</h2>
                                    </div>
                                    
                                    <div className="grid grid-cols-3 gap-6 mb-8">
                                        <div className="text-center">
                                            <div className={`text-3xl font-bold ${isLightMode ? 'text-indigo-600' : 'text-indigo-400'} mb-2`}>12</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills Tracked</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-3xl font-bold ${isLightMode ? 'text-green-600' : 'text-green-400'} mb-2`}>65%</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Avg. Progress</div>
                                        </div>
                                        <div className="text-center">
                                            <div className={`text-3xl font-bold ${isLightMode ? 'text-purple-600' : 'text-purple-400'} mb-2`}>8</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Completed Sprints</div>
                                        </div>
                                    </div>

                                    {/* Active Learning Paths */}
                                    <div className="mb-8">
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Active Learning Paths</h3>
                                        <div className="space-y-4">
                                            {learningPaths.slice(0, 2).map((path) => (
                                                <div key={path.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                    <div className="flex items-start justify-between mb-4">
                                                        <div>
                                                            <h4 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{path.title}</h4>
                                                            <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{path.description}</p>
                                                            <div className="flex items-center gap-3">
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(path.difficulty)}`}>
                                                                    {path.difficulty}
                                                                </span>
                                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{path.estimatedTime}</span>
                                                            </div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className={`text-2xl font-bold ${isLightMode ? 'text-indigo-600' : 'text-indigo-400'} mb-1`}>{path.progress}%</div>
                                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Progress</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="mb-4">
                                                        <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                            <span>Progress</span>
                                                            <span>{path.progress}%</span>
                                                        </div>
                                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                            <div 
                                                                className="bg-gradient-to-r from-purple-500 to-indigo-600 h-2 rounded-full transition-all duration-500"
                                                                style={{ width: `${path.progress}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="mb-4">
                                                        <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}><strong>Next Milestone:</strong> {path.nextMilestone}</p>
                                                        <div className="flex flex-wrap gap-2">
                                                            {path.skills.map((skill) => (
                                                                <span key={skill} className={`px-2 py-1 ${isLightMode ? 'bg-indigo-100 text-indigo-600' : 'bg-indigo-500/20 text-indigo-400'} text-xs rounded-full`}>
                                                                    {skill}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    
                                                    <button className="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300">
                                                        Continue Learning
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Current Learning Sprints */}
                                    <div>
                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Current Learning Sprints</h3>
                                        <div className="space-y-4">
                                            {sprints.filter(sprint => sprint.status === 'active').map((sprint) => (
                                                <div key={sprint.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                    <div className="flex items-start justify-between mb-4">
                                                        <div>
                                                            <h4 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{sprint.title}</h4>
                                                            <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{sprint.description}</p>
                                                            <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                <span>{sprint.duration}</span>
                                                                <span></span>
                                                                <span>Deliverable: {sprint.deliverable}</span>
                                                            </div>
                                                        </div>
                                                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(sprint.status)}`}>
                                                            {sprint.status}
                                                        </span>
                                                    </div>
                                                    
                                                    <div className="mb-4">
                                                        <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                            <span>Progress</span>
                                                            <span>{sprint.progress}%</span>
                                                        </div>
                                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                            <div 
                                                                className="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full transition-all duration-500"
                                                                style={{ width: `${sprint.progress}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Skill Radar Summary */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Skill Radar Summary</h3>
                                    <div className="space-y-4">
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-green-400 mb-1">4</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>High Demand Skills</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-blue-400 mb-1">3</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Trending Up</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-purple-400 mb-1">2</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills to Learn</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-2xl font-bold text-yellow-400 mb-1">85%</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Market Alignment</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Quick Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Actions</h3>
                                    <div className="space-y-3">
                                        <button className="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300">
                                            Start New Sprint
                                        </button>
                                        <button className="w-full bg-blue-600 text-white py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">
                                            Browse Learning Paths
                                        </button>
                                        <button className="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                            Plan Certifications
                                        </button>
                                    </div>
                                </div>

                                {/* Recent Achievements */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Recent Achievements</h3>
                                    <div className="space-y-3">
                                        {achievements.map((achievement) => (
                                            <div key={achievement.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                <div className="flex items-start gap-3">
                                                    <div className={`w-3 h-3 rounded-full ${achievement.color} mt-2 flex-shrink-0`}></div>
                                                    <div>
                                                        <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{achievement.title}</h4>
                                                        <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>{achievement.description}</p>
                                                        <p className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mt-1`}>{achievement.date}</p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'skills' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Your Skills Portfolio</h2>
                                    
                                    <div className="space-y-6">
                                        {skills.map((skill) => (
                                            <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex items-start gap-4">
                                                        <div className="w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                                            <div className="w-6 h-6 text-white text-xl"></div>
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-2">
                                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h3>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getMarketDemandColor(skill.marketDemand)}`}>
                                                                    {skill.marketDemand} demand
                                                                </span>
                                                                <div className="flex items-center gap-1">
                                                                    <div className="w-4 h-4">{getTrendIcon(skill.trendDirection)}</div>
                                                                    <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{skill.trendDirection}</span>
                                                                </div>
                                                            </div>
                                                            <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-4`}>
                                                                <span>Current: {skill.currentLevel}%</span>
                                                                <span>Target: {skill.targetLevel}%</span>
                                                                <span>Updated: {skill.lastUpdated}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className={`text-2xl font-bold ${getSkillLevelColor(skill.currentLevel)}`}>
                                                            {skill.currentLevel}%
                                                        </div>
                                                        <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Current Level</div>
                                                    </div>
                                                </div>
                                                
                                                <div className="mb-4">
                                                    <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                        <span>Progress to Target</span>
                                                        <span>{skill.currentLevel}/{skill.targetLevel}%</span>
                                                    </div>
                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-3`}>
                                                        <div 
                                                            className="bg-gradient-to-r from-purple-500 to-indigo-600 h-3 rounded-full transition-all duration-500"
                                                            style={{ width: `${(skill.currentLevel / skill.targetLevel) * 100}%` }}
                                                        ></div>
                                                    </div>
                                                </div>
                                                
                                                <div className="flex items-center justify-between">
                                                    <div className="text-sm text-gray-400">
                                                        {skill.targetLevel - skill.currentLevel}% to reach target
                                                    </div>
                                                    <button className="bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors duration-200">
                                                        Update Progress
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Market Insights */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Market Insights</h3>
                                    <div className="space-y-4">
                                        <div className="bg-green-500/20 border border-green-500/50 rounded-lg p-4">
                                            <h4 className="font-medium text-green-400 mb-1">Trending Skill</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>AI/ML skills are in high demand (+25% growth)</p>
                                        </div>
                                        <div className="bg-blue-500/20 border border-blue-500/50 rounded-lg p-4">
                                            <h4 className="font-medium text-blue-400 mb-1">Opportunity</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>React developers earn 15% more than average</p>
                                        </div>
                                        <div className="bg-purple-500/20 border border-purple-500/50 rounded-lg p-4">
                                            <h4 className="font-medium text-purple-400 mb-1">Recommendation</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Focus on TypeScript to boost your market value</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'paths' && (
                        <div className="space-y-8">
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Learning Paths</h2>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {learningPaths.map((path) => (
                                        <div key={path.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:scale-105 transition-transform duration-300`}>
                                            <div className="flex items-start justify-between mb-4">
                                                <div>
                                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{path.title}</h3>
                                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{path.description}</p>
                                                    <div className="flex items-center gap-3 mb-4">
                                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(path.difficulty)}`}>
                                                            {path.difficulty}
                                                        </span>
                                                        <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{path.estimatedTime}</span>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <div className={`text-2xl font-bold ${isLightMode ? 'text-indigo-600' : 'text-indigo-400'} mb-1`}>{path.progress}%</div>
                                                    <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Progress</div>
                                                </div>
                                            </div>
                                            
                                            <div className="mb-4">
                                                <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                    <span>Progress</span>
                                                    <span>{path.progress}%</span>
                                                </div>
                                                <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                    <div 
                                                        className="bg-gradient-to-r from-purple-500 to-indigo-600 h-2 rounded-full transition-all duration-500"
                                                        style={{ width: `${path.progress}%` }}
                                                    ></div>
                                                </div>
                                            </div>
                                            
                                            <div className="mb-4">
                                                <div className="flex flex-wrap gap-2">
                                                    {path.skills.map((skill) => (
                                                        <span key={skill} className={`px-2 py-1 ${isLightMode ? 'bg-indigo-100 text-indigo-600' : 'bg-indigo-500/20 text-indigo-400'} text-xs rounded-full`}>
                                                            {skill}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                            
                                            <button className="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300">
                                                Continue Learning
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'sprints' && (
                        <div className="space-y-8">
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Learning Sprints</h2>
                                    <button className="bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300">
                                        Start New Sprint
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {sprints.map((sprint) => (
                                        <div key={sprint.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:scale-105 transition-transform duration-300`}>
                                            <div className="flex items-start justify-between mb-4">
                                                <div>
                                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{sprint.title}</h3>
                                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{sprint.description}</p>
                                                    <div className={`flex items-center gap-3 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-4`}>
                                                        <span>{sprint.duration}</span>
                                                        <span></span>
                                                        <span>{sprint.deliverable}</span>
                                                    </div>
                                                </div>
                                                <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(sprint.status)}`}>
                                                    {sprint.status}
                                                </span>
                                            </div>
                                            
                                            {sprint.status === 'active' && (
                                                <div className="mb-4">
                                                    <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                        <span>Progress</span>
                                                        <span>{sprint.progress}%</span>
                                                    </div>
                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                        <div 
                                                            className="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full transition-all duration-500"
                                                            style={{ width: `${sprint.progress}%` }}
                                                        ></div>
                                                    </div>
                                                </div>
                                            )}
                                            
                                            <div className={`flex items-center justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-4`}>
                                                <span>Start: {sprint.startDate}</span>
                                                <span>End: {sprint.endDate}</span>
                                            </div>
                                            
                                            <button className={`w-full py-2 rounded-lg font-medium transition-colors duration-200 ${
                                                sprint.status === 'active' 
                                                    ? 'bg-green-600 text-white hover:bg-green-700'
                                                    : sprint.status === 'completed'
                                                    ? 'bg-blue-600 text-white hover:bg-blue-700'
                                                    : 'bg-orange-600 text-white hover:bg-orange-700'
                                            }`}>
                                                {sprint.status === 'active' ? 'Continue Sprint' : 
                                                 sprint.status === 'completed' ? 'View Results' : 'Start Sprint'}
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'certifications' && (
                        <div className="space-y-8">
                            <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                <div className="text-center py-20">
                                    <div className="w-20 h-20 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                        <div className="w-10 h-10 text-white text-3xl"></div>
                                    </div>
                                    <h3 className={`text-2xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Certification Planning</h3>
                                    <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-8`}>Plan and track your professional certifications to boost your career</p>
                                    <button className="bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-700 transition-all duration-300">
                                        Plan Certifications
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Upskilling Dashboard when upskilling-dash-content is shown
        window.renderUpskillingDashboard = function() {
            console.log('renderUpskillingDashboard called');
            const container = document.getElementById('upskilling-dash-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Upskilling Dashboard...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<UpskillingDashboard />);
                    console.log('Upskilling Dashboard rendered successfully');
                } catch (error) {
                    console.error('Error rendering Upskilling Dashboard:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Upskilling Dashboard</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('upskilling-dash-container not found');
            }
        };

        // Skill Radar React Component
        const SkillRadar = () => {
            const [activeView, setActiveView] = useState('radar');
            const [timeframe, setTimeframe] = useState('7d');
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [selectedSkill, setSelectedSkill] = useState(null);
            const [showSkillDetail, setShowSkillDetail] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [isScanning, setIsScanning] = useState(false);
            const [lastScanTime, setLastScanTime] = useState('2024-03-15 14:30');
            const [notifications, setNotifications] = useState([]);
            const [showOnboarding, setShowOnboarding] = useState(false);
            const [personalization, setPersonalization] = useState({
                role: 'Software Engineer',
                industry: 'Technology',
                location: 'San Francisco, CA',
                experienceLevel: 'Mid-level',
                careerGoals: 'Senior Developer',
                skillLevel: 'Intermediate'
            });

            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            const skills = [
                {
                    id: 1,
                    name: 'AI/ML',
                    category: 'technical',
                    demandScore: 95,
                    growthRate: 45,
                    salaryImpact: 25,
                    jobCount: 12500,
                    trend: 'rising',
                    position: { x: 0.7, y: 0.8 },
                    isWatched: true,
                    emergingStatus: 'hot',
                    learningResources: ['Coursera', 'Fast.ai', 'Kaggle'],
                    timeToLearn: '6-12 months',
                    relatedSkills: ['Python', 'TensorFlow', 'Data Science']
                },
                {
                    id: 2,
                    name: 'Kubernetes',
                    category: 'tools',
                    demandScore: 88,
                    growthRate: 32,
                    salaryImpact: 20,
                    jobCount: 8500,
                    trend: 'rising',
                    position: { x: 0.6, y: 0.3 },
                    isWatched: false,
                    emergingStatus: 'emerging',
                    learningResources: ['Kubernetes.io', 'CNCF', 'Linux Academy'],
                    timeToLearn: '3-6 months',
                    relatedSkills: ['Docker', 'DevOps', 'Cloud']
                },
                {
                    id: 3,
                    name: 'Product Management',
                    category: 'soft',
                    demandScore: 82,
                    growthRate: 28,
                    salaryImpact: 18,
                    jobCount: 9200,
                    trend: 'rising',
                    position: { x: 0.3, y: 0.7 },
                    isWatched: false,
                    emergingStatus: 'established',
                    learningResources: ['Product School', 'Reforge', 'Mind the Product'],
                    timeToLearn: '6-12 months',
                    relatedSkills: ['Agile', 'User Research', 'Analytics']
                },
                {
                    id: 4,
                    name: 'Cybersecurity',
                    category: 'technical',
                    demandScore: 91,
                    growthRate: 38,
                    salaryImpact: 22,
                    jobCount: 6800,
                    trend: 'rising',
                    position: { x: 0.8, y: 0.6 },
                    isWatched: true,
                    emergingStatus: 'hot',
                    learningResources: ['Cybrary', 'SANS', 'CompTIA'],
                    timeToLearn: '6-18 months',
                    relatedSkills: ['Network Security', 'Penetration Testing', 'Compliance']
                },
                {
                    id: 5,
                    name: 'Blockchain',
                    category: 'technical',
                    demandScore: 65,
                    growthRate: -12,
                    salaryImpact: 15,
                    jobCount: 3200,
                    trend: 'falling',
                    position: { x: 0.4, y: 0.4 },
                    isWatched: false,
                    emergingStatus: 'declining',
                    learningResources: ['Ethereum.org', 'CryptoZombies', 'Blockchain Council'],
                    timeToLearn: '3-9 months',
                    relatedSkills: ['Solidity', 'Web3', 'Smart Contracts']
                },
                {
                    id: 6,
                    name: 'Data Visualization',
                    category: 'tools',
                    demandScore: 76,
                    growthRate: 15,
                    salaryImpact: 12,
                    jobCount: 5400,
                    trend: 'stable',
                    position: { x: 0.5, y: 0.5 },
                    isWatched: false,
                    emergingStatus: 'established',
                    learningResources: ['Tableau', 'D3.js', 'Power BI'],
                    timeToLearn: '2-4 months',
                    relatedSkills: ['Tableau', 'D3.js', 'Power BI']
                }
            ];

            const quadrants = [
                { id: 'technical', name: 'Technical Skills', color: 'blue', skills: skills.filter(s => s.category === 'technical') },
                { id: 'soft', name: 'Soft Skills', color: 'green', skills: skills.filter(s => s.category === 'soft') },
                { id: 'tools', name: 'Tools & Platforms', color: 'orange', skills: skills.filter(s => s.category === 'tools') },
                { id: 'industry', name: 'Industry Knowledge', color: 'purple', skills: skills.filter(s => s.category === 'industry') }
            ];

            const getDemandColor = (score) => {
                if (score >= 90) return 'text-red-400 bg-red-500/20';
                if (score >= 80) return 'text-orange-400 bg-orange-500/20';
                if (score >= 70) return 'text-yellow-400 bg-yellow-500/20';
                if (score >= 60) return 'text-blue-400 bg-blue-500/20';
                return 'text-gray-400 bg-gray-500/20';
            };

            const getGrowthColor = (rate) => {
                if (rate > 0) return 'text-green-400';
                if (rate < 0) return 'text-red-400';
                return 'text-gray-400';
            };

            const getEmergingColor = (status) => {
                switch (status) {
                    case 'hot':
                        return 'text-red-400 bg-red-500/20';
                    case 'emerging':
                        return 'text-orange-400 bg-orange-500/20';
                    case 'established':
                        return 'text-blue-400 bg-blue-500/20';
                    case 'declining':
                        return 'text-gray-400 bg-gray-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getTrendIcon = (trend) => {
                switch (trend) {
                    case 'rising':
                        return '';
                    case 'falling':
                        return '';
                    case 'stable':
                        return '';
                    default:
                        return '';
                }
            };

            const getCategoryColor = (category) => {
                switch (category) {
                    case 'technical':
                        return 'text-blue-400 bg-blue-500/20';
                    case 'soft':
                        return 'text-green-400 bg-green-500/20';
                    case 'tools':
                        return 'text-orange-400 bg-orange-500/20';
                    case 'industry':
                        return 'text-purple-400 bg-purple-500/20';
                    default:
                        return 'text-gray-400 bg-gray-500/20';
                }
            };

            const handleMarketScan = () => {
                setIsScanning(true);
                setTimeout(() => {
                    setIsScanning(false);
                    setLastScanTime(new Date().toLocaleString());
                }, 3000);
            };

            const handleSkillClick = (skill) => {
                setSelectedSkill(skill);
                setShowSkillDetail(true);
            };

            const handleWatchlistToggle = (skillId) => {
                // Toggle watchlist functionality
                console.log('Toggle watchlist for skill:', skillId);
            };

            const tabs = [
                { id: 'radar', label: 'Skill Radar', icon: '' },
                { id: 'list', label: 'Trending Skills', icon: '' },
                { id: 'watchlist', label: 'My Watchlist', icon: '', count: skills.filter(s => s.isWatched).length },
                { id: 'insights', label: 'AI Insights', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex items-center justify-between">
                            <div className="flex space-x-1 overflow-x-auto">
                                {tabs.map((tab) => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveView(tab.id)}
                                        className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                            activeView === tab.id
                                                ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg'
                                                : isLightMode 
                                                    ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                    : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                    >
                                        <div className="w-4 h-4">{tab.icon}</div>
                                        {tab.label}
                                        {tab.count !== undefined && (
                                            <span className="bg-indigo-500 text-white text-xs px-2 py-1 rounded-full">
                                                {tab.count}
                                            </span>
                                        )}
                                    </button>
                                ))}
                            </div>
                            <div className="flex items-center gap-2 ml-4">
                                <button
                                    onClick={() => setShowSettings(true)}
                                    className={`p-2 ${isLightMode ? 'bg-gray-200 hover:bg-gray-300 text-gray-700' : 'bg-gray-700 hover:bg-gray-600 text-white'} rounded-lg transition-all duration-300`}
                                >
                                    <div className="w-4 h-4"></div>
                                </button>
                                <button
                                    onClick={handleMarketScan}
                                    disabled={isScanning}
                                    className="bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all duration-300 disabled:opacity-50"
                                >
                                    {isScanning ? (
                                        <>
                                            <div className="w-4 h-4 animate-spin"></div>
                                            Scanning...
                                        </>
                                    ) : (
                                        <>
                                            <div className="w-4 h-4"></div>
                                            Scan Market
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeView === 'radar' && (
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-3 space-y-6">
                                {/* Live Skill Radar */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Live Skill Radar</h2>
                                        <div className="flex items-center gap-3">
                                            <select
                                                value={timeframe}
                                                onChange={(e) => setTimeframe(e.target.value)}
                                                className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="7d">Last 7 days</option>
                                                <option value="30d">Last 30 days</option>
                                                <option value="90d">Last 90 days</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className={`relative w-full h-96 ${isLightMode ? 'bg-gray-100' : 'bg-gray-900'} rounded-xl overflow-hidden`}>
                                        <svg className="w-full h-full" viewBox="0 0 400 400">
                                            {/* Grid circles */}
                                            <circle cx="200" cy="200" r="50" fill="none" stroke="gray" strokeWidth="1" opacity="0.3"/>
                                            <circle cx="200" cy="200" r="100" fill="none" stroke="gray" strokeWidth="1" opacity="0.3"/>
                                            <circle cx="200" cy="200" r="150" fill="none" stroke="gray" strokeWidth="1" opacity="0.3"/>
                                            
                                            {/* Cross lines */}
                                            <line x1="200" y1="50" x2="200" y2="350" stroke="gray" strokeWidth="1" opacity="0.3"/>
                                            <line x1="50" y1="200" x2="350" y2="200" stroke="gray" strokeWidth="1" opacity="0.3"/>
                                            
                                            {/* Quadrant labels */}
                                            <text x="200" y="30" textAnchor="middle" className={`text-sm font-medium ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Technical Skills</text>
                                            <text x="370" y="200" textAnchor="middle" className={`text-sm font-medium ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Tools & Platforms</text>
                                            <text x="200" y="380" textAnchor="middle" className={`text-sm font-medium ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Industry Knowledge</text>
                                            <text x="30" y="200" textAnchor="middle" className={`text-sm font-medium ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Soft Skills</text>
                                            
                                            {/* Skill dots */}
                                            {skills.map((skill) => {
                                                const x = 200 + (skill.position.x - 0.5) * 300;
                                                const y = 200 + (skill.position.y - 0.5) * 300;
                                                const dotColor = skill.emergingStatus === 'hot' ? 'red' : 
                                                               skill.emergingStatus === 'emerging' ? 'orange' : 
                                                               skill.emergingStatus === 'established' ? 'blue' : 'gray';
                                                
                                                return (
                                                    <g key={skill.id}>
                                                        {skill.isWatched && (
                                                            <circle cx={x} cy={y} r="12" fill="none" stroke="yellow" strokeWidth="2" opacity="0.8"/>
                                                        )}
                                                        <circle
                                                            cx={x}
                                                            cy={y}
                                                            r="8"
                                                            fill={dotColor}
                                                            className="cursor-pointer hover:scale-125 transition-transform duration-200"
                                                            onClick={() => handleSkillClick(skill)}
                                                        />
                                                        <text x={x} y={y + 3} textAnchor="middle" className="text-xs fill-white font-medium">
                                                            {skill.name.substring(0, 3)}
                                                        </text>
                                                    </g>
                                                );
                                            })}
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Filters */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Filters</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Category</label>
                                            <select
                                                value={selectedCategory}
                                                onChange={(e) => setSelectedCategory(e.target.value)}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Categories</option>
                                                <option value="technical">Technical Skills</option>
                                                <option value="soft">Soft Skills</option>
                                                <option value="tools">Tools & Platforms</option>
                                                <option value="industry">Industry Knowledge</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-300 mb-2">Search</label>
                                            <input
                                                type="text"
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                placeholder="Search skills..."
                                                className="w-full px-3 py-2 bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Hot Skills This Week */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Hot Skills This Week</h3>
                                    <div className="space-y-3">
                                        {skills.filter(skill => skill.emergingStatus === 'hot').map((skill) => (
                                            <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                                <div className="flex items-center justify-between mb-2">
                                                    <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h4>
                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDemandColor(skill.demandScore)}`}>
                                                        {skill.demandScore}
                                                    </span>
                                                </div>
                                                <div className={`flex items-center gap-2 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                    <span>{skill.growthRate}% growth</span>
                                                    <span></span>
                                                    <span>{skill.jobCount.toLocaleString()} jobs</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Market Intelligence */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Market Intelligence</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Skills Tracked</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skills.length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Hot Skills</span>
                                            <span className="text-sm font-medium text-red-400">
                                                {skills.filter(s => s.emergingStatus === 'hot').length}
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Rising Trends</span>
                                            <span className="text-sm font-medium text-green-400">
                                                {skills.filter(s => s.trend === 'rising').length}
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>Avg. Demand</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>
                                                {Math.round(skills.reduce((acc, skill) => acc + skill.demandScore, 0) / skills.length)}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeView === 'list' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Trending Skills</h2>
                                        <div className="flex items-center gap-3">
                                            <input
                                                type="text"
                                                value={searchQuery}
                                                onChange={(e) => setSearchQuery(e.target.value)}
                                                placeholder="Search skills..."
                                                className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            />
                                            <select
                                                value={selectedCategory}
                                                onChange={(e) => setSelectedCategory(e.target.value)}
                                                className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Categories</option>
                                                <option value="technical">Technical</option>
                                                <option value="soft">Soft Skills</option>
                                                <option value="tools">Tools</option>
                                                <option value="industry">Industry</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {skills.map((skill) => (
                                            <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:border-indigo-500/50 transition-all duration-300`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex items-start gap-4">
                                                        <div className="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                                            <div className="w-6 h-6 text-white text-xl"></div>
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-2">
                                                                <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h3>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getCategoryColor(skill.category)}`}>
                                                                    {skill.category}
                                                                </span>
                                                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getEmergingColor(skill.emergingStatus)}`}>
                                                                    {skill.emergingStatus}
                                                                </span>
                                                            </div>
                                                            <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                                <span>Demand: {skill.demandScore}</span>
                                                                <span></span>
                                                                <span className={`flex items-center gap-1 ${getGrowthColor(skill.growthRate)}`}>
                                                                    {getTrendIcon(skill.trend)} {skill.growthRate}%
                                                                </span>
                                                                <span></span>
                                                                <span>{skill.jobCount.toLocaleString()} jobs</span>
                                                            </div>
                                                            <div className="flex flex-wrap gap-2 mb-4">
                                                                {skill.relatedSkills.map((relatedSkill) => (
                                                                    <span key={relatedSkill} className={`px-2 py-1 ${isLightMode ? 'bg-indigo-100 text-indigo-600' : 'bg-indigo-500/20 text-indigo-400'} text-xs rounded-full`}>
                                                                        {relatedSkill}
                                                                    </span>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <button
                                                            onClick={() => handleWatchlistToggle(skill.id)}
                                                            className={`p-2 rounded-lg transition-colors duration-200 ${
                                                                skill.isWatched 
                                                                    ? 'bg-yellow-500 text-white' 
                                                                    : 'bg-gray-700 text-gray-400 hover:bg-gray-600'
                                                            }`}
                                                        >
                                                            <div className="w-4 h-4"></div>
                                                        </button>
                                                        <button
                                                            onClick={() => handleSkillClick(skill)}
                                                            className="p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200"
                                                        >
                                                            <div className="w-4 h-4"></div>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-4 gap-4">
                                                    <div className="text-center">
                                                        <div className="text-2xl font-bold text-indigo-400">{skill.demandScore}</div>
                                                        <div className="text-xs text-gray-400">Demand Score</div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className={`text-2xl font-bold ${getGrowthColor(skill.growthRate)}`}>
                                                            {skill.growthRate}%
                                                        </div>
                                                        <div className="text-xs text-gray-400">Growth Rate</div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-2xl font-bold text-green-400">+{skill.salaryImpact}%</div>
                                                        <div className="text-xs text-gray-400">Salary Impact</div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-2xl font-bold text-purple-400">{skill.jobCount.toLocaleString()}</div>
                                                        <div className="text-xs text-gray-400">Job Openings</div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Category Breakdown */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Category Breakdown</h3>
                                    <div className="space-y-3">
                                        {quadrants.map((quadrant) => (
                                            <div key={quadrant.id} className="flex items-center justify-between">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{quadrant.name}</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{quadrant.skills.length}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Quick Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Actions</h3>
                                    <div className="space-y-3">
                                        <button className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-700 transition-all duration-300">
                                            Add to Watchlist
                                        </button>
                                        <button className="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                            Start Learning
                                        </button>
                                        <button className="w-full bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                            Find Jobs
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeView === 'watchlist' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>My Skill Watchlist</h2>
                                    
                                    {skills.filter(skill => skill.isWatched).length === 0 ? (
                                        <div className="text-center py-20">
                                            <div className={`w-16 h-16 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full flex items-center justify-center mx-auto mb-4`}>
                                                <div className={`w-8 h-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'} text-2xl`}></div>
                                            </div>
                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>No Skills in Watchlist</h3>
                                            <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>Start watching skills to track their market trends and opportunities</p>
                                            <button className="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-700 transition-all duration-300">
                                                Browse Skills
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            {skills.filter(skill => skill.isWatched).map((skill) => (
                                                <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-yellow-500/30' : 'bg-gray-800 border-yellow-500/30'} border rounded-lg p-6`}>
                                                    <div className="flex items-start justify-between mb-4">
                                                        <div className="flex items-start gap-4">
                                                            <div className="w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center">
                                                                <div className="w-6 h-6 text-white text-xl"></div>
                                                            </div>
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-3 mb-2">
                                                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h3>
                                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getCategoryColor(skill.category)}`}>
                                                                        {skill.category}
                                                                    </span>
                                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getEmergingColor(skill.emergingStatus)}`}>
                                                                        {skill.emergingStatus}
                                                                    </span>
                                                                </div>
                                                                <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                                    <span>Demand: {skill.demandScore}</span>
                                                                    <span></span>
                                                                    <span className={`flex items-center gap-1 ${getGrowthColor(skill.growthRate)}`}>
                                                                        {getTrendIcon(skill.trend)} {skill.growthRate}%
                                                                    </span>
                                                                    <span></span>
                                                                    <span>{skill.jobCount.toLocaleString()} jobs</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => handleWatchlistToggle(skill.id)}
                                                            className="p-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200"
                                                        >
                                                            <div className="w-4 h-4"></div>
                                                        </button>
                                                    </div>
                                                    
                                                    <div className="grid grid-cols-4 gap-4">
                                                        <div className="text-center">
                                                            <div className="text-2xl font-bold text-indigo-400">{skill.demandScore}</div>
                                                            <div className="text-xs text-gray-400">Demand Score</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className={`text-2xl font-bold ${getGrowthColor(skill.growthRate)}`}>
                                                                {skill.growthRate}%
                                                            </div>
                                                            <div className="text-xs text-gray-400">Growth Rate</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-2xl font-bold text-green-400">+{skill.salaryImpact}%</div>
                                                            <div className="text-xs text-gray-400">Salary Impact</div>
                                                        </div>
                                                        <div className="text-center">
                                                            <div className="text-2xl font-bold text-purple-400">{skill.jobCount.toLocaleString()}</div>
                                                            <div className="text-xs text-gray-400">Job Openings</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Watchlist Insights */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Watchlist Insights</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills Watched</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skills.filter(s => s.isWatched).length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Hot Skills</span>
                                            <span className="text-sm font-medium text-red-400">
                                                {skills.filter(s => s.isWatched && s.emergingStatus === 'hot').length}
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Rising Trends</span>
                                            <span className="text-sm font-medium text-green-400">
                                                {skills.filter(s => s.isWatched && s.trend === 'rising').length}
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                {/* Recommended Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Recommended Actions</h3>
                                    <div className="space-y-3">
                                        <div className="bg-green-500/20 border border-green-500/50 rounded-lg p-3">
                                            <h4 className="font-medium text-green-400 mb-1">Start Learning</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>AI/ML is trending up - perfect time to start</p>
                                        </div>
                                        <div className="bg-blue-500/20 border border-blue-500/50 rounded-lg p-3">
                                            <h4 className="font-medium text-blue-400 mb-1">Job Search</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Cybersecurity has high demand</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeView === 'insights' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Personalized AI Insights</h2>
                                    
                                    {/* Top Recommendation */}
                                    <div className="bg-gradient-to-r from-green-500 to-emerald-600 rounded-2xl p-6 mb-6">
                                        <div className="flex items-center gap-3 mb-4">
                                            <div className="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                                <div className="w-5 h-5 text-white text-xl"></div>
                                            </div>
                                            <h3 className="text-xl font-semibold text-white">Top Recommendation</h3>
                                        </div>
                                        <h4 className="text-lg font-semibold text-white mb-2">Focus on AI/ML Skills</h4>
                                        <p className="text-green-100 mb-4">Based on your profile as a Software Engineer, AI/ML skills show the highest growth potential with 45% growth rate and 12,500+ job openings.</p>
                                        <div className="grid grid-cols-3 gap-4">
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-white">95</div>
                                                <div className="text-sm text-green-100">Demand Score</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-white">45%</div>
                                                <div className="text-sm text-green-100">Growth Rate</div>
                                            </div>
                                            <div className="text-center">
                                                <div className="text-2xl font-bold text-white">25%</div>
                                                <div className="text-sm text-green-100">Salary Impact</div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Market Intelligence Grid */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="bg-red-500/20 border border-red-500/50 rounded-lg p-4">
                                            <div className="flex items-center gap-2 mb-2">
                                                <div className="w-4 h-4 text-red-400"></div>
                                                <h4 className="font-medium text-red-400">Hot Alert</h4>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Cybersecurity demand spiked 38% this week</p>
                                        </div>
                                        <div className="bg-blue-500/20 border border-blue-500/50 rounded-lg p-4">
                                            <div className="flex items-center gap-2 mb-2">
                                                <div className="w-4 h-4 text-blue-400"></div>
                                                <h4 className="font-medium text-blue-400">Trend Alert</h4>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Kubernetes skills growing 32% monthly</p>
                                        </div>
                                        <div className="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4">
                                            <div className="flex items-center gap-2 mb-2">
                                                <div className="w-4 h-4 text-yellow-400"></div>
                                                <h4 className="font-medium text-yellow-400">Warning</h4>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Blockchain demand declining -12%</p>
                                        </div>
                                        <div className="bg-green-500/20 border border-green-500/50 rounded-lg p-4">
                                            <div className="flex items-center gap-2 mb-2">
                                                <div className="w-4 h-4 text-green-400"></div>
                                                <h4 className="font-medium text-green-400">Opportunity</h4>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Product Management roles up 28%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Your Profile */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Your Profile</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Role</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{personalization.role}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Industry</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{personalization.industry}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Location</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{personalization.location}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Experience</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{personalization.experienceLevel}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Career Goal</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{personalization.careerGoals}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Notifications */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Notifications</h3>
                                    <div className="space-y-3">
                                        <div className="bg-blue-500/20 border border-blue-500/50 rounded-lg p-3">
                                            <h4 className="font-medium text-blue-400 mb-1">Skill Alert</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>AI/ML demand increased 5%</p>
                                        </div>
                                        <div className="bg-green-500/20 border border-green-500/50 rounded-lg p-3">
                                            <h4 className="font-medium text-green-400 mb-1">Market Update</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>New jobs posted for your skills</p>
                                        </div>
                                        <div className="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-3">
                                            <h4 className="font-medium text-yellow-400 mb-1">Learning Tip</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Consider Kubernetes certification</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Skill Detail Modal */}
                    {showSkillDetail && selectedSkill && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-[#111827] border border-gray-700 rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-50">{selectedSkill.name}</h2>
                                    <button
                                        onClick={() => setShowSkillDetail(false)}
                                        className="p-2 bg-gray-700 text-gray-400 rounded-lg hover:bg-gray-600 transition-colors duration-200"
                                    >
                                        <div className="w-5 h-5"></div>
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Market Data */}
                                    <div className="space-y-6">
                                        <h3 className="text-lg font-semibold text-gray-50 mb-4">Market Data</h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-gray-800 rounded-lg p-4 text-center">
                                                <div className="text-3xl font-bold text-indigo-400 mb-1">{selectedSkill.demandScore}</div>
                                                <div className="text-sm text-gray-400">Demand Score</div>
                                            </div>
                                            <div className="bg-gray-800 rounded-lg p-4 text-center">
                                                <div className={`text-3xl font-bold ${getGrowthColor(selectedSkill.growthRate)}`}>
                                                    {selectedSkill.growthRate}%
                                                </div>
                                                <div className="text-sm text-gray-400">Growth Rate</div>
                                            </div>
                                            <div className="bg-gray-800 rounded-lg p-4 text-center">
                                                <div className="text-3xl font-bold text-green-400">+{selectedSkill.salaryImpact}%</div>
                                                <div className="text-sm text-gray-400">Salary Impact</div>
                                            </div>
                                            <div className="bg-gray-800 rounded-lg p-4 text-center">
                                                <div className="text-3xl font-bold text-purple-400">{selectedSkill.jobCount.toLocaleString()}</div>
                                                <div className="text-sm text-gray-400">Job Openings</div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Learning Information */}
                                    <div className="space-y-6">
                                        <h3 className="text-lg font-semibold text-gray-50 mb-4">Learning Information</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <h4 className="font-medium text-gray-50 mb-2">Time to Learn</h4>
                                                <p className="text-gray-300">{selectedSkill.timeToLearn}</p>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-gray-50 mb-2">Learning Resources</h4>
                                                <div className="flex flex-wrap gap-2">
                                                    {selectedSkill.learningResources.map((resource) => (
                                                        <span key={resource} className="px-2 py-1 bg-indigo-500/20 text-indigo-400 text-xs rounded-full">
                                                            {resource}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                            <div>
                                                <h4 className="font-medium text-gray-50 mb-2">Related Skills</h4>
                                                <div className="flex flex-wrap gap-2">
                                                    {selectedSkill.relatedSkills.map((skill) => (
                                                        <span key={skill} className="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded-full">
                                                            {skill}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex items-center gap-4 mt-8">
                                    <button
                                        onClick={() => handleWatchlistToggle(selectedSkill.id)}
                                        className={`px-6 py-3 rounded-lg font-medium transition-colors duration-200 ${
                                            selectedSkill.isWatched 
                                                ? 'bg-yellow-600 text-white hover:bg-yellow-700' 
                                                : 'bg-indigo-600 text-white hover:bg-indigo-700'
                                        }`}
                                    >
                                        {selectedSkill.isWatched ? 'Remove from Watchlist' : 'Add to Watchlist'}
                                    </button>
                                    <button className="px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                        Start Learning
                                    </button>
                                    <button className="px-6 py-3 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                        Find Jobs
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-[#111827] border border-gray-700 rounded-2xl p-8 max-w-2xl w-full">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-50">Settings</h2>
                                    <button
                                        onClick={() => setShowSettings(false)}
                                        className="p-2 bg-gray-700 text-gray-400 rounded-lg hover:bg-gray-600 transition-colors duration-200"
                                    >
                                        <div className="w-5 h-5"></div>
                                    </button>
                                </div>
                                
                                <div className="space-y-6">
                                    <div>
                                        <h3 className="text-lg font-semibold text-gray-50 mb-4">Profile Information</h3>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-300 mb-2">Role</label>
                                                <select className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                    <option>Software Engineer</option>
                                                    <option>Data Scientist</option>
                                                    <option>Product Manager</option>
                                                    <option>DevOps Engineer</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-300 mb-2">Industry</label>
                                                <select className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                    <option>Technology</option>
                                                    <option>Finance</option>
                                                    <option>Healthcare</option>
                                                    <option>E-commerce</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-300 mb-2">Experience Level</label>
                                                <select className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                    <option>Entry-level</option>
                                                    <option>Mid-level</option>
                                                    <option>Senior</option>
                                                    <option>Lead</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-300 mb-2">Location</label>
                                                <select className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                    <option>San Francisco, CA</option>
                                                    <option>New York, NY</option>
                                                    <option>Seattle, WA</option>
                                                    <option>Remote</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 className="text-lg font-semibold text-gray-50 mb-4">Notification Preferences</h3>
                                        <div className="space-y-3">
                                            <div className="flex items-center justify-between">
                                                <span className="text-sm text-gray-300">Skill alerts</span>
                                                <input type="checkbox" className="w-4 h-4 text-indigo-600 bg-gray-800 border-gray-700 rounded focus:ring-indigo-500" defaultChecked />
                                            </div>
                                            <div className="flex items-center justify-between">
                                                <span className="text-sm text-gray-300">Market updates</span>
                                                <input type="checkbox" className="w-4 h-4 text-indigo-600 bg-gray-800 border-gray-700 rounded focus:ring-indigo-500" defaultChecked />
                                            </div>
                                            <div className="flex items-center justify-between">
                                                <span className="text-sm text-gray-300">Learning recommendations</span>
                                                <input type="checkbox" className="w-4 h-4 text-indigo-600 bg-gray-800 border-gray-700 rounded focus:ring-indigo-500" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex items-center gap-4 mt-8">
                                    <button className="px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors duration-200">
                                        Save Settings
                                    </button>
                                    <button
                                        onClick={() => setShowSettings(false)}
                                        className="px-6 py-3 bg-gray-600 text-white rounded-lg font-medium hover:bg-gray-700 transition-colors duration-200"
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Skill Radar when skill-radar-content is shown
        window.renderSkillRadar = function() {
            console.log('renderSkillRadar called');
            const container = document.getElementById('skill-radar-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Skill Radar...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<SkillRadar />);
                    console.log('Skill Radar rendered successfully');
                } catch (error) {
                    console.error('Error rendering Skill Radar:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Skill Radar</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('skill-radar-container not found');
            }
        };

        // Learning Path React Component
        const LearningPath = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showOnboarding, setShowOnboarding] = useState(false);
            const [onboardingStep, setOnboardingStep] = useState(1);
            const [selectedPath, setSelectedPath] = useState(null);
            const [showPathDetails, setShowPathDetails] = useState(false);
            const [expandedWeek, setExpandedWeek] = useState(null);
            const [learningGoals, setLearningGoals] = useState([]);
            const [experienceLevel, setExperienceLevel] = useState('');
            const [timeCommitment, setTimeCommitment] = useState(5);
            const [learningStyle, setLearningStyle] = useState([]);
            const [targetRole, setTargetRole] = useState('');

            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            const learningPaths = [
                {
                    id: 1,
                    title: 'Full-Stack React Development',
                    description: 'Master modern React development with hooks, context, and full-stack integration',
                    duration: 90,
                    difficulty: 'intermediate',
                    skills: ['React', 'Node.js', 'MongoDB', 'TypeScript'],
                    progress: 65,
                    status: 'in-progress',
                    estimatedHours: 120,
                    projects: 8,
                    createdAt: '2024-01-15',
                    nextActivity: 'Build a Todo App with React Hooks',
                    streak: 12
                },
                {
                    id: 2,
                    title: 'Modern Frontend with TypeScript',
                    description: 'Advanced frontend development using TypeScript, modern build tools, and best practices',
                    duration: 60,
                    difficulty: 'advanced',
                    skills: ['TypeScript', 'Vite', 'Tailwind CSS', 'Testing'],
                    progress: 0,
                    status: 'not-started',
                    estimatedHours: 80,
                    projects: 5,
                    createdAt: '2024-02-01',
                    nextActivity: 'Setup TypeScript Project',
                    streak: 0
                },
                {
                    id: 3,
                    title: 'DevOps & Cloud Deployment',
                    description: 'Learn containerization, CI/CD, and cloud deployment strategies',
                    duration: 75,
                    difficulty: 'intermediate',
                    skills: ['Docker', 'Kubernetes', 'AWS', 'CI/CD'],
                    progress: 100,
                    status: 'completed',
                    estimatedHours: 100,
                    projects: 6,
                    createdAt: '2023-11-20',
                    nextActivity: 'Certificate Available',
                    streak: 0
                }
            ];

            const weeklySprints = [
                {
                    week: 1,
                    title: 'React Fundamentals',
                    objectives: [
                        'Understand React components and JSX',
                        'Learn state management with useState',
                        'Practice event handling'
                    ],
                    activities: [
                        { id: 1, title: 'Introduction to React', type: 'video', duration: 45, completed: true },
                        { id: 2, title: 'JSX and Components', type: 'reading', duration: 30, completed: true },
                        { id: 3, title: 'State and Props', type: 'practice', duration: 60, completed: false }
                    ],
                    project: {
                        title: 'Hello World Component',
                        estimatedTime: '2 hours',
                        completed: true
                    },
                    completed: true
                },
                {
                    week: 2,
                    title: 'Hooks and State Management',
                    objectives: [
                        'Master React Hooks (useState, useEffect)',
                        'Learn custom hooks',
                        'Understand state lifting'
                    ],
                    activities: [
                        { id: 4, title: 'useState Hook Deep Dive', type: 'video', duration: 50, completed: true },
                        { id: 5, title: 'useEffect Hook', type: 'reading', duration: 40, completed: true },
                        { id: 6, title: 'Custom Hooks', type: 'practice', duration: 90, completed: false }
                    ],
                    project: {
                        title: 'Counter App with Hooks',
                        estimatedTime: '3 hours',
                        completed: false
                    },
                    completed: false
                }
            ];

            const availableSkills = ['React', 'TypeScript', 'Node.js', 'Python', 'JavaScript', 'CSS', 'HTML', 'MongoDB', 'PostgreSQL', 'Docker', 'AWS', 'Git'];
            const learningStyles = ['Visual', 'Auditory', 'Kinesthetic', 'Reading/Writing', 'Interactive', 'Self-paced'];
            const targetRoles = ['Frontend Developer', 'Backend Developer', 'Full-Stack Developer', 'DevOps Engineer', 'Data Scientist', 'Product Manager'];

            const getDifficultyColor = (difficulty) => {
                switch (difficulty) {
                    case 'beginner': return 'text-green-400 bg-green-500/20';
                    case 'intermediate': return 'text-yellow-400 bg-yellow-500/20';
                    case 'advanced': return 'text-red-400 bg-red-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'completed': return 'text-green-400 bg-green-500/20';
                    case 'in-progress': return 'text-blue-400 bg-blue-500/20';
                    case 'paused': return 'text-yellow-400 bg-yellow-500/20';
                    case 'not-started': return 'text-gray-400 bg-gray-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getActivityIcon = (type) => {
                switch (type) {
                    case 'reading': return '';
                    case 'video': return '';
                    case 'project': return '';
                    case 'quiz': return '';
                    case 'practice': return '';
                    default: return '';
                }
            };

            const handleOnboardingNext = () => {
                if (onboardingStep < 5) {
                    setOnboardingStep(onboardingStep + 1);
                } else {
                    setShowOnboarding(false);
                    // Generate learning path logic here
                }
            };

            const handleOnboardingBack = () => {
                if (onboardingStep > 1) {
                    setOnboardingStep(onboardingStep - 1);
                }
            };

            const handlePathClick = (path) => {
                setSelectedPath(path);
                setShowPathDetails(true);
            };

            const handleWeekToggle = (week) => {
                setExpandedWeek(expandedWeek === week ? null : week);
            };

            const tabs = [
                { id: 'dashboard', label: 'Dashboard', icon: '' },
                { id: 'paths', label: 'My Learning Paths', icon: '' },
                { id: 'create', label: 'Discover Paths', icon: '' },
                { id: 'community', label: 'Community', icon: '' },
                { id: 'analytics', label: 'Analytics', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex items-center justify-between">
                            <div className="flex space-x-1 overflow-x-auto">
                                {tabs.map((tab) => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                            activeTab === tab.id
                                                ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg'
                                                : isLightMode 
                                                    ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                    : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                        }`}
                                    >
                                        <div className="w-4 h-4">{tab.icon}</div>
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                            <button
                                onClick={() => setShowOnboarding(true)}
                                className="bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2 transition-all duration-300 ml-4"
                            >
                                <div className="w-4 h-4"></div>
                                Create Learning Path
                            </button>
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'dashboard' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Current Learning Path */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Current Learning Path</h2>
                                    {learningPaths.find(p => p.status === 'in-progress') ? (
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                            <div className="flex items-start justify-between mb-4">
                                                <div className="flex-1">
                                                    <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>
                                                        {learningPaths.find(p => p.status === 'in-progress').title}
                                                    </h3>
                                                    <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>
                                                        {learningPaths.find(p => p.status === 'in-progress').description}
                                                    </p>
                                                    <div className="flex items-center gap-4 mb-4">
                                                        <span className={`px-3 py-1 rounded-full text-sm font-medium ${getDifficultyColor(learningPaths.find(p => p.status === 'in-progress').difficulty)}`}>
                                                            {learningPaths.find(p => p.status === 'in-progress').difficulty}
                                                        </span>
                                                        <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            {learningPaths.find(p => p.status === 'in-progress').progress}% Complete
                                                        </span>
                                                    </div>
                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2 mb-4`}>
                                                        <div 
                                                            className="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-300"
                                                            style={{ width: `${learningPaths.find(p => p.status === 'in-progress').progress}%` }}
                                                        ></div>
                                                    </div>
                                                    <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                        Next: {learningPaths.find(p => p.status === 'in-progress').nextActivity}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                <button className="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-6 py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                    Continue Learning
                                                </button>
                                                <button 
                                                    onClick={() => handlePathClick(learningPaths.find(p => p.status === 'in-progress'))}
                                                    className="bg-gray-700 text-gray-300 px-6 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"
                                                >
                                                    View Details
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center py-12">
                                            <div className={`w-16 h-16 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full flex items-center justify-center mx-auto mb-4`}>
                                                <div className={`w-8 h-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'} text-2xl`}></div>
                                            </div>
                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>No Active Learning Path</h3>
                                            <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>Start a new learning journey to begin your skill development</p>
                                            <button 
                                                onClick={() => setShowOnboarding(true)}
                                                className="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-6 py-3 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300"
                                            >
                                                Create Learning Path
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Today's Learning Activities */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Today's Learning Activities</h2>
                                    <div className="space-y-4">
                                        {weeklySprints[1].activities.map((activity) => (
                                            <div key={activity.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-8 h-8 bg-indigo-500/20 rounded-lg flex items-center justify-center">
                                                            <div className="w-4 h-4">{getActivityIcon(activity.type)}</div>
                                                        </div>
                                                        <div>
                                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{activity.title}</h4>
                                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{activity.duration} minutes  {activity.type}</p>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        {activity.completed ? (
                                                            <div className="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                                                <div className="w-3 h-3 text-white"></div>
                                                            </div>
                                                        ) : (
                                                            <button className="w-6 h-6 border-2 border-gray-600 rounded-full hover:border-indigo-500 transition-colors duration-200"></button>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Learning Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Learning Stats</h3>
                                    <div className="space-y-4">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Current Streak</span>
                                            <span className="text-sm font-medium text-orange-400">12 days</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Weekly Goal</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>8/10 hours</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Hours</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>156 hours</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Projects</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>8 completed</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>12 mastered</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Quick Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Actions</h3>
                                    <div className="space-y-3">
                                        <button className="w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                            Continue Session
                                        </button>
                                        <button className="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                            Review Projects
                                        </button>
                                        <button className="w-full bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                            Join Study Group
                                        </button>
                                        <button className="w-full bg-yellow-600 text-white py-2 rounded-lg font-medium hover:bg-yellow-700 transition-colors duration-200">
                                            Ask AI Tutor
                                        </button>
                                    </div>
                                </div>

                                {/* Recent Achievements */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Recent Achievements</h3>
                                    <div className="space-y-3">
                                        <div className="bg-green-500/20 border border-green-500/50 rounded-lg p-3">
                                            <div className="flex items-center gap-2 mb-1">
                                                <div className="w-4 h-4 text-green-400"></div>
                                                <h4 className="font-medium text-green-400">Week 1 Complete</h4>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Finished React Fundamentals</p>
                                        </div>
                                        <div className="bg-blue-500/20 border border-blue-500/50 rounded-lg p-3">
                                            <div className="flex items-center gap-2 mb-1">
                                                <div className="w-4 h-4 text-blue-400"></div>
                                                <h4 className="font-medium text-blue-400">Streak Milestone</h4>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>10 days in a row!</p>
                                        </div>
                                        <div className="bg-purple-500/20 border border-purple-500/50 rounded-lg p-3">
                                            <div className="flex items-center gap-2 mb-1">
                                                <div className="w-4 h-4 text-purple-400"></div>
                                                <h4 className="font-medium text-purple-400">Project Complete</h4>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Todo App with Hooks</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'paths' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>My Learning Paths</h2>
                                    <div className="space-y-4">
                                        {learningPaths.map((path) => (
                                            <div key={path.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{path.title}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(path.status)}`}>
                                                                {path.status.replace('-', ' ')}
                                                            </span>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(path.difficulty)}`}>
                                                                {path.difficulty}
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{path.description}</p>
                                                        <div className="flex flex-wrap gap-2 mb-3">
                                                            {path.skills.map((skill) => (
                                                                <span key={skill} className={`px-2 py-1 ${isLightMode ? 'bg-indigo-100 text-indigo-600' : 'bg-indigo-500/20 text-indigo-400'} text-xs rounded-full`}>
                                                                    {skill}
                                                                </span>
                                                            ))}
                                                        </div>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <span>{path.duration} days</span>
                                                            <span></span>
                                                            <span>{path.estimatedHours} hours</span>
                                                            <span></span>
                                                            <span>{path.projects} projects</span>
                                                            <span></span>
                                                            <span>{path.streak} day streak</span>
                                                        </div>
                                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2 mb-4`}>
                                                            <div 
                                                                className="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-300"
                                                                style={{ width: `${path.progress}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-4">
                                                    {path.status === 'in-progress' && (
                                                        <button className="bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-4 py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                            Continue
                                                        </button>
                                                    )}
                                                    {path.status === 'not-started' && (
                                                        <button className="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                                            Start Path
                                                        </button>
                                                    )}
                                                    {path.status === 'completed' && (
                                                        <button className="bg-yellow-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-yellow-700 transition-colors duration-200">
                                                            View Certificate
                                                        </button>
                                                    )}
                                                    <button 
                                                        onClick={() => handlePathClick(path)}
                                                        className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"
                                                    >
                                                        View Details
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Overall Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Overall Progress</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Paths Started</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{learningPaths.filter(p => p.status !== 'not-started').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Paths Completed</span>
                                            <span className="text-sm font-medium text-green-400">{learningPaths.filter(p => p.status === 'completed').length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Hours</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>156</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills Learned</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>12</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Recommended Paths */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Recommended Paths</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Advanced React Patterns</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Master advanced React concepts</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Full-Stack TypeScript</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>End-to-end TypeScript development</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Community Activity */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Community Activity</h3>
                                    <div className="space-y-3">
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                                <div className="w-4 h-4 text-white"></div>
                                            </div>
                                            <div>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Sarah completed React Fundamentals</p>
                                                <p className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>2 hours ago</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                                <div className="w-4 h-4 text-white"></div>
                                            </div>
                                            <div>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Mike shared a project</p>
                                                <p className={`text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>4 hours ago</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'create' && (
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-3 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Discover Learning Paths</h2>
                                        <div className="flex items-center gap-3">
                                            <input
                                                type="text"
                                                placeholder="Search paths..."
                                                className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            />
                                            <select className={`px-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}>
                                                <option>All Categories</option>
                                                <option>Frontend</option>
                                                <option>Backend</option>
                                                <option>Full-Stack</option>
                                                <option>DevOps</option>
                                                <option>Data Science</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {[
                                            {
                                                id: 1,
                                                title: 'Complete Web Development Bootcamp',
                                                description: 'Master HTML, CSS, JavaScript, React, Node.js, and MongoDB',
                                                duration: 120,
                                                difficulty: 'beginner',
                                                skills: ['HTML', 'CSS', 'JavaScript', 'React', 'Node.js'],
                                                students: 15420,
                                                rating: 4.8,
                                                projects: 12
                                            },
                                            {
                                                id: 2,
                                                title: 'Python for Data Science',
                                                description: 'Learn Python, Pandas, NumPy, Matplotlib, and Machine Learning',
                                                duration: 90,
                                                difficulty: 'intermediate',
                                                skills: ['Python', 'Pandas', 'NumPy', 'Matplotlib', 'Scikit-learn'],
                                                students: 8920,
                                                rating: 4.7,
                                                projects: 8
                                            },
                                            {
                                                id: 3,
                                                title: 'AWS Cloud Architecture',
                                                description: 'Master AWS services, cloud architecture, and deployment strategies',
                                                duration: 75,
                                                difficulty: 'advanced',
                                                skills: ['AWS', 'CloudFormation', 'Lambda', 'Docker', 'Kubernetes'],
                                                students: 5430,
                                                rating: 4.9,
                                                projects: 6
                                            },
                                            {
                                                id: 4,
                                                title: 'Mobile App Development',
                                                description: 'Build iOS and Android apps with React Native and Flutter',
                                                duration: 100,
                                                difficulty: 'intermediate',
                                                skills: ['React Native', 'Flutter', 'Swift', 'Kotlin', 'Firebase'],
                                                students: 6780,
                                                rating: 4.6,
                                                projects: 10
                                            },
                                            {
                                                id: 5,
                                                title: 'Machine Learning Engineer',
                                                description: 'Advanced ML algorithms, TensorFlow, PyTorch, and MLOps',
                                                duration: 150,
                                                difficulty: 'advanced',
                                                skills: ['TensorFlow', 'PyTorch', 'MLOps', 'Docker', 'Kubernetes'],
                                                students: 3210,
                                                rating: 4.8,
                                                projects: 15
                                            },
                                            {
                                                id: 6,
                                                title: 'Cybersecurity Fundamentals',
                                                description: 'Learn ethical hacking, network security, and penetration testing',
                                                duration: 80,
                                                difficulty: 'intermediate',
                                                skills: ['Ethical Hacking', 'Network Security', 'Penetration Testing', 'Linux', 'Cryptography'],
                                                students: 4560,
                                                rating: 4.7,
                                                projects: 7
                                            }
                                        ].map((path) => (
                                            <div key={path.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:border-indigo-500/50 transition-all duration-300`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{path.title}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(path.difficulty)}`}>
                                                                {path.difficulty}
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3 text-sm`}>{path.description}</p>
                                                        <div className="flex flex-wrap gap-1 mb-3">
                                                            {path.skills.slice(0, 3).map((skill) => (
                                                                <span key={skill} className="px-2 py-1 bg-indigo-500/20 text-indigo-400 text-xs rounded-full">
                                                                    {skill}
                                                                </span>
                                                            ))}
                                                            {path.skills.length > 3 && (
                                                                <span className="px-2 py-1 bg-gray-500/20 text-gray-400 text-xs rounded-full">
                                                                    +{path.skills.length - 3} more
                                                                </span>
                                                            )}
                                                        </div>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <span>{path.duration} days</span>
                                                            <span></span>
                                                            <span>{path.projects} projects</span>
                                                            <span></span>
                                                            <span>{path.students.toLocaleString()} students</span>
                                                        </div>
                                                        <div className="flex items-center gap-2 mb-4">
                                                            <div className="flex items-center gap-1">
                                                                <div className="w-4 h-4 text-yellow-400"></div>
                                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>{path.rating}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                        Start Path
                                                    </button>
                                                    <button className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200">
                                                        Preview
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Categories */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Categories</h3>
                                    <div className="space-y-2">
                                        {['Frontend Development', 'Backend Development', 'Full-Stack', 'DevOps', 'Data Science', 'Mobile Development', 'Cybersecurity', 'AI/ML'].map((category) => (
                                            <button key={category} className={`w-full text-left px-3 py-2 text-sm ${isLightMode ? 'text-gray-600 hover:bg-gray-100' : 'text-gray-300 hover:bg-gray-800'} rounded-lg transition-colors duration-200`}>
                                                {category}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Popular This Week */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Popular This Week</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>React 18 Masterclass</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>2,340 new students</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Python for AI</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>1,890 new students</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>AWS Solutions Architect</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>1,560 new students</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'community' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Active Study Groups */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Active Study Groups</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {[
                                            {
                                                id: 1,
                                                name: 'React Developers United',
                                                description: 'Advanced React patterns and best practices',
                                                members: 245,
                                                activeNow: 12,
                                                nextSession: 'Tomorrow 7:00 PM',
                                                topics: ['React Hooks', 'State Management', 'Performance']
                                            },
                                            {
                                                id: 2,
                                                name: 'Python Data Scientists',
                                                description: 'Machine learning and data analysis with Python',
                                                members: 189,
                                                activeNow: 8,
                                                nextSession: 'Friday 6:30 PM',
                                                topics: ['Pandas', 'NumPy', 'Scikit-learn']
                                            },
                                            {
                                                id: 3,
                                                name: 'DevOps Engineers',
                                                description: 'Cloud infrastructure and deployment strategies',
                                                members: 156,
                                                activeNow: 5,
                                                nextSession: 'Sunday 2:00 PM',
                                                topics: ['Docker', 'Kubernetes', 'AWS']
                                            },
                                            {
                                                id: 4,
                                                name: 'Frontend Masters',
                                                description: 'Modern frontend development and design systems',
                                                members: 312,
                                                activeNow: 18,
                                                nextSession: 'Wednesday 8:00 PM',
                                                topics: ['TypeScript', 'Design Systems', 'Accessibility']
                                            }
                                        ].map((group) => (
                                            <div key={group.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{group.name}</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{group.description}</p>
                                                        <div className="flex flex-wrap gap-2 mb-3">
                                                            {group.topics.map((topic) => (
                                                                <span key={topic} className="px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded-full">
                                                                    {topic}
                                                                </span>
                                                            ))}
                                                        </div>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            <span>{group.members} members</span>
                                                            <span></span>
                                                            <span className="text-green-400">{group.activeNow} online</span>
                                                            <span></span>
                                                            <span>Next: {group.nextSession}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                        Join Group
                                                    </button>
                                                    <button className={`${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} px-4 py-2 rounded-lg font-medium transition-colors duration-200`}>
                                                        View Details
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Community Projects */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Community Projects</h2>
                                    <div className="space-y-4">
                                        {[
                                            {
                                                id: 1,
                                                title: 'Open Source React Component Library',
                                                description: 'Building a comprehensive UI component library for React applications',
                                                contributors: 15,
                                                stars: 234,
                                                language: 'TypeScript',
                                                lastActivity: '2 hours ago'
                                            },
                                            {
                                                id: 2,
                                                title: 'Machine Learning Dataset Collection',
                                                description: 'Curated collection of datasets for machine learning projects',
                                                contributors: 8,
                                                stars: 89,
                                                language: 'Python',
                                                lastActivity: '5 hours ago'
                                            },
                                            {
                                                id: 3,
                                                title: 'DevOps Automation Scripts',
                                                description: 'Collection of automation scripts for common DevOps tasks',
                                                contributors: 12,
                                                stars: 156,
                                                language: 'Bash',
                                                lastActivity: '1 day ago'
                                            }
                                        ].map((project) => (
                                            <div key={project.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{project.title}</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{project.description}</p>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <span>{project.contributors} contributors</span>
                                                            <span></span>
                                                            <span>{project.stars} stars</span>
                                                            <span></span>
                                                            <span>{project.language}</span>
                                                            <span></span>
                                                            <span>Updated {project.lastActivity}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                                        Contribute
                                                    </button>
                                                    <button className={`${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} px-4 py-2 rounded-lg font-medium transition-colors duration-200`}>
                                                        View Code
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Your Activity */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Your Activity</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Groups Joined</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>3</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Projects Contributed</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>2</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Study Sessions</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>12 this month</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Questions Asked</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>8</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Answers Given</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>15</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Trending Topics */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Trending Topics</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>React Server Components</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>45 discussions today</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>AI Code Generation</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>32 discussions today</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>WebAssembly</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>28 discussions today</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'analytics' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Learning Analytics</h2>
                                    <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-8 text-center`}>
                                        <div className="w-16 h-16 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <div className="w-8 h-8 text-indigo-400 text-2xl"></div>
                                        </div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Interactive Charts Coming Soon</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>Advanced learning analytics with detailed progress tracking, skill development graphs, and personalized insights will be available soon.</p>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-700'} border rounded-lg p-4`}>
                                                <div className="text-2xl font-bold text-indigo-400 mb-1">156</div>
                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Hours</div>
                                            </div>
                                            <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-700'} border rounded-lg p-4`}>
                                                <div className="text-2xl font-bold text-green-400 mb-1">12</div>
                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills Mastered</div>
                                            </div>
                                            <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-700'} border rounded-lg p-4`}>
                                                <div className="text-2xl font-bold text-yellow-400 mb-1">8</div>
                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Projects</div>
                                            </div>
                                            <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-700'} border rounded-lg p-4`}>
                                                <div className="text-2xl font-bold text-purple-400 mb-1">85%</div>
                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Completion Rate</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Learning Metrics */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Learning Metrics</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Study Time</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>156 hours</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-indigo-500 h-2 rounded-full" style={{ width: '78%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Concepts Mastered</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>12/15</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-green-500 h-2 rounded-full" style={{ width: '80%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Projects Completed</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>8/10</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-yellow-500 h-2 rounded-full" style={{ width: '80%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Learning Velocity</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>High</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-purple-500 h-2 rounded-full" style={{ width: '90%' }}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Skill Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Skill Progress</h3>
                                    <div className="space-y-3">
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>React</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>85%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-green-500 h-1.5 rounded-full" style={{ width: '85%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>TypeScript</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>70%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-blue-500 h-1.5 rounded-full" style={{ width: '70%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Node.js</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>60%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-yellow-500 h-1.5 rounded-full" style={{ width: '60%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>MongoDB</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>45%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-orange-500 h-1.5 rounded-full" style={{ width: '45%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Docker</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>30%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-red-500 h-1.5 rounded-full" style={{ width: '30%' }}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Onboarding Modal */}
                    {showOnboarding && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-[#111827] border-gray-700'} border rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto`}>
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Create Your Learning Path</h2>
                                    <button
                                        onClick={() => setShowOnboarding(false)}
                                        className={`p-2 ${isLightMode ? 'bg-gray-200 text-gray-600 hover:bg-gray-300' : 'bg-gray-700 text-gray-400 hover:bg-gray-600'} rounded-lg transition-colors duration-200`}
                                    >
                                        <div className="w-5 h-5"></div>
                                    </button>
                                </div>
                                
                                {/* Progress Bar */}
                                <div className="mb-8">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Step {onboardingStep} of 5</span>
                                        <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{Math.round((onboardingStep / 5) * 100)}%</span>
                                    </div>
                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                        <div 
                                            className="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-300"
                                            style={{ width: `${(onboardingStep / 5) * 100}%` }}
                                        ></div>
                                    </div>
                                </div>

                                {/* Step Content */}
                                {onboardingStep === 1 && (
                                    <div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>What skills do you want to learn?</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>Select all the skills you're interested in developing</p>
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                            {availableSkills.map((skill) => (
                                                <button
                                                    key={skill}
                                                    onClick={() => {
                                                        if (learningGoals.includes(skill)) {
                                                            setLearningGoals(learningGoals.filter(s => s !== skill));
                                                        } else {
                                                            setLearningGoals([...learningGoals, skill]);
                                                        }
                                                    }}
                                                    className={`p-3 rounded-lg border transition-all duration-200 ${
                                                        learningGoals.includes(skill)
                                                            ? 'bg-indigo-500 border-indigo-500 text-white'
                                                            : 'bg-gray-800 border-gray-700 text-gray-300 hover:border-indigo-500'
                                                    }`}
                                                >
                                                    {skill}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {onboardingStep === 2 && (
                                    <div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>What's your experience level?</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>This helps us personalize your learning path</p>
                                        <div className="space-y-3">
                                            {['Beginner', 'Intermediate', 'Advanced'].map((level) => (
                                                <label key={level} className={`flex items-center p-4 ${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg cursor-pointer hover:border-indigo-500 transition-colors duration-200`}>
                                                    <input
                                                        type="radio"
                                                        name="experienceLevel"
                                                        value={level.toLowerCase()}
                                                        checked={experienceLevel === level.toLowerCase()}
                                                        onChange={(e) => setExperienceLevel(e.target.value)}
                                                        className={`w-4 h-4 text-indigo-600 ${isLightMode ? 'bg-white border-gray-300' : 'bg-gray-800 border-gray-600'} focus:ring-indigo-500`}
                                                    />
                                                    <div className="ml-3">
                                                        <div className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{level}</div>
                                                        <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            {level === 'Beginner' && 'New to programming or this technology'}
                                                            {level === 'Intermediate' && 'Some experience, want to deepen knowledge'}
                                                            {level === 'Advanced' && 'Experienced, looking for expert-level content'}
                                                        </div>
                                                    </div>
                                                </label>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {onboardingStep === 3 && (
                                    <div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>How much time can you commit?</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>We'll adjust your learning path based on your availability</p>
                                        <div className="space-y-6">
                                            <div>
                                                <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>
                                                    Hours per week: {timeCommitment} hours
                                                </label>
                                                <input
                                                    type="range"
                                                    min="1"
                                                    max="20"
                                                    value={timeCommitment}
                                                    onChange={(e) => setTimeCommitment(parseInt(e.target.value))}
                                                    className={`w-full h-2 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-lg appearance-none cursor-pointer`}
                                                />
                                                <div className={`flex justify-between text-xs ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mt-1`}>
                                                    <span>1 hour</span>
                                                    <span>20 hours</span>
                                                </div>
                                            </div>
                                            <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Estimated Timeline</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-400'}`}>
                                                    With {timeCommitment} hours per week, your learning path will take approximately {Math.ceil(120 / timeCommitment)} weeks to complete.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {onboardingStep === 4 && (
                                    <div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>How do you prefer to learn?</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>Select your preferred learning styles</p>
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                            {learningStyles.map((style) => (
                                                <button
                                                    key={style}
                                                    onClick={() => {
                                                        if (learningStyle.includes(style)) {
                                                            setLearningStyle(learningStyle.filter(s => s !== style));
                                                        } else {
                                                            setLearningStyle([...learningStyle, style]);
                                                        }
                                                    }}
                                                    className={`p-3 rounded-lg border transition-all duration-200 ${
                                                        learningStyle.includes(style)
                                                            ? 'bg-indigo-500 border-indigo-500 text-white'
                                                            : 'bg-gray-800 border-gray-700 text-gray-300 hover:border-indigo-500'
                                                    }`}
                                                >
                                                    {style}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {onboardingStep === 5 && (
                                    <div>
                                        <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>What's your target role?</h3>
                                        <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>This helps us align your learning path with career goals</p>
                                        <div className="grid grid-cols-2 gap-3">
                                            {targetRoles.map((role) => (
                                                <button
                                                    key={role}
                                                    onClick={() => setTargetRole(role)}
                                                    className={`p-4 rounded-lg border transition-all duration-200 ${
                                                        targetRole === role
                                                            ? 'bg-indigo-500 border-indigo-500 text-white'
                                                            : isLightMode 
                                                                ? 'bg-white border-gray-200 text-gray-700 hover:border-indigo-500'
                                                                : 'bg-gray-800 border-gray-700 text-gray-300 hover:border-indigo-500'
                                                    }`}
                                                >
                                                    {role}
                                                </button>
                                            ))}
                                        </div>
                                        
                                        {/* Summary */}
                                        {targetRole && (
                                            <div className={`mt-6 ${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Learning Path Summary</h4>
                                                <div className={`space-y-2 text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>
                                                    <p><span className="font-medium">Skills:</span> {learningGoals.join(', ')}</p>
                                                    <p><span className="font-medium">Level:</span> {experienceLevel}</p>
                                                    <p><span className="font-medium">Time:</span> {timeCommitment} hours/week</p>
                                                    <p><span className="font-medium">Style:</span> {learningStyle.join(', ')}</p>
                                                    <p><span className="font-medium">Goal:</span> {targetRole}</p>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* Navigation Buttons */}
                                <div className="flex items-center justify-between mt-8">
                                    <div className="flex items-center gap-4">
                                        {onboardingStep > 1 && (
                                            <button
                                                onClick={handleOnboardingBack}
                                                className={`px-6 py-3 ${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-600 text-white hover:bg-gray-700'} rounded-lg font-medium transition-colors duration-200`}
                                            >
                                                Back
                                            </button>
                                        )}
                                        <button
                                            onClick={() => setShowOnboarding(false)}
                                            className={`px-6 py-3 ${isLightMode ? 'bg-gray-300 text-gray-700 hover:bg-gray-400' : 'bg-gray-500 text-white hover:bg-gray-600'} rounded-lg font-medium transition-colors duration-200`}
                                        >
                                            Save & Close
                                        </button>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        {onboardingStep < 5 ? (
                                            <button
                                                onClick={handleOnboardingNext}
                                                disabled={onboardingStep === 1 && learningGoals.length === 0 || onboardingStep === 2 && !experienceLevel || onboardingStep === 5 && !targetRole}
                                                className="px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                Next Step
                                            </button>
                                        ) : (
                                            <button
                                                onClick={() => setShowOnboarding(false)}
                                                disabled={!targetRole}
                                                className="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg font-medium hover:from-green-600 hover:to-emerald-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                Generate Learning Path
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Learning Path Details Modal */}
                    {showPathDetails && selectedPath && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-[#111827] border border-gray-700 rounded-2xl p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-50">{selectedPath.title}</h2>
                                    <button
                                        onClick={() => setShowPathDetails(false)}
                                        className="p-2 bg-gray-700 text-gray-400 rounded-lg hover:bg-gray-600 transition-colors duration-200"
                                    >
                                        <div className="w-5 h-5"></div>
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Weekly Learning Sprints */}
                                    <div className="space-y-6">
                                        <h3 className="text-lg font-semibold text-gray-50 mb-4">Weekly Learning Sprints</h3>
                                        {weeklySprints.map((sprint) => (
                                            <div key={sprint.week} className="bg-gray-800 border border-gray-700 rounded-lg">
                                                <button
                                                    onClick={() => handleWeekToggle(sprint.week)}
                                                    className="w-full p-4 flex items-center justify-between hover:bg-gray-700 transition-colors duration-200"
                                                >
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
                                                            sprint.completed ? 'bg-green-500' : 'bg-indigo-500'
                                                        }`}>
                                                            <div className="w-4 h-4 text-white">{sprint.completed ? '' : sprint.week}</div>
                                                        </div>
                                                        <div className="text-left">
                                                            <h4 className="font-medium text-gray-50">{sprint.title}</h4>
                                                            <p className="text-sm text-gray-400">{sprint.objectives.length} objectives</p>
                                                        </div>
                                                    </div>
                                                    <div className={`w-5 h-5 transition-transform duration-200 ${
                                                        expandedWeek === sprint.week ? 'rotate-180' : ''
                                                    }`}>
                                                        
                                                    </div>
                                                </button>
                                                
                                                {expandedWeek === sprint.week && (
                                                    <div className="p-4 border-t border-gray-700">
                                                        <div className="mb-4">
                                                            <h5 className="font-medium text-gray-50 mb-2">Learning Objectives</h5>
                                                            <ul className="space-y-1">
                                                                {sprint.objectives.map((objective, index) => (
                                                                    <li key={index} className="text-sm text-gray-300 flex items-center gap-2">
                                                                        <div className="w-1 h-1 bg-indigo-400 rounded-full"></div>
                                                                        {objective}
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                        
                                                        <div className="mb-4">
                                                            <h5 className="font-medium text-gray-50 mb-2">Activities</h5>
                                                            <div className="space-y-2">
                                                                {sprint.activities.map((activity) => (
                                                                    <div key={activity.id} className="flex items-center justify-between p-2 bg-gray-700 rounded">
                                                                        <div className="flex items-center gap-2">
                                                                            <div className="w-4 h-4">{getActivityIcon(activity.type)}</div>
                                                                            <span className="text-sm text-gray-300">{activity.title}</span>
                                                                        </div>
                                                                        <div className="flex items-center gap-2">
                                                                            <span className="text-xs text-gray-400">{activity.duration}min</span>
                                                                            {activity.completed ? (
                                                                                <div className="w-4 h-4 bg-green-500 rounded-full flex items-center justify-center">
                                                                                    <div className="w-2 h-2 text-white"></div>
                                                                                </div>
                                                                            ) : (
                                                                                <div className="w-4 h-4 border border-gray-600 rounded-full"></div>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                        
                                                        <div>
                                                            <h5 className="font-medium text-gray-50 mb-2">Week Project</h5>
                                                            <div className="bg-gray-700 rounded p-3">
                                                                <div className="flex items-center justify-between">
                                                                    <div>
                                                                        <h6 className="font-medium text-gray-50">{sprint.project.title}</h6>
                                                                        <p className="text-sm text-gray-400">{sprint.project.estimatedTime}</p>
                                                                    </div>
                                                                    {sprint.project.completed ? (
                                                                        <div className="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                                                            <div className="w-3 h-3 text-white"></div>
                                                                        </div>
                                                                    ) : (
                                                                        <div className="w-6 h-6 border border-gray-600 rounded-full"></div>
                                                                    )}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>

                                    {/* Path Overview */}
                                    <div className="space-y-6">
                                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Path Overview</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Duration</span>
                                                    <span className="text-sm font-medium text-gray-50">{selectedPath.duration} days</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Difficulty</span>
                                                    <span className={`text-sm font-medium px-2 py-1 rounded-full ${getDifficultyColor(selectedPath.difficulty)}`}>
                                                        {selectedPath.difficulty}
                                                    </span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Estimated Hours</span>
                                                    <span className="text-sm font-medium text-gray-50">{selectedPath.estimatedHours} hours</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Projects</span>
                                                    <span className="text-sm font-medium text-gray-50">{selectedPath.projects}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Progress</span>
                                                    <span className="text-sm font-medium text-gray-50">{selectedPath.progress}%</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Skills You'll Learn</h3>
                                            <div className="flex flex-wrap gap-2">
                                                {selectedPath.skills.map((skill) => (
                                                    <span key={skill} className="px-3 py-1 bg-indigo-500/20 text-indigo-400 text-sm rounded-full">
                                                        {skill}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>

                                        <div className="flex items-center gap-4">
                                            {selectedPath.status === 'not-started' && (
                                                <button className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white py-3 rounded-lg font-medium hover:from-green-600 hover:to-emerald-600 transition-all duration-300">
                                                    Start Learning Path
                                                </button>
                                            )}
                                            {selectedPath.status === 'in-progress' && (
                                                <button className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                    Continue Learning
                                                </button>
                                            )}
                                            {selectedPath.status === 'completed' && (
                                                <button className="flex-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white py-3 rounded-lg font-medium hover:from-yellow-600 hover:to-orange-600 transition-all duration-300">
                                                    View Certificate
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Learning Path when learning-path-content is shown
        window.renderLearningPath = function() {
            console.log('renderLearningPath called');
            const container = document.getElementById('learning-path-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Learning Path...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<LearningPath />);
                    console.log('Learning Path rendered successfully');
                } catch (error) {
                    console.error('Error rendering Learning Path:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Learning Path</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('learning-path-container not found');
            }
        };

        // Sprints React Component
        const Sprints = () => {
            const [activeTab, setActiveTab] = useState('browse');
            const [selectedSprint, setSelectedSprint] = useState(null);
            const [showSprintDetail, setShowSprintDetail] = useState(false);
            const [filterTechnology, setFilterTechnology] = useState('all');
            const [filterDifficulty, setFilterDifficulty] = useState('all');

            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');
            const [filterDuration, setFilterDuration] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [enrolledSprints, setEnrolledSprints] = useState([1, 3]);

            const sprints = [
                {
                    id: 1,
                    title: 'Modern E-commerce Platform',
                    description: 'Build a full-stack e-commerce platform with React, Node.js, and MongoDB',
                    technology: ['React', 'Node.js', 'MongoDB', 'Stripe'],
                    difficulty: 'intermediate',
                    duration: '3 weeks',
                    participants: 1240,
                    rating: 4.8,
                    deliverable: 'Complete e-commerce website with payment integration',
                    skills: ['React', 'Node.js', 'MongoDB', 'Stripe', 'Authentication', 'Payment Processing'],
                    prerequisites: ['JavaScript', 'HTML/CSS', 'Basic React'],
                    category: 'fullstack',
                    featured: true,
                    completionRate: 78,
                    estimatedHours: 40,
                    industry: 'E-commerce',
                    thumbnail: ''
                },
                {
                    id: 2,
                    title: 'AI-Powered Chat Application',
                    description: 'Create an intelligent chat application with OpenAI integration',
                    technology: ['React', 'TypeScript', 'OpenAI', 'WebSocket'],
                    difficulty: 'advanced',
                    duration: '2 weeks',
                    participants: 890,
                    rating: 4.9,
                    deliverable: 'Real-time chat app with AI responses',
                    skills: ['React', 'TypeScript', 'OpenAI API', 'WebSocket', 'Real-time Communication'],
                    prerequisites: ['React', 'TypeScript', 'API Integration'],
                    category: 'ai',
                    featured: true,
                    completionRate: 65,
                    estimatedHours: 30,
                    industry: 'AI/ML',
                    thumbnail: ''
                },
                {
                    id: 3,
                    title: 'Mobile-First Dashboard Design',
                    description: 'Design and build a responsive dashboard with modern UI/UX',
                    technology: ['React', 'Tailwind CSS', 'Chart.js', 'Framer Motion'],
                    difficulty: 'beginner',
                    duration: '2 weeks',
                    participants: 2100,
                    rating: 4.7,
                    deliverable: 'Responsive dashboard with data visualization',
                    skills: ['React', 'Tailwind CSS', 'Chart.js', 'Responsive Design', 'UI/UX'],
                    prerequisites: ['HTML/CSS', 'JavaScript', 'Basic React'],
                    category: 'frontend',
                    featured: false,
                    completionRate: 85,
                    estimatedHours: 25,
                    industry: 'SaaS',
                    thumbnail: ''
                },
                {
                    id: 4,
                    title: 'DevOps Pipeline Mastery',
                    description: 'Master CI/CD pipelines with Docker, GitHub Actions, and AWS',
                    technology: ['Docker', 'GitHub Actions', 'AWS', 'Kubernetes'],
                    difficulty: 'advanced',
                    duration: '3 weeks',
                    participants: 650,
                    rating: 4.6,
                    deliverable: 'Complete DevOps pipeline with automated deployment',
                    skills: ['Docker', 'CI/CD', 'AWS', 'Kubernetes', 'Infrastructure as Code'],
                    prerequisites: ['Linux', 'Git', 'Basic Cloud Knowledge'],
                    category: 'devops',
                    featured: false,
                    completionRate: 70,
                    estimatedHours: 45,
                    industry: 'DevOps',
                    thumbnail: ''
                },
                {
                    id: 5,
                    title: 'React Native Mobile App',
                    description: 'Build a cross-platform mobile app with React Native and Expo',
                    technology: ['React Native', 'Expo', 'Firebase', 'Redux'],
                    difficulty: 'intermediate',
                    duration: '3 weeks',
                    participants: 980,
                    rating: 4.5,
                    deliverable: 'Cross-platform mobile application',
                    skills: ['React Native', 'Expo', 'Firebase', 'Redux', 'Mobile Development'],
                    prerequisites: ['React', 'JavaScript', 'Mobile Development Basics'],
                    category: 'mobile',
                    featured: false,
                    completionRate: 75,
                    estimatedHours: 35,
                    industry: 'Mobile',
                    thumbnail: ''
                },
                {
                    id: 6,
                    title: 'Microservices Architecture Sprint',
                    description: 'Design and implement a microservices architecture with Node.js',
                    technology: ['Node.js', 'Docker', 'Redis', 'PostgreSQL', 'API Gateway'],
                    difficulty: 'advanced',
                    duration: '4 weeks',
                    participants: 420,
                    rating: 4.8,
                    deliverable: 'Scalable microservices system',
                    skills: ['Node.js', 'Microservices', 'Docker', 'Redis', 'PostgreSQL', 'API Design'],
                    prerequisites: ['Node.js', 'Database Knowledge', 'System Design'],
                    category: 'backend',
                    featured: false,
                    completionRate: 60,
                    estimatedHours: 50,
                    industry: 'Enterprise',
                    thumbnail: ''
                }
            ];

            const userProgress = [
                { sprintId: 1, progress: 65, currentMilestone: 3, totalMilestones: 5, timeSpent: 26, startDate: '2024-01-15', status: 'in_progress' },
                { sprintId: 3, progress: 100, currentMilestone: 5, totalMilestones: 5, timeSpent: 25, startDate: '2024-01-01', status: 'completed' }
            ];

            const achievements = [
                { id: 1, title: 'First Sprint Complete', description: 'Completed your first learning sprint', icon: '', earned: true, earnedDate: '2024-01-20' },
                { id: 2, title: 'Frontend Master', description: 'Completed 3 frontend sprints', icon: '', earned: true, earnedDate: '2024-01-25' },
                { id: 3, title: 'Full-Stack Developer', description: 'Completed both frontend and backend sprints', icon: '', earned: false, earnedDate: null },
                { id: 4, title: 'Sprint Streak', description: 'Completed 5 sprints in a row', icon: '', earned: false, earnedDate: null },
                { id: 5, title: 'Advanced Learner', description: 'Completed 3 advanced difficulty sprints', icon: '', earned: false, earnedDate: null },
                { id: 6, title: 'Community Helper', description: 'Helped 10 other learners in sprint discussions', icon: '', earned: false, earnedDate: null }
            ];

            const getDifficultyColor = (difficulty) => {
                switch (difficulty) {
                    case 'beginner': return 'text-green-400 bg-green-500/20';
                    case 'intermediate': return 'text-yellow-400 bg-yellow-500/20';
                    case 'advanced': return 'text-red-400 bg-red-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getCategoryIcon = (category) => {
                switch (category) {
                    case 'frontend': return '';
                    case 'backend': return '';
                    case 'fullstack': return '';
                    case 'mobile': return '';
                    case 'ai': return '';
                    case 'devops': return '';
                    default: return '';
                }
            };

            const getCategoryColor = (category) => {
                switch (category) {
                    case 'frontend': return 'text-blue-400 bg-blue-500/20';
                    case 'backend': return 'text-green-400 bg-green-500/20';
                    case 'fullstack': return 'text-purple-400 bg-purple-500/20';
                    case 'mobile': return 'text-pink-400 bg-pink-500/20';
                    case 'ai': return 'text-orange-400 bg-orange-500/20';
                    case 'devops': return 'text-gray-400 bg-gray-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const handleSprintClick = (sprint) => {
                setSelectedSprint(sprint);
                setShowSprintDetail(true);
            };

            const handleEnrollSprint = (sprintId) => {
                if (enrolledSprints.includes(sprintId)) {
                    setEnrolledSprints(enrolledSprints.filter(id => id !== sprintId));
                } else {
                    setEnrolledSprints([...enrolledSprints, sprintId]);
                }
            };

            const filteredSprints = sprints.filter(sprint => {
                const matchesSearch = sprint.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                   sprint.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                   sprint.technology.some(tech => tech.toLowerCase().includes(searchQuery.toLowerCase()));
                const matchesTechnology = filterTechnology === 'all' || sprint.technology.includes(filterTechnology);
                const matchesDifficulty = filterDifficulty === 'all' || sprint.difficulty === filterDifficulty;
                const matchesDuration = filterDuration === 'all' || 
                    (filterDuration === '1-2' && sprint.duration === '2 weeks') ||
                    (filterDuration === '2-3' && sprint.duration === '3 weeks') ||
                    (filterDuration === '3+' && sprint.duration === '4 weeks');
                
                return matchesSearch && matchesTechnology && matchesDifficulty && matchesDuration;
            });

            const tabs = [
                { id: 'browse', label: 'Browse Sprints', icon: '' },
                { id: 'my-sprints', label: 'My Sprints', icon: '' },
                { id: 'achievements', label: 'Achievements', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex space-x-1 overflow-x-auto">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                        activeTab === tab.id
                                            ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                    }`}
                                >
                                    <div className="w-4 h-4">{tab.icon}</div>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'browse' && (
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-3 space-y-6">
                                {/* Filters */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Search</label>
                                            <div className="relative">
                                                <input
                                                    type="text"
                                                    value={searchQuery}
                                                    onChange={(e) => setSearchQuery(e.target.value)}
                                                    placeholder="Search sprints..."
                                                    className={`w-full pl-10 pr-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                                />
                                                <div className="absolute left-3 top-2.5 w-4 h-4 text-gray-400"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Technology</label>
                                            <select
                                                value={filterTechnology}
                                                onChange={(e) => setFilterTechnology(e.target.value)}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Technologies</option>
                                                <option value="React">React</option>
                                                <option value="Node.js">Node.js</option>
                                                <option value="Python">Python</option>
                                                <option value="TypeScript">TypeScript</option>
                                                <option value="Vue.js">Vue.js</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Difficulty</label>
                                            <select
                                                value={filterDifficulty}
                                                onChange={(e) => setFilterDifficulty(e.target.value)}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Levels</option>
                                                <option value="beginner">Beginner</option>
                                                <option value="intermediate">Intermediate</option>
                                                <option value="advanced">Advanced</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Duration</label>
                                            <select
                                                value={filterDuration}
                                                onChange={(e) => setFilterDuration(e.target.value)}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Durations</option>
                                                <option value="1-2">1-2 weeks</option>
                                                <option value="2-3">2-3 weeks</option>
                                                <option value="3+">3+ weeks</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                {/* Featured Sprints */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Featured Sprints</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {sprints.filter(sprint => sprint.featured).map((sprint) => (
                                            <div key={sprint.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:border-indigo-500/50 transition-all duration-300`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <div className="text-2xl">{sprint.thumbnail}</div>
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{sprint.title}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(sprint.difficulty)}`}>
                                                                {sprint.difficulty}
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{sprint.description}</p>
                                                        <div className="flex flex-wrap gap-2 mb-3">
                                                            {sprint.technology.slice(0, 3).map((tech) => (
                                                                <span key={tech} className={`px-2 py-1 ${isLightMode ? 'bg-blue-100 text-blue-600' : 'bg-blue-500/20 text-blue-400'} text-xs rounded-full`}>
                                                                    {tech}
                                                                </span>
                                                            ))}
                                                            {sprint.technology.length > 3 && (
                                                                <span className={`px-2 py-1 ${isLightMode ? 'bg-gray-100 text-gray-600' : 'bg-gray-500/20 text-gray-400'} text-xs rounded-full`}>
                                                                    +{sprint.technology.length - 3} more
                                                                </span>
                                                            )}
                                                        </div>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <span>{sprint.duration}</span>
                                                            <span></span>
                                                            <span>{sprint.participants.toLocaleString()} participants</span>
                                                            <span></span>
                                                            <span>{sprint.estimatedHours} hours</span>
                                                        </div>
                                                        {enrolledSprints.includes(sprint.id) && (
                                                            <div className="mb-3">
                                                                <div className="flex justify-between text-sm text-gray-400 mb-1">
                                                                    <span>Progress</span>
                                                                    <span>{sprint.completionRate}%</span>
                                                                </div>
                                                                <div className="w-full bg-gray-700 rounded-full h-2">
                                                                    <div 
                                                                        className="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-300"
                                                                        style={{ width: `${sprint.completionRate}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    {enrolledSprints.includes(sprint.id) ? (
                                                        <button className="flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white py-2 rounded-lg font-medium hover:from-orange-600 hover:to-red-600 transition-all duration-300">
                                                            Continue Sprint
                                                        </button>
                                                    ) : (
                                                        <button 
                                                            onClick={() => handleEnrollSprint(sprint.id)}
                                                            className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300"
                                                        >
                                                            Start Sprint
                                                        </button>
                                                    )}
                                                    <button 
                                                        onClick={() => handleSprintClick(sprint)}
                                                        className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"
                                                    >
                                                        View Details
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* All Sprints */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>All Sprints</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredSprints.filter(sprint => !sprint.featured).map((sprint) => (
                                            <div key={sprint.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4 hover:border-indigo-500/50 transition-all duration-300`}>
                                                <div className="flex items-start justify-between mb-3">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <div className="text-xl">{sprint.thumbnail}</div>
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{sprint.title}</h3>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} text-sm mb-2`}>{sprint.description}</p>
                                                        <div className="flex items-center gap-2 mb-2">
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(sprint.difficulty)}`}>
                                                                {sprint.difficulty}
                                                            </span>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getCategoryColor(sprint.category)}`}>
                                                                {getCategoryIcon(sprint.category)} {sprint.category}
                                                            </span>
                                                        </div>
                                                        <div className="flex items-center gap-3 text-sm text-gray-400">
                                                            <span>{sprint.duration}</span>
                                                            <span></span>
                                                            <span>{sprint.participants.toLocaleString()}</span>
                                                            <span></span>
                                                            <span> {sprint.rating}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    {enrolledSprints.includes(sprint.id) ? (
                                                        <button className="flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white py-2 rounded-lg font-medium hover:from-orange-600 hover:to-red-600 transition-all duration-300 text-sm">
                                                            Continue
                                                        </button>
                                                    ) : (
                                                        <button 
                                                            onClick={() => handleEnrollSprint(sprint.id)}
                                                            className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300 text-sm"
                                                        >
                                                            Start Sprint
                                                        </button>
                                                    )}
                                                    <button 
                                                        onClick={() => handleSprintClick(sprint)}
                                                        className="bg-gray-700 text-gray-300 px-3 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200 text-sm"
                                                    >
                                                        View
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Your Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Your Progress</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Active Sprints</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{enrolledSprints.length}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Completed</span>
                                            <span className="text-sm font-medium text-green-400">1</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Hours</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>51 hours</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Achievements</span>
                                            <span className="text-sm font-medium text-yellow-400">2 earned</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Trending This Week */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Trending This Week</h3>
                                    <div className="space-y-3">
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                                <div className="w-4 h-4 text-white"></div>
                                            </div>
                                            <div>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>React</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>+340 new learners</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                                                <div className="w-4 h-4 text-white"></div>
                                            </div>
                                            <div>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Python</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>+280 new learners</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center">
                                                <div className="w-4 h-4 text-white"></div>
                                            </div>
                                            <div>
                                                <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>TypeScript</h4>
                                                <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>+190 new learners</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Sprint Tips */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Sprint Tips</h3>
                                    <div className="space-y-2">
                                        <div className="flex items-start gap-2">
                                            <div className="w-1 h-1 bg-indigo-400 rounded-full mt-2"></div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Set aside 2-3 hours daily for consistent progress</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-1 h-1 bg-indigo-400 rounded-full mt-2"></div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Join the community discussions for help</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-1 h-1 bg-indigo-400 rounded-full mt-2"></div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Complete the deliverable for maximum learning</p>
                                        </div>
                                        <div className="flex items-start gap-2">
                                            <div className="w-1 h-1 bg-indigo-400 rounded-full mt-2"></div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Share your progress to stay motivated</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'my-sprints' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Active Sprints */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Active Sprints</h2>
                                    {enrolledSprints.length > 0 ? (
                                        <div className="space-y-4">
                                            {sprints.filter(sprint => enrolledSprints.includes(sprint.id)).map((sprint) => {
                                                const progress = userProgress.find(p => p.sprintId === sprint.id);
                                                return (
                                                    <div key={sprint.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                        <div className="flex items-start justify-between mb-4">
                                                            <div className="flex-1">
                                                                <div className="flex items-center gap-3 mb-2">
                                                                    <div className="text-2xl">{sprint.thumbnail}</div>
                                                                    <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{sprint.title}</h3>
                                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(sprint.difficulty)}`}>
                                                                        {sprint.difficulty}
                                                                    </span>
                                                                </div>
                                                                <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{sprint.description}</p>
                                                                <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                                    <span>Milestone {progress?.currentMilestone || 0}/{progress?.totalMilestones || 0}</span>
                                                                    <span></span>
                                                                    <span>{progress?.timeSpent || 0} hours spent</span>
                                                                    <span></span>
                                                                    <span>Started {progress?.startDate || 'N/A'}</span>
                                                                </div>
                                                                <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2 mb-4`}>
                                                                    <div 
                                                                        className="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-300"
                                                                        style={{ width: `${progress?.progress || 0}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div className="flex items-center gap-3">
                                                            <button className="flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white py-2 rounded-lg font-medium hover:from-orange-600 hover:to-red-600 transition-all duration-300">
                                                                Continue Sprint
                                                            </button>
                                                            <button 
                                                                onClick={() => handleSprintClick(sprint)}
                                                                className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"
                                                            >
                                                                View Details
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    ) : (
                                        <div className="text-center py-12">
                                            <div className={`w-16 h-16 ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full flex items-center justify-center mx-auto mb-4`}>
                                                <div className={`w-8 h-8 ${isLightMode ? 'text-gray-500' : 'text-gray-400'} text-2xl`}></div>
                                            </div>
                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>No Active Sprints</h3>
                                            <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-6`}>Start a learning sprint to begin your focused learning journey</p>
                                            <button 
                                                onClick={() => setActiveTab('browse')}
                                                className="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-lg font-medium hover:from-orange-600 hover:to-red-600 transition-all duration-300"
                                            >
                                                Browse Sprints
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Completed Sprints */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Completed Sprints</h2>
                                    <div className="space-y-4">
                                        {sprints.filter(sprint => userProgress.find(p => p.sprintId === sprint.id && p.status === 'completed')).map((sprint) => (
                                            <div key={sprint.id} className={`${isLightMode ? 'bg-white border-green-500/30' : 'bg-gray-800 border-green-500/30'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <div className="text-2xl">{sprint.thumbnail}</div>
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{sprint.title}</h3>
                                                            <span className="px-2 py-1 rounded-full text-xs font-medium text-green-400 bg-green-500/20">
                                                                Completed
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{sprint.description}</p>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            <span>Certificate Available</span>
                                                            <span></span>
                                                            <span>100% Complete</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white py-2 rounded-lg font-medium hover:from-green-600 hover:to-emerald-600 transition-all duration-300">
                                                        View Certificate
                                                    </button>
                                                    <button className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200">
                                                        Download
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Current Sprint Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Current Sprint Progress</h3>
                                    <div className="space-y-4">
                                        {enrolledSprints.length > 0 ? (
                                            sprints.filter(sprint => enrolledSprints.includes(sprint.id)).map((sprint) => {
                                                const progress = userProgress.find(p => p.sprintId === sprint.id);
                                                return (
                                                    <div key={sprint.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                        <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{sprint.title}</h4>
                                                        <div className={`flex justify-between text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-2`}>
                                                            <span>Progress</span>
                                                            <span>{progress?.progress || 0}%</span>
                                                        </div>
                                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2 mb-2`}>
                                                            <div 
                                                                className="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-300"
                                                                style={{ width: `${progress?.progress || 0}%` }}
                                                            ></div>
                                                        </div>
                                                        <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            Milestone {progress?.currentMilestone || 0}/{progress?.totalMilestones || 0}
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        ) : (
                                            <p className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'} text-sm`}>No active sprints</p>
                                        )}
                                    </div>
                                </div>

                                {/* Learning Streak */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Learning Streak</h3>
                                    <div className="flex items-center gap-2 mb-4">
                                        {Array.from({ length: 7 }, (_, i) => (
                                            <div key={i} className={`w-8 h-8 rounded-full flex items-center justify-center ${
                                                i < 5 ? 'bg-orange-500' : (isLightMode ? 'bg-gray-200' : 'bg-gray-700')
                                            }`}>
                                                <div className="w-4 h-4 text-white"></div>
                                            </div>
                                        ))}
                                    </div>
                                    <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>5 day streak! Keep it up!</p>
                                </div>

                                {/* Next Recommended Sprint */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Recommended Next</h3>
                                    <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                        <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>AI-Powered Chat Application</h4>
                                        <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>Build an intelligent chat app with OpenAI</p>
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="px-2 py-1 rounded-full text-xs font-medium text-red-400 bg-red-500/20">
                                                advanced
                                            </span>
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>2 weeks</span>
                                        </div>
                                        <button className="w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                            Start Sprint
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'achievements' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Your Achievements</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {achievements.map((achievement) => (
                                            <div key={achievement.id} className={`border rounded-lg p-6 ${
                                                achievement.earned 
                                                    ? 'bg-yellow-500/10 border-yellow-500/30' 
                                                    : (isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700')
                                            }`}>
                                                <div className="flex items-start gap-4">
                                                    <div className={`w-12 h-12 rounded-full flex items-center justify-center ${
                                                        achievement.earned ? 'bg-yellow-500' : (isLightMode ? 'bg-gray-200' : 'bg-gray-700')
                                                    }`}>
                                                        <div className="w-6 h-6 text-white text-xl">{achievement.icon}</div>
                                                    </div>
                                                    <div className="flex-1">
                                                        <h3 className={`text-lg font-semibold mb-2 ${
                                                            achievement.earned ? 'text-yellow-400' : (isLightMode ? 'text-gray-600' : 'text-gray-400')
                                                        }`}>
                                                            {achievement.title}
                                                        </h3>
                                                        <p className={`text-sm mb-2 ${
                                                            achievement.earned ? (isLightMode ? 'text-gray-600' : 'text-gray-300') : (isLightMode ? 'text-gray-500' : 'text-gray-500')
                                                        }`}>
                                                            {achievement.description}
                                                        </p>
                                                        {achievement.earned && (
                                                            <p className="text-xs text-yellow-400">
                                                                Earned on {achievement.earnedDate}
                                                            </p>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Achievement Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Achievement Stats</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Earned</span>
                                            <span className="text-sm font-medium text-yellow-400">2/6</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Completion Rate</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>33%</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Next Achievement</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Full-Stack Developer</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Skill Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Skill Progress</h3>
                                    <div className="space-y-3">
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>React</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>85%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-green-500 h-1.5 rounded-full" style={{ width: '85%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Node.js</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>70%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-blue-500 h-1.5 rounded-full" style={{ width: '70%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-1">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>TypeScript</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>60%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1.5`}>
                                                <div className="bg-yellow-500 h-1.5 rounded-full" style={{ width: '60%' }}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Sprint Detail Modal */}
                    {showSprintDetail && selectedSprint && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-[#111827] border border-gray-700 rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-50">{selectedSprint.title}</h2>
                                    <button
                                        onClick={() => setShowSprintDetail(false)}
                                        className="p-2 bg-gray-700 text-gray-400 rounded-lg hover:bg-gray-600 transition-colors duration-200"
                                    >
                                        <div className="w-5 h-5"></div>
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Sprint Details */}
                                    <div className="space-y-6">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Sprint Details</h3>
                                            <p className="text-gray-300 mb-4">{selectedSprint.description}</p>
                                            <div className="space-y-3">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Deliverable:</span>
                                                    <span className="text-sm text-gray-50">{selectedSprint.deliverable}</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Duration:</span>
                                                    <span className="text-sm text-gray-50">{selectedSprint.duration}</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Estimated Hours:</span>
                                                    <span className="text-sm text-gray-50">{selectedSprint.estimatedHours} hours</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Industry:</span>
                                                    <span className="text-sm text-gray-50">{selectedSprint.industry}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Technology Stack</h3>
                                            <div className="flex flex-wrap gap-2">
                                                {selectedSprint.technology.map((tech) => (
                                                    <span key={tech} className="px-3 py-1 bg-blue-500/20 text-blue-400 text-sm rounded-full">
                                                        {tech}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Skills You'll Learn</h3>
                                            <div className="flex flex-wrap gap-2">
                                                {selectedSprint.skills.map((skill) => (
                                                    <span key={skill} className="px-3 py-1 bg-indigo-500/20 text-indigo-400 text-sm rounded-full">
                                                        {skill}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Prerequisites</h3>
                                            <div className="flex flex-wrap gap-2">
                                                {selectedSprint.prerequisites.map((prereq) => (
                                                    <span key={prereq} className="px-3 py-1 bg-gray-500/20 text-gray-400 text-sm rounded-full">
                                                        {prereq}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Sprint Stats */}
                                    <div className="space-y-6">
                                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Sprint Statistics</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Participants</span>
                                                    <span className="text-sm font-medium text-gray-50">{selectedSprint.participants.toLocaleString()}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Rating</span>
                                                    <span className="text-sm font-medium text-gray-50"> {selectedSprint.rating}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Completion Rate</span>
                                                    <span className="text-sm font-medium text-gray-50">{selectedSprint.completionRate}%</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Difficulty</span>
                                                    <span className={`text-sm font-medium px-2 py-1 rounded-full ${getDifficultyColor(selectedSprint.difficulty)}`}>
                                                        {selectedSprint.difficulty}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="flex items-center gap-4">
                                            {enrolledSprints.includes(selectedSprint.id) ? (
                                                <button className="flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-lg font-medium hover:from-orange-600 hover:to-red-600 transition-all duration-300">
                                                    Continue Sprint
                                                </button>
                                            ) : (
                                                <button 
                                                    onClick={() => handleEnrollSprint(selectedSprint.id)}
                                                    className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300"
                                                >
                                                    Start Sprint
                                                </button>
                                            )}
                                            <button className="bg-gray-700 text-gray-300 px-4 py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200">
                                                Add to Wishlist
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Sprints when sprints-content is shown
        window.renderSprints = function() {
            console.log('renderSprints called');
            const container = document.getElementById('sprints-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Sprints...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<Sprints />);
                    console.log('Sprints rendered successfully');
                } catch (error) {
                    console.error('Error rendering Sprints:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Sprints</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('sprints-container not found');
            }
        };

        // Certifications React Component
        const Certifications = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [selectedCertification, setSelectedCertification] = useState(null);
            const [showCertificationDetail, setShowCertificationDetail] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [filterCategory, setFilterCategory] = useState('all');

            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');
            const [filterLevel, setFilterLevel] = useState('all');

            const certifications = [
                {
                    id: 1,
                    name: 'AWS Certified Solutions Architect',
                    provider: 'Amazon Web Services',
                    category: 'cloud',
                    level: 'intermediate',
                    marketDemand: 95,
                    salaryImpact: '+$15,000',
                    studyTimeEstimate: '3-4 months',
                    passRate: 65,
                    renewalPeriod: '3 years',
                    prerequisites: ['AWS Fundamentals', 'Cloud Architecture Basics'],
                    description: 'Validate your ability to design and implement distributed systems on AWS',
                    officialUrl: 'https://aws.amazon.com/certification/certified-solutions-architect-associate/',
                    cost: '$150',
                    isRecommended: true,
                    userStatus: 'studying',
                    progress: 45,
                    targetDate: '2024-06-15'
                },
                {
                    id: 2,
                    name: 'Certified Kubernetes Administrator (CKA)',
                    provider: 'Cloud Native Computing Foundation',
                    category: 'devops',
                    level: 'intermediate',
                    marketDemand: 88,
                    salaryImpact: '+$12,000',
                    studyTimeEstimate: '2-3 months',
                    passRate: 70,
                    renewalPeriod: '3 years',
                    prerequisites: ['Linux Fundamentals', 'Container Basics'],
                    description: 'Demonstrate your ability to perform the responsibilities of a Kubernetes administrator',
                    officialUrl: 'https://www.cncf.io/certification/cka/',
                    cost: '$395',
                    isRecommended: true,
                    userStatus: 'planning',
                    progress: 0,
                    targetDate: '2024-08-20'
                },
                {
                    id: 3,
                    name: 'CISSP - Certified Information Systems Security Professional',
                    provider: 'ISC',
                    category: 'security',
                    level: 'expert',
                    marketDemand: 92,
                    salaryImpact: '+$20,000',
                    studyTimeEstimate: '6-8 months',
                    passRate: 45,
                    renewalPeriod: '3 years',
                    prerequisites: ['5 years security experience', 'Security Fundamentals'],
                    description: 'The gold standard for information security professionals',
                    officialUrl: 'https://www.isc2.org/Certifications/CISSP',
                    cost: '$749',
                    isRecommended: false,
                    userStatus: 'not-started',
                    progress: 0,
                    targetDate: null
                },
                {
                    id: 4,
                    name: 'PMP - Project Management Professional',
                    provider: 'Project Management Institute',
                    category: 'project-management',
                    level: 'intermediate',
                    marketDemand: 85,
                    salaryImpact: '+$10,000',
                    studyTimeEstimate: '4-6 months',
                    passRate: 60,
                    renewalPeriod: '3 years',
                    prerequisites: ['35 hours project management education', 'Project experience'],
                    description: 'The most important industry-recognized certification for project managers',
                    officialUrl: 'https://www.pmi.org/certifications/project-management-pmp',
                    cost: '$405',
                    isRecommended: false,
                    userStatus: 'completed',
                    progress: 100,
                    targetDate: '2024-03-15'
                },
                {
                    id: 5,
                    name: 'Microsoft Azure Solutions Architect Expert',
                    provider: 'Microsoft',
                    category: 'cloud',
                    level: 'advanced',
                    marketDemand: 78,
                    salaryImpact: '+$13,000',
                    studyTimeEstimate: '4-5 months',
                    passRate: 55,
                    renewalPeriod: '1 year',
                    prerequisites: ['Azure Fundamentals', 'Cloud Architecture'],
                    description: 'Design and implement solutions that run on Microsoft Azure',
                    officialUrl: 'https://learn.microsoft.com/en-us/certifications/azure-solutions-architect/',
                    cost: '$165',
                    isRecommended: false,
                    userStatus: 'scheduled',
                    progress: 80,
                    targetDate: '2024-05-10'
                },
                {
                    id: 6,
                    name: 'Google Cloud Professional Data Engineer',
                    provider: 'Google Cloud',
                    category: 'data',
                    level: 'advanced',
                    marketDemand: 82,
                    salaryImpact: '+$18,000',
                    studyTimeEstimate: '3-4 months',
                    passRate: 68,
                    renewalPeriod: '2 years',
                    prerequisites: ['Data Engineering Fundamentals', 'SQL Knowledge'],
                    description: 'Design and build data processing systems on Google Cloud Platform',
                    officialUrl: 'https://cloud.google.com/certification/data-engineer',
                    cost: '$200',
                    isRecommended: true,
                    userStatus: 'not-started',
                    progress: 0,
                    targetDate: null
                }
            ];

            const userAchievements = [
                {
                    id: 1,
                    certificationId: 4,
                    name: 'PMP - Project Management Professional',
                    score: 85,
                    earnedDate: '2024-03-15',
                    validityPeriod: '2027-03-15',
                    careerImpact: '+$10,000 salary increase'
                }
            ];

            const getCategoryIcon = (category) => {
                switch (category) {
                    case 'cloud': return '';
                    case 'devops': return '';
                    case 'security': return '';
                    case 'programming': return '';
                    case 'project-management': return '';
                    case 'data': return '';
                    default: return '';
                }
            };

            const getCategoryColor = (category) => {
                switch (category) {
                    case 'cloud': return 'text-blue-400 bg-blue-500/20';
                    case 'devops': return 'text-green-400 bg-green-500/20';
                    case 'security': return 'text-red-400 bg-red-500/20';
                    case 'programming': return 'text-purple-400 bg-purple-500/20';
                    case 'project-management': return 'text-orange-400 bg-orange-500/20';
                    case 'data': return 'text-cyan-400 bg-cyan-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getLevelColor = (level) => {
                switch (level) {
                    case 'beginner': return 'text-green-400 bg-green-500/20';
                    case 'intermediate': return 'text-yellow-400 bg-yellow-500/20';
                    case 'advanced': return 'text-orange-400 bg-orange-500/20';
                    case 'expert': return 'text-red-400 bg-red-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'completed': return 'text-green-400 bg-green-500/20';
                    case 'studying': return 'text-blue-400 bg-blue-500/20';
                    case 'planning': return 'text-yellow-400 bg-yellow-500/20';
                    case 'scheduled': return 'text-purple-400 bg-purple-500/20';
                    case 'expired': return 'text-red-400 bg-red-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const handleCertificationClick = (certification) => {
                setSelectedCertification(certification);
                setShowCertificationDetail(true);
            };

            const filteredCertifications = certifications.filter(cert => {
                const matchesSearch = cert.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                                    cert.provider.toLowerCase().includes(searchQuery.toLowerCase());
                const matchesCategory = filterCategory === 'all' || cert.category === filterCategory;
                const matchesLevel = filterLevel === 'all' || cert.level === filterLevel;
                
                return matchesSearch && matchesCategory && matchesLevel;
            });

            const tabs = [
                { id: 'dashboard', label: 'Dashboard', icon: '' },
                { id: 'discover', label: 'Discover', icon: '' },
                { id: 'roadmap', label: 'My Roadmap', icon: '' },
                { id: 'studies', label: 'Active Studies', icon: '' },
                { id: 'achievements', label: 'Achievements', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex space-x-1 overflow-x-auto">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                        activeTab === tab.id
                                            ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                    }`}
                                >
                                    <div className="w-4 h-4">{tab.icon}</div>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'dashboard' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Progress Overview */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Active Certifications</h2>
                                    <div className="space-y-4">
                                        {certifications.filter(cert => cert.userStatus === 'studying' || cert.userStatus === 'scheduled').map((cert) => (
                                            <div key={cert.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <div className="text-2xl">{getCategoryIcon(cert.category)}</div>
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{cert.name}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(cert.userStatus)}`}>
                                                                {cert.userStatus}
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{cert.description}</p>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <span>{cert.provider}</span>
                                                            <span></span>
                                                            <span>Target: {cert.targetDate}</span>
                                                            <span></span>
                                                            <span>{cert.studyTimeEstimate}</span>
                                                        </div>
                                                        <div className="w-full bg-gray-700 rounded-full h-2 mb-4">
                                                            <div 
                                                                className="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-300"
                                                                style={{ width: `${cert.progress}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                        Continue Study
                                                    </button>
                                                    <button 
                                                        onClick={() => handleCertificationClick(cert)}
                                                        className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"
                                                    >
                                                        View Details
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* AI Recommendations */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>AI Recommendations</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {certifications.filter(cert => cert.isRecommended).map((cert) => (
                                            <div key={cert.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:border-indigo-500/50 transition-all duration-300`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <div className="text-2xl">{getCategoryIcon(cert.category)}</div>
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{cert.name}</h3>
                                                            <span className="px-2 py-1 rounded-full text-xs font-medium text-green-400 bg-green-500/20">
                                                                Recommended
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} text-sm mb-3`}>{cert.description}</p>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <span>Market Demand: {cert.marketDemand}%</span>
                                                            <span></span>
                                                            <span>Salary Impact: {cert.salaryImpact}</span>
                                                            <span></span>
                                                            <span>Pass Rate: {cert.passRate}%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white py-2 rounded-lg font-medium hover:from-green-600 hover:to-emerald-600 transition-all duration-300">
                                                        Add to Plan
                                                    </button>
                                                    <button 
                                                        onClick={() => handleCertificationClick(cert)}
                                                        className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"
                                                    >
                                                        Learn More
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Quick Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Stats</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Active Studies</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>2</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Completed</span>
                                            <span className="text-sm font-medium text-green-400">1</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Planning</span>
                                            <span className="text-sm font-medium text-yellow-400">1</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Career Value</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>+$10,000</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Upcoming Deadlines */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Upcoming Deadlines</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>AWS Solutions Architect</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Target: June 15, 2024</p>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1 mt-2`}>
                                                <div className="bg-blue-500 h-1 rounded-full" style={{ width: '45%' }}></div>
                                            </div>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Azure Solutions Architect</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Target: May 10, 2024</p>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-1 mt-2`}>
                                                <div className="bg-blue-500 h-1 rounded-full" style={{ width: '80%' }}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* AI Insights */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>AI Insights</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Market Trends</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Cloud certifications are in high demand with 15% growth this quarter</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Study Tip</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Focus on hands-on labs for AWS certification success</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Next Step</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Consider adding Kubernetes certification to your roadmap</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'discover' && (
                        <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-3 space-y-6">
                                {/* Search and Filters */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Search</label>
                                            <div className="relative">
                                                <input
                                                    type="text"
                                                    value={searchQuery}
                                                    onChange={(e) => setSearchQuery(e.target.value)}
                                                    placeholder="Search certifications..."
                                                    className={`w-full pl-10 pr-4 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900 placeholder-gray-500' : 'bg-gray-800 border-gray-700 text-gray-50 placeholder-gray-400'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                                />
                                                <div className="absolute left-3 top-2.5 w-4 h-4 text-gray-400"></div>
                                            </div>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Category</label>
                                            <select
                                                value={filterCategory}
                                                onChange={(e) => setFilterCategory(e.target.value)}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Categories</option>
                                                <option value="cloud">Cloud</option>
                                                <option value="devops">DevOps</option>
                                                <option value="security">Security</option>
                                                <option value="programming">Programming</option>
                                                <option value="project-management">Project Management</option>
                                                <option value="data">Data</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Level</label>
                                            <select
                                                value={filterLevel}
                                                onChange={(e) => setFilterLevel(e.target.value)}
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            >
                                                <option value="all">All Levels</option>
                                                <option value="beginner">Beginner</option>
                                                <option value="intermediate">Intermediate</option>
                                                <option value="advanced">Advanced</option>
                                                <option value="expert">Expert</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                {/* Certifications Grid */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Available Certifications</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredCertifications.map((cert) => (
                                            <div key={cert.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6 hover:border-indigo-500/50 transition-all duration-300`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <div className="text-2xl">{getCategoryIcon(cert.category)}</div>
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{cert.name}</h3>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} text-sm mb-3`}>{cert.provider}</p>
                                                        <div className="flex items-center gap-2 mb-3">
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getCategoryColor(cert.category)}`}>
                                                                {cert.category}
                                                            </span>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getLevelColor(cert.level)}`}>
                                                                {cert.level}
                                                            </span>
                                                        </div>
                                                        <div className={`space-y-2 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            <div className="flex justify-between">
                                                                <span>Market Demand</span>
                                                                <span className="text-green-400">{cert.marketDemand}%</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>Salary Impact</span>
                                                                <span className="text-green-400">{cert.salaryImpact}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>Study Time</span>
                                                                <span>{cert.studyTimeEstimate}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>Pass Rate</span>
                                                                <span>{cert.passRate}%</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>Cost</span>
                                                                <span>{cert.cost}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <button className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300 text-sm">
                                                        Add to Plan
                                                    </button>
                                                    <button 
                                                        onClick={() => handleCertificationClick(cert)}
                                                        className={`${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} px-3 py-2 rounded-lg font-medium transition-colors duration-200 text-sm`}
                                                    >
                                                        Details
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Popular Certifications */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Popular This Month</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>AWS Solutions Architect</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>+25% interest this month</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Kubernetes Administrator</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>+18% interest this month</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>CISSP Security</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>+12% interest this month</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Career Impact Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Career Impact</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Average Salary Increase</span>
                                            <span className="text-sm font-medium text-green-400">+$15,000</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Job Market Growth</span>
                                            <span className="text-sm font-medium text-blue-400">+22%</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Career Advancement</span>
                                            <span className="text-sm font-medium text-purple-400">85%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'roadmap' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Certification Roadmap</h2>
                                    <div className="space-y-6">
                                        {/* Roadmap Timeline */}
                                        <div className="relative">
                                            <div className={`absolute left-4 top-0 bottom-0 w-0.5 ${isLightMode ? 'bg-gray-300' : 'bg-gray-700'}`}></div>
                                            
                                            {/* Q1 2024 */}
                                            <div className="relative flex items-start gap-6 mb-8">
                                                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center z-10">
                                                    <div className="w-4 h-4 text-white"></div>
                                                </div>
                                                <div className="flex-1">
                                                    <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Q1 2024 - Project Management</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>Completed PMP certification to strengthen project management skills</p>
                                                        <div className="flex items-center gap-2">
                                                            <span className="px-2 py-1 rounded-full text-xs font-medium text-green-400 bg-green-500/20">
                                                                Completed
                                                            </span>
                                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>March 15, 2024</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Q2 2024 */}
                                            <div className="relative flex items-start gap-6 mb-8">
                                                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center z-10">
                                                    <div className="w-4 h-4 text-white"></div>
                                                </div>
                                                <div className="flex-1">
                                                    <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Q2 2024 - Cloud Architecture</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>AWS Solutions Architect certification in progress</p>
                                                        <div className="flex items-center gap-2 mb-3">
                                                            <span className="px-2 py-1 rounded-full text-xs font-medium text-blue-400 bg-blue-500/20">
                                                                In Progress
                                                            </span>
                                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Target: June 15, 2024</span>
                                                        </div>
                                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                            <div className="bg-blue-500 h-2 rounded-full" style={{ width: '45%' }}></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Q3 2024 */}
                                            <div className="relative flex items-start gap-6 mb-8">
                                                <div className="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center z-10">
                                                    <div className="w-4 h-4 text-white"></div>
                                                </div>
                                                <div className="flex-1">
                                                    <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Q3 2024 - DevOps & Containers</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>Kubernetes Administrator certification planned</p>
                                                        <div className="flex items-center gap-2">
                                                            <span className="px-2 py-1 rounded-full text-xs font-medium text-yellow-400 bg-yellow-500/20">
                                                                Planned
                                                            </span>
                                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Target: August 20, 2024</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Q4 2024 */}
                                            <div className="relative flex items-start gap-6">
                                                <div className="w-8 h-8 bg-gray-700 rounded-full flex items-center justify-center z-10">
                                                    <div className="w-4 h-4 text-white"></div>
                                                </div>
                                                <div className="flex-1">
                                                    <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>Q4 2024 - Security</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>CISSP certification to advance security expertise</p>
                                                        <div className="flex items-center gap-2">
                                                            <span className="px-2 py-1 rounded-full text-xs font-medium text-gray-400 bg-gray-500/20">
                                                                Future
                                                            </span>
                                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Target: December 2024</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Goal Setting */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Goal Setting</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Target Date</label>
                                            <input
                                                type="date"
                                                className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}
                                            />
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Study Hours/Week</label>
                                            <select className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}>
                                                <option>5-10 hours</option>
                                                <option>10-15 hours</option>
                                                <option>15-20 hours</option>
                                                <option>20+ hours</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className={`block text-sm font-medium ${isLightMode ? 'text-gray-700' : 'text-gray-300'} mb-2`}>Learning Style</label>
                                            <select className={`w-full px-3 py-2 ${isLightMode ? 'bg-white border-gray-300 text-gray-900' : 'bg-gray-800 border-gray-700 text-gray-50'} border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500`}>
                                                <option>Visual</option>
                                                <option>Hands-on</option>
                                                <option>Reading</option>
                                                <option>Mixed</option>
                                            </select>
                                        </div>
                                        <button className="w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                            Update Goals
                                        </button>
                                    </div>
                                </div>

                                {/* Path Dependencies */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Path Dependencies</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>AWS Fundamentals</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Required for AWS Solutions Architect</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Linux Basics</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Required for Kubernetes Administrator</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Security Experience</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Required for CISSP</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'studies' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Study Progress */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Study Progress</h2>
                                    <div className="space-y-6">
                                        {certifications.filter(cert => cert.userStatus === 'studying' || cert.userStatus === 'scheduled').map((cert) => (
                                            <div key={cert.id} className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <div className="text-2xl">{getCategoryIcon(cert.category)}</div>
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{cert.name}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(cert.userStatus)}`}>
                                                                {cert.userStatus}
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{cert.provider}</p>
                                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                                            <div className="text-center">
                                                                <div className="text-2xl font-bold text-blue-400">{cert.progress}%</div>
                                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Overall Progress</div>
                                                            </div>
                                                            <div className="text-center">
                                                                <div className="text-2xl font-bold text-green-400">12</div>
                                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Study Hours</div>
                                                            </div>
                                                            <div className="text-center">
                                                                <div className="text-2xl font-bold text-yellow-400">3</div>
                                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Practice Tests</div>
                                                            </div>
                                                            <div className="text-center">
                                                                <div className="text-2xl font-bold text-purple-400">85%</div>
                                                                <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Avg Score</div>
                                                            </div>
                                                        </div>
                                                        <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2 mb-4`}>
                                                            <div 
                                                                className="bg-gradient-to-r from-blue-500 to-indigo-500 h-2 rounded-full transition-all duration-300"
                                                                style={{ width: `${cert.progress}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                        Continue Study
                                                    </button>
                                                    <button className="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                                        Practice Test
                                                    </button>
                                                    <button className="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                                        Schedule Exam
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Study Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Study Actions</h3>
                                    <div className="space-y-3">
                                        <button className="w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                            Continue Current Study
                                        </button>
                                        <button className="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                            Take Practice Test
                                        </button>
                                        <button className="w-full bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                            Schedule Exam
                                        </button>
                                        <button className={`w-full ${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} py-2 rounded-lg font-medium transition-colors duration-200`}>
                                            Review Study Materials
                                        </button>
                                    </div>
                                </div>

                                {/* Performance Analytics */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Performance Analytics</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>AWS Architecture</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>85%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-green-500 h-2 rounded-full" style={{ width: '85%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Security</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>70%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-blue-500 h-2 rounded-full" style={{ width: '70%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Networking</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>60%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-yellow-500 h-2 rounded-full" style={{ width: '60%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Storage</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>45%</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-orange-500 h-2 rounded-full" style={{ width: '45%' }}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'achievements' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Completed Certifications</h2>
                                    <div className="space-y-4">
                                        {userAchievements.map((achievement) => {
                                            const cert = certifications.find(c => c.id === achievement.certificationId);
                                            return (
                                                <div key={achievement.id} className={`${isLightMode ? 'bg-white border-green-500/30' : 'bg-gray-800 border-green-500/30'} border rounded-lg p-6`}>
                                                    <div className="flex items-start justify-between mb-4">
                                                        <div className="flex-1">
                                                            <div className="flex items-center gap-3 mb-2">
                                                                <div className="text-2xl">{getCategoryIcon(cert?.category || 'programming')}</div>
                                                                <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{achievement.name}</h3>
                                                                <span className="px-2 py-1 rounded-full text-xs font-medium text-green-400 bg-green-500/20">
                                                                    Completed
                                                                </span>
                                                            </div>
                                                            <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{cert?.provider || 'Professional Certification'}</p>
                                                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                                                <div className="text-center">
                                                                    <div className="text-2xl font-bold text-green-400">{achievement.score}%</div>
                                                                    <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Exam Score</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-2xl font-bold text-blue-400">3</div>
                                                                    <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Years Valid</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-2xl font-bold text-purple-400">2027</div>
                                                                    <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Expires</div>
                                                                </div>
                                                                <div className="text-center">
                                                                    <div className="text-2xl font-bold text-yellow-400">+$10K</div>
                                                                    <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Salary Impact</div>
                                                                </div>
                                                            </div>
                                                            <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                                <span>Earned: {achievement.earnedDate}</span>
                                                                <span></span>
                                                                <span>Valid until: {achievement.validityPeriod}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        <button className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white py-2 rounded-lg font-medium hover:from-green-600 hover:to-emerald-600 transition-all duration-300">
                                                            View Certificate
                                                        </button>
                                                        <button className="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">
                                                            Download
                                                        </button>
                                                        <button className="bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors duration-200">
                                                            Share
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Achievement Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Achievement Stats</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Total Certifications</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>1</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Study Hours</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>120 hours</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Success Rate</span>
                                            <span className="text-sm font-medium text-green-400">100%</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Career Value</span>
                                            <span className="text-sm font-medium text-yellow-400">+$10,000</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Next Milestones */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Next Milestones</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>AWS Solutions Architect</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Complete by June 15, 2024</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Multi-Cloud Expert</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Earn 3 cloud certifications</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white border-gray-200' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Security Specialist</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Complete CISSP certification</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Certification Detail Modal */}
                    {showCertificationDetail && selectedCertification && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-[#111827] border border-gray-700 rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-50">{selectedCertification.name}</h2>
                                    <button
                                        onClick={() => setShowCertificationDetail(false)}
                                        className="p-2 bg-gray-700 text-gray-400 rounded-lg hover:bg-gray-600 transition-colors duration-200"
                                    >
                                        <div className="w-5 h-5"></div>
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    {/* Certification Details */}
                                    <div className="space-y-6">
                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Certification Details</h3>
                                            <p className="text-gray-300 mb-4">{selectedCertification.description}</p>
                                            <div className="space-y-3">
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Provider:</span>
                                                    <span className="text-sm text-gray-50">{selectedCertification.provider}</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Study Time:</span>
                                                    <span className="text-sm text-gray-50">{selectedCertification.studyTimeEstimate}</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Pass Rate:</span>
                                                    <span className="text-sm text-gray-50">{selectedCertification.passRate}%</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Renewal Period:</span>
                                                    <span className="text-sm text-gray-50">{selectedCertification.renewalPeriod}</span>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-sm text-gray-400">Cost:</span>
                                                    <span className="text-sm text-gray-50">{selectedCertification.cost}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Prerequisites</h3>
                                            <div className="flex flex-wrap gap-2">
                                                {selectedCertification.prerequisites.map((prereq) => (
                                                    <span key={prereq} className="px-3 py-1 bg-gray-500/20 text-gray-400 text-sm rounded-full">
                                                        {prereq}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Certification Stats */}
                                    <div className="space-y-6">
                                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                            <h3 className="text-lg font-semibold text-gray-50 mb-4">Market Information</h3>
                                            <div className="space-y-3">
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Market Demand</span>
                                                    <span className="text-sm font-medium text-green-400">{selectedCertification.marketDemand}%</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Salary Impact</span>
                                                    <span className="text-sm font-medium text-green-400">{selectedCertification.salaryImpact}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Category</span>
                                                    <span className={`text-sm font-medium px-2 py-1 rounded-full ${getCategoryColor(selectedCertification.category)}`}>
                                                        {selectedCertification.category}
                                                    </span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span className="text-sm text-gray-400">Level</span>
                                                    <span className={`text-sm font-medium px-2 py-1 rounded-full ${getLevelColor(selectedCertification.level)}`}>
                                                        {selectedCertification.level}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="flex items-center gap-4">
                                            <button className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-indigo-600 transition-all duration-300">
                                                Add to Plan
                                            </button>
                                            <button className="bg-gray-700 text-gray-300 px-4 py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200">
                                                Learn More
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Render Certifications when certifications-content is shown
        window.renderCertifications = function() {
            console.log('renderCertifications called');
            const container = document.getElementById('certifications-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Certifications...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<Certifications />);
                    console.log('Certifications rendered successfully');
                } catch (error) {
                    console.error('Error rendering Certifications:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Certifications</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('certifications-container not found');
            }
        };

        // Skill Benchmarking React Component
        const SkillBenchmarking = () => {
            const [activeTab, setActiveTab] = useState('overview');
            const [selectedRole, setSelectedRole] = useState('frontend-developer');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [showSetup, setShowSetup] = useState(false);

            // Check for light mode
            const isLightMode = !document.documentElement.classList.contains('dark');

            const skills = [
                {
                    id: 1,
                    name: 'React',
                    category: 'Frontend',
                    userLevel: 85,
                    marketDemand: 95,
                    averageLevel: 70,
                    topPerformerLevel: 90,
                    salaryImpact: '+$8,000',
                    trendDirection: 'up',
                    jobPostings: 12500,
                    gap: 5
                },
                {
                    id: 2,
                    name: 'TypeScript',
                    category: 'Frontend',
                    userLevel: 60,
                    marketDemand: 88,
                    averageLevel: 55,
                    topPerformerLevel: 85,
                    salaryImpact: '+$6,000',
                    trendDirection: 'up',
                    jobPostings: 8900,
                    gap: 25
                },
                {
                    id: 3,
                    name: 'Node.js',
                    category: 'Backend',
                    userLevel: 45,
                    marketDemand: 82,
                    averageLevel: 65,
                    topPerformerLevel: 88,
                    salaryImpact: '+$7,000',
                    trendDirection: 'stable',
                    jobPostings: 10200,
                    gap: 40
                },
                {
                    id: 4,
                    name: 'AWS',
                    category: 'Cloud',
                    userLevel: 30,
                    marketDemand: 92,
                    averageLevel: 50,
                    topPerformerLevel: 85,
                    salaryImpact: '+$12,000',
                    trendDirection: 'up',
                    jobPostings: 15600,
                    gap: 55
                },
                {
                    id: 5,
                    name: 'Docker',
                    category: 'DevOps',
                    userLevel: 25,
                    marketDemand: 78,
                    averageLevel: 40,
                    topPerformerLevel: 75,
                    salaryImpact: '+$5,000',
                    trendDirection: 'up',
                    jobPostings: 6800,
                    gap: 50
                },
                {
                    id: 6,
                    name: 'GraphQL',
                    category: 'Backend',
                    userLevel: 20,
                    marketDemand: 65,
                    averageLevel: 35,
                    topPerformerLevel: 70,
                    salaryImpact: '+$4,000',
                    trendDirection: 'stable',
                    jobPostings: 4200,
                    gap: 50
                }
            ];

            const jobRoles = [
                {
                    id: 'frontend-developer',
                    title: 'Frontend Developer',
                    category: 'Development',
                    alignment: 78,
                    averageSalary: '$85,000 - $120,000',
                    jobCount: 15400,
                    topSkills: ['React', 'TypeScript', 'JavaScript', 'CSS', 'HTML'],
                    location: 'Remote/Hybrid'
                },
                {
                    id: 'fullstack-developer',
                    title: 'Full-Stack Developer',
                    category: 'Development',
                    alignment: 65,
                    averageSalary: '$95,000 - $140,000',
                    jobCount: 12800,
                    topSkills: ['React', 'Node.js', 'TypeScript', 'AWS', 'Docker'],
                    location: 'Remote/Hybrid'
                },
                {
                    id: 'devops-engineer',
                    title: 'DevOps Engineer',
                    category: 'Infrastructure',
                    alignment: 45,
                    averageSalary: '$100,000 - $150,000',
                    jobCount: 8900,
                    topSkills: ['AWS', 'Docker', 'Kubernetes', 'CI/CD', 'Linux'],
                    location: 'Remote/Hybrid'
                },
                {
                    id: 'backend-developer',
                    title: 'Backend Developer',
                    category: 'Development',
                    alignment: 55,
                    averageSalary: '$90,000 - $130,000',
                    jobCount: 11200,
                    topSkills: ['Node.js', 'Python', 'AWS', 'GraphQL', 'Database'],
                    location: 'Remote/Hybrid'
                }
            ];

            const recommendations = [
                {
                    id: 1,
                    type: 'skill_gap',
                    title: 'Improve AWS Skills',
                    description: 'Your AWS skills are significantly below market average. Focus on core services like EC2, S3, and Lambda.',
                    priority: 'high',
                    impact: 'High salary increase potential',
                    effort: 'medium',
                    timeline: '3-4 months',
                    actionSteps: ['Complete AWS Fundamentals course', 'Build 2-3 projects using AWS services', 'Take AWS Solutions Architect exam']
                },
                {
                    id: 2,
                    type: 'trending_skill',
                    title: 'Learn Docker & Kubernetes',
                    description: 'Containerization skills are in high demand. Start with Docker basics and progress to Kubernetes.',
                    priority: 'medium',
                    impact: 'Strong market demand',
                    effort: 'low',
                    timeline: '2-3 months',
                    actionSteps: ['Complete Docker fundamentals', 'Build containerized applications', 'Learn Kubernetes basics']
                },
                {
                    id: 3,
                    type: 'career_pivot',
                    title: 'Consider Full-Stack Development',
                    description: 'Your frontend skills are strong. Adding backend skills could open full-stack opportunities.',
                    priority: 'medium',
                    impact: 'Career advancement',
                    effort: 'high',
                    timeline: '6-8 months',
                    actionSteps: ['Strengthen Node.js skills', 'Learn database design', 'Build full-stack projects']
                }
            ];

            const getAlignmentColor = (alignment) => {
                if (alignment >= 80) return 'text-green-400 bg-green-500/20';
                if (alignment >= 60) return 'text-yellow-400 bg-yellow-500/20';
                return 'text-red-400 bg-red-500/20';
            };

            const getGapColor = (gap) => {
                if (gap <= 10) return 'text-green-400 bg-green-500/20';
                if (gap <= 30) return 'text-yellow-400 bg-yellow-500/20';
                return 'text-red-400 bg-red-500/20';
            };

            const getPriorityColor = (priority) => {
                switch (priority) {
                    case 'high': return 'text-red-400 bg-red-500/20';
                    case 'medium': return 'text-yellow-400 bg-yellow-500/20';
                    case 'low': return 'text-green-400 bg-green-500/20';
                    default: return 'text-gray-400 bg-gray-500/20';
                }
            };

            const getTrendIcon = (trend) => {
                switch (trend) {
                    case 'up': return '';
                    case 'down': return '';
                    default: return '';
                }
            };

            const getTrendColor = (trend) => {
                switch (trend) {
                    case 'up': return 'text-green-400';
                    case 'down': return 'text-red-400';
                    default: return 'text-gray-400';
                }
            };

            const handleRunAnalysis = () => {
                setIsAnalyzing(true);
                setTimeout(() => {
                    setIsAnalyzing(false);
                }, 3000);
            };

            const tabs = [
                { id: 'overview', label: 'Overview', icon: '' },
                { id: 'skills', label: 'Skills Analysis', icon: '' },
                { id: 'roles', label: 'Role Comparison', icon: '' },
                { id: 'recommendations', label: 'Recommendations', icon: '' },
                { id: 'progress', label: 'Progress Tracking', icon: '' }
            ];

            return (
                <div className="space-y-8">

                    {/* Navigation Tabs */}
                    <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-2`}>
                        <div className="flex space-x-1 overflow-x-auto">
                            {tabs.map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-300 whitespace-nowrap ${
                                        activeTab === tab.id
                                            ? 'bg-gradient-to-r from-purple-500 to-indigo-600 text-white shadow-lg'
                                            : isLightMode 
                                                ? 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                                : 'text-gray-300 hover:text-white hover:bg-gray-800'
                                    }`}
                                >
                                    <div className="w-4 h-4">{tab.icon}</div>
                                    {tab.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Tab Content */}
                    {activeTab === 'overview' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Market Alignment Dashboard */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Market Alignment Dashboard</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="text-center">
                                            <div className="text-6xl font-bold text-green-400 mb-2">78%</div>
                                            <div className={`text-lg ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Overall Alignment</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Frontend Developer Role</div>
                                        </div>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center">
                                                <span className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Skills Above Average</span>
                                                <span className="text-green-400 font-semibold">2/6</span>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Skills Need Improvement</span>
                                                <span className="text-red-400 font-semibold">4/6</span>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'}`}>Market Demand Match</span>
                                                <span className="text-blue-400 font-semibold">85%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Skills Heatmap */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Skills Heatmap</h2>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                        {skills.map((skill) => (
                                            <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                                <div className="flex items-center justify-between mb-2">
                                                    <h3 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h3>
                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getGapColor(skill.gap)}`}>
                                                        {skill.gap}% gap
                                                    </span>
                                                </div>
                                                <div className="space-y-2">
                                                    <div className="flex justify-between text-sm">
                                                        <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Your Level</span>
                                                        <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.userLevel}%</span>
                                                    </div>
                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                        <div 
                                                            className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                                            style={{ width: `${skill.userLevel}%` }}
                                                        ></div>
                                                    </div>
                                                    <div className="flex justify-between text-sm">
                                                        <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Market Avg</span>
                                                        <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.averageLevel}%</span>
                                                    </div>
                                                    <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                        <div 
                                                            className="bg-green-500 h-2 rounded-full transition-all duration-300"
                                                            style={{ width: `${skill.averageLevel}%` }}
                                                        ></div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Top Skill Gaps */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Top Skill Gaps</h2>
                                    <div className="space-y-4">
                                        {skills.filter(skill => skill.gap > 30).map((skill) => (
                                            <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getGapColor(skill.gap)}`}>
                                                                {skill.gap}% gap
                                                            </span>
                                                            <span className={`text-sm ${getTrendColor(skill.trendDirection)}`}>
                                                                {getTrendIcon(skill.trendDirection)}
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{skill.category}  {skill.jobPostings.toLocaleString()} job postings</p>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            <span>Your Level: {skill.userLevel}%</span>
                                                            <span></span>
                                                            <span>Market Avg: {skill.averageLevel}%</span>
                                                            <span></span>
                                                            <span>Salary Impact: {skill.salaryImpact}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                                                        Improve Skill
                                                    </button>
                                                    <button className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200">
                                                        View Resources
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Quick Stats */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Quick Stats</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills Analyzed</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>6</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Above Average</span>
                                            <span className="text-sm font-medium text-green-400">2</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Need Improvement</span>
                                            <span className="text-sm font-medium text-red-400">4</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Trending Skills</span>
                                            <span className="text-sm font-medium text-blue-400">3</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Market Insights */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Market Insights</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Hot Skills</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>AWS, React, TypeScript trending up</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Your Strengths</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>React and TypeScript above market</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Opportunities</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Cloud skills could boost salary 40%</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Recommended Actions */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Recommended Actions</h3>
                                    <div className="space-y-3">
                                        <button className="w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                                            Run Full Analysis
                                        </button>
                                        <button className="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                            Set Skill Goals
                                        </button>
                                        <button className="w-full bg-blue-600 text-white py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">
                                            Compare Roles
                                        </button>
                                        <button className={`w-full ${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} py-2 rounded-lg font-medium transition-colors duration-200`}>
                                            Export Report
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'skills' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Skills Analysis */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Detailed Skills Analysis</h2>
                                    <div className="space-y-6">
                                        {skills.map((skill) => (
                                            <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className={`text-xl font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getGapColor(skill.gap)}`}>
                                                                {skill.gap}% gap
                                                            </span>
                                                            <span className={`text-sm ${getTrendColor(skill.trendDirection)}`}>
                                                                {getTrendIcon(skill.trendDirection)}
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-4`}>{skill.category}  {skill.jobPostings.toLocaleString()} job postings  {skill.salaryImpact} salary impact</p>
                                                        
                                                        {/* Progress Bars */}
                                                        <div className="space-y-3">
                                                            <div>
                                                                <div className="flex justify-between text-sm mb-1">
                                                                    <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Your Level</span>
                                                                    <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.userLevel}%</span>
                                                                </div>
                                                                <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                                    <div 
                                                                        className="bg-blue-500 h-2 rounded-full transition-all duration-300"
                                                                        style={{ width: `${skill.userLevel}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div className="flex justify-between text-sm mb-1">
                                                                    <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Market Average</span>
                                                                    <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.averageLevel}%</span>
                                                                </div>
                                                                <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                                    <div 
                                                                        className="bg-green-500 h-2 rounded-full transition-all duration-300"
                                                                        style={{ width: `${skill.averageLevel}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div className="flex justify-between text-sm mb-1">
                                                                    <span className="text-gray-400">Top Performers</span>
                                                                    <span className="text-gray-50">{skill.topPerformerLevel}%</span>
                                                                </div>
                                                                <div className="w-full bg-gray-700 rounded-full h-2">
                                                                    <div 
                                                                        className="bg-purple-500 h-2 rounded-full transition-all duration-300"
                                                                        style={{ width: `${skill.topPerformerLevel}%` }}
                                                                    ></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                                                        Improve Skill
                                                    </button>
                                                    <button className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200">
                                                        View Resources
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Skill Categories */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Skill Categories</h3>
                                    <div className="space-y-3">
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Frontend</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>72% avg</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-blue-500 h-2 rounded-full" style={{ width: '72%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Backend</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>45% avg</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-yellow-500 h-2 rounded-full" style={{ width: '45%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Cloud</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>30% avg</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-red-500 h-2 rounded-full" style={{ width: '30%' }}></div>
                                            </div>
                                        </div>
                                        <div>
                                            <div className="flex justify-between mb-2">
                                                <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>DevOps</span>
                                                <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>25% avg</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2`}>
                                                <div className="bg-red-500 h-2 rounded-full" style={{ width: '25%' }}></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Trending Skills */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Trending Skills</h3>
                                    <div className="space-y-3">
                                        {skills.filter(skill => skill.trendDirection === 'up').map((skill) => (
                                            <div key={skill.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                                <div className="flex items-center justify-between">
                                                    <div>
                                                        <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{skill.name}</h4>
                                                        <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{skill.salaryImpact} impact</p>
                                                    </div>
                                                    <div className="text-green-400"></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'roles' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Role Comparison */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Role Comparison</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        {jobRoles.map((role) => (
                                            <div 
                                                key={role.id} 
                                                className={`border rounded-lg p-6 cursor-pointer transition-all duration-300 ${
                                                    selectedRole === role.id 
                                                        ? 'border-indigo-500 bg-indigo-500/10' 
                                                        : isLightMode
                                                            ? 'border-gray-200 bg-white/30 hover:border-gray-300'
                                                            : 'border-gray-700 bg-gray-800 hover:border-gray-600'
                                                }`}
                                                onClick={() => setSelectedRole(role.id)}
                                            >
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{role.title}</h3>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{role.category}  {role.location}</p>
                                                        <div className="flex items-center gap-2 mb-3">
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getAlignmentColor(role.alignment)}`}>
                                                                {role.alignment}% alignment
                                                            </span>
                                                        </div>
                                                        <div className={`space-y-2 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>
                                                            <div className="flex justify-between">
                                                                <span>Salary Range</span>
                                                                <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{role.averageSalary}</span>
                                                            </div>
                                                            <div className="flex justify-between">
                                                                <span>Job Count</span>
                                                                <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{role.jobCount.toLocaleString()}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="mb-4">
                                                    <h4 className={`text-sm font-medium ${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-2`}>Top Skills</h4>
                                                    <div className="flex flex-wrap gap-1">
                                                        {role.topSkills.map((skill) => (
                                                            <span key={skill} className={`px-2 py-1 ${isLightMode ? 'bg-gray-200 text-gray-700' : 'bg-gray-700 text-gray-300'} text-xs rounded-full`}>
                                                                {skill}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                                <button className="w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                                                    View Details
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Selected Role Details */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Selected Role Details</h3>
                                    {(() => {
                                        const role = jobRoles.find(r => r.id === selectedRole);
                                        return role ? (
                                            <div className="space-y-4">
                                                <div>
                                                    <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-2`}>{role.title}</h4>
                                                    <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>{role.category}</p>
                                                </div>
                                                <div className="space-y-2 text-sm">
                                                    <div className="flex justify-between">
                                                        <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Alignment</span>
                                                        <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{role.alignment}%</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Salary Range</span>
                                                        <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{role.averageSalary}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className={`${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Job Count</span>
                                                        <span className={`${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{role.jobCount.toLocaleString()}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ) : null;
                                    })()}
                                </div>

                                {/* Alignment Metrics */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Alignment Metrics</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Technical Skills</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>75%</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Experience Level</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>80%</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Market Demand</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>85%</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Salary Potential</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>70%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'recommendations' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* AI Recommendations */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>AI-Powered Recommendations</h2>
                                    <div className="space-y-6">
                                        {recommendations.map((rec) => (
                                            <div key={rec.id} className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-6`}>
                                                <div className="flex items-start justify-between mb-4">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>{rec.title}</h3>
                                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getPriorityColor(rec.priority)}`}>
                                                                {rec.priority} priority
                                                            </span>
                                                        </div>
                                                        <p className={`${isLightMode ? 'text-gray-600' : 'text-gray-300'} mb-3`}>{rec.description}</p>
                                                        <div className={`flex items-center gap-4 text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'} mb-3`}>
                                                            <span>Impact: {rec.impact}</span>
                                                            <span></span>
                                                            <span>Effort: {rec.effort}</span>
                                                            <span></span>
                                                            <span>Timeline: {rec.timeline}</span>
                                                        </div>
                                                        <div className="mb-4">
                                                            <h4 className="text-sm font-medium text-gray-300 mb-2">Action Steps</h4>
                                                            <ul className="space-y-1">
                                                                {rec.actionSteps.map((step, index) => (
                                                                    <li key={index} className="text-sm text-gray-400 flex items-start gap-2">
                                                                        <span className="text-indigo-400 mt-1"></span>
                                                                        {step}
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <button className="flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                                                        Start Learning
                                                    </button>
                                                    <button className="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors duration-200">
                                                        Add to Goals
                                                    </button>
                                                    <button className="bg-gray-700 text-gray-300 px-4 py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200">
                                                        Learn More
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Impact vs Effort Matrix */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Impact vs Effort</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>High Impact, Low Effort</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Docker & Kubernetes</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>High Impact, High Effort</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>AWS Skills</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Medium Impact, Low Effort</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>GraphQL</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Learning Resources */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Learning Resources</h3>
                                    <div className="space-y-3">
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>AWS Fundamentals</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Free course  20 hours</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Docker Basics</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Interactive tutorial  8 hours</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-3`}>
                                            <h4 className={`font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-1`}>Node.js Advanced</h4>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Project-based  15 hours</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'progress' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Main Content */}
                            <div className="lg:col-span-2 space-y-6">
                                {/* Progress Overview */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Progress Overview</h2>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-green-400 mb-2">+15</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Points Gained</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-blue-400 mb-2">3</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills Improved</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-purple-400 mb-2">12</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Study Hours</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-3xl font-bold text-yellow-400 mb-2">5</div>
                                            <div className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Projects</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Recent Improvements */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Recent Improvements</h2>
                                    <div className="space-y-4">
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <h3 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>React</h3>
                                                <span className="text-green-400 text-sm">+5% this week</span>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Improved from 80% to 85% - now above market average</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <h3 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>TypeScript</h3>
                                                <span className="text-green-400 text-sm">+8% this week</span>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Improved from 52% to 60% - closing the gap</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <h3 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Node.js</h3>
                                                <span className="text-green-400 text-sm">+3% this week</span>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Improved from 42% to 45% - steady progress</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Current Goals */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-8`}>
                                    <h2 className={`text-2xl font-bold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-6`}>Current Goals</h2>
                                    <div className="space-y-4">
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <h3 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>AWS Skills</h3>
                                                <span className="text-blue-400 text-sm">45% complete</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2 mb-2`}>
                                                <div className="bg-blue-500 h-2 rounded-full" style={{ width: '45%' }}></div>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Target: 70% by end of month</p>
                                        </div>
                                        <div className={`${isLightMode ? 'bg-white/30 backdrop-blur-xl border-white/20' : 'bg-gray-800 border-gray-700'} border rounded-lg p-4`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <h3 className={`font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>Docker & Kubernetes</h3>
                                                <span className="text-blue-400 text-sm">20% complete</span>
                                            </div>
                                            <div className={`w-full ${isLightMode ? 'bg-gray-200' : 'bg-gray-700'} rounded-full h-2 mb-2`}>
                                                <div className="bg-blue-500 h-2 rounded-full" style={{ width: '20%' }}></div>
                                            </div>
                                            <p className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Target: 60% by next month</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sidebar */}
                            <div className="space-y-6">
                                {/* Weekly Tracking */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Weekly Tracking</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Study Hours</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>12 hours</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Projects Completed</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>2</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Skills Practiced</span>
                                            <span className={`text-sm font-medium ${isLightMode ? 'text-gray-900' : 'text-gray-50'}`}>4</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className={`text-sm ${isLightMode ? 'text-gray-500' : 'text-gray-400'}`}>Learning Streak</span>
                                            <span className="text-sm font-medium text-green-400">7 days</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Export & Share */}
                                <div className={`${isLightMode ? 'bg-white/50 backdrop-blur-xl border-white/30' : 'bg-[#111827] border-gray-700/50'} border rounded-2xl p-6`}>
                                    <h3 className={`text-lg font-semibold ${isLightMode ? 'text-gray-900' : 'text-gray-50'} mb-4`}>Export & Share</h3>
                                    <div className="space-y-3">
                                        <button className="w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-2 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                                            Download Report
                                        </button>
                                        <button className="w-full bg-blue-600 text-white py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors duration-200">
                                            Share on LinkedIn
                                        </button>
                                        <button className={`w-full ${isLightMode ? 'bg-gray-200 text-gray-700 hover:bg-gray-300' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'} py-2 rounded-lg font-medium transition-colors duration-200`}>
                                            Export Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Setup Modal */}
                    {showSetup && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-[#111827] border border-gray-700 rounded-2xl p-8 max-w-2xl w-full">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-2xl font-bold text-gray-50">Setup Your Profile</h2>
                                    <button
                                        onClick={() => setShowSetup(false)}
                                        className="p-2 bg-gray-700 text-gray-400 rounded-lg hover:bg-gray-600 transition-colors duration-200"
                                    >
                                        <div className="w-5 h-5"></div>
                                    </button>
                                </div>
                                
                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Current Role</label>
                                        <select className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option>Frontend Developer</option>
                                            <option>Backend Developer</option>
                                            <option>Full-Stack Developer</option>
                                            <option>DevOps Engineer</option>
                                            <option>Data Scientist</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Experience Level</label>
                                        <select className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                            <option>Entry Level (0-2 years)</option>
                                            <option>Mid Level (3-5 years)</option>
                                            <option>Senior Level (6-10 years)</option>
                                            <option>Expert Level (10+ years)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Location</label>
                                        <input
                                            type="text"
                                            placeholder="Enter your location"
                                            className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Career Goals</label>
                                        <textarea
                                            placeholder="Describe your career goals and aspirations"
                                            className="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-gray-50 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                            rows={3}
                                        ></textarea>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <button className="flex-1 bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-3 rounded-lg font-medium hover:from-purple-600 hover:to-indigo-600 transition-all duration-300">
                                            Save Profile
                                        </button>
                                        <button 
                                            onClick={() => setShowSetup(false)}
                                            className="bg-gray-700 text-gray-300 px-4 py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };


        // Render Skill Benchmarking when skill-benchmarking-content is shown
        window.renderSkillBenchmarking = function() {
            console.log('renderSkillBenchmarking called');
            const container = document.getElementById('skill-benchmarking-container');
            console.log('Container found:', container);
            
            if (container) {
                try {
                    console.log('Creating React root and rendering Skill Benchmarking...');
                    const root = ReactDOM.createRoot(container);
                    root.render(<SkillBenchmarking />);
                    console.log('Skill Benchmarking rendered successfully');
                } catch (error) {
                    console.error('Error rendering Skill Benchmarking:', error);
                    container.innerHTML = `
                        <div class="text-center py-20">
                            <h2 class="text-2xl font-bold text-slate-800 mb-4">Error loading Skill Benchmarking</h2>
                            <p class="text-slate-600">${error.message}</p>
                        </div>
                    `;
                }
            } else {
                console.error('skill-benchmarking-container not found');
            }
        };
    </script>

    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div id="search-modal-overlay" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div id="search-modal-content" class="relative w-full max-w-4xl bg-white/50 dark:bg-slate-800/60 backdrop-blur-xl rounded-2xl shadow-lg border border-white/30 dark:border-slate-700 m-4 flex flex-col" style="max-height: 90vh;">
            <div class="flex items-center justify-between p-5 flex-shrink-0 border-b border-white/30 dark:border-slate-700">
                <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-100">Search Results</h3>
                <button id="close-search-modal" class="p-2 rounded-lg hover:bg-slate-200/60 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div id="search-results-container" class="overflow-y-auto p-6 flex-grow custom-scrollbar">
                <div class="text-center py-12">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-slate-400 mb-4"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <p class="text-slate-500 dark:text-slate-400">Enter a search query to begin</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Search functionality
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const searchModal = document.getElementById('search-modal');
            const closeSearchModal = document.getElementById('close-search-modal');
            const searchModalOverlay = document.getElementById('search-modal-overlay');
            const searchResultsContainer = document.getElementById('search-results-container');

            let isLoading = false;

            async function performSearch(query) {
                if (!query || query.trim().length === 0 || isLoading) return;

                isLoading = true;
                searchResultsContainer.innerHTML = `
                    <div class="text-center py-12">
                        <div class="inline-block w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                        <p class="text-slate-600 dark:text-slate-400">Searching...</p>
                    </div>
                `;

                try {
                    // Use the Serper API to search
                    const searchData = await SerperSearch.search(query);
                    const results = SerperSearch.formatResults(searchData);
                    SerperSearch.renderResults(results, searchResultsContainer);
                } catch (error) {
                    console.error('Search error:', error);
                    searchResultsContainer.innerHTML = `
                        <div class="text-center py-12">
                            <p class="text-red-600 mb-4">Error performing search: ${error.message}</p>
                            <p class="text-slate-500 text-sm">Please try again later.</p>
                        </div>
                    `;
                } finally {
                    isLoading = false;
                }
            }

            function openSearchModal() {
                searchModal.classList.remove('hidden');
            }

            function closeModal() {
                searchModal.classList.add('hidden');
            }

            // Search button click
            if (searchButton) {
                searchButton.addEventListener('click', () => {
                    const query = searchInput.value.trim();
                    if (query) {
                        performSearch(query);
                        openSearchModal();
                    }
                });
            }

            // Enter key in search input
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const query = searchInput.value.trim();
                        if (query) {
                            performSearch(query);
                            openSearchModal();
                        }
                    }
                });
            }

            // Close modal handlers
            if (closeSearchModal) {
                closeSearchModal.addEventListener('click', closeModal);
            }

            if (searchModalOverlay) {
                searchModalOverlay.addEventListener('click', closeModal);
            }

            // Escape key to close modal
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !searchModal.classList.contains('hidden')) {
                    closeModal();
                }
            });

            // ==================== ACHIEVEMENTS SYSTEM ====================
            
            // Initialize achievements on page load
            let achievementsInitialized = false;
            async function initializeAchievements() {
                if (achievementsInitialized) return;
                achievementsInitialized = true;
                
                // Wait for modules to load
                let retries = 0;
                while (retries < 10 && !window.AchievementService) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    retries++;
                }
                
                await renderRecentAchievements();
            }
            
            // Initialize after page loads
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeAchievements);
            } else {
                setTimeout(initializeAchievements, 500);
            }

            /**
             * Render recent achievements in sidebar
             */
            async function renderRecentAchievements() {
                const container = document.getElementById('recent-achievements-container');
                if (!container) return;

                try {
                    container.innerHTML = '<div class="text-center py-4 text-slate-500 dark:text-slate-400 text-sm"><div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mb-2"></div><p>Loading achievements...</p></div>';

                    let recent = [];
                    if (window.AchievementService) {
                        try {
                            recent = await window.AchievementService.getRecentAchievements(5);
                        } catch (error) {
                            console.warn('Error getting recent achievements:', error);
                            recent = [];
                        }
                    }
                    
                    if (recent.length === 0) {
                        container.innerHTML = '<div class="text-center py-4 text-slate-500 dark:text-slate-400 text-sm"><p>No achievements yet. Complete brand analysis to unlock achievements!</p></div>';
                        return;
                    }

                    container.innerHTML = recent.map(ua => {
                        let def, unlockedDate;
                        if (typeof ua === 'object') {
                            def = ua.achievement_definitions || ua;
                            unlockedDate = new Date(ua.unlocked_at || ua.created_at || Date.now());
                        } else {
                            def = { icon: '', name: 'Achievement' };
                            unlockedDate = new Date();
                        }
                        const dateStr = unlockedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                        
                        return `
                            <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-3 border border-slate-200 dark:border-slate-700">
                                <div class="flex items-center gap-2">
                                    <span class="text-2xl">${def.icon || ''}</span>
                                    <h4 class="font-medium text-slate-800 dark:text-slate-200 text-sm flex-1">${def.name || 'Achievement'}</h4>
                                </div>
                                <p class="text-slate-500 dark:text-slate-400 text-xs mt-1">Unlocked on ${dateStr}</p>
                            </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Error rendering recent achievements:', error);
                    container.innerHTML = '<div class="text-center py-4 text-slate-500 dark:text-slate-400 text-sm"><p>Error loading achievements</p></div>';
                }
            }

            /**
             * Load and render achievements tab
             */
            async function loadAchievementsTab() {
                const container = document.getElementById('achievements-tab-content');
                if (!container) return;

                try {
                    container.innerHTML = '<div class="text-center p-16"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mb-4"></div><p class="text-slate-600 dark:text-slate-400">Loading achievements...</p></div>';

                    // Import achievement modules
                    let getAchievementDefinitions, getAchievementsByCategory, getRarityBadgeColor, AchievementCategories;
                    
                    try {
                        const achievementsModule = await import('/js/achievements.js');
                        getAchievementDefinitions = achievementsModule.getAchievementDefinitions;
                        getAchievementsByCategory = achievementsModule.getAchievementsByCategory;
                        getRarityBadgeColor = achievementsModule.getRarityBadgeColor;
                        AchievementCategories = achievementsModule.AchievementCategories;
                    } catch (error) {
                        console.error('Error loading achievements module:', error);
                        container.innerHTML = '<div class="text-center p-16 bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl"><h3 class="text-xl font-semibold text-slate-800 dark:text-slate-50 mb-2">Error Loading Achievements</h3><p class="text-slate-600 dark:text-slate-400">Please refresh the page.</p></div>';
                        return;
                    }
                    
                    // Get user achievements (will use localStorage fallback if Supabase not available)
                    let userAchievements = [];
                    if (window.AchievementService) {
                        try {
                            userAchievements = await window.AchievementService.fetchUserAchievements();
                        } catch (error) {
                            console.warn('Error fetching achievements, using empty array:', error);
                            userAchievements = [];
                        }
                    } else {
                        console.warn('AchievementService not available, showing all achievements as locked');
                    }

                    const allDefinitions = getAchievementDefinitions();
                    const unlockedCodes = new Set(userAchievements.map(ua => {
                        if (typeof ua === 'string') return ua;
                        return ua.achievement_code || ua.achievement_definitions?.code;
                    }).filter(Boolean));

                    // Current filter state
                    let currentFilter = 'all';
                    let currentSort = 'recent';

                    function renderAchievements(filter = 'all', sort = 'recent') {
                        let filtered = allDefinitions;
                        
                        if (filter !== 'all') {
                            filtered = getAchievementsByCategory(filter);
                        }

                        // Sort achievements
                        if (sort === 'name') {
                            filtered.sort((a, b) => a.name.localeCompare(b.name));
                        } else if (sort === 'rarity') {
                            const rarityOrder = { 'legendary': 4, 'epic': 3, 'rare': 2, 'common': 1 };
                            filtered.sort((a, b) => (rarityOrder[b.rarity] || 0) - (rarityOrder[a.rarity] || 0));
                        } else {
                            // Recent: unlocked first, then by code
                            filtered.sort((a, b) => {
                                const aUnlocked = unlockedCodes.has(a.code);
                                const bUnlocked = unlockedCodes.has(b.code);
                                if (aUnlocked && !bUnlocked) return -1;
                                if (!aUnlocked && bUnlocked) return 1;
                                return a.code.localeCompare(b.code);
                            });
                        }

                        const achievementsHtml = filtered.map(achievement => {
                            const isUnlocked = unlockedCodes.has(achievement.code);
                            const userAchievement = userAchievements.find(ua => (ua.achievement_code || ua.achievement_definitions?.code) === achievement.code);
                            const unlockedDate = userAchievement ? new Date(userAchievement.unlocked_at || userAchievement.created_at) : null;
                            const dateStr = unlockedDate ? unlockedDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '';

                            return `
                                <div class="bg-white/50 dark:bg-slate-800/50 backdrop-blur-xl border ${isUnlocked ? 'border-indigo-300 dark:border-indigo-700' : 'border-slate-200 dark:border-slate-700'} rounded-xl p-6 hover:shadow-lg transition-all duration-300 ${isUnlocked ? '' : 'opacity-60'}" data-achievement-code="${achievement.code}">
                                    <div class="flex items-start gap-4">
                                        <div class="text-4xl flex-shrink-0">${achievement.icon}</div>
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-2">
                                                <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200">${achievement.name}</h3>
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getRarityBadgeColor(achievement.rarity)}">${achievement.rarity}</span>
                                            </div>
                                            <p class="text-slate-600 dark:text-slate-400 mb-3">${achievement.description}</p>
                                            ${isUnlocked ? `
                                                <div class="flex items-center gap-2 text-sm text-green-600 dark:text-green-400">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                                    <span>Unlocked on ${dateStr}</span>
                                                </div>
                                            ` : `
                                                <div class="text-sm text-slate-500 dark:text-slate-400">
                                                    <span>Not unlocked yet</span>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('');

                        const emptyState = filtered.length === 0 ? '<div class="text-center py-12 text-slate-500 dark:text-slate-400"><p>No achievements found in this category.</p></div>' : '';

                        return `
                            <div class="space-y-6">
                                <div class="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
                                    <div>
                                        <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200">Your Achievements</h2>
                                        <p class="text-slate-600 dark:text-slate-400 mt-1">${unlockedCodes.size} of ${allDefinitions.length} unlocked</p>
                                    </div>
                                    <div class="flex gap-2">
                                        <select id="achievement-filter" class="px-4 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-sm text-slate-700 dark:text-slate-200">
                                            <option value="all">All Categories</option>
                                            <option value="${AchievementCategories.BRAND_SCORE}">Brand Score</option>
                                            <option value="${AchievementCategories.ENGAGEMENT}">Engagement</option>
                                            <option value="${AchievementCategories.PROFILE_COMPLETION}">Profile Completion</option>
                                            <option value="${AchievementCategories.CONSISTENCY}">Consistency</option>
                                        </select>
                                        <select id="achievement-sort" class="px-4 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg text-sm text-slate-700 dark:text-slate-200">
                                            <option value="recent">Recent</option>
                                            <option value="name">Name</option>
                                            <option value="rarity">Rarity</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="achievements-grid">
                                    ${emptyState || achievementsHtml}
                                </div>
                            </div>
                        `;
                    }

                    container.innerHTML = renderAchievements(currentFilter, currentSort);

                    // Add event listeners for filters
                    const filterSelect = document.getElementById('achievement-filter');
                    const sortSelect = document.getElementById('achievement-sort');

                    if (filterSelect) {
                        filterSelect.addEventListener('change', (e) => {
                            currentFilter = e.target.value;
                            container.innerHTML = renderAchievements(currentFilter, currentSort);
                            // Re-attach listeners
                            const newFilterSelect = document.getElementById('achievement-filter');
                            const newSortSelect = document.getElementById('achievement-sort');
                            if (newFilterSelect) newFilterSelect.value = currentFilter;
                            if (newSortSelect) {
                                newSortSelect.addEventListener('change', (e) => {
                                    currentSort = e.target.value;
                                    container.innerHTML = renderAchievements(currentFilter, currentSort);
                                });
                            }
                        });
                    }

                    if (sortSelect) {
                        sortSelect.addEventListener('change', (e) => {
                            currentSort = e.target.value;
                            container.innerHTML = renderAchievements(currentFilter, currentSort);
                        });
                    }

                } catch (error) {
                    console.error('Error loading achievements tab:', error);
                    container.innerHTML = '<div class="text-center p-16 bg-white/50 backdrop-blur-xl border border-white/30 shadow-lg rounded-2xl"><h3 class="text-xl font-semibold text-slate-800 dark:text-slate-50 mb-2">Error Loading Achievements</h3><p class="text-slate-600 dark:text-slate-400">' + error.message + '</p></div>';
                }
            }

            /**
             * Check and unlock achievements after brand analysis
             */
            async function checkAndUnlockAchievementsAfterAnalysis(brandMetrics) {
                try {
                    if (!window.AchievementService) {
                        console.warn('Achievement service not available');
                        return;
                    }

                    // Import achievement definitions
                    const { getAchievementDefinitions } = await import('/js/achievements.js');
                    const definitions = getAchievementDefinitions();

                    // Extract metrics from brand score
                    const metrics = {
                        overallScore: brandMetrics.overall || 78,
                        overall: brandMetrics.overall || 78,
                        visibility: 82, // These would come from actual metrics
                        engagement: 75,
                        professional_presence: 80,
                        network_quality: 70,
                        profileCompleteness: 85 // This would come from LinkedIn profile data
                    };

                    // Check and unlock achievements
                    const unlocked = await window.AchievementService.checkAndUnlockAchievements(metrics, definitions);

                    // Show notifications for newly unlocked achievements
                    unlocked.forEach(achievement => {
                        const notification = {
                            id: Date.now() + Math.random(),
                            text: `Achievement Unlocked: ${achievement.name}! ${achievement.description}`,
                            timestamp: "Just now",
                            read: false,
                            sourceId: 'brand-audit',
                            createdAt: Date.now()
                        };
                        notifications.unshift(notification);
                        updateNotificationUI();
                    });

                    // Refresh achievements if tab is open
                    const achievementsTab = document.getElementById('achievements-tab-content');
                    if (achievementsTab && !achievementsTab.classList.contains('hidden')) {
                        await loadAchievementsTab();
                    }

                } catch (error) {
                    console.error('Error checking achievements:', error);
                }
            }
        });
    </script>
</body>
</html>
